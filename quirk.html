<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <meta name="keywords" content="quantum,simulator,circuit,quirk">
        <meta name="description" content="Quirk is a toy quantum circuit simulator for exploring and understanding small quantum circuits.">
        <title>Quirk: Quantum Circuit Simulator</title>
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg==">

        <!-- Whatever is between these start/end analytic tags is stripped by the 'downloading offline copy' code. -->
        <!-- Start Analytics -->
        <script type="text/javascript">

            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-48771413-1']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        <!-- End Analytics -->
    </head>
    <body style="margin: 0">
        <!-- INCLUDE LOADING PART -->

        <!-- Primary content -->
        <div id="inspectorDiv" style="display: none">
            <!-- Buttons -->
            <div style="margin: 5px;">
                <button id="menu-button" style="min-width: 50px; min-height: 30px;">Menu</button>
                &nbsp;
                &nbsp;
                <button id="export-button" style="min-width: 50px; min-height: 30px;">Export</button>
                &nbsp;
                &nbsp;
                <button id="clear-button" style="min-width: 50px; min-height: 30px;">Clear ALL</button>
                &nbsp;
                &nbsp;
                <button id="undo-button" style="min-width: 50px; min-height: 30px;">Undo</button>
                <button id="redo-button" style="min-width: 50px; min-height: 30px;">Redo</button>
                &nbsp;
                &nbsp;
                <button id="gate-forge-button" style="min-width: 50px; min-height: 30px;">Make Gate</button>
            </div>

            <!-- Circuit drawing area -->
            <div id="canvasDiv" style="width: 100%; touch-action: manipulation; tab-index: 0; position: relative;">
                <canvas id="drawCanvas"></canvas>
            </div>

            <div id="export-div" style="display:none;">
    <div id="export-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.5);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <strong>Escaped Link</strong> - Link to current circuit, without special characters that confuse forums.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="100" id="export-link-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-link-copy-result"></span>
            <div style="overflow:auto; word-wrap:break-word; max-height:60px; max-width:600px; border: 1px solid black; padding: 10px; margin: 2px;"><a tabindex="101" id="export-escaped-anchor"></a></div>
        </div>

        <strong>Offline Copy</strong> - Html file containing Quirk and the current circuit.
        <div style="margin: 10px 0 30px 20px;">
            <button tabindex="102" id="download-offline-copy-button" style="width:600px; height:60px;">Download ...</button>
        </div>

        <strong>JSON</strong> - Parsable representation of current circuit.
        <div style="margin: 10px 0 0 20px;">
            <button tabindex="103" id="export-json-copy-button">Copy to Clipboard</button>&nbsp;&nbsp;<span id="export-json-copy-result"></span>
            <br>
            <pre tabindex="104" id="export-circuit-json-pre" style="overflow:auto; max-width:600px; max-height:60px; border: 1px solid black; padding:5px; margin:2px;"></pre>
        </div>
    </div>
</div>


            <div id="gate-forge-div" style="display:none">
    <div id="gate-forge-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.5);">
    </div>
    <div style="position: absolute; top: 20px; left: 50px; padding: 20px; background-color: white; border: 1px solid black;">
        <style scoped>
            th {
                font-size: 20px;
            }
        </style>
        <table cellspacing="0">
            <colgroup>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
                <col/>
                <col style="background-color:#EEE;"/>
            </colgroup>
            <tr>
                <th>From Rotation</th>
                <th></th>
                <th>From Matrix</th>
                <th></th>
                <th>From Circuit</th>
            </tr>
            <tr>
                <td>
                    <input tabindex="100" id='gate-forge-rotation-axis' type="text" size="8" placeholder="X+Z"> axis<br/>
                    <input tabindex="101" id='gate-forge-rotation-angle' type="text" size="8" placeholder="45" style="margin:0.5em 0 0 0;">° angle<br/>
                    <input tabindex="102" id='gate-forge-rotation-phase' type="text" size="8" placeholder="0" style="margin:0.5em 0 0 0;">° phase
                </td>
                <td></td>
                <td>
                    <style scoped>
                        input[type="checkbox"]:not(:checked) + label {
                            font-weight: bold;
                            background-color: pink;
                        }
                    </style>

                    <textarea tabindex="200" id="gate-forge-matrix" cols="25" rows="5" placeholder="1, i,  i, 1"></textarea><br/>

                    <input tabindex="201" id="gate-forge-matrix-fix" type="checkbox" checked>
                    <label for="gate-forge-matrix-fix">ensure unitary (by SVD)</label>
                </td>
                <td></td>
                <td>
                    From part of current circuit:<br/>
                    <input tabindex="300" id="gate-forge-circuit-cols" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0 0;"> column range<br/>
                    <input tabindex="301" id="gate-forge-circuit-rows" type="text" size="4" placeholder="1:∞" style="margin:0.5em 0 0.5em 0;"> wire range<br/>
                    Inputs: <span id="gate-forge-circuit-inputs">(none)</span>, Weight: <span id="gate-forge-circuit-weight">0</span>
                </td>
            </tr>
            <tr>
                <td>
                    <canvas id="gate-forge-rotation-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-matrix-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
                <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>OR</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
                <td>
                    <canvas id="gate-forge-circuit-canvas" style="border:1px black solid;width:195px;height:100px;margin:10px 0 0 0;"></canvas>
                </td>
            </tr>
            <tr>
                <td>
                    <br/><input tabindex="110" id='gate-forge-rotation-name' type="text" placeholder="[the matrix]" style="width:7em;">  circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="210" id='gate-forge-matrix-name' type="text" placeholder="[the matrix]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
                <td></td>
                <td>
                    <br/><input tabindex="310" id='gate-forge-circuit-name' type="text" placeholder="[the circuit]" style="width:7em;"> circuit symbol<br/><br/>
                </td>
            </tr>
            <tr>
                <td>
                    <button tabindex="120" id="gate-forge-rotation-button" style="width:100%;height:30px;">Create Rotation Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="220" id="gate-forge-matrix-button" style="width:100%;height:30px;">Create Matrix Gate</button>
                </td>
                <td></td>
                <td>
                    <button tabindex="320" id="gate-forge-circuit-button" style="width:100%;height:30px;">Create Circuit Gate</button>
                </td>
            </tr>
        </table>
    </div>
</div>

        </div>

        <div id="menu-div" style="display:block;">
    <div id="menu-overlay" style="position:fixed; left: 0; top: 0; height: 100vh; width: 100vw; background: rgba(0, 0, 0, 0.5);">
    </div>
    <div style="position:absolute; top:20px; left:50px; margin:0;">
        <div style="display:inline-block; padding:20px; background-color:white; border:1px solid black; text-align:center;">
            <div style="font-size: 32px;">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJGUlEQVRYw6WXa2xUZRrHf+fM6ZyZdmY6M50yhdJSoLWtWUkLQmvF1W2AaAvpiss2Gy9LrLIJGq/EWyKJbnYDiTHRbDXULWtEN1sNYMuWRaAuKoyASitgOr1bLG1HhplhzrRz6XTOfmjniG3xts/59J7znuf5v+9z+z8CPyBNTU3U1tYCUFFRgc/vswIlQCFQDjimt3qBk0AX0GG32QMul2uWjrlEuNaH5uZmampqKCouShpFNsr3RsPRnLKKsrx0W7pceF1hNkBPb4+il/T+lv0tF2Wj3B0NR/dMq+lwd7oDSV0/GUBjYyN1dXVJ4w/mLMlZs/WRratMVpPV6XTiPuum7NYyPAMeAJyLnZz66BRFy4rweDyEAqFA/av1p4f6h44Cb7g73YGkzpmimwtAd0+31ZHpKF+Qt2D7fXX3bdm2fVvxdddfZ8hakMVA5wCKpFBcWIzP4wMga1EWvaO9iOMiJWUl5OXnGW5ff/vS9PT0m1ApiEVjl10uV8Dr9UZ+FMD0qTevXrP6oYcfebi67NYyvdliBiDoDzIyOsKK0hWkyCn4PX4AbFk2suxZDA8PY7FYMBgNxMZjSDpJnzkv8waz1Zzf4+6RHZkO90wQuquvvbun2wpsvu2O2+599oVny3KX5iLLsra5v78fYpC9OBudqNNuICMrA1Encnn4MoZUA109XTz7xFMcP3WY8+52ll2/PDcj0zGvv7dfdGQ63Dt37oy0tLQAICYDbto/JavXrL7r6e1PL7ekW2YEi4CaUDGZTUiSNMttkiRhMpvQp+nZ9vBjWG8+y7q/DlH90hBvN79Ebl7u8qrfVt0FlNTV1dHc3DwFoKmpSYv2BXkLttx9z92rZxqfQiri9/ixOq3XTClHtoM3X3kL/cJRNj1lwZKlw5wt8OBbaZzo+DcrVq1YXbyseEtRcZG1pqaGpqYmxNraWi3a77zrzg2LixZfI10EImMRzFbzNQFkZmQyOZkgrIQ5dyLM6SaFeFglPqGiTggsK11G5drKDcCDRcVF1tra2ikXACULlyxcs2HTBlMy4GYajxNHVEVMsglp+tGJOnSiTluLiNy4cjme3gm+PDSGIzcFW6qOT5tCqFEjJouJDZs2mPKvz1+TrC3SdIVj6yNbV11tXEBARNSMH3EdQVVVuvq6CIfCRMYjtO5rBaB6YzXGNCPxeJzG3X/H2x/nxD/H6Dk5wZGGELGh+bz8tyew2KZce/+W+1c999hzVFRUIPn8PqtslO81W81WVVUJ+oNcHLmImlDxe/xExiKIqoiqqjAJY74xUuQU7Jl2qmqqprJgXga7d+3mixNfcNp1mrV3rKXugQfoaD+LTtSxueE+iKpc8V3BYrOQZkkz6A363/v8vg4JKImGo0udTidnT54lPBFG1smYzCYKbyjEbDVjkk109XUx5hujdGUpCRIAJMYSSIJEZnYm/X39tH/RzvKVy9n2wjYqVlZwx8bbuXT5EufPnMdkNBGdjGJMMTJ/wfxELBJbBJRI01eic591M2mZpKK0AkOqYVaqhUNhUuQUEiRQUbX3kZQIT/7pST7Y9wGV1ZXc88d7MOgNJEgQJ44tw8Yta24hHo8TGY/ganfhPetN3fLQlryG+oZCCVg3PDL8q9r7azFZTKioCHO0iMh4BHumXVurqEzGJ9n+5Hba2tqoqa3h5V0v4/f6ufzt5TnrRJoljXW3riMUDOH6i2sBsEgCKMgvMHsGPIwyOmd66UQdrftaqaqpIjGWAHUKQOv7rbS1tVFZWcnjzzxO4EIA7xUvB5sPovgUchbmzKlPURQK8gvMhziExC8QSZQYDYyiQ8ejzzzKpt9tIkVIIZ6I/3xdyX6+vna99VoukJCo3liNPdNOQX4B/nE/J988SdnaMuzpdgqWFSAIAgICfb19VG+spvymcuJ8H1BSdygYovVAq5IEcDg3N7fm1EenrD8UhIZUA2ElzDdD3/D5fz+nanMVvl4f8UQcQfgOcHQ8iiHVMOukVwehLqgjOzd7GBiUABrqG3zv/uddvMNeznec19LQ6rRqaWhMMzLoHsTr8XLjb27ElmrjW/VbENBuTERkIjpBmj1tKnCjEZSAQsATIKSEiE5GceqdOJY52P70dh/QJQEdslHu9ng8q0vLS7VCFEvE6DrXpRWiOHFOfXyKmytvxn/JTyQSwa9M8YG+3j6i41EmohOMDo7CEAyeGyQhJDCkGbA5bchWmSXzl2CxWWj/rJ1p6tYh2W32gM/v2xMKhDYKgmBNt6eTbk+fKsU3fFeK9x3ZR9mvy1hUtIjwWBjfJR8Hmw9qpdiQapg6+RAIToHKikokJFTUWbVDCSiBaDi6x26zBySXy0VRcRH1r9afLi0vXZfsByoqk0xqfWHj2o18+P6HFOYXfqfIpwBQflO59m7w3CCVFZUa8FkpGFR47dXXTgO4XC6tG3YM9Q8dPfDegZASVGb9pKIiIZEQEoSiIeLTT87CHHIW5mjrUDREQkhoJ5/L+IH3DoSmyWqHRkjcne4A8Mb+vfsPDLgH5sxXFRVDmgEloFwzp5WAgiHNMKdxgAH3APv37j+QZMoaIWlubsbd6Q4Mfz3c8M7b7xwPXgnO+jlBApvTRsATuCaAgCeAzWnTmtXVErwSZM/be44Pfz3ckJwVNEJSU1NDY2MjQMfxo8f37nhxx5mZIFRUBFEgpISIx+Nz5nlICSGIwqwbCF4JsuPFHWdcR117gY7GxkZtUNFYcUtLC16vN+LIdLgHewfFwcFBkzPDmZtqTtWYsV7SM+oZxZ5hn0XLw6EwIyMjLFm6BIPRoPm868su6l+pP/7J4U/+Bbzp7nQHkox4zrkgCeJC/4XO9o52WVTFxXn5eXpZlpENMr4RH+6LbvLz8r9Hy4+dPIZVbyW3IBdBELSA2/X6rr1fnfnqJeDQdKz9+GS0c+fOyO7G3V/LKXLbZ59+Fjr24THV6XBm+Hw+w7z58/Bd8DFv/jxGvhkhFothtpoZ7h4mZ2mOt6+nL7X7q+7A8089/3HbwbZ/KAHlz+5O9/dmgV88nOqN+j/EwjHH+jvXl07GJ235+flmgK7urouSTlIOthw8Jxvl8f97OP0J4znAuhnbDyeN/pzx/H9hJ0Pb7MiyZAAAAABJRU5ErkJggg=="/>
                Welcome to Quirk
            </div>

            A quantum circuit simulator that runs in your browser.

            <div style="margin:20px;">
                <div id="loading-div" style="color:#D90; font-size:40px; display:block; height:120px; width:344px;">
                    Loading...
                </div>
                <button tabindex="50" id="close-menu-button" style="width:344px; height:120px; font-size:20px; display:none;">Edit Circuit</button>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:4px; margin-right:64px;">
                <a tabindex="51" href="https://www.youtube.com/watch?v=aloFwlBUwsQ">
                    <div style="width:128px;">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAACt0lEQVQoz+3SP09TYRQG8IOL4RsgSNvbv4C4uMAkLgbippEw6CKwqIuGwW/gZEI6kIiDo0MnEk1MmEBLRQFbCnJLa6WlFK6K2kKrBarH55p7TUWa1vgm8pqe5Jc0vbfneZ+8JWYmmUl9+FqBWoFagf+hwP5Jn/TUQw/cgmG4Dz54DH4IQQwSkIaMgf+Q+bu0sStm7PYbWT4je9g4i36meio3a+2eOrgBGeBDKmOcse63Aql29yiwJO79cvjVE+4+YMn0/SyQbHNPA0tm+sfhV9rcdmBJOehNq2sQWFKDFG91eYEl5aXXLS4fsKR8FPM4A8BCtLq3hO2qToCiHqcKLMJOKrW3NnTzZbTFlRO1swKVlt1ODViEr9ks65NPpQor/VeCyx5XQdTuMjSKuBw5YBHMAvoU9/Z4MxzejvdeDOJZUVTGPjlS8UGUYkkBc/JbW7weCGRi53rm8c43kXk6euV0sCgHFTBv46OmcXp8/F3kTNeCyExadDhYlHIFSm/jbTLJqbGx9aWOjoiITFpw2FmUSgXM2/iwscFaIsHRgf7I32ZS2G5nUaopoM+237+61Nm5JCKT5hU7i1LxLxQKaerprrDITAopCotSrsAXVX0f6e4OiswyUdCmsCj7C+wkk9no+QtzeFYUmVOK5qxKDlgEs8CupuWjly7P4LtdUbvLyNGsVdGARSisJArxq9dmZ232gqidFWg0Y7GpwEJYlbywXdVR6UWzbQpYUlP0vNnmA5aUj6aPW73AkvLSsybrALCkBijQZFWAJaWQPlONlgCwZAJkztNGSy+wZHqpdJ4cs4wAS2KEDprJBssgJIEPqU24DnVUbiYamo/AKeiH23AXHsAjmISQIQ4J0CBjyAJX4bPx/idjh27R2DsBD43MUbgDQ3AWjv52YGaWWq1ArUCtQK3Av/UdR/1BF+14cggAAAAASUVORK5CYII=">
                        <div>Tutorial Video</div>
                    </div>
                </a>
            </div>

            <div style="display:inline-block; text-align:center; border:1px solid black; padding:4px;">
                <a tabindex="52" href="https://github.com/Strilanc/Quirk">
                    <div style="width:128px;">
                        <svg version="1.1" viewBox="0 0 16 16" width="48" height="48">
                            <path fill-rule="evenodd"
                                  d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                            </path>
                        </svg>
                        <div>Source Code</div>
                    </div>
                </a>
            </div>
        </div>
        <div style="display:inline-block; vertical-align:top; padding:20px 15px 20px 5px; background-color:#DDD; border:1px solid gray; margin:10px 0 0 -5px;">
            Example Circuits<br><br>
            <a id="example-anchor-grover">Grover Search</a><br><br>
            <a id="example-anchor-teleport">Quantum Teleportation</a><br><br>
            <a id="example-anchor-delayed-erasure">Delayed Choice Erasure</a>
        </div>
    </div>
</div>


        <div id="error-div" style="display:none; font-size:24px; font-family:monospace; color:red;">
    <div id="error-happened-div">An error happened. :(</div>
    <div id="error-message-div" style="font-size: 16px;"></div>
    <div id="error-known-div" style="font-size: 18px;">
        <br>
        <a id="error-known-issue-anchor">See more / complain about this issue on github</a>.
        <br>
        <br>
    </div>
    <div id="error-report-div">
        <br>
        Please report it:
        <ul style="font-size: 18px;">
            <li>
                <a id="error-github-anchor">Create an issue on github</a>
                (requires an account)
                (repository: <a href="https://github.com/Strilanc/Quirk">Strilanc/Quirk</a>)
            </li>
            <li>
                or <a id="error-mailto-anchor"></a>
            </li>
        </ul>
        <br>
        <br>
        Useful details to mention (auto-included if you use the create/email links above):
        <div style="font-size: 16px;">
            <br>
            <div id="error-description-div"></div>
            <br>
            PRE-DRAWN
            <br>
            <img id="error-image-pre" src="#" style="max-height: 250px; max-width: 600px"/>
            <br>
            POST-DRAWN
            <br>
            <img id="error-image-post" src="#" style="max-height: 250px; max-width: 600px"/>
        </div>
    </div>
</div>


        <!-- Javascript detection -->
        <style scoped>
            @keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                from { opacity: 0; }
                95% { opacity: 0; }
                to { opacity: 1; }
            }
            @-webkit-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                from { opacity: 0; }
                95% { opacity: 0; }
                to { opacity: 1; }
            }
            @-moz-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                from { opacity: 0; }
                95% { opacity: 0; }
                to { opacity: 1; }
            }
            @-o-keyframes delay-showing-before-hide-script-can-run-but-then-jump-in {
                from { opacity: 0; }
                95% { opacity: 0; }
                to { opacity: 1; }
            }

            .noscript-warning {
                color: red;
                font-size: 24px;
                position: absolute;
                top: 25%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        </style>
        <div id="noscript-div" class="noscript-warning" style="
                        animation-duration: 3.0s;
                   -moz-animation-duration: 3.0s;
                -webkit-animation-duration: 3.0s;
                     -o-animation-duration: 3.0s;
                        animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                   -moz-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                -webkit-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                     -o-animation-name: delay-showing-before-hide-script-can-run-but-then-jump-in;
                      background-color:white;
                                border:1px solid red">
            You appear to have JavaScript blocked. But Quirk is made out of JavaScript... :(
        </div>
        <script>
          document.getElementById('noscript-div').style.display = 'none';
        </script>

        <script>
          document.getElementById('noscript-div').style.display = 'block';
          //noinspection InnerHTMLJS
          document.QUIRK_QUINE_ALL_HTML_ORIGINAL = '<!'+'DOCTYPE html>\n<'+'html>\n    ' +
                  document.documentElement.innerHTML + '\n<' + '/html>';
          document.getElementById('noscript-div').style.display = 'none';
//DEFAULT_CIRCUIT_START
document.DEFAULT_CIRCUIT = undefined;
//DEFAULT_CIRCUIT_END

// UN-MINIFIED SOURCE IS AVAILABLE FROM github.com/Strilanc/Quirk

!function(a){"use strict";function b(a){a.Reflect=a.Reflect||{},a.Reflect.global=a.Reflect.global||a}if(!a.$traceurRuntime){b(a);var c=function(a){
return typeof a};a.$traceurRuntime={options:{},setupGlobals:b,"typeof":c}}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),
function(){function a(a,b,c,d,e,f,g){var h=[];return a&&h.push(a,":"),c&&(h.push("//"),b&&h.push(b,"@"),h.push(c),d&&h.push(":",d)),
e&&h.push(e),f&&h.push("?",f),g&&h.push("#",g),h.join("")}function b(a){return a.match(h)}function c(a){if("/"===a)return"/";for(var b="/"===a[0]?"/":"",c="/"===a.slice(-1)?"/":"",d=a.split("/"),e=[],f=0,g=0;g<d.length;g++){
var h=d[g];switch(h){case"":case".":break;case"..":e.length?e.pop():f++;break;default:e.push(h)}}if(!b){for(;f-- >0;)e.unshift("..");
0===e.length&&e.push(".")}return b+e.join("/")+c}function d(b){var d=b[i.PATH]||"";return d=c(d),b[i.PATH]=d,a(b[i.SCHEME],b[i.USER_INFO],b[i.DOMAIN],b[i.PORT],b[i.PATH],b[i.QUERY_DATA],b[i.FRAGMENT]);
}function e(a){var c=b(a);return d(c)}function f(a,c){var e=b(c),f=b(a);if(e[i.SCHEME])return d(e);e[i.SCHEME]=f[i.SCHEME];for(var g=i.SCHEME;g<=i.PORT;g++)e[g]||(e[g]=f[g]);
if("/"==e[i.PATH][0])return d(e);var h=f[i.PATH],j=h.lastIndexOf("/");return h=h.slice(0,j+1)+e[i.PATH],e[i.PATH]=h,d(e)}function g(a){
if(!a)return!1;if("/"===a[0])return!0;var c=b(a);return!!c[i.SCHEME]}var h=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),i={
SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7};$traceurRuntime.canonicalizeUrl=e,$traceurRuntime.isAbsolute=g,
$traceurRuntime.removeDotSegments=c,$traceurRuntime.resolveUrl=f}(),function(a){"use strict";function b(a,b){this.url=a,this.value_=b;
}function c(a,b){this.message=this.constructor.name+": "+this.stripCause(b)+" in "+a,b instanceof c||!b.stack?this.stack="":this.stack=this.stripStack(b.stack);
}function d(a,b){var c=[],d=b-3;d<0&&(d=0);for(var e=d;e<b;e++)c.push(a[e]);return c}function e(a,b){var c=b+1;c>a.length-1&&(c=a.length-1);
for(var d=[],e=b;e<=c;e++)d.push(a[e]);return d}function f(a){for(var b="",c=0;c<a-1;c++)b+="-";return b}function g(a,c){b.call(this,a,null),
this.func=c}function h(a){if(a){var b=r.normalize(a);return o[b]}}function i(a){var b=arguments[1],c=Object.create(null);return Object.getOwnPropertyNames(a).forEach(function(d){
var e,f;if(b===q){var g=Object.getOwnPropertyDescriptor(a,d);g.get&&(e=g.get)}e||(f=a[d],e=function(){return f}),Object.defineProperty(c,d,{
get:e,enumerable:!0})}),Object.preventExtensions(c),c}var j,k=$traceurRuntime,l=k.canonicalizeUrl,m=k.resolveUrl,n=k.isAbsolute,o=Object.create(null);
j=a.location&&a.location.href?m(a.location.href,"./"):"",c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c.prototype.stripError=function(a){
return a.replace(/.*Error:/,this.constructor.name+":")},c.prototype.stripCause=function(a){return a?a.message?this.stripError(a.message):a+"":"";
},c.prototype.loadedBy=function(a){this.stack+="\n loaded by "+a},c.prototype.stripStack=function(a){var b=[];return a.split("\n").some(function(a){
return!!/UncoatedModuleInstantiator/.test(a)||void b.push(a)}),b[0]=this.stripError(b[0]),b.join("\n")},g.prototype=Object.create(b.prototype),
g.prototype.getUncoatedModule=function(){var b=this;if(this.value_)return this.value_;try{var g;return void 0!==typeof $traceurRuntime&&$traceurRuntime.require&&(g=$traceurRuntime.require.bind(null,this.url)),
this.value_=this.func.call(a,g)}catch(h){if(h instanceof c)throw h.loadedBy(this.url),h;if(h.stack){var i=this.func.toString().split("\n"),j=[];
h.stack.split("\n").some(function(a,c){if(a.indexOf("UncoatedModuleInstantiator.getUncoatedModule")>0)return!0;var g=/(at\s[^\s]*\s).*>:(\d*):(\d*)\)/.exec(a);
if(g){var h=parseInt(g[2],10);j=j.concat(d(i,h)),1===c?j.push(f(g[3])+"^ "+b.url):j.push(f(g[3])+"^"),j=j.concat(e(i,h)),j.push("= = = = = = = = =");
}else j.push(a)}),h.stack=j.join("\n")}throw new c(this.url,h)}};var p=Object.create(null),q={},r={normalize:function(a,b,c){if("string"!=typeof a)throw new TypeError("module name must be a string, not "+typeof a);
if(n(a))return l(a);if(/[^\.]\/\.\.\//.test(a))throw new Error("module name embeds /../: "+a);return"."===a[0]&&b?m(b,a):l(a)},get:function(a){
var b=h(a);if(b){var c=p[b.url];return c?c:(c=i(b.getUncoatedModule(),q),p[b.url]=c)}},set:function(a,b){a=String(a),o[a]=new g(a,function(){
return b}),p[a]=b},get baseURL(){return j},set baseURL(a){j=String(a)},registerModule:function(a,b,c){var d=r.normalize(a);if(o[d])throw new Error("duplicate module named "+d);
o[d]=new g(d,c)},bundleStore:Object.create(null),register:function(a,b,c){b&&(b.length||c.length)?this.bundleStore[a]={deps:b,execute:function(){
var a=arguments,d={};b.forEach(function(b,c){return d[b]=a[c]});var e=c.call(this,d);return e.execute.call(this),e.exports}}:this.registerModule(a,b,c);
},getAnonymousModule:function(a){return new i(a(),q)}},s=new i({ModuleStore:r});r.set("@traceur/src/runtime/ModuleStore.js",s);var t=$traceurRuntime.setupGlobals;
$traceurRuntime.setupGlobals=function(a){t(a)},$traceurRuntime.ModuleStore=r,$traceurRuntime.registerModule=r.registerModule.bind(r),
$traceurRuntime.getModule=r.get,$traceurRuntime.setModule=r.set,$traceurRuntime.normalizeModuleName=r.normalize}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/new-unique-string.js",[],function(){"use strict";function a(){
return"__$"+(1e9*b()>>>1)+"$"+ ++c+"$__"}var b=Math.random,c=Date.now()%1e9;return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/has-native-symbols.js",[],function(){
"use strict";function a(){return b}var b=!!Object.getOwnPropertySymbols&&"function"==typeof Symbol;return{get default(){return a}
}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/symbols.js",[],function(){"use strict";function a(a){
return{configurable:!0,enumerable:!1,value:a,writable:!0}}function b(a){var b=i();l(this,s,{value:this}),l(this,q,{value:b}),l(this,r,{
value:a}),m(this),t[b]=this}function c(a){return t[a]}function d(a){for(var b=[],d=0;d<a.length;d++)c(a[d])||b.push(a[d]);return b;
}function e(a){return d(n(a))}function f(a){return d(o(a))}function g(a){for(var b=[],c=n(a),d=0;d<c.length;d++){var e=t[c[d]];e&&b.push(e);
}return b}function h(b){var c=b.Object;j()||(b.Symbol=u,c.getOwnPropertyNames=e,c.keys=f,l(c,"getOwnPropertySymbols",a(g))),b.Symbol.iterator||(b.Symbol.iterator=b.Symbol("Symbol.iterator")),
b.Symbol.observer||(b.Symbol.observer=b.Symbol("Symbol.observer"))}var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../new-unique-string.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js"))["default"],j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/modules/symbols.js"))["default"],k=Object.create,l=Object.defineProperty,m=Object.freeze,n=Object.getOwnPropertyNames,o=Object.keys,p=TypeError,q=i(),r=i(),s=i(),t=k(null),u=function(a){
var c=new b(a);if(!(this instanceof u))return c;throw new p("Symbol cannot be new'ed")};l(u.prototype,"constructor",a(u)),l(u.prototype,"toString",a(function(){
var a=this[s];return a[q]})),l(u.prototype,"valueOf",a(function(){var a=this[s];if(!a)throw p("Conversion from symbol to string");
return a[q]})),l(b.prototype,"constructor",a(u)),l(b.prototype,"toString",{value:u.prototype.toString,enumerable:!1}),l(b.prototype,"valueOf",{
value:u.prototype.valueOf,enumerable:!1}),m(b.prototype);var v="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0;
h(v);var w=j()?function(a){return typeof a}:function(a){return a instanceof b?"symbol":typeof a};return{get typeof(){return w}}}),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/typeof.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/modules/typeof.js"));
return{get default(){return a["typeof"]}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/symbols.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/typeof.js","traceur-runtime@0.0.111/src/runtime/symbols.js"))["default"];
return $traceurRuntime["typeof"]=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createClass.js",[],function(){
"use strict";function a(a,b){m(a).forEach(b),n&&n(a).forEach(b)}function b(b){var c={};return a(b,function(a){c[a]=l(b,a),c[a].enumerable=!1;
}),c}function c(b){a(b,function(a){k(b,a,o)})}function d(a,d,f,g){return k(d,"constructor",{value:a,configurable:!0,enumerable:!1,
writable:!0}),arguments.length>3?("function"==typeof g&&(a.__proto__=g),a.prototype=i(e(g),b(d))):(c(d),a.prototype=d),k(a,"prototype",{
configurable:!1,writable:!1}),j(a,b(f))}function e(a){if("function"==typeof a){var b=a.prototype;if(f(b)===b||null===b)return a.prototype;
throw new g("super prototype must be an Object or null")}if(null===a)return null;throw new g("Super expression must either be null or a function, not "+typeof a+".");
}var f=Object,g=TypeError,h=Object,i=h.create,j=h.defineProperties,k=h.defineProperty,l=h.getOwnPropertyDescriptor,m=h.getOwnPropertyNames,n=h.getOwnPropertySymbols,o={
enumerable:!1};return{get default(){return d}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superConstructor.js",[],function(){
"use strict";function a(a){return a.__proto__}return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superDescriptor.js",[],function(){
"use strict";function a(a,b){var e=d(a);do{var f=c(e,b);if(f)return f;e=d(e)}while(e)}var b=Object,c=b.getOwnPropertyDescriptor,d=b.getPrototypeOf;
return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superGet.js",[],function(){
"use strict";function a(a,c,d){var e=b(c,d);if(e){var f=e.value;return f?f:e.get?e.get.call(a):f}}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superGet.js"))["default"];
return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/superSet.js",[],function(){
"use strict";function a(a,d,e,f){var g=b(d,e);if(g&&g.set)return g.set.call(a,f),f;throw c("super has no setter '"+e+"'.")}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./superDescriptor.js","traceur-runtime@0.0.111/src/runtime/modules/superSet.js"))["default"],c=TypeError;
return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/classes.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createClass.js","traceur-runtime@0.0.111/src/runtime/classes.js"))["default"],b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superConstructor.js","traceur-runtime@0.0.111/src/runtime/classes.js"))["default"],c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superGet.js","traceur-runtime@0.0.111/src/runtime/classes.js"))["default"],d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/superSet.js","traceur-runtime@0.0.111/src/runtime/classes.js"))["default"];
return $traceurRuntime.createClass=a,$traceurRuntime.superConstructor=b,$traceurRuntime.superGet=c,$traceurRuntime.superSet=d,{}}),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/exportStar.js",[],function(){"use strict";function a(a){
for(var b=arguments,e=function(e){var f,g=b[e],h=d(g),i=function(b){var d=h[b];return"__esModule"===d||"default"===d?0:void c(a,d,{
get:function(){return g[d]},enumerable:!0})};a:for(var j=0;j<h.length;j++)switch(f=i(j)){case 0:continue a}},f=1;f<arguments.length;f++)e(f);
return a}var b=Object,c=b.defineProperty,d=b.getOwnPropertyNames;return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/exportStar.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/exportStar.js","traceur-runtime@0.0.111/src/runtime/exportStar.js"))["default"];
return $traceurRuntime.exportStar=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-symbol.js",[],function(){
"use strict";function a(a){return l[a]}function b(){var a=(i||h)();return l[a]=!0,a}function c(a,b){return hasOwnProperty.call(a,b);
}function d(a,b){return!!c(a,b)&&(delete a[b],!0)}function e(a,b,c){a[b]=c}function f(a,b){var c=a[b];if(void 0!==c)return hasOwnProperty.call(a,b)?c:void 0;
}function g(){j&&(Object.getOwnPropertySymbols=function(b){for(var c=[],d=j(b),e=0;e<d.length;e++){var f=d[e];a(f)||c.push(f)}return c;
})}var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./new-unique-string.js","traceur-runtime@0.0.111/src/runtime/private-symbol.js"))["default"],i="function"==typeof Symbol?Symbol:void 0,j=Object.getOwnPropertySymbols,k=Object.create,l=k(null);
return{get isPrivateSymbol(){return a},get createPrivateSymbol(){return b},get hasPrivate(){return c},get deletePrivate(){return d;
},get setPrivate(){return e},get getPrivate(){return f},get init(){return g}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private-weak-map.js",[],function(){
"use strict";function a(a){return!1}function b(){return new h}function c(a,b){return b.has(a)}function d(a,b){return b["delete"](a);
}function e(a,b,c){b.set(a,c)}function f(a,b){return b.get(a)}function g(){}var h="function"==typeof WeakMap?WeakMap:void 0;return{
get isPrivateSymbol(){return a},get createPrivateSymbol(){return b},get hasPrivate(){return c},get deletePrivate(){return d},get setPrivate(){
return e},get getPrivate(){return f},get init(){return g}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/private.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-symbol.js","traceur-runtime@0.0.111/src/runtime/private.js")),b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./private-weak-map.js","traceur-runtime@0.0.111/src/runtime/private.js")),c="function"==typeof WeakMap,d=c?b:a,e=d.isPrivateSymbol,f=d.createPrivateSymbol,g=d.hasPrivate,h=d.deletePrivate,i=d.setPrivate,j=d.getPrivate;
return d.init(),{get isPrivateSymbol(){return e},get createPrivateSymbol(){return f},get hasPrivate(){return g},get deletePrivate(){
return h},get setPrivate(){return i},get getPrivate(){return j}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js",[],function(){
"use strict";function a(a,b,c){return[o,a,b,c]}function b(a){return a&&a[0]===o}function c(a,b,c){for(var d=[b],e=0;e<c.length;e++)d[e+1]=c[e];
var f=n(Function.prototype.bind,a,d);return f}function d(a,b){var d=new(c(a,null,b));return d}function e(a){return!!k(a,p)}function f(c,d,f){
var g=f[0];if(b(g))return g=n(c,d,g[3]);for(g=a(c,d,f);;){if(g=e(c)?n(c,g[2],[g]):n(c,g[2],g[3]),!b(g))return g;c=g[1]}}function g(){
var b;return b=e(this)?d(this,[a(null,null,arguments)]):d(this,arguments)}function h(){p=m(),Function.prototype.call=i(function(b){
var c=f(function(b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];var e=a(this,b,c);return e},this,arguments);return c;
}),Function.prototype.apply=i(function(b,c){var d=f(function(b,c){var d=a(this,b,c);return d},this,arguments);return d})}function i(a){
return null===p&&h(),l(a,p,!0),a}var j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/properTailCalls.js")),k=j.getPrivate,l=j.setPrivate,m=j.createPrivateSymbol,n=Function.prototype.call.bind(Function.prototype.apply),o=Object.create(null),p=null;
return{get createContinuation(){return a},get tailCall(){return f},get construct(){return g},get initTailRecursiveFunction(){return i;
}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/initTailRecursiveFunction.js"));
return{get default(){return a.initTailRecursiveFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/call.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/call.js"));
return{get default(){return a.tailCall}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/continuation.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/continuation.js"));
return{get default(){return a.createContinuation}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/construct.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/modules/construct.js"));
return{get default(){return a.construct}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/properTailCalls.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initTailRecursiveFunction.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js"))["default"],b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/call.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js"))["default"],c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/continuation.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js"))["default"],d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/construct.js","traceur-runtime@0.0.111/src/runtime/properTailCalls.js"))["default"];
return $traceurRuntime.initTailRecursiveFunction=a,$traceurRuntime.call=b,$traceurRuntime.continuation=c,$traceurRuntime.construct=d,
{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/relativeRequire.js",[],function(){"use strict";function a(a,c){
function d(a){return"/"===a.slice(-1)}function e(a){return"/"===a[0]}function f(a){return"."===a[0]}if(b=b||"undefined"!=typeof require&&require("path"),
!d(c)&&!e(c))return f(c)?require(b.resolve(b.dirname(a),c)):require(c)}var b;return $traceurRuntime.require=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/checkObjectCoercible.js",[],function(){
"use strict";function a(a){if(null===a||void 0===a)throw new b("Value cannot be converted to an Object");return a}var b=TypeError;
return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spread.js",[],function(){
"use strict";function a(){for(var a,c=[],d=0,e=0;e<arguments.length;e++){var f=b(arguments[e]);if("function"!=typeof f[Symbol.iterator])throw new TypeError("Cannot spread non-iterable object.");
for(var g=f[Symbol.iterator]();!(a=g.next()).done;)c[d++]=a.value}return c}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/modules/spread.js"))["default"];
return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spread.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spread.js","traceur-runtime@0.0.111/src/runtime/spread.js"))["default"];
return $traceurRuntime.spread=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/iteratorToArray.js",[],function(){
"use strict";function a(a){for(var b,c=[],d=0;!(b=a.next()).done;)c[d++]=b.value;return c}return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/destructuring.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/iteratorToArray.js","traceur-runtime@0.0.111/src/runtime/destructuring.js"))["default"];
return $traceurRuntime.iteratorToArray=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/async.js",[],function(){
"use strict";function a(){}function b(){}function c(a){return a.prototype=m(b.prototype),a.__proto__=b,a}function d(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];
var e=m(b.prototype);return k(e,o,a),e}function e(a,b){return new Promise(function(c,d){var e=a({next:function(a){return b.call(e,a);
},"throw":function(a){d(a)},"return":function(a){c(a)}})})}function f(a){return Promise.resolve().then(a)}function g(a,b){return new s(a,b);
}var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/async.js")),i=h.createPrivateSymbol,j=h.getPrivate,k=h.setPrivate,l=Object,m=l.create,n=l.defineProperty,o=i();
a.prototype=b,b.constructor=a,n(b,"constructor",{enumerable:!1});var p=function(){function a(a){var b=this;this.decoratedObserver=g(a,function(){
b.done=!0}),this.done=!1,this.inReturn=!1}return $traceurRuntime.createClass(a,{"throw":function(a){if(!this.inReturn)throw a},"yield":function(a){
if(this.done)throw void(this.inReturn=!0);var b;try{b=this.decoratedObserver.next(a)}catch(c){throw this.done=!0,c}if(void 0!==b){
if(b.done)throw this.done=!0,void(this.inReturn=!0);return b.value}},yieldFor:function(a){var b=this;return e(a[Symbol.observer].bind(a),function(a){
if(b.done)return void this["return"]();var c;try{c=b.decoratedObserver.next(a)}catch(d){throw b.done=!0,d}if(void 0!==c)return c.done&&(b.done=!0),
c})}},{})}();b.prototype[Symbol.observer]=function(a){var b=j(this,o),c=new p(a);return f(function(){return b(c)}).then(function(a){
c.done||c.decoratedObserver["return"](a)})["catch"](function(a){c.done||c.decoratedObserver["throw"](a)}),c.decoratedObserver},n(b.prototype,Symbol.observer,{
enumerable:!1});var q=Symbol(),r=Symbol(),s=function(){function a(a,b){this[q]=a,this[r]=b}return $traceurRuntime.createClass(a,{
next:function(a){var b=this[q].next(a);return void 0!==b&&b.done&&this[r].call(this),b},"throw":function(a){return this[r].call(this),
this[q]["throw"](a)},"return":function(a){return this[r].call(this),this[q]["return"](a)}},{})}();return Array.prototype[Symbol.observer]=function(a){
var b=!1,c=g(a,function(){return b=!0}),d=!0,e=!1,f=void 0;try{for(var h=void 0,i=this[Symbol.iterator]();!(d=(h=i.next()).done);d=!0){
var j=h.value;if(c.next(j),b)return}}catch(k){e=!0,f=k}finally{try{d||null==i["return"]||i["return"]()}finally{if(e)throw f}}return c["return"](),
c},n(Array.prototype,Symbol.observer,{enumerable:!1}),{get initAsyncGeneratorFunction(){return c},get createAsyncGeneratorInstance(){
return d},get observeForEach(){return e},get schedule(){return f},get createDecoratedGenerator(){return g}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/initAsyncGeneratorFunction.js"));
return{get default(){return a.initAsyncGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createAsyncGeneratorInstance.js"));
return{get default(){return a.createAsyncGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/observeForEach.js"));
return{get default(){return a.observeForEach}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/schedule.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/schedule.js"));
return{get default(){return a.schedule}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/modules/createDecoratedGenerator.js"));
return{get default(){return a.createDecoratedGenerator}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/async.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initAsyncGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/async.js"))["default"],b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createAsyncGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/async.js"))["default"],c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/observeForEach.js","traceur-runtime@0.0.111/src/runtime/async.js"))["default"],d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/schedule.js","traceur-runtime@0.0.111/src/runtime/async.js"))["default"],e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createDecoratedGenerator.js","traceur-runtime@0.0.111/src/runtime/async.js"))["default"];
return $traceurRuntime.initAsyncGeneratorFunction=a,$traceurRuntime.createAsyncGeneratorInstance=b,$traceurRuntime.observeForEach=c,
$traceurRuntime.schedule=d,$traceurRuntime.createDecoratedGenerator=e,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/generators.js",[],function(){
"use strict";function a(a){return{configurable:!0,enumerable:!1,value:a,writable:!0}}function b(a){return new Error("Traceur compiler bug: invalid state in state machine: "+a);
}function c(){this.state=0,this.GState=v,this.storedException=void 0,this.finallyFallThrough=void 0,this.sent_=void 0,this.returnValue=void 0,
this.oldReturnValue=void 0,this.tryStack_=[]}function d(a,b,c,d){switch(a.GState){case w:throw new Error('"'+c+'" on executing generator');
case y:if("next"==c)return{value:void 0,done:!0};if(d===B)return{value:a.returnValue,done:!0};throw d;case v:if("throw"===c){if(a.GState=y,
d===B)return{value:a.returnValue,done:!0};throw d}if(void 0!==d)throw q("Sent value to newborn generator");case x:a.GState=w,a.action=c,
a.sent=d;var e;try{e=b(a)}catch(f){if(f!==B)throw f;e=a}var g=e===a;return g&&(e=a.returnValue),a.GState=g?y:x,{value:e,done:g}}}
function e(){}function f(){}function g(a,b,d){var e=k(a,d),f=new c,g=s(b.prototype);return p(g,C,f),p(g,D,e),g}function h(a){return a.prototype=s(f.prototype),
a.__proto__=f,a}function i(){c.call(this),this.err=void 0;var a=this;a.result=new Promise(function(b,c){a.resolve=b,a.reject=c})}
function j(a,b){var c=k(a,b),d=new i;return d.createCallback=function(a){return function(b){d.state=a,d.value=b,c(d)}},d.errback=function(a){
l(d,a),c(d)},c(d),d.result}function k(a,b){return function(c){for(;;)try{return a.call(b,c)}catch(d){l(c,d)}}}function l(a,b){a.storedException=b;
var c=a.tryStack_[a.tryStack_.length-1];return c?(a.state=void 0!==c["catch"]?c["catch"]:c["finally"],void(void 0!==c.finallyFallThrough&&(a.finallyFallThrough=c.finallyFallThrough))):void a.handleException(b);
}var m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/modules/generators.js")),n=m.createPrivateSymbol,o=m.getPrivate,p=m.setPrivate,q=TypeError,r=Object,s=r.create,t=r.defineProperties,u=r.defineProperty,v=0,w=1,x=2,y=3,z=-2,A=-3,B={};
c.prototype={pushTry:function(a,b){if(null!==b){for(var c=null,d=this.tryStack_.length-1;d>=0;d--)if(void 0!==this.tryStack_[d]["catch"]){
c=this.tryStack_[d]["catch"];break}null===c&&(c=A),this.tryStack_.push({"finally":b,finallyFallThrough:c})}null!==a&&this.tryStack_.push({
"catch":a})},popTry:function(){this.tryStack_.pop()},maybeUncatchable:function(){if(this.storedException===B)throw B},get sent(){
return this.maybeThrow(),this.sent_},set sent(a){this.sent_=a},get sentIgnoreThrow(){return this.sent_},maybeThrow:function(){if("throw"===this.action)throw this.action="next",
this.sent_},end:function(){switch(this.state){case z:return this;case A:throw this.storedException;default:throw b(this.state)}},
handleException:function(a){throw this.GState=y,this.state=z,a},wrapYieldStar:function(a){var b=this;return{next:function(b){return a.next(b);
},"throw":function(c){var d;if(c===B){if(a["return"]){if(d=a["return"](b.returnValue),!d.done)return b.returnValue=b.oldReturnValue,
d;b.returnValue=d.value}throw c}if(a["throw"])return a["throw"](c);throw a["return"]&&a["return"](),q("Inner iterator does not have a throw method");
}}}};var C=n(),D=n();return e.prototype=f,u(f,"constructor",a(e)),f.prototype={constructor:f,next:function(a){return d(o(this,C),o(this,D),"next",a);
},"throw":function(a){return d(o(this,C),o(this,D),"throw",a)},"return":function(a){var b=o(this,C);return b.oldReturnValue=b.returnValue,
b.returnValue=a,d(b,o(this,D),"throw",B)}},t(f.prototype,{constructor:{enumerable:!1},next:{enumerable:!1},"throw":{enumerable:!1
},"return":{enumerable:!1}}),Object.defineProperty(f.prototype,Symbol.iterator,a(function(){return this})),i.prototype=s(c.prototype),
i.prototype.end=function(){switch(this.state){case z:this.resolve(this.returnValue);break;case A:this.reject(this.storedException);
break;default:this.reject(b(this.state))}},i.prototype.handleException=function(){this.state=A},{get createGeneratorInstance(){return g;
},get initGeneratorFunction(){return h},get asyncWrap(){return j}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/asyncWrap.js"));
return{get default(){return a.asyncWrap}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/initGeneratorFunction.js"));
return{get default(){return a.initGeneratorFunction}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/modules/createGeneratorInstance.js"));
return{get default(){return a.createGeneratorInstance}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/generators.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/asyncWrap.js","traceur-runtime@0.0.111/src/runtime/generators.js"))["default"],b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/initGeneratorFunction.js","traceur-runtime@0.0.111/src/runtime/generators.js"))["default"],c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/createGeneratorInstance.js","traceur-runtime@0.0.111/src/runtime/generators.js"))["default"];
return $traceurRuntime.asyncWrap=a,$traceurRuntime.initGeneratorFunction=b,$traceurRuntime.createGeneratorInstance=c,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spawn.js",[],function(){
"use strict";function a(a,b,c){return new Promise(function(d,e){function f(a){try{h(c.next(a))}catch(b){e(b)}}function g(a){try{h(c["throw"](a));
}catch(b){e(b)}}function h(a){a.done?d(a.value):Promise.resolve(a.value).then(f,g)}h((c=c.apply(a,b)).next())})}return{get default(){
return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/spawn.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spawn.js","traceur-runtime@0.0.111/src/runtime/spawn.js"))["default"];
return $traceurRuntime.spawn=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/getTemplateObject.js",[],function(){
"use strict";function a(a){var b=arguments[1],g=a.join("${}"),h=f[g];return h?h:(b||(b=e.call(a)),f[g]=d(c(b,"raw",{value:d(a)})));
}var b=Object,c=b.defineProperty,d=b.freeze,e=Array.prototype.slice,f=Object.create(null);return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/template.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/getTemplateObject.js","traceur-runtime@0.0.111/src/runtime/template.js"))["default"];
return $traceurRuntime.getTemplateObject=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/modules/spreadProperties.js",[],function(){
"use strict";function a(a,b,c){d(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0})}function b(b,c){if(null!=c){var d=function(d){
for(var e=0;e<d.length;e++){var f=d[e];if(g.call(c,f)){var h=c[f];a(b,f,h)}}};d(e(c)),d(f(c))}}var c=Object,d=c.defineProperty,e=c.getOwnPropertyNames,f=c.getOwnPropertySymbols,g=c.propertyIsEnumerable,h=function(){
for(var a=arguments[0],c=1;c<arguments.length;c++)b(a,arguments[c]);return a};return{get default(){return h}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/jsx.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./modules/spreadProperties.js","traceur-runtime@0.0.111/src/runtime/jsx.js"))["default"];
return $traceurRuntime.spreadProperties=a,{}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js",[],function(){
"use strict";return $traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./symbols.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./classes.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./exportStar.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./properTailCalls.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./relativeRequire.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spread.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./destructuring.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./async.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./generators.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./spawn.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./template.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./jsx.js","traceur-runtime@0.0.111/src/runtime/runtime-modules.js")),
{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/runtime-modules.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/frozen-data.js",[],function(){
"use strict";function a(a,b){for(var c=0;c<a.length;c+=2)if(a[c]===b)return c;return-1}function b(b,c,d){var e=a(b,c);e===-1&&b.push(c,d);
}function c(b,c){var d=a(b,c);if(d!==-1)return b[d+1]}function d(b,c){return a(b,c)!==-1}function e(b,c){var d=a(b,c);return d!==-1&&(b.splice(d,2),
!0)}return{get setFrozen(){return b},get getFrozen(){return c},get hasFrozen(){return d},get deleteFrozen(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/utils.js",[],function(){
"use strict";function a(a){if(null==a)throw y();return z(a)}function b(a){return a>>>0}function c(a){return a&&("object"==typeof a||"function"==typeof a);
}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return a=+a,v(a)?0:0!==a&&u(a)?a>0?t(a):s(a):a;
}function g(a){var b=f(a);return b<0?0:x(b,A)}function h(a){return c(a)?a[Symbol.iterator]:void 0}function i(a){return d(a)}function j(a,b){
return{value:a,done:b}}function k(a,b,c){b in a||Object.defineProperty(a,b,c)}function l(a,b,c){k(a,b,{value:c,configurable:!0,enumerable:!1,
writable:!0})}function m(a,b,c){k(a,b,{value:c,configurable:!1,enumerable:!1,writable:!1})}function n(a,b){for(var c=0;c<b.length;c+=2){
var d=b[c],e=b[c+1];l(a,d,e)}}function o(a,b){for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];m(a,d,e)}}function p(a,b,c){c&&c.iterator&&!a[c.iterator]&&(a["@@iterator"]&&(b=a["@@iterator"]),
Object.defineProperty(a,c.iterator,{value:b,configurable:!0,enumerable:!1,writable:!0}))}function q(a){B.push(a)}function r(a){B.forEach(function(b){
return b(a)})}var s=Math.ceil,t=Math.floor,u=isFinite,v=isNaN,w=Math.pow,x=Math.min,y=TypeError,z=Object,A=w(2,53)-1,B=[];return{
get toObject(){return a},get toUint32(){return b},get isObject(){return c},get isCallable(){return d},get isNumber(){return e},get toInteger(){
return f},get toLength(){return g},get checkIterable(){return h},get isConstructor(){return i},get createIteratorResultObject(){return j;
},get maybeDefine(){return k},get maybeDefineMethod(){return l},get maybeDefineConst(){return m},get maybeAddFunctions(){return n;
},get maybeAddConsts(){return o},get maybeAddIterator(){return p},get registerPolyfill(){return q},get polyfillAll(){return r}}}),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js",[],function(){"use strict";function a(a){return i(a,y);
}function b(b){var c=a(b);return c||(c=x++,j(b,y,c)),c}function c(b,c){if("string"==typeof c)return b.stringIndex_[c];if(p(c)){if(!v(c))return m(b.frozenData_,c);
var d=a(c);if(void 0===d)return;return b.objectIndex_[d]}return b.primitiveIndex_[c]}function d(a){a.entries_=[],a.objectIndex_=Object.create(null),
a.stringIndex_=Object.create(null),a.primitiveIndex_=Object.create(null),a.frozenData_=[],a.deletedCount_=0}function e(a){var b=a,c=b.Map,d=b.Symbol;
if(!(c&&r()&&c.prototype[d.iterator]&&c.prototype.entries))return!0;try{return 1!==new c([[]]).size}catch(e){return!1}}function f(a){
e(a)&&(a.Map=z)}var g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),h=g.createPrivateSymbol,i=g.getPrivate,j=g.setPrivate,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),l=k.deleteFrozen,m=k.getFrozen,n=k.setFrozen,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js")),p=o.isObject,q=o.registerPolyfill,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Map.js"))["default"],s=Object,t=s.defineProperty,u=(s.getOwnPropertyDescriptor,
s.hasOwnProperty),v=s.isExtensible,w={},x=1,y=h(),z=function(){function e(){var a,b,c=arguments[0];if(!p(this))throw new TypeError("Map called on incompatible type");
if(u.call(this,"entries_"))throw new TypeError("Map can not be reentrantly initialised");if(d(this),null!==c&&void 0!==c){var e=!0,f=!1,g=void 0;
try{for(var h=void 0,i=c[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=(a=j[Symbol.iterator](),(b=a.next()).done?void 0:b.value),l=(b=a.next()).done?void 0:b.value;
this.set(k,l)}}catch(m){f=!0,g=m}finally{try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}}}return $traceurRuntime.createClass(e,{
get size(){return this.entries_.length/2-this.deletedCount_},get:function(a){var b=c(this,a);if(void 0!==b)return this.entries_[b+1];
},set:function(a,d){var e=c(this,a);if(void 0!==e)this.entries_[e+1]=d;else if(e=this.entries_.length,this.entries_[e]=a,this.entries_[e+1]=d,
p(a))if(v(a)){var f=b(a);this.objectIndex_[f]=e}else n(this.frozenData_,a,e);else"string"==typeof a?this.stringIndex_[a]=e:this.primitiveIndex_[a]=e;
return this},has:function(a){return void 0!==c(this,a)},"delete":function(b){var d=c(this,b);if(void 0===d)return!1;if(this.entries_[d]=w,
this.entries_[d+1]=void 0,this.deletedCount_++,p(b))if(v(b)){var e=a(b);delete this.objectIndex_[e]}else l(this.frozenData_,b);else"string"==typeof b?delete this.stringIndex_[b]:delete this.primitiveIndex_[b];
return!0},clear:function(){d(this)},forEach:function(a){for(var b=arguments[1],c=0;c<this.entries_.length;c+=2){var d=this.entries_[c],e=this.entries_[c+1];
d!==w&&a.call(b,e,d,this)}},entries:$traceurRuntime.initGeneratorFunction(function f(){var a,b,c;return $traceurRuntime.createGeneratorInstance(function(d){
for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;break;case 4:a+=2,d.state=12;break;
case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===w?4:6;break;case 6:return d.state=2,[b,c];case 2:
d.maybeThrow(),d.state=4;break;default:return d.end()}},f,this)}),keys:$traceurRuntime.initGeneratorFunction(function g(){var a,b,c;
return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;
break;case 4:a+=2,d.state=12;break;case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===w?4:6;break;case 6:
return d.state=2,b;case 2:d.maybeThrow(),d.state=4;break;default:return d.end()}},g,this)}),values:$traceurRuntime.initGeneratorFunction(function h(){
var a,b,c;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:a=0,d.state=12;break;case 12:d.state=a<this.entries_.length?8:-2;
break;case 4:a+=2,d.state=12;break;case 8:b=this.entries_[a],c=this.entries_[a+1],d.state=9;break;case 9:d.state=b===w?4:6;break;case 6:
return d.state=2,c;case 2:d.maybeThrow(),d.state=4;break;default:return d.end()}},h,this)})},{})}();return t(z.prototype,Symbol.iterator,{
configurable:!0,writable:!0,value:z.prototype.entries}),q(f),{get Map(){return z},get polyfillMap(){return f}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Map.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js",[],function(){"use strict";function a(a){var b=a,c=b.Set,d=b.Symbol;
if(!(c&&g()&&c.prototype[d.iterator]&&c.prototype.values))return!0;try{return 1!==new c([1]).size}catch(e){return!1}}function b(b){
a(b)&&(b.Set=i)}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")),d=c.isObject,e=c.registerPolyfill,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./Map.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js")).Map,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/Set.js"))["default"],h=Object.prototype.hasOwnProperty,i=function(){
function a(){var a=arguments[0];if(!d(this))throw new TypeError("Set called on incompatible type");if(h.call(this,"map_"))throw new TypeError("Set can not be reentrantly initialised");
if(this.map_=new f,null!==a&&void 0!==a){var b=!0,c=!1,e=void 0;try{for(var g=void 0,i=a[Symbol.iterator]();!(b=(g=i.next()).done);b=!0){
var j=g.value;this.add(j)}}catch(k){c=!0,e=k}finally{try{b||null==i["return"]||i["return"]()}finally{if(c)throw e}}}}return $traceurRuntime.createClass(a,{
get size(){return this.map_.size},has:function(a){return this.map_.has(a)},add:function(a){return this.map_.set(a,a),this},"delete":function(a){
return this.map_["delete"](a)},clear:function(){return this.map_.clear()},forEach:function(a){var b=arguments[1],c=this;return this.map_.forEach(function(d,e){
a.call(b,e,e,c)})},values:$traceurRuntime.initGeneratorFunction(function b(){var a,c;return $traceurRuntime.createGeneratorInstance(function(b){
for(;;)switch(b.state){case 0:a=b.wrapYieldStar(this.map_.keys()[Symbol.iterator]()),b.sent=void 0,b.action="next",b.state=12;break;
case 12:c=a[b.action](b.sentIgnoreThrow),b.state=9;break;case 9:b.state=c.done?3:2;break;case 3:b.sent=c.value,b.state=-2;break;case 2:
return b.state=12,c.value;default:return b.end()}},b,this)}),entries:$traceurRuntime.initGeneratorFunction(function c(){var a,b;return $traceurRuntime.createGeneratorInstance(function(c){
for(;;)switch(c.state){case 0:a=c.wrapYieldStar(this.map_.entries()[Symbol.iterator]()),c.sent=void 0,c.action="next",c.state=12;break;
case 12:b=a[c.action](c.sentIgnoreThrow),c.state=9;break;case 9:c.state=b.done?3:2;break;case 3:c.sent=b.value,c.state=-2;break;case 2:
return c.state=12,b.value;default:return c.end()}},c,this)})},{})}();return Object.defineProperty(i.prototype,Symbol.iterator,{configurable:!0,
writable:!0,value:i.prototype.values}),Object.defineProperty(i.prototype,"keys",{configurable:!0,writable:!0,value:i.prototype.values
}),e(b),{get Set(){return i},get polyfillSet(){return b}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Set.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/node_modules/rsvp/lib/rsvp/asap.js",[],function(){"use strict";function a(a,b){
q[k]=a,q[k+1]=b,k+=2,2===k&&j()}function b(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);
return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(g)}}function c(){return function(){i(g)}}function d(){
var a=0,b=new n(g),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function e(){var a=new MessageChannel;
return a.port1.onmessage=g,function(){a.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var a=0;a<k;a+=2){
var b=q[a],c=q[a+1];b(c),q[a]=void 0,q[a+1]=void 0}k=0}function h(){try{var a=require,b=a("vertx");return i=b.runOnLoop||b.runOnContext,
c()}catch(d){return f()}}var i,j,k=0,l=({}.toString,"undefined"!=typeof window?window:void 0),m=l||{},n=m.MutationObserver||m.WebKitMutationObserver,o="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,q=new Array(1e3);
return j=o?b():n?d():p?e():void 0===l&&"function"==typeof require?h():f(),{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js",[],function(){
"use strict";function a(a){return a&&"object"==typeof a&&void 0!==a.status_}function b(a){return a}function c(a){throw a}function d(a){
var d=void 0!==arguments[1]?arguments[1]:b,f=void 0!==arguments[2]?arguments[2]:c,g=e(a.constructor);switch(a.status_){case void 0:
throw TypeError;case 0:a.onResolve_.push(d,g),a.onReject_.push(f,g);break;case 1:k(a.value_,[d,g]);break;case-1:k(a.value_,[f,g]);
}return g.promise}function e(a){if(this===y){var b=g(new y(w));return{promise:b,resolve:function(a){h(b,a)},reject:function(a){i(b,a);
}}}var c={};return c.promise=new a(function(a,b){c.resolve=a,c.reject=b}),c}function f(a,b,c,d,e){return a.status_=b,a.value_=c,a.onResolve_=d,
a.onReject_=e,a}function g(a){return f(a,0,void 0,[],[])}function h(a,b){j(a,1,b,a.onResolve_)}function i(a,b){j(a,-1,b,a.onReject_);
}function j(a,b,c,d){0===a.status_&&(k(c,d),f(a,b,c))}function k(a,b){o(function(){for(var c=0;c<b.length;c+=2)l(a,b[c],b[c+1])});
}function l(b,c,e){try{var f=c(b);if(f===e.promise)throw new TypeError;a(f)?d(f,e.resolve,e.reject):e.resolve(f)}catch(g){try{e.reject(g);
}catch(g){}}}function m(b,c){if(!a(c)&&q(c)){var d;try{d=c.then}catch(f){var g=z.call(b,f);return v(c,A,g),g}if("function"==typeof d){
var h=u(c,A);if(h)return h;var i=e(b);v(c,A,i.promise);try{d.call(c,i.resolve,i.reject)}catch(f){i.reject(f)}return i.promise}}return c;
}function n(a){a.Promise||(a.Promise=x)}var o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../../../node_modules/rsvp/lib/rsvp/asap.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js"))["default"],p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),q=p.isObject,r=p.registerPolyfill,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js")),t=s.createPrivateSymbol,u=s.getPrivate,v=s.setPrivate,w={},x=function(){
function j(a){if(a!==w){if("function"!=typeof a)throw new TypeError;var b=g(this);try{a(function(a){h(b,a)},function(a){i(b,a)})}catch(c){
i(b,c)}}}return $traceurRuntime.createClass(j,{"catch":function(a){return this.then(void 0,a)},then:function(e,f){"function"!=typeof e&&(e=b),
"function"!=typeof f&&(f=c);var g=this,h=this.constructor;return d(this,function(b){return b=m(h,b),b===g?f(new TypeError):a(b)?b.then(e,f):e(b);
},f)}},{resolve:function(b){return this===y?a(b)?b:f(new y(w),1,b):new this(function(a,c){a(b)})},reject:function(a){return this===y?f(new y(w),-1,a):new this(function(b,c){
c(a)})},all:function(a){var b=e(this),c=[];try{var d=function(a){return function(d){c[a]=d,0===--f&&b.resolve(c)}},f=0,g=0,h=!0,i=!1,j=void 0;
try{for(var k=void 0,l=a[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value,n=d(g);this.resolve(m).then(n,function(a){
b.reject(a)}),++g,++f}}catch(o){i=!0,j=o}finally{try{h||null==l["return"]||l["return"]()}finally{if(i)throw j}}0===f&&b.resolve(c);
}catch(p){b.reject(p)}return b.promise},race:function(a){var b=e(this);try{for(var c=0;c<a.length;c++)this.resolve(a[c]).then(function(a){
b.resolve(a)},function(a){b.reject(a)})}catch(d){b.reject(d)}return b.promise}})}(),y=x,z=y.reject,A=t();return r(n),{get Promise(){
return x},get polyfillPromise(){return n}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Promise.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js",[],function(){"use strict";function a(a){
var b=String(a),c=Object.create(h.prototype);return c[f]=b,c[g]=0,c}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/StringIterator.js")),c=b.createIteratorResultObject,d=b.isObject,e=Object.prototype.hasOwnProperty,f=Symbol("iteratedString"),g=Symbol("stringIteratorNextIndex"),h=function(){
function a(){}var b;return $traceurRuntime.createClass(a,(b={},Object.defineProperty(b,"next",{value:function(){var a=this;if(!d(a)||!e.call(a,f))throw new TypeError("this must be a StringIterator object");
var b=a[f];if(void 0===b)return c(void 0,!0);var h=a[g],i=b.length;if(h>=i)return a[f]=void 0,c(void 0,!0);var j,k=b.charCodeAt(h);
if(k<55296||k>56319||h+1===i)j=String.fromCharCode(k);else{var l=b.charCodeAt(h+1);j=l<56320||l>57343?String.fromCharCode(k):String.fromCharCode(k)+String.fromCharCode(l);
}return a[g]=h+j.length,c(j,!1)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,Symbol.iterator,{value:function(){
return this},configurable:!0,enumerable:!0,writable:!0}),b),{})}();return{get createStringIterator(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js",[],function(){
"use strict";function a(a){var b=String(this);if(null==this||"[object RegExp]"==p.call(a))throw TypeError();var c=b.length,d=String(a),e=(d.length,
arguments.length>1?arguments[1]:void 0),f=e?Number(e):0;isNaN(f)&&(f=0);var g=Math.min(Math.max(f,0),c);return q.call(b,d,f)==g}function b(a){
var b=String(this);if(null==this||"[object RegExp]"==p.call(a))throw TypeError();var c=b.length,d=String(a),e=d.length,f=c;if(arguments.length>1){
var g=arguments[1];void 0!==g&&(f=g?Number(g):0,isNaN(f)&&(f=0))}var h=Math.min(Math.max(f,0),c),i=h-e;return!(i<0)&&r.call(b,d,i)==i;
}function c(a){if(null==this)throw TypeError();var b=String(this);if(a&&"[object RegExp]"==p.call(a))throw TypeError();var c=b.length,d=String(a),e=d.length,f=arguments.length>1?arguments[1]:void 0,g=f?Number(f):0;
g!=g&&(g=0);var h=Math.min(Math.max(g,0),c);return!(e+h>c)&&q.call(b,d,g)!=-1}function d(a){if(null==this)throw TypeError();var b=String(this),c=a?Number(a):0;
if(isNaN(c)&&(c=0),c<0||c==1/0)throw RangeError();if(0==c)return"";for(var d="";c--;)d+=b;return d}function e(a){if(null==this)throw TypeError();
var b=String(this),c=b.length,d=a?Number(a):0;if(isNaN(d)&&(d=0),!(d<0||d>=c)){var e,f=b.charCodeAt(d);return f>=55296&&f<=56319&&c>d+1&&(e=b.charCodeAt(d+1),
e>=56320&&e<=57343)?1024*(f-55296)+e-56320+65536:f}}function f(a){var b=a.raw,c=b.length>>>0;if(0===c)return"";for(var d="",e=0;;){
if(d+=b[e],e+1===c)return d;d+=arguments[++e]}}function g(a){var b,c,d=[],e=Math.floor,f=-1,g=arguments.length;if(!g)return"";for(;++f<g;){
var h=Number(arguments[f]);if(!isFinite(h)||h<0||h>1114111||e(h)!=h)throw RangeError("Invalid code point: "+h);h<=65535?d.push(h):(h-=65536,
b=(h>>10)+55296,c=h%1024+56320,d.push(b,c))}return String.fromCharCode.apply(null,d)}function h(){var a=j(this),b=String(a);return k(b);
}function i(i){var j=i.String;m(j.prototype,["codePointAt",e,"endsWith",b,"includes",c,"repeat",d,"startsWith",a]),m(j,["fromCodePoint",g,"raw",f]),
n(j.prototype,h,Symbol)}var j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../checkObjectCoercible.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js"))["default"],k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./StringIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")).createStringIterator,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/String.js")),m=l.maybeAddFunctions,n=l.maybeAddIterator,o=l.registerPolyfill,p=Object.prototype.toString,q=String.prototype.indexOf,r=String.prototype.lastIndexOf;
return o(i),{get startsWith(){return a},get endsWith(){return b},get includes(){return c},get repeat(){return d},get codePointAt(){
return e},get raw(){return f},get fromCodePoint(){return g},get stringPrototypeIterator(){return h},get polyfillString(){return i;
}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/String.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js",[],function(){
"use strict";function a(a,b){var c=f(a),d=new l;return d.iteratorObject_=c,d.arrayIteratorNextIndex_=0,d.arrayIterationKind_=b,d}
function b(){return a(this,k)}function c(){return a(this,i)}function d(){return a(this,j)}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/ArrayIterator.js")),f=e.toObject,g=e.toUint32,h=e.createIteratorResultObject,i=1,j=2,k=3,l=function(){
function a(){}var b;return $traceurRuntime.createClass(a,(b={},Object.defineProperty(b,"next",{value:function(){var a=f(this),b=a.iteratorObject_;
if(!b)throw new TypeError("Object is not an ArrayIterator");var c=a.arrayIteratorNextIndex_,d=a.arrayIterationKind_,e=g(b.length);
return c>=e?(a.arrayIteratorNextIndex_=1/0,h(void 0,!0)):(a.arrayIteratorNextIndex_=c+1,d==j?h(b[c],!1):d==k?h([c,b[c]],!1):h(c,!1));
},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,Symbol.iterator,{value:function(){return this},configurable:!0,
enumerable:!0,writable:!0}),b),{})}();return{get entries(){return b},get keys(){return c},get values(){return d}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js",[],function(){
"use strict";function a(a){var b,c,d=arguments[1],e=arguments[2],f=this,g=u(a),h=void 0!==d,i=0;if(h&&!n(d))throw TypeError();if(m(g)){
b=o(f)?new f:[];var j=!0,k=!1,l=void 0;try{for(var p=void 0,q=g[Symbol.iterator]();!(j=(p=q.next()).done);j=!0){var r=p.value;h?b[i]=d.call(e,r,i):b[i]=r,
i++}}catch(s){k=!0,l=s}finally{try{j||null==q["return"]||q["return"]()}finally{if(k)throw l}}return b.length=i,b}for(c=t(g.length),
b=o(f)?new f(c):new Array(c);i<c;i++)h?b[i]="undefined"==typeof e?d(g[i],i):d.call(e,g[i],i):b[i]=g[i];return b.length=c,b}function b(){
for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var c=this,d=a.length,e=o(c)?new c(d):new Array(d),f=0;f<d;f++)e[f]=a[f];
return e.length=d,e}function c(a){var b=void 0!==arguments[1]?arguments[1]:0,c=arguments[2],d=u(this),e=t(d.length),f=s(b),g=void 0!==c?s(c):e;
for(f=f<0?Math.max(e+f,0):Math.min(f,e),g=g<0?Math.max(e+g,0):Math.min(g,e);f<g;)d[f]=a,f++;return d}function d(a){var b=arguments[1];
return f(this,a,b)}function e(a){var b=arguments[1];return f(this,a,b,!0)}function f(a,b){var c=arguments[2],d=void 0!==arguments[3]&&arguments[3],e=u(a),f=t(e.length);
if(!n(b))throw TypeError();for(var g=0;g<f;g++){var h=e[g];if(b.call(c,h,g,e))return d?g:h}return d?-1:void 0}function g(f){var g=f,h=g.Array,l=g.Object,m=g.Symbol,n=k;
m&&m.iterator&&h.prototype[m.iterator]&&(n=h.prototype[m.iterator]),p(h.prototype,["entries",i,"keys",j,"values",n,"fill",c,"find",d,"findIndex",e]),
p(h,["from",a,"of",b]),q(h.prototype,n,m),q(l.getPrototypeOf([].values()),function(){return this},m)}var h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./ArrayIterator.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),i=h.entries,j=h.keys,k=h.values,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Array.js")),m=l.checkIterable,n=l.isCallable,o=l.isConstructor,p=l.maybeAddFunctions,q=l.maybeAddIterator,r=l.registerPolyfill,s=l.toInteger,t=l.toLength,u=l.toObject;
return r(g),{get from(){return a},get of(){return b},get fill(){return c},get find(){return d},get findIndex(){return e},get polyfillArray(){
return g}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Array.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/assign.js",[],function(){
"use strict";function a(a){for(var c=1;c<arguments.length;c++){var d=arguments[c],e=null==d?[]:b(d),f=void 0,g=e.length;for(f=0;f<g;f++){
var h=e[f];a[h]=d[h]}}return a}var b=Object.keys;return{get default(){return a}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js",[],function(){
"use strict";function a(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}function b(a,b){var c,d,e=k(b),f=e.length;for(c=0;c<f;c++){
e[c];d=j(b,e[c]),i(a,e[c],d)}return a}function c(c){var d=c.Object;e(d,["assign",g,"is",a,"mixin",b])}var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js")),e=d.maybeAddFunctions,f=d.registerPolyfill,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./assign.js","traceur-runtime@0.0.111/src/runtime/polyfills/Object.js"))["default"],h=Object,i=h.defineProperty,j=h.getOwnPropertyDescriptor,k=h.getOwnPropertyNames;
return f(c),{get assign(){return g},get is(){return a},get mixin(){return b},get polyfillObject(){return c}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Object.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js",[],function(){"use strict";function a(a){
return g(a)&&m(a)}function b(b){return a(b)&&k(b)===b}function c(a){return g(a)&&n(a)}function d(b){if(a(b)){var c=k(b);if(c===b)return l(c)<=o;
}return!1}function e(e){var f=e.Number;h(f,["MAX_SAFE_INTEGER",o,"MIN_SAFE_INTEGER",p,"EPSILON",q]),i(f,["isFinite",a,"isInteger",b,"isNaN",c,"isSafeInteger",d]);
}var f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Number.js")),g=f.isNumber,h=f.maybeAddConsts,i=f.maybeAddFunctions,j=f.registerPolyfill,k=f.toInteger,l=Math.abs,m=isFinite,n=isNaN,o=Math.pow(2,53)-1,p=-Math.pow(2,53)+1,q=Math.pow(2,-52);
return j(e),{get MAX_SAFE_INTEGER(){return o},get MIN_SAFE_INTEGER(){return p},get EPSILON(){return q},get isFinite(){return a},get isInteger(){
return b},get isNaN(){return c},get isSafeInteger(){return d},get polyfillNumber(){return e}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Number.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/fround.js",[],function(){"use strict";function a(a,b,c){
function d(a){var b=k(a),c=a-b;return c<.5?b:c>.5?b+1:b%2?b+1:b}var e,f,g,h,o,p,q,r=(1<<b-1)-1;for(a!==a?(f=(1<<b)-1,g=n(2,c-1),e=0):a===1/0||a===-(1/0)?(f=(1<<b)-1,
g=0,e=a<0?1:0):0===a?(f=0,g=0,e=1/a===-(1/0)?1:0):(e=a<0,a=j(a),a>=n(2,1-r)?(f=m(k(l(a)/i),1023),g=d(a/n(2,f)*n(2,c)),g/n(2,c)>=2&&(f+=1,
g=1),f>r?(f=(1<<b)-1,g=0):(f+=r,g-=n(2,c))):(f=0,g=d(a/n(2,1-r-c)))),o=[],h=c;h;h-=1)o.push(g%2?1:0),g=k(g/2);for(h=b;h;h-=1)o.push(f%2?1:0),
f=k(f/2);for(o.push(e?1:0),o.reverse(),p=o.join(""),q=[];p.length;)q.push(parseInt(p.substring(0,8),2)),p=p.substring(8);return q;
}function b(a,b,c){var d,e,f,g,h,i,j,k,l=[];for(d=a.length;d;d-=1)for(f=a[d-1],e=8;e;e-=1)l.push(f%2?1:0),f>>=1;return l.reverse(),
g=l.join(""),h=(1<<b-1)-1,i=parseInt(g.substring(0,1),2)?-1:1,j=parseInt(g.substring(1,1+b),2),k=parseInt(g.substring(1+b),2),j===(1<<b)-1?0!==k?NaN:i*(1/0):j>0?i*n(2,j-h)*(1+k/n(2,c)):0!==k?i*n(2,-(h-1))*(k/n(2,c)):i<0?-0:0;
}function c(a){return b(a,8,23)}function d(b){return a(b,8,23)}function e(a){return 0===a||!f(a)||g(a)?a:c(d(Number(a)))}var f=isFinite,g=isNaN,h=Math,i=h.LN2,j=h.abs,k=h.floor,l=h.log,m=h.min,n=h.pow;
return{get fround(){return e}}}),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js",[],function(){
"use strict";function a(a){if(a=x(+a),0==a)return 32;var b=0;return 0===(4294901760&a)&&(a<<=16,b+=16),0===(4278190080&a)&&(a<<=8,
b+=8),0===(4026531840&a)&&(a<<=4,b+=4),0===(3221225472&a)&&(a<<=2,b+=2),0===(2147483648&a)&&(a<<=1,b+=1),b}function b(a,b){a=x(+a),
b=x(+b);var c=a>>>16&65535,d=65535&a,e=b>>>16&65535,f=65535&b;return d*f+(c*f+d*e<<16>>>0)|0}function c(a){return a=+a,a>0?1:a<0?-1:a;
}function d(a){return.4342944819032518*F(a)}function e(a){return 1.4426950408889634*F(a)}function f(a){if(a=+a,a<-1||z(a))return NaN;
if(0===a||a===1/0)return a;if(a===-1)return-(1/0);var b=0,c=50;if(a<0||a>1)return F(1+a);for(var d=1;d<c;d++)d%2===0?b-=G(a,d)/d:b+=G(a,d)/d;
return b}function g(a){return a=+a,a===-(1/0)?-1:y(a)&&0!==a?D(a)-1:a}function h(a){return a=+a,0===a?1:z(a)?NaN:y(a)?(a<0&&(a=-a),
a>21?D(a)/2:(D(a)+D(-a))/2):1/0}function i(a){return a=+a,y(a)&&0!==a?(D(a)-D(-a))/2:a}function j(a){if(a=+a,0===a)return a;if(!y(a))return c(a);
var b=D(a),d=D(-a);return(b-d)/(b+d)}function k(a){return a=+a,a<1?NaN:y(a)?F(a+H(a+1)*H(a-1)):a}function l(a){return a=+a,0!==a&&y(a)?a>0?F(a+H(a*a+1)):-F(-a+H(a*a+1)):a;
}function m(a){return a=+a,a===-1?-(1/0):1===a?1/0:0===a?a:z(a)||a<-1||a>1?NaN:.5*F((1+a)/(1-a))}function n(a,b){for(var c=arguments.length,d=new Array(c),e=0,f=0;f<c;f++){
var g=arguments[f];if(g=+g,g===1/0||g===-(1/0))return 1/0;g=B(g),g>e&&(e=g),d[f]=g}0===e&&(e=1);for(var h=0,i=0,f=0;f<c;f++){var g=d[f]/e,j=g*g-i,k=h+j;
i=k-h-j,h=k}return H(h)*e}function o(a){return a=+a,a>0?E(a):a<0?C(a):a}function p(a){if(a=+a,0===a)return a;var b=a<0;b&&(a=-a);var c=G(a,1/3);
return b?-c:c}function q(q){var s=q.Math;v(s,["acosh",k,"asinh",l,"atanh",m,"cbrt",p,"clz32",a,"cosh",h,"expm1",g,"fround",r,"hypot",n,"imul",b,"log10",d,"log1p",f,"log2",e,"sign",c,"sinh",i,"tanh",j,"trunc",o]);
}var r,s,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./fround.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")).fround,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/Math.js")),v=u.maybeAddFunctions,w=u.registerPolyfill,x=u.toUint32,y=isFinite,z=isNaN,A=Math,B=A.abs,C=A.ceil,D=A.exp,E=A.floor,F=A.log,G=A.pow,H=A.sqrt;
return"function"==typeof Float32Array?(s=new Float32Array(1),r=function(a){return s[0]=Number(a),s[0]}):r=t,w(q),{get clz32(){return a;
},get imul(){return b},get sign(){return c},get log10(){return d},get log2(){return e},get log1p(){return f},get expm1(){return g;
},get cosh(){return h},get sinh(){return i},get tanh(){return j},get acosh(){return k},get asinh(){return l},get atanh(){return m;
},get hypot(){return n},get trunc(){return o},get fround(){return r},get cbrt(){return p},get polyfillMath(){return q}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/Math.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js",[],function(){"use strict";function a(a){
var b=a,c=b.WeakMap;b.Symbol;if(!c||!q())return!0;try{var d={},e=new c([[d,!1]]);return e.get(d)}catch(f){return!1}}function b(b){
a(b)&&(b.WeakMap=u)}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),d=c.createPrivateSymbol,e=c.deletePrivate,f=c.getPrivate,g=c.hasPrivate,h=c.setPrivate,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),j=i.deleteFrozen,k=i.getFrozen,l=i.hasFrozen,m=i.setFrozen,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js")),o=n.isObject,p=n.registerPolyfill,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js"))["default"],r=Object,s=(r.defineProperty,
r.getOwnPropertyDescriptor,r.isExtensible),t=TypeError,u=(Object.prototype.hasOwnProperty,function(){function a(){this.name_=d(),
this.frozenData_=[]}return $traceurRuntime.createClass(a,{set:function(a,b){if(!o(a))throw new t("key must be an object");return s(a)?h(a,this.name_,b):m(this.frozenData_,a,b),
this},get:function(a){if(o(a))return s(a)?f(a,this.name_):k(this.frozenData_,a)},"delete":function(a){return!!o(a)&&(s(a)?e(a,this.name_):j(this.frozenData_,a));
},has:function(a){return!!o(a)&&(s(a)?g(a,this.name_):l(this.frozenData_,a))}},{})}());return p(b),{get WeakMap(){return u},get polyfillWeakMap(){
return b}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakMap.js"),$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js",[],function(){
"use strict";function a(a){var b=a,c=b.WeakSet;b.Symbol;if(!c||!o())return!0;try{var d={},e=new c([[d]]);return!e.has(d)}catch(f){
return!1}}function b(b){a(b)&&(b.WeakSet=s)}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../private.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),d=c.createPrivateSymbol,e=c.deletePrivate,f=(c.getPrivate,
c.hasPrivate),g=c.setPrivate,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../frozen-data.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),i=h.deleteFrozen,j=h.getFrozen,k=h.setFrozen,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js")),m=l.isObject,n=l.registerPolyfill,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("../has-native-symbols.js","traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js"))["default"],p=Object,q=(p.defineProperty,
p.isExtensible),r=TypeError,s=(Object.prototype.hasOwnProperty,function(){function a(){this.name_=d(),this.frozenData_=[]}return $traceurRuntime.createClass(a,{
add:function(a){if(!m(a))throw new r("value must be an object");return q(a)?g(a,this.name_,!0):k(this.frozenData_,a,a),this},"delete":function(a){
return!!m(a)&&(q(a)?e(a,this.name_):i(this.frozenData_,a))},has:function(a){return!!m(a)&&(q(a)?f(a,this.name_):j(this.frozenData_,a)===a);
}},{})}());return n(b),{get WeakSet(){return s},get polyfillWeakSet(){return b}}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/WeakSet.js"),
$traceurRuntime.registerModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("./utils.js","traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js")).polyfillAll;
a(Reflect.global);var b=$traceurRuntime.setupGlobals;return $traceurRuntime.setupGlobals=function(c){b(c),a(c)},{}}),$traceurRuntime.getModule("traceur-runtime@0.0.111/src/runtime/polyfills/polyfills.js"),
$traceurRuntime.registerModule("src/base/CooldownThrottle.js",[],function(){"use strict";var a=function(){function a(a,b){var c=void 0!==arguments[2]?arguments[2]:0,d=void 0!==arguments[3]&&arguments[3];
this.action=a,this.cooldownDuration=b,this.slowActionCooldownPumpupFactor=c,this._waitWithRequestAnimationFrame=d,this._state="idle",
this._cooldownStartTime=-(1/0)}return $traceurRuntime.createClass(a,{_triggerIdle:function(){var a=this.cooldownDuration-(performance.now()-this._cooldownStartTime);
if(a>0)return void this._forceIdleTriggerAfter(a);this._state="running";var b=performance.now();try{this.action()}finally{var c=performance.now()-b;
this._cooldownStartTime=performance.now()+c*this.slowActionCooldownPumpupFactor,"running-and-triggered"===this._state?this._forceIdleTriggerAfter(this.cooldownDuration):this._state="idle";
}},trigger:function(){switch(this._state){case"idle":this._triggerIdle();break;case"waiting":break;case"running":this._state="running-and-triggered";
break;case"running-and-triggered":break;default:throw new Error("Unrecognized throttle state: "+this._state)}},_forceIdleTriggerAfter:function(a){
var b=this;if(this._state="waiting",this._waitWithRequestAnimationFrame){var c,d=performance.now();c=function(){return performance.now()<d+a?void requestAnimationFrame(c):(b._state="idle",
b._cooldownStartTime=-(1/0),void b.trigger())},c()}else setTimeout(function(){b._state="idle",b._cooldownStartTime=-(1/0),b.trigger();
},a)}},{})}();return{get CooldownThrottle(){return a}}}),$traceurRuntime.registerModule("src/base/Describe.js",[],function(){"use strict";
function a(a){return null===a?"null":void 0===a?"undefined":"string"==typeof a?'"'+a+'"':"number"==typeof a?""+a:void 0}function b(a,b){
return 0===b?k:a instanceof Map?e(a,b):a instanceof Set?f(a,b):void 0!==a[Symbol.iterator]?g(a,b):void 0}function c(a,b){var c=String(a);
return c!==j?c:h(a,b)}function d(d){var e=void 0!==arguments[1]?arguments[1]:l;return a(d)||b(d,e)||c(d,e)}function e(a,b){var c,e,f=[],g=!0,h=!1,j=void 0;
try{for(var k=void 0,l=a.entries()[Symbol.iterator]();!(g=(k=l.next()).done);g=!0){var m=k.value,n=(c=m[Symbol.iterator](),(e=c.next()).done?void 0:e.value),o=(e=c.next()).done?void 0:e.value;
if(f.length>i){f.push("[...]");break}var p=d(n,b-1),q=d(o,b-1);f.push(p+": "+q)}}catch(r){h=!0,j=r}finally{try{g||null==l["return"]||l["return"]();
}finally{if(h)throw j}}return"Map{"+f.join(", ")+"}"}function f(a,b){var c=[],e=!0,f=!1,g=void 0;try{for(var h=void 0,j=a[Symbol.iterator]();!(e=(h=j.next()).done);e=!0){
var k=h.value;if(c.length>i){c.push("[...]");break}c.push(d(k,b-1))}}catch(l){f=!0,g=l}finally{try{e||null==j["return"]||j["return"]();
}finally{if(f)throw g}}return"Set{"+c.join(", ")+"}"}function g(a,b){var c=[],e=!0,f=!1,g=void 0;try{for(var h=void 0,j=a[Symbol.iterator]();!(e=(h=j.next()).done);e=!0){
var k=h.value;if(c.length>i){c.push("[...]");break}c.push(d(k,b-1))}}catch(l){f=!0,g=l}finally{try{e||null==j["return"]||j["return"]();
}finally{if(f)throw g}}var m=Array.isArray(a)?"":a.constructor.name;return m+"["+c.join(", ")+"]"}function h(a,b){var c=[];for(var e in a)if(a.hasOwnProperty(e)){
if(c.length>i){c.push("[...]");break}var f=a[e],g=d(e,b-1),h=d(f,b-1);c.push(g+": "+h)}var j=a.constructor.name,k=j==={}.constructor.name?"":"(Type: "+j+")";
return k+"{"+c.join(", ")+"}"}var i=1e3,j=(new function(){}).toString(),k="!recursion-limit!",l=10;return{get describe(){return d;
}}}),$traceurRuntime.registerModule("src/base/DetailedError.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/base/DetailedError.js")).describe,b=0,c=function(c){
function d(c,e){$traceurRuntime.superConstructor(d).call(this,c),this.detailsObj=e,this.name="Error",this.message=c,this.stack=(new Error).stack,
void 0!==this.stack&&(this.stack=this.stack.replace(/^Error\n\s+at new DetailedError (\S+)\s?\n\s+at /,"\n    ")),b++;try{this.details=1===b?a(this.detailsObj):"(failed to describe detailsObj due to possibly re-entrancy)";
}catch(f){console.error(f),this.details="(failed to describe detailsObj, see the console for details)"}finally{b--}}return $traceurRuntime.createClass(d,{
toString:function(){return $traceurRuntime.superGet(this,d.prototype,"toString").call(this)+"\nDetails: "+this.details}},{},c)}(Error);
return{get DetailedError(){return c}}}),$traceurRuntime.registerModule("src/base/Equate.js",[],function(){"use strict";function a(a,h){
if(a===h||b(a)&&b(h))return!0;var k=c(a,h);return void 0!==k?k:!(d(a)||d(h)||!f(a,h))&&(a instanceof Map?i(a,h):a instanceof Set?j(a,h):e(a)?g(a,h):l(a,h));
}function b(a){return"number"==typeof a&&isNaN(a)}function c(a,b){return!d(a)&&a.constructor.prototype.hasOwnProperty("isEqualTo")?a.isEqualTo(b):!d(b)&&b.constructor.prototype.hasOwnProperty("isEqualTo")?b.isEqualTo(a):void 0;
}function d(a){return null===a||void 0===a||"string"==typeof a||"number"==typeof a||"boolean"==typeof a}function e(a){return Array.isArray(a)||!m.every(function(b){
return!(a instanceof b)})}function f(a,b){return a.constructor.name===b.constructor.name}function g(b,c){if(b.length!==c.length)return!1;
for(var d=0;d<b.length;d++)if(!a(b[d],c[d]))return!1;return!0}function h(b,c){var d=c[Symbol.iterator](),e=!0,f=!1,g=void 0;try{for(var h=void 0,i=b[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){
var j=h.value,k=d.next();if(k.done||!a(j,k.value))return!1}}catch(l){f=!0,g=l}finally{try{e||null==i["return"]||i["return"]()}finally{
if(f)throw g}}return d.next().done}function i(b,c){var d,e;if(b.size!==c.size)return!1;var f=!0,g=!1,h=void 0;try{for(var i=void 0,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value,l=(d=k[Symbol.iterator](),(e=d.next()).done?void 0:e.value),m=(e=d.next()).done?void 0:e.value;if(!c.has(l))return!1;
var n=c.get(l);if(!a(m,n))return!1}}catch(o){g=!0,h=o}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}}return!0;
}function j(a,b){if(a.size!==b.size)return!1;var c=!0,d=!1,e=void 0;try{for(var f=void 0,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value;if(!b.has(h))return!1}}catch(i){d=!0,e=i}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return!0;
}function k(a){var b=new Set;for(var c in a)a.hasOwnProperty(c)&&b.add(c);return b}function l(b,c){var d=k(b);if(!j(d,k(c)))return!1;
var e=!0,f=!1,g=void 0;try{for(var i=void 0,l=d[Symbol.iterator]();!(e=(i=l.next()).done);e=!0){var m=i.value;if(m!==Symbol.iterator&&!a(b[m],c[m]))return!1;
}}catch(n){f=!0,g=n}finally{try{e||null==l["return"]||l["return"]()}finally{if(f)throw g}}var o=void 0!==b[Symbol.iterator],p=void 0!==c[Symbol.iterator];
return o===p&&!(o&&p&&!h(b,c))}var m=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray];
return{get equate(){return a}}}),$traceurRuntime.registerModule("src/base/Format.js",[],function(){"use strict";function a(b){var e=void 0!==arguments[1]?arguments[1]:0,f=arguments[2];
if(Math.abs(b)<e)return"0";if(b<0)return"-"+a(-b,e,f);var g=d(c,function(a){return Math.abs(a.value-b)<=e});if(void 0!==g)return g.character;
var h=d(c,function(a){return Math.abs(Math.sqrt(a.value)-b)<=e});return void 0!==h?"√"+h.character:b%1!==0&&void 0!==f?b.toFixed(f):b.toString();
}var b=function(){function b(a,b,c,d){this.allowAbbreviation=a,this.maxAbbreviationError=b,this.fixedDigits=c,this.itemSeparator=d;
}return $traceurRuntime.createClass(b,{formatFloat:function(b){return this.allowAbbreviation?a(b,this.maxAbbreviationError,this.fixedDigits):void 0!==this.fixedDigits?b.toFixed(this.fixedDigits):b+"";
}},{parseFloat:function(a){if(0===a.length)throw new Error("Not a number: '"+a+"'");if("-"===a[0])return-b.parseFloat(a.substr(1));
if("√"===a[0])return Math.sqrt(b.parseFloat(a.substr(1)));var e=d(c,function(b){return b.character===a});if(void 0!==e)return e.value;
var f=parseFloat(a);if(isNaN(f))throw new Error("Not a number: '"+a+"'");return f},simplifyByRounding:function(a,e){if(a<0)return-b.simplifyByRounding(-a,e);
var f=a%1;if(f<=e||1-f<=e)return Math.round(a);var g=d(c,function(b){return Math.abs(b.value-a)<=e});if(void 0!==g)return g.value;
var h=d(c,function(b){return Math.abs(Math.sqrt(b.value)-a)<=e});return void 0!==h?Math.sqrt(h.value):a}})}(),c=[{character:"½",ref:"½",
expanded:"1/2",value:.5},{character:"¼",ref:"¼",expanded:"1/4",value:.25},{character:"¾",ref:"¾",expanded:"3/4",value:.75},{character:"⅓",
ref:"⅓",expanded:"1/3",value:1/3},{character:"⅔",ref:"⅔",expanded:"2/3",value:2/3},{character:"⅕",ref:"⅕",expanded:"1/5",value:.2
},{character:"⅖",ref:"⅖",expanded:"2/5",value:.4},{character:"⅗",ref:"⅗",expanded:"3/5",value:.6},{character:"⅘",ref:"⅘",expanded:"4/5",
value:.8},{character:"⅙",ref:"⅙",expanded:"1/6",value:1/6},{character:"⅚",ref:"⅚",expanded:"5/6",value:5/6},{character:"⅐",ref:"⅐",
expanded:"1/7",value:1/7},{character:"⅛",ref:"⅛",expanded:"1/8",value:1/8},{character:"⅜",ref:"⅜",expanded:"3/8",value:3/8},{character:"⅝",
ref:"⅝",expanded:"5/8",value:5/8},{character:"⅞",ref:"⅞",expanded:"7/8",value:7/8},{character:"⅑",ref:"⅑",expanded:"1/9",value:1/9
},{character:"⅒",ref:"⅒",expanded:"1/10",value:.1}],d=function(a,b){var c=!0,d=!1,e=void 0;try{for(var f=void 0,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value;if(b(h))return h}}catch(i){d=!0,e=i}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}};return b.EXACT=new b((!0),0,(void 0),", "),
b.MINIFIED=new b((!0),0,(void 0),","),b.SIMPLIFIED=new b((!0),5e-4,3,", "),b.CONSISTENT=new b((!1),0,2,", "),{get Format(){return b;
},get UNICODE_FRACTIONS(){return c}}}),$traceurRuntime.registerModule("src/base/Obs.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/CooldownThrottle.js","src/base/Obs.js")).CooldownThrottle,b=function(){
function b(a){this._subscribe=a}return $traceurRuntime.createClass(b,{subscribe:function(a){return this._subscribe(a)},snapshot:function(){
var a=[],b=this.subscribe(function(b){return a.push(b)});return b(),a},map:function(a){var c=this;return new b(function(b){return c.subscribe(function(c){
return b(a(c))})})},filter:function(a){var c=this;return new b(function(b){return c.subscribe(function(c){a(c)&&b(c)})})},zipLatest:function(a,c){
var d=this;return new b(function(b){var e,f,g=!1,h=!1,i=d.subscribe(function(a){e=a,g=!0,h&&b(c(e,f))}),j=a.subscribe(function(a){
f=a,h=!0,g&&b(c(e,f))});return function(){i(),j()}})},flattenLatest:function(){var a=this;return new b(function(b){var c=function(){},d=!1,e=a.subscribe(function(a){
if(!d){var e=c;c=a.subscribe(b),e()}});return function(){d=!0,c(),e()}})},peek:function(a){return this.map(function(b){return a(b),
b})},flatten:function(){var a=this;return new b(function(b){var c=[];return c.push(a.subscribe(function(a){return c.push(a.subscribe(b));
})),function(){var a=!0,b=!1,d=void 0;try{for(var e=void 0,f=c[Symbol.iterator]();!(a=(e=f.next()).done);a=!0){var g=e.value;g()}
}catch(h){b=!0,d=h}finally{try{a||null==f["return"]||f["return"]()}finally{if(b)throw d}}}})},throttleLatest:function(c){var d=this;
return new b(function(b){var e=void 0,f=!1,g=new a(function(){f||b(e)},c),h=d.subscribe(function(a){e=a,g.trigger()});return function(){
f=!0,h()}})},skip:function(a){var c=this;return new b(function(b){var d=a;return c.subscribe(function(a){d>0?d-=1:b(a)})})},whenDifferent:function(){
var a=arguments[0],c=this,d=a||function(a,b){return a===b};return new b(function(a){var b=!1,e=void 0;return c.subscribe(function(c){
b&&d(e,c)||(e=c,b=!0,a(c))})})}},{of:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return new b(function(b){
var c=!0,d=!1,e=void 0;try{for(var f=void 0,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;b(h)}}catch(i){d=!0,
e=i}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return function(){}})},requestAnimationTicker:function(){
return new b(function(a){var b,c=!1;return b=function(){c||(a(void 0),window.requestAnimationFrame(b))},b(),function(){c=!0}})},elementEvent:function(a,c){
return new b(function(b){return a.addEventListener(c,b),function(){return a.removeEventListener(c,b)}})}})}(),c=function(){function a(){
var a=this;this._observers=[],this._observable=new b(function(b){a._observers.push(b);var c=!1;return function(){c||(c=!0,a._observers.splice(a._observers.indexOf(b),1));
}})}return $traceurRuntime.createClass(a,{observable:function(){return this._observable},send:function(a){var b=!0,c=!1,d=void 0;try{
for(var e=void 0,f=this._observers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g(a)}}catch(h){c=!0,d=h}finally{
try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}}},{})}(),d=function(){function a(){var a=arguments[0],d=this;this._value=a,
this._source=new c,this._observable=new b(function(a){return a(d._value),d._source.observable().subscribe(a)})}return $traceurRuntime.createClass(a,{
observable:function(){return this._observable},set:function(a){this._value=a,this._source.send(a)},get:function(){return this._value;
}},{})}();return{get Observable(){return b},get ObservableSource(){return c},get ObservableValue(){return d}}}),$traceurRuntime.registerModule("src/base/RestartableRng.js",[],function(){
"use strict";var a=function(){function a(){this._cache=[],this._next=0}return $traceurRuntime.createClass(a,{restarted:function(){
var b=new a;return b._cache=this._cache,b},random:function(){var a=this._next++;return a>=this._cache.length&&this._cache.push(Math.random()),
this._cache[a]}},{})}();return{get RestartableRng(){return a}}}),$traceurRuntime.registerModule("src/base/Revision.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/base/Revision.js")).describe,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Equate.js","src/base/Revision.js")).equate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Revision.js")).DetailedError,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/base/Revision.js")),e=d.ObservableSource,f=d.ObservableValue,g=function(){
function d(a,b,d){if(b<0||b>=a.length)throw new c("Bad index",{history:a,index:b,isWorkingOnCommit:d});if(!Array.isArray(a))throw new c("Bad history",{
history:a,index:b,isWorkingOnCommit:d});this.history=a,this.index=b,this.isWorkingOnCommit=d,this._changes=new e,this._latestActiveCommit=new f(this.history[this.index]);
}return $traceurRuntime.createClass(d,{changes:function(){return this._changes.observable()},latestActiveCommit:function(){return this._latestActiveCommit.observable();
},isAtBeginningOfHistory:function(){return 0===this.index&&!this.isWorkingOnCommit},isAtEndOfHistory:function(){return this.index===this.history.length-1;
},clear:function(a){this.history=[a],this.index=0,this.isWorkingOnCommit=!1,this._changes.send(a),this._latestActiveCommit.set(a);
},startedWorkingOnCommit:function(){this.isWorkingOnCommit=!0,this._changes.send(void 0)},cancelCommitBeingWorkedOn:function(){this.isWorkingOnCommit=!1;
var a=this.history[this.index];return this._changes.send(a),this._latestActiveCommit.set(a),a},commit:function(a){return a===this.history[this.index]?void this.cancelCommitBeingWorkedOn():(this.isWorkingOnCommit=!1,
this.index+=1,this.history.splice(this.index,this.history.length-this.index),this.history.push(a),this._changes.send(a),void this._latestActiveCommit.set(a));
},undo:function(){if(!this.isWorkingOnCommit){if(0===this.index)return;this.index-=1}this.isWorkingOnCommit=!1;var a=this.history[this.index];
return this._changes.send(a),this._latestActiveCommit.set(a),a},redo:function(){if(this.index+1!==this.history.length){this.index+=1,
this.isWorkingOnCommit=!1;var a=this.history[this.index];return this._changes.send(a),this._latestActiveCommit.set(a),a}},toString:function(){
return"Revision("+a({index:this.index,count:this.history.length,workingOnCommit:this.isWorkingOnCommit,head:this.history[this.index]
})+")"},isEqualTo:function(a){return a instanceof d&&this.index===a.index&&this.isWorkingOnCommit===a.isWorkingOnCommit&&b(this.history,a.history);
}},{startingAt:function(a){return new d([a],0,(!1))}})}();return{get Revision(){return g}}}),$traceurRuntime.registerModule("src/base/Seq.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Seq.js")).DetailedError,b={
if_same_instance_as_this_then_throw:!0},c={not_a_normal_value:!0},d=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray],e=function(a){
return"function"==typeof Object(a)[Symbol.iterator]},f=function(a,d,e){if(a!==c)return a;if(d===b)throw new Error(e);return d},g=function(){
function g(a){var b,c,d,f=void 0!==arguments[1]&&arguments[1];if(a instanceof g)c=a._iterable,d=a[Symbol.iterator];else if(f)b={},
Object.defineProperty(b,Symbol.iterator,{value:a,configurable:!0,enumerable:!0,writable:!0}),c=b,d=a;else{if(!e(a))throw new Error("Not iterable: "+a);
c=a,d=a[Symbol.iterator].bind(a)}this._iterable=c,this[Symbol.iterator]=d}return $traceurRuntime.createClass(g,{isEqualTo:function(a){
var b=void 0!==arguments[1]?arguments[1]:function(a,b){return a===b};if(!e(a))return!1;if(a===this)return!0;var c=a[Symbol.iterator](),d=!0,f=!1,g=void 0;
try{for(var h=void 0,i=this._iterable[Symbol.iterator]();!(d=(h=i.next()).done);d=!0){var j=h.value,k=c.next();if(k.done||!b(j,k.value))return!1;
}}catch(l){f=!0,g=l}finally{try{d||null==i["return"]||i["return"]()}finally{if(f)throw g}}return c.next().done},toArray:function(){
return Array.from(this._iterable)},toFloat32Array:function(){var a=this.tryPeekCount();if(void 0===a)return new Float32Array(this.toArray());
var b=new Float32Array(a),c=0,d=!0,e=!1,f=void 0;try{for(var g=void 0,h=this._iterable[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){
var i=g.value;b[c++]=i}}catch(j){e=!0,f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return b},toSet:function(){
return new Set(this._iterable)},join:function(a){return this.toArray().join(a)},toString:function(){return"Seq["+this.join(", ")+"]";
},solidify:function(){var a=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array];if(Array.isArray(this._iterable))return this;
var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=a[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var h=e.value;if(this._iterable instanceof h)return this;
}}catch(i){c=!0,d=i}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return new g(this.toArray())},map:function(a){
var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){var d,e,f,g,h,i,j;return $traceurRuntime.createGeneratorInstance(function(c){
for(;;)switch(c.state){case 0:d=!0,e=!1,f=void 0,c.state=24;break;case 24:c.pushTry(10,11),c.state=13;break;case 13:g=void 0,h=b[Symbol.iterator](),
c.state=9;break;case 9:c.state=(d=(g=h.next()).done)?7:5;break;case 4:d=!0,c.state=9;break;case 5:i=g.value,c.state=6;break;case 6:
return c.state=2,a(i);case 2:c.maybeThrow(),c.state=4;break;case 7:c.popTry(),c.state=11,c.finallyFallThrough=-2;break;case 10:c.popTry(),
c.maybeUncatchable(),j=c.storedException,c.state=16;break;case 16:e=!0,f=j,c.state=11,c.finallyFallThrough=-2;break;case 11:c.popTry(),
c.state=22;break;case 22:try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}c.state=20;break;case 20:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},mapWithIndex:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=0,e=!0,f=!1,g=void 0,
c.state=26;break;case 26:c.pushTry(12,13),c.state=15;break;case 15:h=void 0,i=b[Symbol.iterator](),c.state=11;break;case 11:c.state=(e=(h=i.next()).done)?9:7;
break;case 6:e=!0,c.state=11;break;case 7:j=h.value,c.state=8;break;case 8:return c.state=2,a(j,d);case 2:c.maybeThrow(),c.state=4;
break;case 4:d+=1,c.state=6;break;case 9:c.popTry(),c.state=13,c.finallyFallThrough=-2;break;case 12:c.popTry(),c.maybeUncatchable(),
k=c.storedException,c.state=18;break;case 18:f=!0,g=k,c.state=13,c.finallyFallThrough=-2;break;case 13:c.popTry(),c.state=24;break;
case 24:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=22;break;case 22:c.state=c.finallyFallThrough;break;default:
return c.end()}},c,this)}))},flatMap:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=!0,e=!1,f=void 0,
c.state=32;break;case 32:c.pushTry(18,19),c.state=21;break;case 21:g=void 0,h=b[Symbol.iterator](),c.state=17;break;case 17:c.state=(d=(g=h.next()).done)?15:13;
break;case 10:d=!0,c.state=17;break;case 13:i=g.value,c.state=14;break;case 14:j=c.wrapYieldStar(a(i)[Symbol.iterator]()),c.sent=void 0,
c.action="next",c.state=12;break;case 12:k=j[c.action](c.sentIgnoreThrow),c.state=9;break;case 9:c.state=k.done?3:2;break;case 3:
c.sent=k.value,c.state=10;break;case 2:return c.state=12,k.value;case 15:c.popTry(),c.state=19,c.finallyFallThrough=-2;break;case 18:
c.popTry(),c.maybeUncatchable(),l=c.storedException,c.state=24;break;case 24:e=!0,f=l,c.state=19,c.finallyFallThrough=-2;break;case 19:
c.popTry(),c.state=30;break;case 30:try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}c.state=28;break;case 28:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},filter:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=!0,e=!1,f=void 0,c.state=25;
break;case 25:c.pushTry(11,12),c.state=14;break;case 14:g=void 0,h=b[Symbol.iterator](),c.state=10;break;case 10:c.state=(d=(g=h.next()).done)?8:6;
break;case 4:d=!0,c.state=10;break;case 6:i=g.value,c.state=7;break;case 7:c.state=a(i)?1:4;break;case 1:return c.state=2,i;case 2:
c.maybeThrow(),c.state=4;break;case 8:c.popTry(),c.state=12,c.finallyFallThrough=-2;break;case 11:c.popTry(),c.maybeUncatchable(),
j=c.storedException,c.state=17;break;case 17:e=!0,f=j,c.state=12,c.finallyFallThrough=-2;break;case 12:c.popTry(),c.state=23;break;
case 23:try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}c.state=21;break;case 21:c.state=c.finallyFallThrough;break;default:
return c.end()}},c,this)}))},filterWithIndex:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=0,e=!0,f=!1,g=void 0,
c.state=27;break;case 27:c.pushTry(13,14),c.state=16;break;case 16:h=void 0,i=b[Symbol.iterator](),c.state=12;break;case 12:c.state=(e=(h=i.next()).done)?10:8;
break;case 7:e=!0,c.state=12;break;case 8:j=h.value,c.state=9;break;case 9:c.state=a(j,d)?1:4;break;case 1:return c.state=2,j;case 2:
c.maybeThrow(),c.state=4;break;case 4:d++,c.state=7;break;case 10:c.popTry(),c.state=14,c.finallyFallThrough=-2;break;case 13:c.popTry(),
c.maybeUncatchable(),k=c.storedException,c.state=19;break;case 19:f=!0,g=k,c.state=14,c.finallyFallThrough=-2;break;case 14:c.popTry(),
c.state=25;break;case 25:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=23;break;case 23:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},fold:function(a){var d=void 0!==arguments[1]?arguments[1]:b,e=c,g=!0,h=!1,i=void 0;try{
for(var j=void 0,k=this._iterable[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;e=e===c?l:a(e,l)}}catch(m){h=!0,i=m;
}finally{try{g||null==k["return"]||k["return"]()}finally{if(h)throw i}}return f(e,d,"Folded empty sequence without providing an alternative result.");
},aggregate:function(a,b){var c=a,d=!0,e=!1,f=void 0;try{for(var g=void 0,h=this._iterable[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){
var i=g.value;c=b(c,i)}}catch(j){e=!0,f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c},zip:function(a,b){
var c=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){var e,f,g,h,i,j,k,l,m;return $traceurRuntime.createGeneratorInstance(function(d){
for(;;)switch(d.state){case 0:e=a[Symbol.iterator](),f=!0,g=!1,h=void 0,d.state=29;break;case 29:d.pushTry(15,16),d.state=18;break;
case 18:i=void 0,j=c[Symbol.iterator](),d.state=14;break;case 14:d.state=(f=(i=j.next()).done)?12:10;break;case 7:f=!0,d.state=14;
break;case 10:k=i.value,d.state=11;break;case 11:l=e.next(),d.state=9;break;case 9:d.state=l.done?12:2;break;case 2:return d.state=5,
b(k,l.value);case 5:d.maybeThrow(),d.state=7;break;case 12:d.popTry(),d.state=16,d.finallyFallThrough=-2;break;case 15:d.popTry(),
d.maybeUncatchable(),m=d.storedException,d.state=21;break;case 21:g=!0,h=m,d.state=16,d.finallyFallThrough=-2;break;case 16:d.popTry(),
d.state=27;break;case 27:try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}d.state=25;break;case 25:d.state=d.finallyFallThrough;
break;default:return d.end()}},d,this)}))},max:function(){var a=void 0!==arguments[0]?arguments[0]:b;return this.fold(function(a,b){
return a<b?b:a},a)},min:function(){var a=void 0!==arguments[0]?arguments[0]:b;return this.fold(function(a,b){return a<b?a:b},a)},
maxBy:function(a){var d=void 0!==arguments[1]?arguments[1]:b,e=void 0!==arguments[2]?arguments[2]:function(a,b){return a<b},g=c,h=c,i=!0,j=!1,k=void 0;
try{for(var l=void 0,m=this._iterable[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;if(g!==c){h===c&&(h=a(g));var o=a(n);
e(h,o)&&(g=n,h=o)}else g=n}}catch(p){j=!0,k=p}finally{try{i||null==m["return"]||m["return"]()}finally{if(j)throw k}}return f(g,d,"Can't maxBy an empty sequence.");
},minBy:function(a){var c=void 0!==arguments[1]?arguments[1]:b,d=void 0!==arguments[2]?arguments[2]:function(a,b){return a<b};return this.maxBy(a,c,function(a,b){
return d(b,a)})},any:function(a){var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this._iterable[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;if(a(g))return!0}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return!1},
every:function(a){return!this.any(function(b){return!a(b)})},contains:function(a){return this.any(function(b){return b===a})},sum:function(){
var a=0,b=!0,c=!0,d=!1,e=void 0;try{for(var f=void 0,g=this._iterable[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;
a=b?h:a+h,b=!1}}catch(i){d=!0,e=i}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return a},product:function(){
return this.fold(function(a,b){return a*b},1)},scan:function(a,b){var c=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){
var e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:e=a,d.state=30;break;
case 30:return d.state=2,e;case 2:d.maybeThrow(),d.state=4;break;case 4:f=!0,g=!1,h=void 0,d.state=32;break;case 32:d.pushTry(16,17),
d.state=19;break;case 19:i=void 0,j=c[Symbol.iterator](),d.state=15;break;case 15:d.state=(f=(i=j.next()).done)?13:11;break;case 8:
f=!0,d.state=15;break;case 11:k=i.value,d.state=12;break;case 12:e=b(e,k),d.state=10;break;case 10:return d.state=6,e;case 6:d.maybeThrow(),
d.state=8;break;case 13:d.popTry(),d.state=17,d.finallyFallThrough=-2;break;case 16:d.popTry(),d.maybeUncatchable(),l=d.storedException,
d.state=22;break;case 22:g=!0,h=l,d.state=17,d.finallyFallThrough=-2;break;case 17:d.popTry(),d.state=28;break;case 28:try{f||null==j["return"]||j["return"]();
}finally{if(g)throw h}d.state=26;break;case 26:d.state=d.finallyFallThrough;break;default:return d.end()}},d,this)}))},reverse:function(){
return new g(this.toArray().reverse())},flatten:function(){var a=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function b(){
var c,d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(b){for(;;)switch(b.state){case 0:c=!0,d=!1,e=void 0,
b.state=32;break;case 32:b.pushTry(18,19),b.state=21;break;case 21:f=void 0,g=a[Symbol.iterator](),b.state=17;break;case 17:b.state=(c=(f=g.next()).done)?15:13;
break;case 10:c=!0,b.state=17;break;case 13:h=f.value,b.state=14;break;case 14:i=b.wrapYieldStar(h[Symbol.iterator]()),b.sent=void 0,
b.action="next",b.state=12;break;case 12:j=i[b.action](b.sentIgnoreThrow),b.state=9;break;case 9:b.state=j.done?3:2;break;case 3:
b.sent=j.value,b.state=10;break;case 2:return b.state=12,j.value;case 15:b.popTry(),b.state=19,b.finallyFallThrough=-2;break;case 18:
b.popTry(),b.maybeUncatchable(),k=b.storedException,b.state=24;break;case 24:d=!0,e=k,b.state=19,b.finallyFallThrough=-2;break;case 19:
b.popTry(),b.state=30;break;case 30:try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}b.state=28;break;case 28:b.state=b.finallyFallThrough;
break;default:return b.end()}},b,this)}))},concat:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=c.wrapYieldStar(b[Symbol.iterator]()),
c.sent=void 0,c.action="next",c.state=12;break;case 12:e=d[c.action](c.sentIgnoreThrow),c.state=9;break;case 9:c.state=e.done?3:2;
break;case 3:c.sent=e.value,c.state=10;break;case 2:return c.state=12,e.value;case 10:f=c.wrapYieldStar(a[Symbol.iterator]()),c.sent=void 0,
c.action="next",c.state=24;break;case 24:g=f[c.action](c.sentIgnoreThrow),c.state=21;break;case 21:c.state=g.done?15:14;break;case 15:
c.sent=g.value,c.state=-2;break;case 14:return c.state=24,g.value;default:return c.end()}},c,this)}))},withOverlayedItem:function(a,b){
if(a<0)throw new Error("needed index >= 0");var c=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){
var e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:if(void 0!==c.tryPeekCount()&&a>=c.tryPeekCount())throw new Error("needed index <= count");
e=0,f=!0,g=!1,h=void 0,d.state=26;break;case 26:d.pushTry(12,13),d.state=15;break;case 15:i=void 0,j=c._iterable[Symbol.iterator](),
d.state=11;break;case 11:d.state=(f=(i=j.next()).done)?9:7;break;case 6:f=!0,d.state=11;break;case 7:k=i.value,d.state=8;break;case 8:
return d.state=2,e===a?b:k;case 2:d.maybeThrow(),d.state=4;break;case 4:e++,d.state=6;break;case 9:d.popTry(),d.state=13,d.finallyFallThrough=17;
break;case 12:d.popTry(),d.maybeUncatchable(),l=d.storedException,d.state=18;break;case 18:g=!0,h=l,d.state=13,d.finallyFallThrough=17;
break;case 13:d.popTry(),d.state=24;break;case 24:try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}d.state=22;break;case 17:
if(e<=a)throw new Error("sequence ended before overlay [withOverlayedItem(${index}, ${overlayedItem})]");d.state=-2;break;case 22:
d.state=d.finallyFallThrough;break;default:return d.end()}},d,this)}))},withTransformedItem:function(a,b){if(a<0)throw new Error("needed index >= 0");
var c=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){var e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(d){
for(;;)switch(d.state){case 0:if(void 0!==c.tryPeekCount()&&a>=c.tryPeekCount())throw new Error("needed index <= count");e=0,f=!0,
g=!1,h=void 0,d.state=26;break;case 26:d.pushTry(12,13),d.state=15;break;case 15:i=void 0,j=c._iterable[Symbol.iterator](),d.state=11;
break;case 11:d.state=(f=(i=j.next()).done)?9:7;break;case 6:f=!0,d.state=11;break;case 7:k=i.value,d.state=8;break;case 8:return d.state=2,
e===a?b(k):k;case 2:d.maybeThrow(),d.state=4;break;case 4:e++,d.state=6;break;case 9:d.popTry(),d.state=13,d.finallyFallThrough=17;
break;case 12:d.popTry(),d.maybeUncatchable(),l=d.storedException,d.state=18;break;case 18:g=!0,h=l,d.state=13,d.finallyFallThrough=17;
break;case 13:d.popTry(),d.state=24;break;case 24:try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}d.state=22;break;case 17:
if(e<=a)throw new Error("sequence ended before transformation [withTransformedItem(${index}, ${itemTransformation})]");d.state=-2;
break;case 22:d.state=d.finallyFallThrough;break;default:return d.end()}},d,this)}))},withInsertedItem:function(a,b){if(a<0)throw new Error("needed index >= 0");
var c=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){var e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(d){
for(;;)switch(d.state){case 0:if(void 0!==c.tryPeekCount()&&a>c.tryPeekCount())throw new Error("needed index <= count");e=0,f=!0,
g=!1,h=void 0,d.state=36;break;case 36:d.pushTry(17,18),d.state=20;break;case 20:i=void 0,j=c._iterable[Symbol.iterator](),d.state=16;
break;case 16:d.state=(f=(i=j.next()).done)?14:12;break;case 9:f=!0,d.state=16;break;case 12:k=i.value,d.state=13;break;case 13:d.state=e===a?1:4;
break;case 1:return d.state=2,b;case 2:d.maybeThrow(),d.state=4;break;case 4:e++,d.state=11;break;case 11:return d.state=7,k;case 7:
d.maybeThrow(),d.state=9;break;case 14:d.popTry(),d.state=18,d.finallyFallThrough=22;break;case 17:d.popTry(),d.maybeUncatchable(),
l=d.storedException,d.state=23;break;case 23:g=!0,h=l,d.state=18,d.finallyFallThrough=22;break;case 18:d.popTry(),d.state=29;break;
case 29:try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}d.state=27;break;case 22:d.state=e===a?30:33;break;case 30:return d.state=31,
b;case 31:d.maybeThrow(),d.state=33;break;case 33:if(e<a)throw new Error("sequence ended before insertion [withInsertedItem(${index}, ${item})]");
d.state=-2;break;case 27:d.state=d.finallyFallThrough;break;default:return d.end()}},d,this)}))},takeWhile:function(a){var b=this._iterable;
return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){var d,e,f,g,h,i,j;return $traceurRuntime.createGeneratorInstance(function(c){
for(;;)switch(c.state){case 0:d=!0,e=!1,f=void 0,c.state=27;break;case 27:c.pushTry(13,14),c.state=16;break;case 16:g=void 0,h=b[Symbol.iterator](),
c.state=12;break;case 12:c.state=(d=(g=h.next()).done)?10:8;break;case 7:d=!0,c.state=12;break;case 8:i=g.value,c.state=9;break;case 9:
c.state=a(i)?2:10;break;case 2:return c.state=5,i;case 5:c.maybeThrow(),c.state=7;break;case 10:c.popTry(),c.state=14,c.finallyFallThrough=-2;
break;case 13:c.popTry(),c.maybeUncatchable(),j=c.storedException,c.state=19;break;case 19:e=!0,f=j,c.state=14,c.finallyFallThrough=-2;
break;case 14:c.popTry(),c.state=25;break;case 25:try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}c.state=23;break;case 23:
c.state=c.finallyFallThrough;break;default:return c.end()}},c,this)}))},skipTailWhile:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k,l,m;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=[],e=!0,f=!1,g=void 0,
c.state=41;break;case 41:c.pushTry(27,28),c.state=30;break;case 30:h=void 0,i=b[Symbol.iterator](),c.state=26;break;case 26:c.state=(e=(h=i.next()).done)?24:22;
break;case 20:e=!0,c.state=26;break;case 22:j=h.value,c.state=23;break;case 23:c.state=a(j)?19:11;break;case 19:d.push(j),c.state=20;
break;case 11:k=c.wrapYieldStar(d[Symbol.iterator]()),c.sent=void 0,c.action="next",c.state=12;break;case 12:l=k[c.action](c.sentIgnoreThrow),
c.state=9;break;case 9:c.state=l.done?3:2;break;case 3:c.sent=l.value,c.state=10;break;case 2:return c.state=12,l.value;case 10:d=[],
c.state=18;break;case 18:return c.state=14,j;case 14:c.maybeThrow(),c.state=20;break;case 24:c.popTry(),c.state=28,c.finallyFallThrough=-2;
break;case 27:c.popTry(),c.maybeUncatchable(),m=c.storedException,c.state=33;break;case 33:f=!0,g=m,c.state=28,c.finallyFallThrough=-2;
break;case 28:c.popTry(),c.state=39;break;case 39:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=37;break;case 37:
c.state=c.finallyFallThrough;break;default:return c.end()}},c,this)}))},skipWhile:function(a){var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=!0,e=!0,f=!1,g=void 0,
c.state=27;break;case 27:c.pushTry(13,14),c.state=16;break;case 16:h=void 0,i=b[Symbol.iterator](),c.state=12;break;case 12:c.state=(e=(h=i.next()).done)?10:8;
break;case 4:e=!0,c.state=12;break;case 8:j=h.value,c.state=9;break;case 9:d=d&&a(j),c.state=7;break;case 7:c.state=d?4:1;break;case 1:
return c.state=2,j;case 2:c.maybeThrow(),c.state=4;break;case 10:c.popTry(),c.state=14,c.finallyFallThrough=-2;break;case 13:c.popTry(),
c.maybeUncatchable(),k=c.storedException,c.state=19;break;case 19:f=!0,g=k,c.state=14,c.finallyFallThrough=-2;break;case 14:c.popTry(),
c.state=25;break;case 25:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=23;break;case 23:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},take:function(a){if(a<0)throw new Error("needed maxTakeCount >= 0");if(0===a)return new g([]);
var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){
for(;;)switch(c.state){case 0:d=0,e=!0,f=!1,g=void 0,c.state=29;break;case 29:c.pushTry(15,16),c.state=18;break;case 18:h=void 0,
i=b[Symbol.iterator](),c.state=14;break;case 14:c.state=(e=(h=i.next()).done)?12:10;break;case 6:e=!0,c.state=14;break;case 10:j=h.value,
c.state=11;break;case 11:return c.state=2,j;case 2:c.maybeThrow(),c.state=4;break;case 4:d++,c.state=9;break;case 9:c.state=d>=a?12:6;
break;case 12:c.popTry(),c.state=16,c.finallyFallThrough=-2;break;case 15:c.popTry(),c.maybeUncatchable(),k=c.storedException,c.state=21;
break;case 21:f=!0,g=k,c.state=16,c.finallyFallThrough=-2;break;case 16:c.popTry(),c.state=27;break;case 27:try{e||null==i["return"]||i["return"]();
}finally{if(f)throw g}c.state=25;break;case 25:c.state=c.finallyFallThrough;break;default:return c.end()}},c,this)}))},skip:function(a){
if(a<0)throw new Error("needed maxSkipCount >= 0");if(0===a)return this;var b=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=0,e=!0,f=!1,g=void 0,
c.state=27;break;case 27:c.pushTry(13,14),c.state=16;break;case 16:h=void 0,i=b[Symbol.iterator](),c.state=12;break;case 12:c.state=(e=(h=i.next()).done)?10:8;
break;case 7:e=!0,c.state=12;break;case 8:j=h.value,c.state=9;break;case 9:c.state=d>=a?1:4;break;case 1:return c.state=2,j;case 2:
c.maybeThrow(),c.state=4;break;case 4:d++,c.state=7;break;case 10:c.popTry(),c.state=14,c.finallyFallThrough=-2;break;case 13:c.popTry(),
c.maybeUncatchable(),k=c.storedException,c.state=19;break;case 19:f=!0,g=k,c.state=14,c.finallyFallThrough=-2;break;case 14:c.popTry(),
c.state=25;break;case 25:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=23;break;case 23:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},distinctBy:function(a){var b=this;return g.fromGenerator(function(){var c=new Set;return b.filter(function(b){
var d=a(b);return!c.has(d)&&(c.add(d),!0)})[Symbol.iterator]()})},distinct:function(){return this.distinctBy(function(a){return a;
})},segmentBy:function(a){var b=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){var d,e,f,g,h,i,j,k,l,m;
return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=[],e=void 0,f=!0,g=!1,h=void 0,c.state=36;
break;case 36:c.pushTry(17,18),c.state=20;break;case 20:i=void 0,j=b[Symbol.iterator](),c.state=16;break;case 16:c.state=(f=(i=j.next()).done)?14:12;
break;case 11:f=!0,c.state=16;break;case 12:k=i.value,c.state=13;break;case 13:l=a(k),c.state=9;break;case 9:c.state=d.length>0&&l!==e?1:6;
break;case 1:return c.state=2,d;case 2:c.maybeThrow(),c.state=4;break;case 4:d=[],c.state=6;break;case 6:d.push(k),e=l,c.state=11;
break;case 14:c.popTry(),c.state=18,c.finallyFallThrough=22;break;case 17:c.popTry(),c.maybeUncatchable(),m=c.storedException,c.state=23;
break;case 23:g=!0,h=m,c.state=18,c.finallyFallThrough=22;break;case 18:c.popTry(),c.state=29;break;case 29:try{f||null==j["return"]||j["return"]();
}finally{if(g)throw h}c.state=27;break;case 22:c.state=d.length>0?30:-2;break;case 30:return c.state=31,d;case 31:c.maybeThrow(),
c.state=-2;break;case 27:c.state=c.finallyFallThrough;break;default:return c.end()}},c,this)}))},single:function(){var a=void 0!==arguments[0]?arguments[0]:b,c=this[Symbol.iterator](),d=c.next();
if(!d.done&&c.next().done)return d.value;if(a===b)throw d.done?new Error("Empty sequence doesn't contain a single item."):new Error("Sequence contains more than a single item.");
return a},first:function(){var a=void 0!==arguments[0]?arguments[0]:b,c=this[Symbol.iterator](),d=c.next();if(!d.done)return d.value;
if(a===b)throw new Error("Empty sequence has no first item.");return a},last:function(){var a=void 0!==arguments[0]?arguments[0]:b,d=c,e=!0,g=!1,h=void 0;
try{for(var i=void 0,j=this._iterable[Symbol.iterator]();!(e=(i=j.next()).done);e=!0){var k=i.value;d=k}}catch(l){g=!0,h=l}finally{
try{e||null==j["return"]||j["return"]()}finally{if(g)throw h}}return f(d,a,"Empty sequence has no last item.")},tryPeekCount:function(){
var a=this;return Array.isArray(this._iterable)||!d.every(function(b){return!(a._iterable instanceof b)})?this._iterable.length:this._iterable instanceof Map||this._iterable instanceof Set?this._iterable.size:void 0;
},count:function(){var a=this.tryPeekCount();if(void 0!==a)return a;var b=0,c=!0,d=!1,e=void 0;try{for(var f=void 0,g=this._iterable[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
f.value;b++}}catch(h){d=!0,e=h}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return b},padded:function(a){
var b=arguments[1];if(a<0)throw new Error("needed minCount >= 0");var c=this._iterable;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){
var e,f,g,h,i,j,k,l;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:e=a,f=!0,g=!1,h=void 0,
d.state=33;break;case 33:d.pushTry(12,13),d.state=15;break;case 15:i=void 0,j=c[Symbol.iterator](),d.state=11;break;case 11:d.state=(f=(i=j.next()).done)?9:7;
break;case 6:f=!0,d.state=11;break;case 7:k=i.value,d.state=8;break;case 8:return d.state=2,k;case 2:d.maybeThrow(),d.state=4;break;
case 4:e-=1,d.state=6;break;case 9:d.popTry(),d.state=13,d.finallyFallThrough=17;break;case 12:d.popTry(),d.maybeUncatchable(),l=d.storedException,
d.state=18;break;case 18:g=!0,h=l,d.state=13,d.finallyFallThrough=17;break;case 13:d.popTry(),d.state=24;break;case 24:try{f||null==j["return"]||j["return"]();
}finally{if(g)throw h}d.state=22;break;case 17:d.state=e>0?25:-2;break;case 25:return d.state=26,b;case 26:d.maybeThrow(),d.state=28;
break;case 28:e-=1,d.state=17;break;case 22:d.state=d.finallyFallThrough;break;default:return d.end()}},d,this)}))},sorted:function(){
return h(this.toArray().sort())},sortedBy:function(a){return h(this.toArray().sort(function(b,c){var d=a(b),e=a(c);return d<e?-1:d>e?1:0;
}))},ifThen:function(a,b){return a?new g(b(this)):this},toMap:function(a,b){var c=new Map,d=!0,e=!1,f=void 0;try{for(var g=void 0,h=this._iterable[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){
var i=g.value,j=a(i),k=b(i);if(c.has(j))throw new Error("Duplicate key <"+j+">. Came from item <"+i+">.");c.set(j,k)}}catch(l){e=!0,
f=l}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c},keyedBy:function(a){return this.toMap(a,function(a){
return a})},groupBy:function(a){var b=new Map,c=!0,d=!1,e=void 0;try{for(var f=void 0,g=this._iterable[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value,i=a(h);b.has(i)||b.set(i,[]),b.get(i).push(h)}}catch(j){d=!0,e=j}finally{try{c||null==g["return"]||g["return"]()}finally{
if(d)throw e}}return b},partitioned:function(a){if(a<=0)throw new Error("need partitionSize > 0");var b=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var d,e,f,g,h,i,j,k;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:d=[],e=!0,f=!1,g=void 0,
c.state=34;break;case 34:c.pushTry(15,16),c.state=18;break;case 18:h=void 0,i=b[Symbol.iterator](),c.state=14;break;case 14:c.state=(e=(h=i.next()).done)?12:10;
break;case 6:e=!0,c.state=14;break;case 10:j=h.value,c.state=11;break;case 11:d.push(j),c.state=9;break;case 9:c.state=d.length>=a?1:6;
break;case 1:return c.state=2,d;case 2:c.maybeThrow(),c.state=4;break;case 4:d=[],c.state=6;break;case 12:c.popTry(),c.state=16,c.finallyFallThrough=20;
break;case 15:c.popTry(),c.maybeUncatchable(),k=c.storedException,c.state=21;break;case 21:f=!0,g=k,c.state=16,c.finallyFallThrough=20;
break;case 16:c.popTry(),c.state=27;break;case 27:try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}c.state=25;break;case 20:
c.state=d.length>0?28:-2;break;case 28:return c.state=29,d;case 29:c.maybeThrow(),c.state=-2;break;case 25:c.state=c.finallyFallThrough;
break;default:return c.end()}},c,this)}))},stride:function(a){return this.filterWithIndex(function(b,c){return c%a===0})},breadthFirstSearch:function(a){
var b=void 0!==arguments[1]?arguments[1]:function(a){return a},c=this;return g.fromGenerator($traceurRuntime.initGeneratorFunction(function d(){
var e,f,g,h,i,j,k,l,m,n,o;return $traceurRuntime.createGeneratorInstance(function(d){for(;;)switch(d.state){case 0:e=new Set,f=c.toArray(),
d.state=16;break;case 16:g=0,d.state=14;break;case 14:d.state=g<f.length?8:-2;break;case 7:g++,d.state=14;break;case 8:h=f[g],i=b(h),
d.state=9;break;case 9:d.state=e.has(i)?7:2;break;case 2:e.add(i),j=!0,k=!1,l=void 0;try{for(m=void 0,n=a(h)[Symbol.iterator]();!(j=(m=n.next()).done);j=!0)o=m.value,
f.push(o)}catch(p){k=!0,l=p}finally{try{j||null==n["return"]||n["return"]()}finally{if(k)throw l}}d.state=11;break;case 11:return d.state=5,
h;case 5:d.maybeThrow(),d.state=7;break;default:return d.end()}},d,this)}))}},{fromGenerator:function(a){return new g(a,(!0))},range:function(b){
if(!Number.isInteger(b)||b<0)throw new a("bad count",{count:b});return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){
var a;return $traceurRuntime.createGeneratorInstance(function(c){for(;;)switch(c.state){case 0:a=0,c.state=7;break;case 7:c.state=a<b?1:-2;
break;case 4:a++,c.state=7;break;case 1:return c.state=2,a;case 2:c.maybeThrow(),c.state=4;break;default:return c.end()}},c,this);
}))},naturals:function(){return g.fromGenerator($traceurRuntime.initGeneratorFunction(function a(){var b;return $traceurRuntime.createGeneratorInstance(function(a){
for(;;)switch(a.state){case 0:b=0,a.state=9;break;case 9:a.state=1;break;case 1:return a.state=2,b;case 2:a.maybeThrow(),a.state=4;
break;case 4:b++,a.state=9;break;default:return a.end()}},a,this)}))},repeat:function(a,b){if(b<0)throw new Error("needed repeatCount >= 0");
return g.fromGenerator($traceurRuntime.initGeneratorFunction(function c(){var d;return $traceurRuntime.createGeneratorInstance(function(c){
for(;;)switch(c.state){case 0:d=0,c.state=7;break;case 7:c.state=d<b?1:-2;break;case 4:d++,c.state=7;break;case 1:return c.state=2,
a;case 2:c.maybeThrow(),c.state=4;break;default:return c.end()}},c,this)}))}})}(),h=function(a){return new g(a)};return{get THROW_IF_EMPTY(){
return b},get seq(){return h},get Seq(){return g}}}),$traceurRuntime.registerModule("src/base/Util.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/base/Util.js")).DetailedError,b=function(){
function b(){}return $traceurRuntime.createClass(b,{},{need:function(a,b,c){if(a!==!0){var d=void 0===c?"(not provided)":"["+Array.prototype.slice.call(c).join(", ")+"]",e=void 0===b?"(not provided)":b,f="Precondition failed\n\nMessage: "+e+"\n\nArgs: "+d;
throw new Error(f)}},numberOfSetBits:function(a){if(a<0)throw new Error("i < 0");if(!Number.isInteger(a))throw new Error("!Number.isInteger(i)");
if(a>4294967295)throw new Error("i > 0xFFFFFFFF");return a=(1431655765&a)+(a>>1&1431655765),a=(858993459&a)+(a>>2&858993459),a=a+(a>>4)&252645135,
a+=a>>8,a+=a>>16,255&a},bin:function(a,b){return("0".repeat(b)+a.toString(2)).slice(-b).split("").join("")},notNull:function(a){return b.need(null!==a,"notNull"),
a},isPowerOf2:function(a){return a>0&&0===(a-1&a)},bitSize:function(a){return b.need(a>=0,"bitSize: n >= 0"),0===a?0:b.floorLg2(a)+1;
},ceilingPowerOf2:function(a){return a<=1?1:1<<b.ceilLg2(a)},ceilLg2:function(a){if(a<=1)return 0;var b=Math.ceil(Math.log2(a)),c=1<<b;
return c<a?b+1:c>=2*a?b-1:b},floorLg2:function(a){if(a<=1)return 0;var b=Math.floor(Math.log2(a)),c=1<<b;return 2*c<a?b+1:c>a?b-1:b;
},powerOfTwoness:function(a){if(0===a)return Math.POSITIVE_INFINITY;if(a<0)return b.powerOfTwoness(-a);var c=a^a-1,d=a&c;return Math.round(Math.log2(d));
},reverseGroupMap:function(a){var b,c,d=void 0!==arguments[1]&&arguments[1],e=new Map;if(d){var f=!0,g=!1,h=void 0;try{for(var i=void 0,j=a.keys()[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value;e.set(k,[])}}catch(l){g=!0,h=l}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}}}var m=!0,n=!1,o=void 0;
try{for(var p=void 0,q=a[Symbol.iterator]();!(m=(p=q.next()).done);m=!0){var r=p.value,s=(b=r[Symbol.iterator](),(c=b.next()).done?void 0:c.value),t=(c=b.next()).done?void 0:c.value,u=!0,v=!1,w=void 0;
try{for(var x=void 0,y=t[Symbol.iterator]();!(u=(x=y.next()).done);u=!0){var z=x.value;e.has(z)||e.set(z,[]),e.get(z).push(s)}}catch(A){
v=!0,w=A}finally{try{u||null==y["return"]||y["return"]()}finally{if(v)throw w}}}}catch(B){n=!0,o=B}finally{try{m||null==q["return"]||q["return"]();
}finally{if(n)throw o}}return e},binarySearchForTransitionFromTrueToFalse:function(a,b){for(var c=0;a>c;){var d=c+Math.floor((a-c)/2);
b(d)?c=d+1:a=d}return c},breakLine:function(a,c,d){if(""===a)return[""];for(var e=[],f=0;f<a.length;){var g=b.binarySearchForTransitionFromTrueToFalse(a.length-f+1,function(b){
return d(a.substr(f,b))<=c})-1;g=Math.max(1,g);var h=a.substr(f,g),i=f+g===a.length||null!==a.substr(f+g,1).match(/\s/);if(!i){var j=/^(.*\S)(\s+)\S*$/,k=j.exec(h);
if(null!==k){var l=k[1],m=k[2];e.push(l.trim()),f+=l.length+m.length;continue}}e.push(h.trim()),f+=h.length,f+=a.substr(f).match(/^\s*/)[0].length;
}return e},decomposeObjectValues:function(a){var b,c=[];b=function(a){if(Array.isArray(a)){var d=!0,e=!1,f=void 0;try{for(var g=void 0,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){
var i=g.value;b(i)}}catch(j){e=!0,f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}}else c.push(a)};var d=!0,e=!1,f=void 0;
try{for(var g=void 0,h=Object.keys(a).sort()[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;b(a[i],c)}}catch(j){e=!0,
f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c},recomposedObjectValues:function(a,c){var d,e={},f=0;
d=function(a){if(Array.isArray(a)){var b=[],e=!0,g=!1,h=void 0;try{for(var i=void 0,j=a[Symbol.iterator]();!(e=(i=j.next()).done);e=!0){
var k=i.value;b.push(d(k))}}catch(l){g=!0,h=l}finally{try{e||null==j["return"]||j["return"]()}finally{if(g)throw h}}return b}return c[f++];
};var g=!0,h=!1,i=void 0;try{for(var j=void 0,k=Object.keys(a).sort()[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;
e[l]=d(a[l])}}catch(m){h=!0,i=m}finally{try{g||null==k["return"]||k["return"]()}finally{if(h)throw i}}return b.need(f===c.length,"Mismatched field value count."),
e},objectifyArrayFunc:function(a){return function(c){return b.recomposedObjectValues(c,a(b.decomposeObjectValues(c)))}},snappedCosSin:function(a){
var b=Math.PI/4,c=Math.round(a/b);if(c*b===a){var d=Math.sqrt(.5),e=[[1,0],[d,d],[0,1],[-d,d],[-1,0],[-d,-d],[0,-1],[d,-d]];return e[7&c];
}return[Math.cos(a),Math.sin(a)]},properMod:function(b,c){if(c<=0)throw new a("denominator <= 0",{numerator:b,denominator:c});var d=b%c;
return d+(d<0?c:0)},mergeMaps:function(){for(var a,b,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var e=new Map,f=!0,g=!1,h=void 0;
try{for(var i=void 0,j=c[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=!0,m=!1,n=void 0;try{for(var o=void 0,p=k.entries()[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){
var q=o.value,r=(a=q[Symbol.iterator](),(b=a.next()).done?void 0:b.value),s=(b=a.next()).done?void 0:b.value;e.set(r,s)}}catch(t){
m=!0,n=t}finally{try{l||null==p["return"]||p["return"]()}finally{if(m)throw n}}}}catch(u){g=!0,h=u}finally{try{f||null==j["return"]||j["return"]();
}finally{if(g)throw h}}return e}})}();return b.STRICT_EQUALITY=function(a,b){return a===b},b.CUSTOM_IS_EQUAL_TO_EQUALITY=function(a,b){
return null===a?null===b:void 0===a?void 0===b:a.isEqualTo(b)},{get Util(){return b}}}),$traceurRuntime.registerModule("src/browser/Clipboard.js",[],function(){
"use strict";function a(a){if(document.selection){var b=document.body.createTextRange();b.moveToElementText(a),b.select()}else if(window.getSelection){
var c=document.createRange();c.selectNodeContents(a),window.getSelection().removeAllRanges(),window.getSelection().addRange(c)}if(!document.execCommand("copy"))throw new Error("execCommand failed");
}return{get selectAndCopyToClipboard(){return a}}}),$traceurRuntime.registerModule("src/browser/EventUtil.js",[],function(){"use strict";
function a(a){return b.of(b.elementEvent(a,"change"),b.elementEvent(a,"keyup"),b.elementEvent(a,"click"),b.elementEvent(a,"paste"),b.elementEvent(a,"input")).flatten().map(function(b){
return a.value}).whenDifferent()}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/browser/EventUtil.js")).Observable;
return{get textEditObservable(){return a}}}),$traceurRuntime.registerModule("src/browser/HistoryPusher.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/browser/HistoryPusher.js")).DetailedError,b=function(){
function b(){this._historyActionsNotWorking=!1,this._currentMemorableStateObj=void 0}return $traceurRuntime.createClass(b,{currentStateIsMemorableButUnknown:function(){
this._currentMemorableStateObj={wont_equal_this:!0}},currentStateIsMemorableAndEqualTo:function(a){this._currentMemorableStateObj=a;
},currentStateIsNotMemorable:function(){this._currentMemorableStateObj=void 0},stateChange:function(b,c){if(!c.startsWith("#"))throw new a("Expected a hash URL.",{
stateObj:b,stateUrlHash:c});if(this._currentMemorableStateObj!==b){if(this._historyActionsNotWorking)return void(document.location.hash=c);
try{void 0===this._currentMemorableStateObj?history.replaceState(b,"",c):(history.pushState(b,"",c),this._currentMemorableStateObj=void 0);
}catch(d){console.warn("Calling 'history.replaceState/pushState' failed. Falling back to setting location.hash.",d),this._historyActionsNotWorking=!0,
document.location.hash=c}}}},{})}();return{get HistoryPusher(){return b}}}),$traceurRuntime.registerModule("src/browser/MouseWatcher.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/browser/MouseWatcher.js")).Point,b=5e3,c="mouse!",d=function(a){
return void 0!==window.TouchEvent&&a instanceof TouchEvent||1===a.which},e=function(a){return 2===a.which},f=function(b,c){var d=c.getBoundingClientRect();
return new a(b.clientX-d.left,b.clientY-d.top)},g=function(a,b,c,d,e){return new i(a,b,c,d,e).addListenersUntilResultInvoked()},h=function(a,b,c){
return a.addEventListener(b,c),function(){return a.removeEventListener(b,c)}},i=function(){function a(a,b,c,d,e){this._element=a,
this._grabHandler=b,this._cancelHandler=c,this._dragHandler=d,this._dropHandler=e,this._grabPointerId=void 0,this._grabActivityTime=window.performance.now(),
this._lastPos=void 0,this._lastEv=void 0}return $traceurRuntime.createClass(a,{addListenersUntilResultInvoked:function(){var a=this,b=this._element,c=[h(b,"mousedown",function(b){
return a.handleMouseEventWith(b,a.onDown)}),h(document,"mousemove",function(b){return a.handleMouseEventWith(b,a.onMove)}),h(document,"mouseup",function(b){
return a.handleMouseEventWith(b,a.onUp)}),h(document,"mouseleave",function(b){return a.handleMouseEventWith(b,a.onLeave)}),h(document,"mouseenter",function(b){
return a.handleMouseEventWith(b,a.onEnter)}),h(b,"touchstart",function(b){return a.handleTouchEventWith(b,a.onDown)}),h(b,"touchmove",function(b){
return a.handleTouchEventWith(b,a.onMove)}),h(b,"touchend",function(b){return a.handleTouchEventWith(b,a.onUp)}),h(b,"touchcancel",function(b){
return a.handleTouchEventWith(b,a.onCancel)})];return function(){var a=!0,b=!1,d=void 0;try{for(var e=void 0,f=c[Symbol.iterator]();!(a=(e=f.next()).done);a=!0){
var g=e.value;g()}}catch(h){b=!0,d=h}finally{try{a||null==f["return"]||f["return"]()}finally{if(b)throw d}}}},canRegrab:function(){
return window.performance.now()>=this._grabActivityTime+b},onDown:function(a,b,c){if(d(c)){if(void 0!==this._grabPointerId){if(!this.canRegrab())return;
this._dropHandler(this._lastPos,this._lastEv)}this._grabPointerId=b,this._grabActivityTime=window.performance.now(),this._lastPos=a,
this._lastEv=c,this._grabHandler(a,c)}},onMove:function(a,b,c){if(this._grabPointerId===b){if(!d(c))return this._lastPos=void 0,this._lastEv=void 0,
this._grabPointerId=void 0,void this._dropHandler(void 0,c);this._grabActivityTime=window.performance.now(),this._lastPos=a,this._lastEv=c,
this._dragHandler(a,c)}},onCancel:function(a,b,c){this._grabPointerId===b&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,
this._cancelHandler(c))},onUp:function(a,b,c){d(c)&&this._grabPointerId===b&&(this._lastPos=void 0,this._lastEv=void 0,this._grabPointerId=void 0,
this._dropHandler(a,c))},onLeave:function(a,b,c){d(c)&&this._grabPointerId===b&&(this._grabActivityTime=window.performance.now(),
this._lastPos=void 0,this._lastEv=c,this._dragHandler(void 0,c))},onEnter:function(a,b,c){d(c)||this._grabPointerId!==b||(this._lastPos=void 0,
this._lastEv=void 0,this._grabPointerId=void 0,this._dropHandler(void 0,c))},relativeEventPos:function(a){return f(a,this._element);
},handleTouchEventWith:function(a,b){for(var c=0;c<a.changedTouches.length;c++){var d=a.changedTouches[c];b.call(this,this.relativeEventPos(d),d.identifier,a);
}},handleMouseEventWith:function(a,b){b.call(this,this.relativeEventPos(a),c,a)}},{})}();return{get watchDrags(){return g},get isLeftClicking(){
return d},get isMiddleClicking(){return e},get eventPosRelativeTo(){return f}}}),$traceurRuntime.registerModule("src/browser/Polyfills.js",[],function(){
"use strict";Float32Array.prototype.slice=Float32Array.prototype.slice||function(a,b){return new Float32Array(Array.from(this).slice(a,b));
},Float64Array.prototype.slice=Float64Array.prototype.slice||function(a,b){return new Float64Array(Array.from(this).slice(a,b))},
Uint32Array.prototype.slice=Uint32Array.prototype.slice||function(a,b){return new Uint32Array(Array.from(this).slice(a,b))},Int32Array.prototype.slice=Int32Array.prototype.slice||function(a,b){
return new Int32Array(Array.from(this).slice(a,b))},Uint16Array.prototype.slice=Uint16Array.prototype.slice||function(a,b){return new Uint16Array(Array.from(this).slice(a,b));
},Int16Array.prototype.slice=Int16Array.prototype.slice||function(a,b){return new Int16Array(Array.from(this).slice(a,b))},Uint8Array.prototype.slice=Uint8Array.prototype.slice||function(a,b){
return new Uint8Array(Array.from(this).slice(a,b))},Int8Array.prototype.slice=Int8Array.prototype.slice||function(a,b){return new Int8Array(Array.from(this).slice(a,b));
};var a=function(){var a=this;return $traceurRuntime.initGeneratorFunction(function b(){var c;return $traceurRuntime.createGeneratorInstance(function(b){
for(;;)switch(b.state){case 0:c=0,b.state=7;break;case 7:b.state=c<a.length?1:-2;break;case 4:c++,b.state=7;break;case 1:return b.state=2,
a[c];case 2:b.maybeThrow(),b.state=4;break;default:return b.end()}},b,this)})()};Float32Array.prototype[Symbol.iterator]=Float32Array.prototype[Symbol.iterator]||a,
Float64Array.prototype[Symbol.iterator]=Float64Array.prototype[Symbol.iterator]||a,Uint32Array.prototype[Symbol.iterator]=Uint32Array.prototype[Symbol.iterator]||a,
Uint16Array.prototype[Symbol.iterator]=Uint16Array.prototype[Symbol.iterator]||a,Uint8Array.prototype[Symbol.iterator]=Uint8Array.prototype[Symbol.iterator]||a,
Int32Array.prototype[Symbol.iterator]=Int32Array.prototype[Symbol.iterator]||a,Int16Array.prototype[Symbol.iterator]=Int16Array.prototype[Symbol.iterator]||a,
Int8Array.prototype[Symbol.iterator]=Int8Array.prototype[Symbol.iterator]||a,window.performance=window.performance||{},window.performance.now=window.performance.now||function(){
return Date.now()};var b=WebGLRenderingContext;if(void 0!==b&&void 0===b.INVALID_ENUM){var c=["ARRAY_BUFFER","CLAMP_TO_EDGE","COLOR_ATTACHMENT0","COMPILE_STATUS","ELEMENT_ARRAY_BUFFER","FLOAT","FRAGMENT_SHADER","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","HIGH_FLOAT","LINK_STATUS","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MEDIUM_FLOAT","NEAREST","NO_ERROR","RGBA","STATIC_DRAW","TEXTURE_2D","TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE0","TRIANGLES","UNSIGNED_SHORT","UNSIGNED_BYTE","VALIDATE_STATUS","VERTEX_SHADER"],d=document.createElement("canvas").getContext("webgl"),e=!0,f=!1,g=void 0;
try{for(var h=void 0,i=c[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;b[j]=b[j]||d[j]}}catch(k){f=!0,g=k}finally{
try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}}return{}}),$traceurRuntime.registerModule("src/browser/SaveFile.js",[],function(){
"use strict";function a(a,b){if(navigator.msSaveBlob)return void navigator.msSaveBlob(new Blob([b],{type:"text/html;charset=UTF-8"
}),a);var c=document.createElement("a");c.href=void 0!==window.URL?window.URL.createObjectURL(new Blob([b],{type:"text/html;charset=UTF-8"
})):"data:application/octet-stream,"+encodeURI(moddedHtml),c.download=a;try{document.body.appendChild(c),c.click()}finally{document.body.removeChild(c);
}}return{get saveFile(){return a}}}),$traceurRuntime.registerModule("src/browser/TouchScrollBlocker.js",[],function(){"use strict";
var a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/browser/TouchScrollBlocker.js")).Rect,
function(){function a(a){this._parentElement=a,this._curBlockers=[],this._curShowing=0}return $traceurRuntime.createClass(a,{setBlockers:function(a,b){
for(;this._curBlockers.length<a.length;){var c=document.createElement("div");c.style.touchAction="none",c.style.position="absolute",
c.style.opacity=1e-4,this._parentElement.appendChild(c),this._curBlockers.push({div:c,area:void 0})}for(var d=0;d<a.length;d++){var e=a[d].rect,f=b||a[d].cursor||"auto",g=this._curBlockers[d],h=g.div.style;
e.isEqualTo(g.area)||(g.area=e,h.left=e.x+"px",h.top=e.y+"px",h.width=e.w+"px",h.height=e.h+"px"),h.cursor!==f&&(h.cursor=f)}for(;this._curShowing<a.length;)this._curBlockers[this._curShowing].div.style.display="inline",
this._curShowing++;for(;this._curShowing>a.length;)this._curShowing--,this._curBlockers[this._curShowing].div.style.display="none";
}},{})}());return{get TouchScrollBlocker(){return a}}}),$traceurRuntime.registerModule("src/circuit/CircuitComputeUtil.js",[],function(){
"use strict";function a(a){var c=void 0!==arguments[1]?arguments[1]:"",d=void 0!==arguments[2]?arguments[2]:"",e=void 0!==arguments[3]?arguments[3]:"";
return i.withoutKnownMatrix(c,d,e).withKnownCircuit(a).withStableDuration(a.stableDuration()).withCustomOperation(function(c){return b(c,a.withDisabledReasonsForEmbeddedContext(c.row,c.customContextFromGates),!1);
}).withHeight(a.numWires).withCustomDisableReasonFinder(function(b){for(var c=a.withDisabledReasonsForEmbeddedContext(b.outerRow,b.context),d=0;d<c.numWires;d++)for(var e=0;e<c.columns.length;e++){
var f=c.gateAtLocIsDisabledReason(e,d);if(void 0!==f)return f;if(c.gateInSlot(e,d)===j.Special.Measurement)return"hidden\nmeasure\nbroken";
}})}function b(a,b,e){for(var f=[],i=[],j=[],k=[],l=function(a){return function(d){if(e){var g=c(d,b,a),h=g.qubitDensities,l=g.norm,m=g.customGateStats;
f.push(h),j.push(l);var n=!0,o=!1,p=void 0;try{for(var q=void 0,r=m[Symbol.iterator]();!(n=(q=r.next()).done);n=!0){var s=q.value,t=s.row,u=s.stat;
k.push({col:a,row:t,out:i.length}),i.push(u)}}catch(v){o=!0,p=v}finally{try{n||null==r["return"]||r["return"]()}finally{if(o)throw p;
}}}}},m=0;m<b.columns.length;m++)d(a,b,m,l(m));if(e){var n=(1<<b.numWires)-1;f.push(g.superpositionToQubitDensities(a.stateTrader.currentTexture,h.NONE,n));
}return{colQubitDensities:f,colNorms:j,customStats:i,customStatsMap:k}}function c(a,b,c){var d=[],f=!0,h=!1,i=void 0;try{for(var j=void 0,k=b.customStatRowsInCol(c)[Symbol.iterator]();!(f=(j=k.next()).done);f=!0){
var l=j.value,m=new e(a.time,l,b.numWires,a.controls,a.controlsTexture,a.stateTrader,b.colCustomContextFromGates(c,l)),n=b.columns[c].gates[l].customStatTexturesMaker(m);
d.push({row:l,stat:n})}}catch(o){h=!0,i=o}finally{try{f||null==k["return"]||k["return"]()}finally{if(h)throw i}}var p=g.superpositionToQubitDensities(a.stateTrader.currentTexture,a.controls,b.colDesiredSingleQubitStatsMask(c)),q=void 0!==b.columns[c].indexOfNonUnitaryGate(),r=g.superpositionToNorm(a.stateTrader.currentTexture,q);
return{qubitDensities:p,norm:r,customGateStats:d}}function d(a,b,c,d){var g=a.controls.and(b.colControls(c).shift(a.row)),h=f.controlMask(g).toBoolTexture(a.wireCount),i=k.mergeMaps(a.customContextFromGates,b.colCustomContextFromGates(c,a.row)),j=a.stateTrader,l=new e(a.time,a.row,a.wireCount,a.controls,a.controlsTexture,j,i),m=new e(a.time,a.row,a.wireCount,g,h,j,i);
b.applyBeforeOperationsInCol(c,l),b.applyMainOperationsInCol(c,m),d(m),b.applyAfterOperationsInCol(c,l),h.deallocByDepositingInPool("controlTex in _advanceStateWithCircuitDefinitionColumn");
}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitEvalContext.js","src/circuit/CircuitComputeUtil.js")).CircuitEvalContext,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitComputeUtil.js")).CircuitShaders,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetTextureUtil.js","src/circuit/CircuitComputeUtil.js")).KetTextureUtil,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitComputeUtil.js")).Controls,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/CircuitComputeUtil.js")).Gate,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/CircuitComputeUtil.js")).Gates,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitComputeUtil.js")).Util;
return{get circuitDefinitionToGate(){return a},get advanceStateWithCircuit(){return b}}}),$traceurRuntime.registerModule("src/circuit/CircuitDefinition.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitDefinition.js")).CircuitShaders,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/CircuitDefinition.js")).Config,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitDefinition.js")).Controls,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CustomGateSet.js","src/circuit/CircuitDefinition.js")).CustomGateSet,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CircuitDefinition.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/CircuitDefinition.js")).Gate,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/circuit/CircuitDefinition.js")).GateColumn,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/circuit/CircuitDefinition.js")).GateShaders,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/CircuitDefinition.js")).Gates,j=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/circuit/CircuitDefinition.js")).Point,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/CircuitDefinition.js"))),k=j.seq,l=j.Seq,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitDefinition.js")).Util,n=function(){
function j(a,b){var c=void 0!==arguments[2]?arguments[2]:0,f=void 0!==arguments[3]?arguments[3]:new Map,h=void 0!==arguments[4]?arguments[4]:new d,i=void 0!==arguments[5]&&arguments[5];
if(a<0)throw new e("Bad numWires",{numWires:a});if(!Array.isArray(b))throw new e("Bad columns",{numWires:a,columns:b});if(!b.every(function(a){
return a instanceof g}))throw new e("Not a GateColumn",{columns:b});if(!b.every(function(b){return b.gates.length===a}))throw new e("Wrong gate count in a column",{
numWires:a,columns:b});this.numWires=a,this.columns=b,this.customGateSet=h,this.outerRowOffset=c,this.outerContext=f,this.isNested=i,
this._disabledReasons=[],this._measureMasks=[0];var j=0,k=!0,l=!1,m=void 0;try{for(var n=void 0,o=b[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){
var p=n.value,q=p.disabledReasons(j,c,f,i);j=p.nextMeasureMask(j,q),this._disabledReasons.push(q),this._measureMasks.push(j)}}catch(r){
l=!0,m=r}finally{try{k||null==o["return"]||o["return"]()}finally{if(l)throw m}}this._gateSlotCoverMap=this._computeGateSlotCoverMap();
}return $traceurRuntime.createClass(j,{gateWeight:function(){return k(this.columns).flatMap(function(a){return a.gates}).filter(function(a){
return void 0!==a}).map(function(a){return void 0===a.knownCircuit?1:a.knownCircuit.gateWeight()}).sum()},hasControls:function(){
return!this.columns.every(function(a){return!a.hasControl(-1)})},hasOnlyUnitaryGates:function(){return this.columns.every(function(a){
return void 0===a.indexOfNonUnitaryGate()})},hasNonControlGates:function(){var a=function(a){return!a.gates.every(function(a){return void 0===a||a.isControl();
})};return!this.columns.every(function(b){return!a(b)})},countGatesUpTo:function(a){var b=0,c=!0,d=!1,e=void 0;try{for(var f=void 0,g=this.columns[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value,i=!0,j=!1,k=void 0;try{for(var l=void 0,m=h.gates[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;if(void 0!==n&&(b++,
b>=a))return b}}catch(o){j=!0,k=o}finally{try{i||null==m["return"]||m["return"]()}finally{if(j)throw k}}}}catch(p){d=!0,e=p}finally{
try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return b},getUnmetContextKeys:function(){for(var a=new Set,b=0;b<this.columns.length;b++){
var c=this.columns[b],d=this.colCustomContextFromGates(b,0),e=!0,f=!1,g=void 0;try{for(var h=void 0,i=c.gates[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){
var j=h.value,k=!0,l=!1,m=void 0;try{for(var n=void 0,o=(void 0===j?[]:j.getUnmetContextKeys())[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){
var p=n.value;d.has(p)||a.add(p)}}catch(q){l=!0,m=q}finally{try{k||null==o["return"]||o["return"]()}finally{if(l)throw m}}}}catch(r){
f=!0,g=r}finally{try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}}return a},withDisabledReasonsForEmbeddedContext:function(a,b){
return new j(this.numWires,this.columns,a,b,this.customGateSet,(!0))},_computeGateSlotCoverMap:function(){for(var a=new Map,b=0;b<this.columns.length;b++)for(var c=0;c<this.numWires;c++){
var d=this.columns[b].gates[c];if(void 0!==d)for(var e=0;e<d.width;e++)for(var f=0;f<d.height;f++)a.set(b+e+":"+(c+f),{col:b,row:c,
gate:d})}return a},isEmpty:function(){return 0===this.columns.length},isEqualTo:function(a){return this===a||a instanceof j&&this.numWires===a.numWires&&k(this.columns).isEqualTo(k(a.columns),m.CUSTOM_IS_EQUAL_TO_EQUALITY);
},toString:function(){var a=this,b=function(a){return"─".repeat(a)},c=function(a,c){return b(Math.floor(a-c.length)/2)+c+b(Math.ceil(a-c.length)/2);
},d=l.range(this.columns.length).map(function(b){return k(a.columns[b].gates).map(function(a){return void 0===a?0:a.serializedId.length;
}).max()}).toArray();return"CircuitDefinition ("+this.numWires+" wires, "+this.columns.length+" cols):\n\t"+l.range(this.numWires).map(function(e){
return b(1)+l.range(a.columns.length).map(function(b){var f=a.columns[b].gates[e],g=void 0===f?"":f.serializedId;return c(d[b],g);
}).join(b(1))+b(1)}).join("\n\t")},stableDuration:function(){return k(this.columns).flatMap(function(a){return a.gates}).filter(function(a){
return void 0!==a}).map(function(a){return a.stableDuration()}).min(1/0)},readableHash:function(){var a=k(this.columns).flatMap(function(a){
return a.gates}).filter(function(a){return void 0!==a}).map(function(a){return a.symbol}).toArray();if(0===a.length)return b.EMPTY_CIRCUIT_TITLE;
var c=this.numWires+" wires, "+a.length+" ops, "+a.join("").split("^").join("");return c.length<=40?c:c.substring(0,40)+"…"},withColumns:function(a){
return new j(this.numWires,a,this.outerRowOffset,this.outerContext,this.customGateSet)},_usedColumns:function(){for(var a=new Set,b=0;b<this.columns.length;b++)for(var c=0;c<this.columns[b].maximumGateWidth();c++)a.add(b+c);
return a},_findWidthWiseOverlapInRect:function(a,b,c,d){for(var e=1;e<c&&a+e<this.columns.length;e++)for(var f=0;f<d;f++){var g=this.findGateCoveringSlot(a+e,b+f);
if(void 0!==g&&g.col!==a)return{col:g.col,row:g.row}}},withWidthOverlapsFixed:function(){for(var a=this,b=[],c=this,d=function(d){
var e=l.range(c.numWires).map(function(b){var c=a.columns[d].gates[b];if(void 0===c)return 0;var e=a._findWidthWiseOverlapInRect(d,b,c.width,c.height);
return void 0===e?0:c.width-(e.col-d)}).max(0);b.push(c.columns[d]);for(var f=0;f<e;f++)b.push(g.empty(c.numWires))},e=0;e<this.columns.length;e++)d(e);
return this.withColumns(b)},_findHeightWiseOverlapsInCol:function(a){for(var b=new Set,c=0,d=0;d<this.numWires;d++){c-=1;var e=this.gateInSlot(a,d);
void 0!==e&&(c>0&&b.add(d),c=Math.max(c,e.height))}return b},withHeightOverlapsFixed:function(){var a,b=void 0!==arguments[0]?arguments[0]:5,c=[],d=this,e=function(a){
var b=d._findHeightWiseOverlapsInCol(a);if(0===b.size)return c.push(d.columns[a]),0;var e=k(d.columns[a].gates).mapWithIndex(function(a,c){
return b.has(c)?void 0:a}).toArray(),f=k(d.columns[a].gates).mapWithIndex(function(a,c){return void 0!==a&&(a.isControl()||b.has(c))?a:void 0;
}).toArray();c.push(new g(e)),c.push(new g(f))};a:for(var f=0;f<this.columns.length;f++)switch(a=e(f)){case 0:continue a}var h=this.withColumns(c);
return c.length>this.columns.length&&b>0&&(h=h.withHeightOverlapsFixed(b-1)),h},withTrailingSpacersIncluded:function(){var a=void 0!==arguments[0]?arguments[0]:0;
return this.withColumns($traceurRuntime.spread(this.columns,new Array(Math.max(0,this.minimumRequiredColCount()+a-this.columns.length)).fill(g.empty(this.numWires))));
},trimEmptyColumnsAtEndIgnoringGateWidths:function(){for(var a=this.columns.length;;a--)if(0===a||!this.columns[a-1].isEmpty())return this.withColumns(this.columns.slice(0,a));
},withUncoveredColumnsRemoved:function(){var a=this._usedColumns();return new j(this.numWires,k(this.columns).filterWithIndex(function(b,c){
return a.has(c)}).toArray(),this.outerRowOffset,this.outerContext,this.customGateSet)},withWireCount:function(a){return a===this.numWires?this:new j(a,this.columns.map(function(b){
return new g($traceurRuntime.spread(b.gates.slice(0,a),new Array(Math.max(0,a-b.gates.length)).fill(void 0)))}),this.outerRowOffset,this.outerContext,this.customGateSet);
},minimumRequiredWireCount:function(){var a=1,b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this.columns[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;a=Math.max(a,g.minimumRequiredWireCount())}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{
if(c)throw d}}return a},withMinimumWireCount:function(){return this.withWireCount(this.minimumRequiredWireCount())},minimumRequiredColCount:function(){
for(var a=0,b=0;b<this.columns.length;b++)a=Math.max(a,this.columns[b].maximumGateWidth()+b);return a},colIsMeasuredMask:function(a){
return a<0?0:this._measureMasks[Math.min(a,this.columns.length)]},colDesiredSingleQubitStatsMask:function(a){if(a<0||a>=this.columns.length)return 0;
for(var b=this.columns[a],c=0,d=0;d<b.gates.length;d++)void 0!==b.gates[d]&&b.gates[d].isSingleQubitDisplay&&void 0===this.gateAtLocIsDisabledReason(a,d)&&(c|=1<<d);
return c},colCustomContextFromGates:function(a,b){var c=new Map;if(a<0||a>=this.columns.length)return c;for(var d=this.columns[a],e=0;e<d.gates.length;e++){
var f=d.gates[e];if(void 0!==f&&void 0===this.gateAtLocIsDisabledReason(a,e)){var g=!0,h=!1,i=void 0;try{for(var j=void 0,k=f.customColumnContextProvider(b+e)[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){
var l=j.value,m=l.key,n=l.val;c.set(m,n)}}catch(o){h=!0,i=o}finally{try{g||null==k["return"]||k["return"]()}finally{if(h)throw i}
}}}return c},locIsMeasured:function(a){var b=a.y;return!(b<0||b>=this.numWires)&&0!==(this.colIsMeasuredMask(a.x)&1<<b)},locClassifyMeasuredIncludingGateExtension:function(a){
var b=a.y;if(b<0||b>=this.numWires)return!1;var c=this.columns[a.x].gates[b],d=void 0===c?1:c.height,e=this.colIsMeasuredMask(a.x)>>b&(1<<d)-1;
return 0!==e&&(e===(1<<d)-1||void 0)},gateInSlot:function(a,b){if(!(a<0||a>=this.columns.length||b<0||b>=this.numWires)){var c=this.columns[a].gates[b];
return void 0===c?void 0:c}},findGateCoveringSlot:function(a,b){var c=a+":"+b;if(this._gateSlotCoverMap.has(c))return this._gateSlotCoverMap.get(c);
},locIsControlWireStarter:function(a){var b=this.gateInSlot(a.x,a.y);return void 0!==b&&b.isControlWireSource},locStartsSingleControlWire:function(a){
return this.locIsControlWireStarter(a)&&this.locClassifyMeasuredIncludingGateExtension(a)!==!0&&void 0===this.gateAtLocIsDisabledReason(a.x,a.y);
},locStartsDoubleControlWire:function(a){return this.locIsControlWireStarter(a)&&this.locClassifyMeasuredIncludingGateExtension(a)!==!1&&void 0===this.gateAtLocIsDisabledReason(a.x,a.y);
},colHasEnabledSwapGate:function(a){if(a<0||a>=this.columns.length)return!1;for(var b=0,c=0;c<this.numWires;c++)if(this.gateInSlot(a,c)===i.Special.SwapHalf){
if(void 0!==this.gateAtLocIsDisabledReason(a,c))return!1;b++}return 2===b},locProvidesStat:function(a,b){var c=this.gateInSlot(a.x,a.y);
return void 0!==c&&!c.customColumnContextProvider(0).every(function(a){return a.key!==b})},locNeedsStat:function(a,b){var c=this.gateInSlot(a.x,a.y);
return void 0!==c&&c._requiredContextKeys.indexOf(b)!==-1},locHasControllableGate:function(a){var b=this.gateInSlot(a.x,a.y);return void 0!==b&&!b.isControl()&&b!==i.SpacerGate&&(b!==i.Special.SwapHalf||this.colHasEnabledSwapGate(a.x));
},colHasControls:function(a){return!(a<0||a>=this.columns.length)&&this.columns[a].hasControl()},colHasSingleWireControl:function(a){
return!(a<0||a>=this.columns.length)&&this.columns[a].hasCoherentControl(this._measureMasks[a])},colHasDoubleWireControl:function(a){
return!(a<0||a>=this.columns.length)&&this.columns[a].hasMeasuredControl(this._measureMasks[a])},colControls:function(a){if(a<0||a>=this.columns.length)return c.NONE;
for(var b=c.NONE,d=this.columns[a],e=0;e<d.gates.length;e++){var f=d.gates[e];if(void 0!==f&&void 0===this.gateAtLocIsDisabledReason(a,e)){
var g=f.controlBit();void 0!==g&&(b=b.and(c.bit(e,g)))}}return b},gateAtLocIsDisabledReason:function(a,b){if(!(a<0||b<0||a>=this._disabledReasons.length||b>=this.numWires))return this._disabledReasons[a][b];
},applyMainOperationsInCol:function(b,c){var d,e;if(!(b<0||b>=this.columns.length)){this._applyOpsInCol(b,c,function(a){if(!a.definitelyHasNoEffect()&&a!==i.Special.SwapHalf)return void 0!==a.customOperation?a.customOperation:function(b){
return h.applyMatrixOperation(b,a.knownMatrixAt(b.time))}});var f=!0,g=!1,j=void 0;try{for(var k=void 0,l=this.columns[b].swapPairs()[Symbol.iterator]();!(f=(k=l.next()).done);f=!0){
var m=k.value,n=(d=m[Symbol.iterator](),(e=d.next()).done?void 0:e.value),o=(e=d.next()).done?void 0:e.value;c.applyOperation(a.swap(c.withRow(n+c.row),o+c.row));
}}catch(p){g=!0,j=p}finally{try{f||null==l["return"]||l["return"]()}finally{if(g)throw j}}}},applyBeforeOperationsInCol:function(a,b){
this._applyOpsInCol(a,b,function(a){return a.customBeforeOperation})},applyAfterOperationsInCol:function(a,b){this._applyOpsInCol(a,b,function(a){
return a.customAfterOperation})},_applyOpsInCol:function(a,b,c){if(!(a<0||a>=this.columns.length))for(var d=this.columns[a],e=0;e<this.numWires;e++){
var f=d.gates[e];if(void 0!==f&&void 0===this.gateAtLocIsDisabledReason(a,e)){var g=c(f);void 0!==g&&g(b.withRow(b.row+e))}}},customStatRowsInCol:function(a){
if(a<0||a>=this.columns.length)return[];for(var b=this.columns[a],c=[],d=0;d<b.gates.length;d++)void 0!==b.gates[d]&&void 0!==b.gates[d].customStatPostProcesser&&void 0===this.gateAtLocIsDisabledReason(a,d)&&c.push(d);
return c},isSlotRectCoveredByGateInSameColumn:function(a,b,c){for(var d=0;d<c;d++){var e=this.findGateCoveringSlot(a,b+d);if(void 0!==e&&e.col===a)return!0;
}return!1},withCustomGate:function(a){return new j(this.numWires,this.columns,this.outerRowOffset,this.outerContext,this.customGateSet.withGate(a));
}},{fromTextDiagram:function(a,b){var c=k(b.split("\n")).map(function(a){return a.trim()}).filter(function(a){return""!==a}).toArray();
if(k(c.map(function(a){return a.length})).distinct().count()>1)throw new e("Uneven diagram",{diagram:b});var d=c.length,h=c.length>0?c[0].length:0,i=function(b,d){
for(var e=1;d+e<c.length;e++)if(null!==a.get(c[d+e][b]))return e;return c.length-d};return new j(d,l.range(h).map(function(b){return new g(k(c).mapWithIndex(function(c,d){
var g=c[b];if(!a.has(g))throw new e("Unspecified gate",{"char":g});var h=a.get(g);if(null!==h&&void 0!==h){if(h.hasOwnProperty("ofSize"))return h.ofSize(i(b,d));
if(h instanceof f)return h;throw new e("Not a gate",h)}}).toArray())}).toArray())}})}();return n.EMPTY=new n(0,[]),{get CircuitDefinition(){
return n}}}),$traceurRuntime.registerModule("src/circuit/CircuitEvalContext.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/CircuitEvalContext.js")).WglConfiguredShader,b=function(){
function b(a,b,c,d,e,f,g){this.time=a,this.row=b,this.wireCount=c,this.controls=d,this.controlsTexture=e,this.stateTrader=f,this.customContextFromGates=g;
}return $traceurRuntime.createClass(b,{applyOperation:function(b){var c=b instanceof a?b:b(this);this.stateTrader.shadeAndTrade(c);
},_clone:function(){return new b(this.time,this.row,this.wireCount,this.controls,this.controlsTexture,this.stateTrader,this.customContextFromGates);
},withRow:function(a){var b=this._clone();return b.row=a,b}},{})}();return{get CircuitEvalContext(){return b}}}),$traceurRuntime.registerModule("src/circuit/CircuitShaders.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/CircuitShaders.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitShaders.js")).Controls,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/circuit/CircuitShaders.js")),d=c.ketArgs,e=c.ketShaderPermute,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/CircuitShaders.js")).Shaders,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitShaders.js")).Util,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/CircuitShaders.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/CircuitShaders.js")).WglConfiguredShader,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/CircuitShaders.js"))),j=i.currentShaderCoder,k=i.makePseudoShaderWithInputsAndOutputAndCode,l=i.Inputs,m=i.Outputs,n=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}();n.classicalState=function(a){return o(h["float"]("state",a))};var o=k([],m.vec2(),"\n    uniform float state;\n    vec2 outputFor(float k) {\n        return vec2(float(k == state), 0.0);\n    }");
n.linearOverlay=function(a,b,c){return p(c,b,h["float"]("offset",a))};var p=k([l.vec4("back"),l.vec4("fore")],m.vec4(),"\n    uniform float offset;\n    vec4 outputFor(float k) {\n        // Note: can't use multiplication to combine because it spreads NaNs from the background into the foreground.\n        return k >= offset && k < offset + len_fore() ? read_fore(k - offset) : read_back(k);\n    }");
n.controlMask=function(a){return a.isEqualTo(b.NONE)?f.color(1,0,0,0):q(h["float"]("used",a.inclusionMask),h["float"]("desired",a.desiredValueMask));
};var q=k([],m.bool(),"\n    uniform float used;\n    uniform float desired;\n\n    bool outputFor(float k) {\n        float pass = 1.0;\n        float bit = 1.0;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/bit), 2.0);\n            float u = mod(floor(used/bit), 2.0);\n            float d = mod(floor(desired/bit), 2.0);\n            pass *= 1.0 - abs(v-d)*u;\n            bit *= 2.0;\n        }\n        return pass == 1.0;\n    }");
n.controlSelect=function(a,c){return a.isEqualTo(b.NONE)?f.passthrough(c):r(c,h["float"]("used",a.inclusionMask),h["float"]("desired",a.desiredValueMask));
};var r=k([l.vec2("input")],m.vec2(),"\n    uniform float used;\n    uniform float desired;\n\n    /**\n     * Inserts bits from the given value into the holes between used bits in the desired mask.\n     */\n    float scatter(float k) {\n        float maskPos = 1.0;\n        float coordPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float v = mod(floor(k/coordPos), 2.0);\n            float u = mod(floor(used/maskPos), 2.0);\n            float d = mod(floor(desired/maskPos), 2.0);\n            result += (v + u*(d-v)) * maskPos;\n            coordPos *= 2.0-u;\n            maskPos *= 2.0;\n        }\n        return result;\n    }\n\n    vec2 outputFor(float k) {\n        return read_input(scatter(k));\n    }");
n.swap=function(a,b){var c;return(c=s).withArgs.apply(c,$traceurRuntime.spread(d(a,b-a.row+1)))};var s=e("","\n    float low_bit = mod(out_id, 2.0);\n    float mid_bits = floor(mod(out_id, span*0.5)*0.5);\n    float high_bit = floor(out_id*2.0/span);\n    return high_bit + mid_bits*2.0 + low_bit*span*0.5;");
n.qubitDensities=function(a){var b=arguments[1];void 0===b&&(b=(1<<j().vec2.arrayPowerSizeOfTexture(a))-1);var c=g.ceilingPowerOf2(g.numberOfSetBits(b));
return t(a,h["float"]("keptCount",c),h["float"]("keptBitMask",b))};var t=k([l.vec2("input")],m.vec4(),"\n    uniform float keptCount;\n    uniform float keptBitMask;\n\n    float scatter(float val, float used) {\n        float result = 0.0;\n        float posUsed = 1.0;\n        float posVal = 1.0;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float u = mod(floor(used/posUsed), 2.0);\n            float v = mod(floor(val/posVal), 2.0);\n            result += u * v * posUsed;\n            posVal *= 1.0+u;\n            posUsed *= 2.0;\n        }\n        return result;\n    }\n\n    vec4 outputFor(float k) {\n        float bitIndex = mod(k, keptCount);\n        float otherBits = floor(k / keptCount);\n        float bit = scatter(exp2(bitIndex), keptBitMask);\n\n        // Indices of the two complex values making up the current conditional ket.\n        float srcIndex0 = mod(otherBits, bit) + floor(otherBits / bit) * bit * 2.0;\n        float srcIndex1 = srcIndex0 + bit;\n\n        // Grab the two complex values.\n        vec2 w1 = read_input(srcIndex0);\n        vec2 w2 = read_input(srcIndex1);\n\n        // Compute density matrix components.\n        float a = dot(w1, w1);\n        float br = dot(w1, w2);\n        float bi = dot(vec2(-w1.y, w1.x), w2);\n        float d = dot(w2, w2);\n\n        return vec4(a, br, bi, d);\n    }");
return{get CircuitShaders(){return n}}}),$traceurRuntime.registerModule("src/circuit/CircuitStats.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/circuit/CircuitStats.js")).CircuitDefinition,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitEvalContext.js","src/circuit/CircuitStats.js")).CircuitEvalContext,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/CircuitStats.js")).CircuitShaders,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetTextureUtil.js","src/circuit/CircuitStats.js")).KetTextureUtil,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/CircuitStats.js")).Controls,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CircuitStats.js")).DetailedError,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/CircuitStats.js")).Matrix,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/CircuitStats.js")).Shaders,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/circuit/CircuitStats.js")).Serializer,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/CircuitStats.js")).Util,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/circuit/CircuitStats.js")).notifyAboutRecoveryFromUnexpectedError,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/circuit/CircuitStats.js")).advanceStateWithCircuit,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/CircuitStats.js")).currentShaderCoder,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/circuit/CircuitStats.js")).WglTextureTrader,o=function(){
function a(a,b,c,d,e,f){this.circuitDefinition=a,this.time=b,this._survivalRates=c,this._qubitDensities=d,this.finalState=e,this._customStatsProcessed=f;
}return $traceurRuntime.createClass(a,{qubitDensityMatrix:function(a,b){if(b<0)throw new f("Bad wireIndex",{wireIndex:b,colIndex:a
});if(a<0||b>=this.circuitDefinition.numWires){if(b>=this.circuitDefinition.numWires&&this.qubitDensityMatrix(a,0).hasNaN())return g.zero(2,2).times(NaN);
var c=new Float32Array(8);return c[0]=1,new g(2,2,c)}var d=Math.min(a,this._qubitDensities.length-1);return d<0||b>=this._qubitDensities[d].length?g.zero(2,2).times(NaN):this._qubitDensities[d][b];
},survivalRate:function(a){return a=Math.min(a,this._survivalRates.length-1),a<0?1:this._survivalRates[a]},customStatsForSlot:function(a,b){
var c=a+":"+b;return this._customStatsProcessed.has(c)?this._customStatsProcessed.get(c):void 0},controlledWireProbabilityJustAfter:function(a,b){
return this.qubitDensityMatrix(b,a).rawBuffer()[6]},withTime:function(b){return new a(this.circuitDefinition,b,this._survivalRates,this._qubitDensities,this.finalState,this._customStatsProcessed);
}},{withNanDataFromCircuitAtTime:function(b,c){return new a(b,c,[1],[],g.zero(1,1<<b.numWires).times(NaN),new Map)},fromCircuitAtTime:function(b,c){
try{return a._fromCircuitAtTime_noFallback(b,c)}catch(d){return k("Defaulted to NaN results. Computing circuit values failed.",{circuitDefinition:i.toJson(b)
},d),a.withNanDataFromCircuitAtTime(b,c)}},decohereMeasuredBitsInDensityMatrix:function(a,b){if(0===b)return a;for(var c=new Float32Array(a.rawBuffer()),d=a.width(),e=0;e<d;e++)for(var f=0;f<d;f++)if(0!==((e^f)&b)){
var h=2*(e*d+f);c[h]=0,c[h+1]=0}return new g(d,d,c)},scatterAndDecohereDensities:function(b,c,d,e,f){for(var h=g.zero(1<<d,1<<d).times(NaN),i=0,j=[],k=0;k<c-d+1;k++)0===(f&1<<k)?j.push(h):j.push(a.decohereMeasuredBitsInDensityMatrix(b[i++],e>>k&(1<<d)-1));
return j},_extractColumnQubitStatsFromPixelDatas:function(b,c){for(var e=[],f=0;f<c.length;f++){var g=f===b.columns.length?-1:b.colDesiredSingleQubitStatsMask(f);
e.push(a.scatterAndDecohereDensities(d.pixelsToQubitDensityMatrices(c[f]),b.numWires,1,b.colIsMeasuredMask(f),g))}return e},_extractColumnSurvivalRateStatsFromPixelDatas:function(a){
for(var b=1,c=[],d=0;d<a.length;d++)a[d].length>0&&(b=a[d][0]),c.push(b);return c},_fromCircuitAtTime_noFallback:function(f,g){f=f.withMinimumWireCount();
var i=f.numWires,k=new n(c.classicalState(0).toVec2Texture(i)),o=c.controlMask(e.NONE).toBoolTexture(i),p=l(new b(g,0,i,e.NONE,o,k,new Map),f,!0),q=p.colQubitDensities,r=p.colNorms,s=p.customStats,t=p.customStatsMap;
o.deallocByDepositingInPool("controlTex in _fromCircuitAtTime_noFallback"),m().vec2.needRearrangingToBeInVec4Format&&k.shadeHalveAndTrade(h.packVec2IntoVec4);
var u=j.objectifyArrayFunc(d.mergedReadFloats)({output:k.currentTexture,colQubitDensities:q,colNorms:r,customStats:s}),v=a._extractColumnQubitStatsFromPixelDatas(f,u.colQubitDensities),w=a._extractColumnSurvivalRateStatsFromPixelDatas(u.colNorms),x=d.pixelsToAmplitudes(u.output,0===w.length?1:w[w.length-1]),y=new Map,z=!0,A=!1,B=void 0;
try{for(var C=void 0,D=t[Symbol.iterator]();!(z=(C=D.next()).done);z=!0){var E=C.value,F=E.col,G=E.row,H=E.out,I=f.gateInSlot(F,G).customStatPostProcesser||function(a){
return a};y.set(F+":"+G,I(u.customStats[H],f,F,G))}}catch(J){A=!0,B=J}finally{try{z||null==D["return"]||D["return"]()}finally{if(A)throw B;
}}return new a(f,g,w,v,x,y)}})}();return o.EMPTY=o.withNanDataFromCircuitAtTime(a.EMPTY,0),{get CircuitStats(){return o}}}),$traceurRuntime.registerModule("src/circuit/Controls.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Controls.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/Controls.js")).Seq,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/Controls.js")).Util,d=function(){
function d(b,c){if(0!==(c&~b))throw new a("Desired un-included bits",{inclusionMask:b,desiredValueMask:c});this.inclusionMask=b,this.desiredValueMask=c;
}return $traceurRuntime.createClass(d,{isEqualTo:function(a){return a instanceof d&&this.inclusionMask===a.inclusionMask&&this.desiredValueMask===a.desiredValueMask;
},toString:function(){var a=this;return 0===this.inclusionMask?"No Controls":"Controls: ...__"+b.naturals().takeWhile(function(b){
return 1<<b<=a.inclusionMask}).map(this.desiredValueFor.bind(this)).map(function(a){return void 0===a?"_":a?"1":"0"}).reverse().join("");
},allowsState:function(a){return(this.inclusionMask&a)===this.desiredValueMask},desiredValueFor:function(a){if(0!==(this.inclusionMask&1<<a))return 0!==(this.desiredValueMask&1<<a);
},includedBitCount:function(){return this.inclusionMask<0?1/0:c.numberOfSetBits(this.inclusionMask)},and:function(b){if((b.desiredValueMask&this.inclusionMask)!==(this.desiredValueMask&b.inclusionMask))throw new a("Contradictory controls.",{
"this":this,other:b});return new d(this.inclusionMask|b.inclusionMask,this.desiredValueMask|b.desiredValueMask)},shift:function(a){
return new d(this.inclusionMask<<a,this.desiredValueMask<<a)}},{bit:function(b,c){if(b<0)throw new a("Out of range",{bitIndex:b});
return new d(1<<b,c?1<<b:0)}})}();return d.NONE=new d(0,0),{get Controls(){return d}}}),$traceurRuntime.registerModule("src/circuit/CustomGateSet.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/CustomGateSet.js")).DetailedError,b=function(){
function b(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.gates=a}return $traceurRuntime.createClass(b,{withGate:function(c){
if(!c.serializedId.startsWith("~"))throw new a("Custom gates' serialized id must start with '~'.",{id:c.serializedId,gate:c});if(this.findGateWithSerializedId(c.serializedId))throw new a("Duplicate serialized id.",{
gate:c});return new(Function.prototype.bind.apply(b,$traceurRuntime.spread([null],this.gates,[c])))},findGateWithSerializedId:function(a){
var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this.gates[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(g.serializedId===a)return g;
}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}}},{})}();return{get CustomGateSet(){return b;
}}}),$traceurRuntime.registerModule("src/circuit/Gate.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Gate.js")).DetailedError,b=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/circuit/Gate.js")).GateDrawParams,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/Gate.js")).Matrix),c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/Gate.js")),d=c.seq,e=c.Seq,f=function(){
function c(a,b,c){this.symbol=a,this.serializedId=a,this.name=b,this.blurb=c,this.width=1,this.height=1,this.customDrawer=void 0,
this.tag=void 0,this.customBeforeOperation=void 0,this.customOperation=void 0,this.customAfterOperation=void 0,this.customStatTexturesMaker=void 0,
this.customStatPostProcesser=void 0,this.gateFamily=[this],this._stableDuration=void 0,this._knownMatrix=void 0,this._knownMatrixFunc=void 0,
this._hasNoEffect=!1,this._effectPermutesStates=void 0,this._effectCreatesSuperpositions=void 0,this.isControlWireSource=!1,this.knownCircuit=void 0,
this.knownCircuitNested=void 0,this._requiredContextKeys=[],this.isSingleQubitDisplay=!1,this._controlBit=void 0,this._isDefinitelyUnitary=!1,
this.customColumnContextProvider=function(a){return[]},this.customDisableReasonFinder=function(a){},this.knownBitPermutationFunc=void 0;
}return $traceurRuntime.createClass(c,{getUnmetContextKeys:function(){var a=new Set(this._requiredContextKeys);if(void 0!==this.knownCircuit){
var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this.knownCircuit.getUnmetContextKeys()[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;a.add(g)}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}}return a},withKnownMatrix:function(a){
var b=this._copy();return b._knownMatrix=a,void 0!==a&&(b._isDefinitelyUnitary=a.isUnitary(.01),b._hasNoEffect=a.isIdentity(),b._stableDuration=1/0),
b},withKnownMatrixFunc:function(a){var b=this._copy();return b._knownMatrixFunc=a,b},markedAsOnlyPermutingAndPhasing:function(){var a=this._copy();
return a._hasNoEffect=!1,a._effectPermutesStates=!0,a._effectCreatesSuperpositions=!1,a._isDefinitelyUnitary=!0,a},markedAsOnlyPhasing:function(){
var a=this._copy();return a._hasNoEffect=!1,a._effectPermutesStates=!1,a._effectCreatesSuperpositions=!1,a._isDefinitelyUnitary=!0,
a},markedAsControl:function(a){var b=this._copy();return b._controlBit=a,b.isControlWireSource=!0,b._isDefinitelyUnitary=!0,b},markedAsControlWireSource:function(){
var a=this._copy();return a.isControlWireSource=!0,a},markedAsStable:function(){var a=this._copy();return a._stableDuration=1/0,a;
},markedAsUnitary:function(){var a=this._copy();return a._isDefinitelyUnitary=!0,a},_copy:function(){var a=new c(this.symbol,this.name,this.blurb);
return a.serializedId=this.serializedId,a.tag=this.tag,a.customDrawer=this.customDrawer,a.customBeforeOperation=this.customBeforeOperation,
a.knownBitPermutationFunc=this.knownBitPermutationFunc,a.customOperation=this.customOperation,a.customAfterOperation=this.customAfterOperation,
a.customStatTexturesMaker=this.customStatTexturesMaker,a.customStatPostProcesser=this.customStatPostProcesser,a.width=this.width,
a.height=this.height,a.isSingleQubitDisplay=this.isSingleQubitDisplay,a._knownMatrix=this._knownMatrix,a.knownCircuit=this.knownCircuit,
a.knownCircuitNested=this.knownCircuitNested,a._requiredContextKeys=this._requiredContextKeys,a._knownMatrixFunc=this._knownMatrixFunc,
a._stableDuration=this._stableDuration,a._hasNoEffect=this._hasNoEffect,a._effectPermutesStates=this._effectPermutesStates,a._effectCreatesSuperpositions=this._effectCreatesSuperpositions,
a._affectsOtherWires=this._affectsOtherWires,a._controlBit=this._controlBit,a.isControlWireSource=this.isControlWireSource,a._isDefinitelyUnitary=this._isDefinitelyUnitary,
a.customColumnContextProvider=this.customColumnContextProvider,a.customDisableReasonFinder=this.customDisableReasonFinder,a},withStableDuration:function(a){
var b=this._copy();return b._stableDuration=a,b},withKnownCircuit:function(a){var b=this._copy();return b.knownCircuit=a,b.knownCircuitNested=a.withDisabledReasonsForEmbeddedContext(0,new Map),
b._isDefinitelyUnitary=a.hasOnlyUnitaryGates(),b},withCustomColumnContextProvider:function(a){var b=this._copy();return b.customColumnContextProvider=a,
b},withCustomDisableReasonFinder:function(a){var b=this._copy();return b.customDisableReasonFinder=a,b},markedAsSingleQubitDisplay:function(){
var a=this._copy();return a.isSingleQubitDisplay=!0,a},withWidth:function(a){var b=this._copy();return b.width=a,b},withHeight:function(a){
var b=this._copy();return b.height=a,b},withCustomDrawer:function(a){var b=this._copy();return b.customDrawer=a,b},withKnownBitPermutation:function(a){
var b=this._copy();return b.knownBitPermutationFunc=a,b._isDefinitelyUnitary=!0,b},withSerializedId:function(a){var b=this._copy();
return b.serializedId=a,b},withCustomBeforeOperation:function(b){if(void 0!==b&&"function"!=typeof b)throw new a("Bad customOperation",{
customOperation:b});var c=this._copy();return c.customBeforeOperation=b,c},withCustomAfterOperation:function(b){if(void 0!==b&&"function"!=typeof b)throw new a("Bad customOperation",{
customOperation:b});var c=this._copy();return c.customAfterOperation=b,c},withCustomOperation:function(b){if(void 0!==b&&"function"!=typeof b)throw new a("Bad customOperation",{
customOperation:b});var c=this._copy();return c.customOperation=b,c},withCustomShader:function(a){return this.withCustomShaders([a]);
},withCustomShaders:function(a){return this.withCustomOperation(function(b){var c=!0,d=!1,e=void 0;try{for(var f=void 0,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value;b.applyOperation(h)}}catch(i){d=!0,e=i}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}})},withCustomStatTexturesMaker:function(a){
var b=this._copy();return b.customStatTexturesMaker=a,b},withCustomStatPostProcessor:function(a){var b=this._copy();return b.customStatPostProcesser=a,
b},withRequiredContextKeys:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=this._copy();return c._requiredContextKeys=a,
c},canChangeInSize:function(){return this.gateFamily.length>1},canIncreaseInSize:function(){var a=this;return!this.gateFamily.every(function(b){
return b.height!==a.height+1})},canDecreaseInSize:function(){var a=this;return!this.gateFamily.every(function(b){return b.height!==a.height-1;
})},withTag:function(a){var b=this._copy();return b.tag=a,b},knownMatrixAt:function(a){return void 0!==this._knownMatrix?this._knownMatrix:void 0!==this._knownMatrixFunc?this._knownMatrixFunc(a):void 0;
},isControl:function(){return void 0!==this._controlBit},controlBit:function(){return this._controlBit},effectMightPermutesStates:function(){
return void 0!==this._effectPermutesStates?this._effectPermutesStates:void 0===this._knownMatrix||!this._knownMatrix.isDiagonal();
},effectMightCreateSuperpositions:function(){return void 0!==this._effectCreatesSuperpositions?this._effectCreatesSuperpositions:void 0===this._knownMatrix||!this._knownMatrix.isPhasedPermutation();
},definitelyHasNoEffect:function(){return this._hasNoEffect},isDefinitelyUnitary:function(){return this._isDefinitelyUnitary},stableDuration:function(){
return void 0!==this._stableDuration?this._stableDuration:void 0!==this._knownMatrix||this._hasNoEffect?1/0:0},toString:function(){
return"Gate("+this.symbol+")"}},{fromKnownMatrix:function(d,e){var f=void 0!==arguments[2]?arguments[2]:"",g=void 0!==arguments[3]?arguments[3]:"";
if(!(e instanceof b))throw new a("Bad matrix.",{symbol:d,matrix:e,name:f,blurb:g});return new c(d,f,g).withKnownMatrix(e)},fromVaryingMatrix:function(a,b,d,e){
var f=void 0===arguments[4]||arguments[4],g=void 0===arguments[5]||arguments[5],h=new c(a,d,e);return h._knownMatrixFunc=b,h._hasNoEffect=!1,
h._effectPermutesStates=f,h._effectCreatesSuperpositions=g,h},fromIdentity:function(a,b,d){var e=new c(a,b,d);return e._stableDuration=1/0,
e._hasNoEffect=!0,e._isDefinitelyUnitary=!0,e._effectPermutesStates=!1,e._effectCreatesSuperpositions=!1,e},withoutKnownMatrix:function(a,b,d){
return new c(a,b,d)},generateFamily:function(a,b,c){var f=e.range(b+1).skip(a).map(function(a){return c(a)._copy()}).toArray(),g=!0,h=!1,i=void 0;
try{for(var j=void 0,k=f[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;l.gateFamily=f}}catch(m){h=!0,i=m}finally{
try{g||null==k["return"]||k["return"]()}finally{if(h)throw i}}return{all:f,ofSize:function(a){return d(f).filter(function(b){return void 0===b||b.height===a;
}).first()}}}})}();return{get Gate(){return f}}}),$traceurRuntime.registerModule("src/circuit/GateCheckArgs.js",[],function(){"use strict";
var a=function(){function a(a,b,c,d,e,f){this.gate=a,this.innerColumn=b,this.outerRow=c,this.measuredMask=d,this.context=e,this.isNested=f;
}return $traceurRuntime.createClass(a,{},{})}();return{get GateCheckArgs(){return a}}}),$traceurRuntime.registerModule("src/circuit/GateColumn.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/GateColumn.js")).DetailedError,b=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/GateColumn.js")).Gate,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateCheckArgs.js","src/circuit/GateColumn.js")).GateCheckArgs),c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/GateColumn.js")).Gates,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/GateColumn.js")),e=d.seq,f=d.Seq,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/GateColumn.js")).Util,h=function(){
function d(a){this.gates=a}return $traceurRuntime.createClass(d,{isEqualTo:function(a){return this===a||a instanceof d&&e(this.gates).isEqualTo(e(a.gates),g.STRICT_EQUALITY);
},stableDuration:function(){var a;return(a=Math).min.apply(a,$traceurRuntime.spread([1/0],this.gates.filter(function(a){return void 0!==a;
}).map(function(a){return a.stableDuration()})))},isEmpty:function(){return this.gates.every(function(a){return void 0===a})},swapPairs:function(){
var a=this,b=f.range(this.gates.length).filter(function(b){return a.gates[b]===c.Special.SwapHalf}).toArray();return 2!==b.length?[]:[b];
},hasControl:function(a){return this.hasCoherentControl(a)||this.hasMeasuredControl(a)},hasCoherentControl:function(a){for(var b=0;b<this.gates.length;b++)if(0===(a&1<<b)&&void 0!==this.gates[b]&&this.gates[b].isControl())return!0;
return!1},hasMeasuredControl:function(a){for(var b=0;b<this.gates.length;b++)if(0!==(a&1<<b)&&void 0!==this.gates[b]&&this.gates[b].definitelyHasNoEffect()&&this.gates[b].isControl())return!0;
return!1},_disabledReason:function(a,c,e,f,g){var h=this.gates[c];if(void 0!==h){var i=new b(h,this,e+c,a,f,g);return h.customDisableReasonFinder(i)||d._disabledReason_inputs(i)||this._disabledReason_controlInside(c)||this._disabledReason_remixing(c,a)||this._disabledReason_overlappingTags(e,c);
}},_disabledReason_overlappingTags:function(a,b){var c=new Set(this.gates[b].customColumnContextProvider(a+b).map(function(a){return a.key;
}));if(0!==c.length)for(var d=0;d<b;d++){var e=this.gates[d],f=!0,g=!1,h=void 0;try{for(var i=void 0,j=(void 0===e?[]:e.customColumnContextProvider(a+d))[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value.key;if(c.has(k))return"already\ndefined"}}catch(l){g=!0,h=l}finally{try{f||null==j["return"]||j["return"]()}finally{
if(g)throw h}}}},_disabledReason_remixing:function(a,b){var c=this.gates[a],d=(1<<c.height)-1<<a,e=d&b;if(0!==e){if(c.effectMightCreateSuperpositions())return"no\nremix\n(sorry)";
if(c.effectMightPermutesStates()&&void 0===c.knownBitPermutationFunc&&(e!==d||this.hasCoherentControl(b)))return"no\nremix\n(sorry)";
}},indexOfNonUnitaryGate:function(){for(var a=0;a<this.gates.length;a++){var b=this.gates[a];if(void 0!==b&&!b.isDefinitelyUnitary())return a;
}},_disabledReason_controlInside:function(a){for(var b=this.gates[a],c=1;c<b.height&&a+c<this.gates.length;c++)if(void 0!==this.gates[a+c]&&this.gates[a+c].isControl())return"control\ninside";
},minimumRequiredWireCount:function(){for(var a=0,b=0;b<this.gates.length;b++)void 0!==this.gates[b]&&(a=Math.max(a,this.gates[b].height+b));
return a},maximumGateWidth:function(){var a=-(1/0),b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this.gates[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;void 0!==g&&(a=Math.max(a,g.width))}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d;
}}return a},disabledReasons:function(a,b,c,d){for(var e=new Map(c),f=this.gates.length-1;f>=0;f--){var g=this.gates[f];if(void 0!==g){
var h=!0,i=!1,j=void 0;try{for(var k=void 0,l=g.customColumnContextProvider(f+b)[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){
var m=k.value,n=m.key,o=m.val;e.set(n,o)}}catch(p){i=!0,j=p}finally{try{h||null==l["return"]||l["return"]()}finally{if(i)throw j}
}}}for(var q=[],r=0;r<this.gates.length;r++)q.push(this._disabledReason(a,r,b,e,d));return q},_updateMeasureMask_gateStep:function(a,b,e){
if(void 0===e[b]){var f=this.gates[b];if(void 0!==f){if(f===c.Special.Measurement)return void(a.measureMask|=1<<b);var g=f===c.PostSelectionGates.PostSelectOn||f===c.PostSelectionGates.PostSelectOff;
if(!this.hasControl()&&g)return void(a.measureMask&=~(1<<b));d._updateMeasureMask_swapGate(f,a,b),d._updateMeasureMask_customPermute(f,a,b);
}}},nextMeasureMask:function(a,b){for(var c={measureMask:a,earlierRowWithSwapGate:void 0},d=0;d<this.gates.length;d++)this._updateMeasureMask_gateStep(c,d,b);
return c.measureMask},withGatesAdded:function(b,c){if(!Number.isInteger(b)||b<0||b>this.gates.length-c.gates.length)throw new a("Bad start index",{
baseCol:this,startIndex:b,insertedCol:c});for(var e=this.gates.map(function(a){return a}),f=0;f<c.gates.length;f++)e[b+f]=c.gates[f];
return new d(e)}},{empty:function(a){return new d(new Array(a).fill(void 0))},_disabledReason_inputs:function(a){var b=[],c=!0,e=!1,f=void 0;
try{for(var g=void 0,h=a.gate.getUnmetContextKeys()[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var i=g.value;i.startsWith("Input Range ")&&a.context.has(i)&&b.push(a.context.get(i));
}}catch(j){e=!0,f=j}finally{try{c||null==h["return"]||h["return"]()}finally{if(e)throw f}}return d._disabledReason_inputs_missing(a)||d._disabledReason_inputs_inside(a,b)||d._disabledReason_inputs_coherenceMismatch(a,b);
},_disabledReason_inputs_missing:function(a){var b=[],c=!0,d=!1,e=void 0;try{for(var f=void 0,g=a.gate.getUnmetContextKeys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value;a.context.has(h)||a.isNested||b.push(h)}}catch(i){d=!0,e=i}finally{try{c||null==g["return"]||g["return"]()}finally{
if(d)throw e}}if(b.length>0)return"Need\nInput\n "+b.map(function(a){return a.replace("Input Range ","")}).join(", ")},_disabledReason_inputs_inside:function(a,b){
var c=a.outerRow,d=!0,e=!1,f=void 0;try{for(var g=void 0,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=i.offset,k=i.length;
if(j+k>c&&c+a.gate.height>j)return"input\ninside"}}catch(l){e=!0,f=l}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f;
}}},_disabledReason_inputs_coherenceMismatch:function(a,b){var c=a.outerRow;if(a.gate.effectMightPermutesStates()){var d=0!==(a.measuredMask>>c&(1<<a.gate.height)-1);
if(d){var e=!0,f=!1,g=void 0;try{for(var h=void 0,i=b[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=j.offset,l=j.length;
if(0!==(~a.measuredMask>>k&(1<<l)-1))return"no\nremix\n(sorry)"}}catch(m){f=!0,g=m}finally{try{e||null==i["return"]||i["return"]();
}finally{if(f)throw g}}}}},_updateMeasureMask_swapGate:function(a,b,d){if(a===c.Special.SwapHalf){if(void 0===b.earlierRowWithSwapGate)return void(b.earlierRowWithSwapGate=d);
var e=1<<b.earlierRowWithSwapGate,f=d-b.earlierRowWithSwapGate,g=1<<d;b.measureMask=b.measureMask&~(e|g)|(b.measureMask&e)<<f|(b.measureMask&g)>>f,
b.earlierRowWithSwapGate=void 0}},_updateMeasureMask_customPermute:function(a,b,c){if(void 0!==a.knownBitPermutationFunc){var d=(1<<a.height)-1<<c,e=b.measureMask&d;
b.measureMask&=~d;for(var f=0;f<a.height;f++){var g=1<<c+f;if(0!==(e&g)){var h=1<<c+a.knownBitPermutationFunc(f);b.measureMask|=h;
}}}}})}();return{get GateColumn(){return h}}}),$traceurRuntime.registerModule("src/circuit/GateShaders.js",[],function(){"use strict";
function a(a,c){var e,f,g;if(2!==c.width()||2!==c.height())throw new b("Not a single-qubit operation.",{matrix:c});var i=c.rawBuffer(),j=(f=i[Symbol.iterator](),
(g=f.next()).done?void 0:g.value),k=(g=f.next()).done?void 0:g.value,l=(g=f.next()).done?void 0:g.value,m=(g=f.next()).done?void 0:g.value,n=(g=f.next()).done?void 0:g.value,p=(g=f.next()).done?void 0:g.value,q=(g=f.next()).done?void 0:g.value,r=(g=f.next()).done?void 0:g.value;
a.applyOperation((e=o).withArgs.apply(e,$traceurRuntime.spread(d(a),[h.vec2("a",j,k),h.vec2("b",l,m),h.vec2("c",n,p),h.vec2("d",q,r)])));
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/GateShaders.js")).DetailedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/circuit/GateShaders.js")),d=c.ketArgs,e=c.ketShader,f=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/GateShaders.js")).Matrix,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/GateShaders.js")).Shaders),g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/GateShaders.js")).Util,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/GateShaders.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/circuit/GateShaders.js")).WglConfiguredShader,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/GateShaders.js"))),j=i.Inputs,k=i.Outputs,l=i.currentShaderCoder,m=i.makePseudoShaderWithInputsAndOutputAndCode,n=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}(),o=e("uniform vec2 a, b, c, d;","return cmul(inp(0.0), a+(c-a)*out_id) + cmul(inp(1.0), b+(d-b)*out_id);",1),p=function(a){
return e("","\n        vec2 t = vec2(0.0, 0.0);\n        for (int k = 0; k < "+(1<<a)+"; k++) {\n            t += cmul(inp(float(k)),\n                      read_coefs(out_id * "+(1<<a)+".0 + float(k)));\n        }\n        return t;\n    ",a,[j.vec2("coefs")]);
},q=function(a){return e("uniform vec4 coefs["+(1<<2*a-1)+"];","\n        int row = int(out_id);\n        vec2 t = vec2(0.0, 0.0);\n        for (int d = 0; d < "+(1<<a)+"; d++) {\n            // Can't index by row, since it's not a constant, so we do a const brute force loop searching for it.\n            if (d == row) {\n                for (int k = 0; k < "+(1<<a-1)+"; k++) {\n                    vec4 u = coefs[d*"+(1<<a-1)+" + k];\n                    t += cmul(inp(float(k*2)), u.xy);\n                    t += cmul(inp(float(k*2+1)), u.zw);\n                }\n            }\n        }\n        return t;\n    ",a);
},r=[void 0,void 0,q(2),q(3),p(4)];n.applyMatrixOperation=function(c,e){var i,j;if(!g.isPowerOf2(e.width()))throw new b("Matrix size isn't a power of 2.",{
ctx:c,matrix:e});if(2===e.width())return void a(c,e);var k=Math.round(Math.log2(e.width()));if(k<=3)return void c.applyOperation((i=r[k]).withArgs.apply(i,$traceurRuntime.spread(d(c),[h.vec4_array("coefs",e.rawBuffer())])));
{if(!(k<=4))throw new b("Matrix is past 4 qubits. Too expensive.",{ctx:c,matrix:e});var m=f.data(l().vec2.dataToPixels(e.rawBuffer())).toVec2Texture(2*k);
try{c.applyOperation((j=r[k]).withArgs.apply(j,$traceurRuntime.spread([m],d(c))))}finally{m.deallocByDepositingInPool()}}},n.cycleAllBits=function(a,b){
var c=l().vec2.arrayPowerSizeOfTexture(a);return s(a,h["float"]("shiftAmount",1<<g.properMod(-b,c)))};var s=m([j.vec2("input")],k.vec2(),"\n    uniform float shiftAmount;\n\n    vec2 outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }");
n.cycleAllBitsFloat=function(a,b){var c=l().vec2.arrayPowerSizeOfTexture(a);return t(a,h["float"]("shiftAmount",1<<g.properMod(-b,c)));
};var t=m([j["float"]("input")],k["float"](),"\n    uniform float shiftAmount;\n\n    float outputFor(float k) {\n        float span = len_input();\n        float shiftedState = k * shiftAmount;\n        float cycledState = mod(shiftedState, span) + floor(shiftedState / span);\n        return read_input(cycledState);\n    }");
return{get GateShaders(){return n}}}),$traceurRuntime.registerModule("src/circuit/KetShaderUtil.js",[],function(){"use strict";function a(a){
var c=arguments[1],d=[a.stateTrader.currentTexture,a.controlsTexture,b["float"]("_ketgen_step",1<<a.row)];return void 0!==c&&d.push(b["float"]("span",1<<c)),
d}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/circuit/KetShaderUtil.js")).WglArg,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/KetShaderUtil.js")),d=c.makePseudoShaderWithInputsAndOutputAndCode,e=c.Inputs,f=c.Outputs,g=function(a,b){
var c=void 0!==arguments[2]?arguments[2]:null,g=void 0!==arguments[3]?arguments[3]:[];return{withArgs:d($traceurRuntime.spread(g,[e.vec2("ketgen_ket"),e.bool("ketgen_control")]),f.vec2(),"\n    uniform float _ketgen_step;\n    "+(null===c?"uniform float span;":"")+"\n    float _ketgen_off;\n    float full_out_id;\n\n    "+(b.match(/\bcmul\b/)?"vec2 cmul(vec2 c1, vec2 c2) { return mat2(c1.x, c1.y, -c1.y, c1.x) * c2; }":"")+"\n    "+(b.match(/\binp\b/)?"vec2 inp(float k) { return read_ketgen_ket(_ketgen_off + _ketgen_step*k); }":"")+"\n\n    "+a+"\n\n    vec2 _ketgen_output_for(float out_id, vec2 amp) {\n        "+b+"\n    }\n\n    vec2 outputFor(float k) {\n        full_out_id = k;\n\n        float relevant_out_id = mod(floor(full_out_id / _ketgen_step), "+(null===c?"span":(1<<c)+".0")+");\n        _ketgen_off = full_out_id - relevant_out_id*_ketgen_step;\n\n        float c = read_ketgen_control(full_out_id);\n        vec2 vc = read_ketgen_ket(full_out_id);\n        vec2 vt = _ketgen_output_for(relevant_out_id, vc);\n        return (1.0-c)*vc + c*vt;\n    }")
}},h=function(a,b){var c=void 0!==arguments[2]?arguments[2]:null;return g(a+("float _ketgen_input_for(float out_id) { "+b+" }"),"return inp(_ketgen_input_for(out_id));",c);
},i=function(a,b){var c=void 0!==arguments[2]?arguments[2]:null;return g(a+("vec2 _ketgen_phase_for(float out_id) { "+b+" }"),"return cmul(amp, _ketgen_phase_for(out_id));",c);
};return{get ketArgs(){return a},get ketShader(){return g},get ketShaderPermute(){return h},get ketShaderPhase(){return i}}}),$traceurRuntime.registerModule("src/circuit/KetTextureUtil.js",[],function(){
"use strict";function a(a,b){if(0===b)throw new e("keptBitMask === 0",{trader:a,keptBitMask:b});var d=o().vec2.arrayPowerSizeOfTexture(a.currentTexture),f=h.numberOfSetBits(b);
a.shadeAndTrade(function(a){return c.qubitDensities(a,b)},s.takeVec4Tex(d-1+h.ceilLg2(f)))}function b(a,b){for(var c=h.ceilLg2(b),d=o().vec4.arrayPowerSizeOfTexture(a.currentTexture);d>c;)a.shadeHalveAndTrade(g.sumFoldVec4),
d-=1}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/circuit/KetTextureUtil.js")).CircuitShaders,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Controls.js","src/circuit/KetTextureUtil.js")).Controls,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/KetTextureUtil.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/KetTextureUtil.js")).Matrix,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/circuit/KetTextureUtil.js")).Shaders,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/KetTextureUtil.js")).Util,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/circuit/KetTextureUtil.js")).WglTexture,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/KetTextureUtil.js")),k=j.seq,l=j.Seq,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/circuit/KetTextureUtil.js")),n=m.outputShaderCoder,o=m.currentShaderCoder,p=m.makePseudoShaderWithInputsAndOutputAndCode,q=m.Inputs,r=m.Outputs,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/circuit/KetTextureUtil.js")).WglTexturePool,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/circuit/KetTextureUtil.js")).WglTextureTrader,u=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}();u.tradeTextureForVec2Output=function(a){return o().vec2.needRearrangingToBeInVec4Format&&a.shadeHalveAndTrade(g.packVec2IntoVec4),
u.tradeTextureForVec4Output(a)},u.tradeTextureForVec4Output=function(a){if(n()===o()){var b=o().vec4.pixelsToData(a.currentTexture.readPixels());
return a.currentTexture.deallocByDepositingInPool("tradeTextureForVec4Output"),b}var c=o().vec4.arrayPowerSizeOfTexture(a.currentTexture),d=c+n().vec4.powerSizeOverhead;
a.shadeAndTrade(g.convertVec4CodingForOutput,s.take(d,n().vec4.pixelType));var e=n().vec4.pixelsToData(a.currentTexture.readPixels());
return a.currentTexture.deallocByDepositingInPool("tradeTextureForVec4Output"),e},u.mergedReadFloats=function(a){var b=function(a){
return 0===a.width?0:1<<o().vec4.arrayPowerSizeOfTexture(a)},d=Math.round(Math.log2(h.ceilingPowerOf2(k(a).map(b).sum()))),e=new t(g.color(0,0,0,0).toVec4Texture(d)),f=0,i=!0,j=!1,l=void 0;
try{for(var m=function(){var a=n.value;a.width>0&&e.shadeAndTrade(function(b){return c.linearOverlay(f,a,b)}),f+=b(a)},n=void 0,p=a[Symbol.iterator]();!(i=(n=p.next()).done);i=!0)m();
}catch(q){j=!0,l=q}finally{try{i||null==p["return"]||p["return"]()}finally{if(j)throw l}}var r=u.tradeTextureForVec4Output(e),s=[],v=0,w=!0,x=!1,y=void 0;
try{for(var z=void 0,A=a[Symbol.iterator]();!(w=(z=A.next()).done);w=!0){var B=z.value,C=b(B)<<2;s.push(r.subarray(v,v+C)),v+=C,B.deallocByDepositingInPool();
}}catch(D){x=!0,y=D}finally{try{w||null==A["return"]||A["return"]()}finally{if(x)throw y}}return s},u.pixelsToAmplitudes=function(a,b){
b<1e-6&&(b=NaN);for(var c=Math.sqrt(b),d=a.length>>1,e=new Float32Array(2*d),g=0;g<a.length;g++)e[g]=a[g]/c;return new f(1,d,e)},
u.superpositionToQubitDensities=function(e,f,g){if(0===g)return new i(0,0,o().vec4.pixelType);var j=!f.isEqualTo(d.NONE),k=new t(e);
if(k.dontDeallocCurrentTexture(),j){var l=o().vec2.arrayPowerSizeOfTexture(e)-f.includedBitCount();k.shadeAndTrade(function(a){return c.controlSelect(f,a);
},s.takeVec2Tex(l))}for(var m=1,n=1;n<=f.inclusionMask;n<<=1)0===(f.inclusionMask&n)?m<<=1:g=g&m-1|(g&~(m-1))>>1;a(k,g);var p=h.numberOfSetBits(g);
return b(k,p),k.currentTexture},u.pixelsToQubitDensityMatrices=function(a){var b=a.length/4;return l.range(b).map(function(b){var c=a[4*b],d=a[4*b+3],e=c+d;
if(e<1e-7||isNaN(e))return new f(2,2,new Float32Array([NaN,NaN,NaN,NaN,NaN,NaN,NaN,NaN]));var g=a[4*b+1]/e,h=a[4*b+2]/e;return new f(2,2,new Float32Array([c/e,0,g,h,g,-h,d/e,0]));
}).toArray()};var v=p([q.vec2("input")],r["float"](),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp);\n    }");
return u.superpositionToNorm=function(a,b){if(!b)return new i(0,0,o().vec4.pixelType);var c=new t(a);c.dontDeallocCurrentTexture();
var d=o().vec2.arrayPowerSizeOfTexture(a);for(c.shadeAndTrade(v,s.takeVecFloatTex(d));d>0;)d-=1,c.shadeHalveAndTrade(g.sumFoldFloat);
return c.shadeAndTrade(g.packFloatIntoVec4,s.takeVec4Tex(0)),c.currentTexture},{get KetTextureUtil(){return u}}}),$traceurRuntime.registerModule("src/circuit/Serializer.js",[],function(){
"use strict";function a(a,b){A=a,B=b}function b(a){var b="string"==typeof a?a:a.id;return void 0===b?"":"string"!=typeof b?m(b):b;
}function c(a){if(void 0===a)throw new Error("Unrecognized gate id, but no matrix specified.");var b=G(a);if(b.width()!==b.height())throw new Error("Gate matrix must be square.");
if(b.width()<2||b.width()>16||!t.isPowerOf2(b.width()))throw new Error("Supported gate matrix sizes are 2, 4, 8, and 16.");return b;
}function d(a){var b=void 0!==arguments[1]?arguments[1]:new l;return a.gates.map(function(a){return void 0===a?1:H(a,b)})}function e(a){
for(var b=[],c=0;c<a.gates.length;c++)b.push(H(a.gates[c],new(Function.prototype.bind.apply(l,$traceurRuntime.spread([null],a.gates.slice(0,c))))));
return b}function f(a){if(!Array.isArray(a))throw new n("Expected an array of gates.",{json:a});var b=new l,c=!0,d=!1,e=void 0;try{
for(var f=void 0,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;b=b.withGate(L(h,b))}}catch(i){d=!0,e=i}finally{
try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}return b}function g(a){return P===a?O:(P=a,O=h(JSON.parse(a),void 0));
}function h(a){var b=arguments[1],c=a.cols,d=b||(void 0===a.gates?new l:f(a.gates));if(!Array.isArray(c))throw new Error("CircuitDefinition json should contain an array of cols. Json: "+m(a));
var e=c.map(function(a){return M(a,d)}),g=0,h=!0,j=!1,n=void 0;try{for(var o=void 0,p=e[Symbol.iterator]();!(h=(o=p.next()).done);h=!0){
var r=o.value;g=Math.max(g,r.minimumRequiredWireCount())}}catch(s){j=!0,n=s}finally{try{h||null==p["return"]||p["return"]()}finally{
if(j)throw n}}return g=Math.max(k.MIN_WIRE_COUNT,Math.min(g,k.MAX_WIRE_COUNT)),e=e.map(function(a){return new q($traceurRuntime.spread(a.gates,new Array(Math.max(0,g-a.gates.length)).fill(void 0)).slice(0,g));
}),new i(g,e,(void 0),(void 0),d).withTrailingSpacersIncluded()}var i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/circuit/Serializer.js")).CircuitDefinition,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/circuit/Serializer.js")).Complex,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/circuit/Serializer.js")).Config,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CustomGateSet.js","src/circuit/Serializer.js")).CustomGateSet,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/circuit/Serializer.js")).describe,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/circuit/Serializer.js")).DetailedError,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/circuit/Serializer.js")).Format,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/circuit/Serializer.js")).Gate,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/circuit/Serializer.js")).GateColumn,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/circuit/Serializer.js")).Gates,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/circuit/Serializer.js")).Matrix,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/circuit/Serializer.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/circuit/Serializer.js")).notifyAboutRecoveryFromUnexpectedError,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_MysteryGate.js","src/circuit/Serializer.js")),w=v.MysteryGateSymbol,x=v.MysteryGateMakerWithMatrix,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/circuit/Serializer.js")).seq,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/circuit/Serializer.js")).circuitDefinitionToGate,A=void 0,B=void 0,C=function(){
function a(){}return $traceurRuntime.createClass(a,{},{toJson:function(a){var b,c,d=arguments[1],e=!0,f=!1,g=void 0;try{for(var h=void 0,i=Q[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){
var j=h.value,k=(b=j[Symbol.iterator](),(c=b.next()).done?void 0:c.value),l=(c=b.next()).done?void 0:c.value;(c=b.next()).done?void 0:c.value;
if(a instanceof k)return l(a,d)}}catch(n){f=!0,g=n}finally{try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}throw new Error("Don't know how to convert "+m(a)+" to JSON.");
},fromJson:function(a,b){var c,d,e=arguments[2],f=!0,g=!1,h=void 0;try{for(var i=void 0,j=Q[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value,l=(c=k[Symbol.iterator](),(d=c.next()).done?void 0:d.value),n=((d=c.next()).done?void 0:d.value,(d=c.next()).done?void 0:d.value);
if(l===a)return n(b,e)}}catch(o){g=!0,h=o}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}}throw new Error("Don't know how to deserialize JSON "+m(b)+" into an instance of "+a+".");
}})}(),D=function(a){return a.toString(o.MINIFIED)},E=function(a){if("string"==typeof a)return j.parse(a);throw new Error("Not a packed complex string: "+a);
},F=function(a){return a.toString(o.MINIFIED)},G=function(a){if("string"!=typeof a)throw new Error("Not a packed matrix string: "+a);
return s.parse(a)},H=function(a){var b=void 0!==arguments[1]?arguments[1]:new l;if(r.findKnownGateById(a.serializedId,b)===a)return a.serializedId;
if("Parse Error"===a.name)return a.tag;var c={};if(""!==a.serializedId&&(c.id=a.serializedId),(a.serializedId.startsWith("~")?""!==a.symbol:a.symbol!==a.serializedId)&&(c.name=a.symbol),
a.stableDuration()===1/0&&void 0!==a.knownMatrixAt(0))c.matrix=F(a.knownMatrixAt(.25));else{if(void 0===a.knownCircuit)throw new n("Don't known how to serialize gate's function.",{
gate:a});c.circuit=N(a.knownCircuit,b)}return c},I=function(a){var c=b(a),d=a.matrix,e=a.circuit,f=void 0!==a.name?a.name:c.startsWith("~")?"":c,g=c.startsWith("~")?(f||"Custom")+" Gate ["+c.substring(1)+"]":""!==f?f:c;
return{id:c,matrix:d,circuit:e,symbol:f,name:g}},J=function(a){var b=c(a.matrix);if(a.id===w)return x(b);var d=Math.round(Math.log2(b.height())),e=""===a.symbol?d:1;
return p.fromKnownMatrix(a.symbol,c(a.matrix),a.name,"").withCustomDrawer(""===a.symbol?A:void 0).withSerializedId(a.id).withHeight(d).withWidth(e);
},K=function(a,b){var c=h(a.circuit,b).withMinimumWireCount();return z(c,a.symbol,a.name,"").withSerializedId(a.id).withHeight(c.numWires).withCustomDrawer(B);
},L=function(a){var b=void 0!==arguments[1]?arguments[1]:new l,c=I(a);try{if(void 0!==c.matrix)return J(c);if(void 0!==c.circuit)return K(c,b);
var d=r.findKnownGateById(c.id,b);if(void 0===d)throw new n("No gate with the id '"+c.id+"'.",{json:a});return d}catch(e){return u("Defaulted to a do-nothing 'parse error' gate. Failed to understand the json defining a gate.",{
gate_json:a},e),p.fromIdentity(c.id,"Parse Error",m(e)).withTag(a).withCustomDisableReasonFinder(function(){return"parse\nerror"});
}},M=function(a){var b=void 0!==arguments[1]?arguments[1]:new l;if(!Array.isArray(a))throw new Error("GateColumn json should be an array. Json: "+m(a));
return new q(a.map(function(a){return 1===a||void 0===a?void 0:L(a,b)}))},N=function(a,b){var c={cols:a.trimEmptyColumnsAtEndIgnoringGateWidths().columns.map(function(c){
return d(c,b||a.customGateSet)}).map(function(a){return y(a).skipTailWhile(function(a){return 1===a}).toArray()})};return void 0===b&&a.customGateSet.gates.length>0&&(c.gates=e(a.customGateSet)),
c},O=void 0,P=void 0,Q=[[j,D,E],[p,H,L],[s,F,G],[q,d,M],[i,N,h]];return{get Serializer(){return C},get initSerializer(){return a},
get fromJsonText_CircuitDefinition(){return g}}}),$traceurRuntime.registerModule("src/Config.js",[],function(){"use strict";var a=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}();return a.EMPTY_CIRCUIT_TITLE="Quirk: Quantum Circuit Simulator",a.MAX_WIRE_COUNT=16,
a.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD=14,a.MIN_WIRE_COUNT=2,a.MIN_COL_COUNT=5,a.URL_CIRCUIT_PARAM_KEY="circuit",a.GATE_FILL_COLOR="white",
a.HIGHLIGHTED_GATE_FILL_COLOR="#FB7",a.TIME_DEPENDENT_HIGHLIGHT_COLOR="#FFC",a.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR="#4F4",a.DISPLAY_GATE_BACK_COLOR="#EFE",
a.DISPLAY_GATE_FORE_COLOR="#3F3",a.OPERATION_BACK_COLOR="#FFE",a.OPERATION_FORE_COLOR="#FF0",a.SUPERPOSITION_BACK_COLOR="#EFF",a.SUPERPOSITION_MID_COLOR="#8FF",
a.SUPERPOSITION_FORE_COLOR="#0BB",a.CYCLE_DURATION_MS=8e3,a.TIME_CACHE_GRANULARITY=196,a.REDRAW_COOLDOWN_MILLIS=10,a.GATE_RADIUS=20,
a.WIRE_SPACING=50,a.BACKGROUND_COLOR="white",a.BACKGROUND_COLOR_CIRCUIT="white",a.BACKGROUND_COLOR_TOOLBOX="#CCC",a.TOOLBOX_GATE_SPACING=2,
a.TOOLBOX_GROUP_SPACING=24-a.TOOLBOX_GATE_SPACING,a.TOOLBOX_GATE_SPAN=2*a.GATE_RADIUS+a.TOOLBOX_GATE_SPACING,a.TOOLBOX_GROUP_SPAN=2*a.TOOLBOX_GATE_SPAN+a.TOOLBOX_GROUP_SPACING,
a.TOOLBOX_MARGIN_X=35,a.TOOLBOX_MARGIN_Y=18,a.MINIMUM_CANVAS_HEIGHT=400,a.SUPPRESSED_GLSL_WARNING_PATTERNS=[],a.DEFAULT_FILL_COLOR="white",
a.DEFAULT_STROKE_COLOR="black",a.DEFAULT_TEXT_COLOR="black",a.DEFAULT_FONT_SIZE=12,a.DEFAULT_FONT_FAMILY="sans-serif",a.DEFAULT_STROKE_THICKNESS=1,
a.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS=!1,a.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS=300,{get Config(){return a}}}),$traceurRuntime.registerModule("src/draw/CachablePainting.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/CachablePainting.js")).Painter,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/draw/CachablePainting.js")).RestartableRng,c=new b,d=function(){
function b(a,b){this.sizeFunc=a,this._drawingFunc=b,this._cachedCanvases=new Map}return $traceurRuntime.createClass(b,{paint:function(b,d,e){
var f=arguments[3];if(!this._cachedCanvases.has(f)){var g=document.createElement("canvas"),h=this.sizeFunc(f),i=h.width,j=h.height;
g.width=i,g.height=j,this._drawingFunc(new a(g,c.restarted()),f),this._cachedCanvases.set(f,g)}e.ctx.drawImage(this._cachedCanvases.get(f),b,d);
}},{})}();return{get CachablePainting(){return d}}}),$traceurRuntime.registerModule("src/draw/GateDrawParams.js",[],function(){"use strict";
var a=function(){function a(a,b,c,d,e,f,g,h,i,j,k){this.painter=a,this.isInToolbox=b,this.isHighlighted=c,this.isResizeShowing=d,
this.isResizeHighlighted=e,this.rect=f,this.gate=g,this.stats=h,this.positionInCircuit=i,this.focusPoints=j,this.customStats=k}return $traceurRuntime.createClass(a,{},{});
}();return{get GateDrawParams(){return a}}}),$traceurRuntime.registerModule("src/draw/GatePainting.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/GatePainting.js")).Config,b=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/draw/GatePainting.js")).GateDrawParams,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/draw/GatePainting.js")).MathPainter),c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/GatePainting.js")).Point,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/GatePainting.js")).Rect,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/GatePainting.js")).Util,f=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}();f.paintOutline=function(a){if(a.isInToolbox){var b=a.rect.shiftedBy(.5,.5);
a.painter.strokeLine(b.topRight(),b.bottomRight()),a.painter.strokeLine(b.bottomLeft(),b.bottomRight())}a.painter.strokeRect(a.rect,"black");
},f.paintBackground=function(b){var c=void 0!==arguments[1]?arguments[1]:a.GATE_FILL_COLOR,d=void 0!==arguments[2]?arguments[2]:a.GATE_FILL_COLOR,e=b.isInToolbox?c:d;
b.isHighlighted&&(e=a.HIGHLIGHTED_GATE_FILL_COLOR),b.painter.fillRect(b.rect,e)},f.MAKE_HIGHLIGHTED_DRAWER=function(){var b=void 0!==arguments[0]?arguments[0]:a.GATE_FILL_COLOR,c=void 0!==arguments[1]?arguments[1]:a.GATE_FILL_COLOR;
return function(a){f.paintBackground(a,b,c),f.paintOutline(a),f.paintResizeTab(a),f.paintGateSymbol(a)}},f.DEFAULT_DRAWER=f.MAKE_HIGHLIGHTED_DRAWER(),
f.rectForResizeTab=function(b){var c=Math.min(a.GATE_RADIUS,b.h/4);return new d(b.x,b.bottom()-c,b.w,2*a.GATE_RADIUS)},f.paintResizeTab=function(b){
if(b.isResizeShowing&&b.gate.canChangeInSize()){var c=a.GATE_RADIUS,d=f.rectForResizeTab(b.rect),e=d.skipLeft(2).skipRight(2),g=e.center(),h=g.x,i=g.y,j=b.isResizeHighlighted?a.HIGHLIGHTED_GATE_FILL_COLOR:a.GATE_FILL_COLOR,k=b.isResizeHighlighted?"#222":"gray";
b.painter.ctx.save(),b.painter.ctx.globalAlpha*=b.isResizeHighlighted?1:.7,b.painter.fillRect(e,j),b.painter.strokeRect(e,"gray"),
b.painter.ctx.restore(),b.painter.print("resize",h,i,"center","middle",k,"monospace",e.w-4,e.h-4),b.painter.trace(function(a){var d=[b.gate.canIncreaseInSize()?1:-1,b.gate.canDecreaseInSize()?-1:1],e=[1,-1],f=!0,g=!1,j=void 0;
try{for(var k=void 0,l=[-1,1][Symbol.iterator]();!(f=(k=l.next()).done);f=!0)for(var m=k.value,n=0;n<2;n++){var o=i+c*e[n]*5/8,p=o+c*d[n]/8,q=o-c*d[n]/8;
a.line(h,p,h+c*m*.3,q)}}catch(r){g=!0,j=r}finally{try{f||null==l["return"]||l["return"]()}finally{if(g)throw j}}}).thenStroke(k)}
},f.paintGateSymbol=function(a){var b,c,d=a.painter,e=a.gate.symbol,f=a.rect,g="16px sans-serif";f=f.paddedBy(-2);var h=a.gate.gateFamily.length>1&&a.isInToolbox?"↕":void 0,i=e.indexOf("\n"),j=void 0;
i!==-1&&(j=e.substring(i+1),e=e.substring(0,i));var k=j||h;void 0!==k&&(a.isInToolbox||a.isHighlighted)&&d.print(k,f.x+f.w,f.y+f.h,"right","bottom","black","16px sans-serif",f.w,f.h/2);
var l=e.split("^");if(2!==l.length||""===l[0]||""===l[1])return void d.print(e,f.x+f.w/2,f.y+f.h/2,"center","middle","black",g,f.w,f.h);
var m=l,n=(b=m[Symbol.iterator](),(c=b.next()).done?void 0:c.value),o=(c=b.next()).done?void 0:c.value;d.ctx.font=g;var p=d.ctx.measureText(n).width,q=d.ctx.measureText(o).width,r=Math.min(f.w,p+q)/(p+q),s=f.w/2+(p-q)*r/2;
d.print(n,f.x+s,f.y+f.h/2,"right","hanging","black",g,s,f.h),d.print(o,f.x+s,f.y+f.h/2,"left","alphabetic","black",g,f.w-s,f.h)},
f.SECTIONED_DRAWER_MAKER=function(b,d){return function(e){if(e.isInToolbox)return void f.DEFAULT_DRAWER(e);var g=e.isHighlighted?a.HIGHLIGHTED_GATE_FILL_COLOR:a.GATE_FILL_COLOR,h="16px sans-serif";
e.painter.fillRect(e.rect,g);for(var i=0,j=0;j<b.length;j++){var k=void 0;if(j<b.length-1){k=i+d[j];var l=e.rect.y+e.rect.h*k;e.painter.strokeLine(new c(e.rect.x,l),new c(e.rect.right(),l),"#BBB");
}else k=1;e.painter.print(b[j],e.rect.x+e.rect.w/2,e.rect.y+e.rect.h*(i+k)/2,"center","middle","black",h,e.rect.w-2,e.rect.h*(k-i)),
i=k}e.painter.strokeRect(e.rect),f.paintResizeTab(e)}};var g=f.MAKE_HIGHLIGHTED_DRAWER(a.DISPLAY_GATE_IN_TOOLBOX_FILL_COLOR);return f.makeDisplayDrawer=function(a){
return function(b){return void 0===b.positionInCircuit?void g(b):(f.paintResizeTab(b),a(b),b.isHighlighted&&b.painter.strokeRect(b.rect,"black",1.5),
b.painter.ctx.save(),b.painter.ctx.globalAlpha*=.25,f.paintResizeTab(b),void b.painter.ctx.restore())}},f.MATRIX_DRAWER=function(c){
var d=c.gate.knownMatrixAt(c.stats.time);return void 0===d?void f.DEFAULT_DRAWER(c):(c.painter.fillRect(c.rect,c.isHighlighted?a.HIGHLIGHTED_GATE_FILL_COLOR:a.GATE_FILL_COLOR),
b.paintMatrix(c.painter,d,c.rect,a.OPERATION_FORE_COLOR,"black",void 0,a.OPERATION_BACK_COLOR,void 0,"transparent"),c.isHighlighted&&(c.painter.ctx.save(),
c.painter.ctx.globalAlpha*=.9,c.painter.fillRect(c.rect,a.HIGHLIGHTED_GATE_FILL_COLOR),c.painter.ctx.restore()),void f.paintOutline(c));
},f.makeCycleDrawer=function(){var b=void 0!==arguments[0]?arguments[0]:1,c=void 0!==arguments[1]?arguments[1]:1,d=void 0!==arguments[2]?arguments[2]:1;
return function(g){if(f.MAKE_HIGHLIGHTED_DRAWER(a.TIME_DEPENDENT_HIGHLIGHT_COLOR)(g),!g.isInToolbox||g.isHighlighted){var h=2*Math.PI,i=e.properMod(-g.stats.time*h*d,h),j=g.rect.center(),k=.4*g.rect.w;
g.painter.ctx.save(),g.painter.ctx.translate(j.x,j.y),g.painter.ctx.scale(b,c),g.painter.ctx.strokeStyle="black",g.painter.ctx.fillStyle="yellow",
g.painter.ctx.globalAlpha*=.4,g.painter.ctx.beginPath(),g.painter.ctx.moveTo(0,0),g.painter.ctx.lineTo(0,k),g.painter.ctx.arc(0,0,k,h/4,h/4+i,!0),
g.painter.ctx.lineTo(0,0),g.painter.ctx.closePath(),g.painter.ctx.stroke(),g.painter.ctx.fill(),g.painter.ctx.restore()}}},f.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX=function(a){
return a.isInToolbox?void f.DEFAULT_DRAWER(a):void f.MATRIX_DRAWER(a)},{get GatePainting(){return f}}}),$traceurRuntime.registerModule("src/draw/MathPainter.js",[],function(){
"use strict";var a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/MathPainter.js")).Painter,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/draw/MathPainter.js")).Format),b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/MathPainter.js")).Point,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/MathPainter.js")).Rect,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/MathPainter.js")),e=d.seq,f=d.Seq,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/MathPainter.js")).Util,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/MathPainter.js")).Config,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/draw/MathPainter.js")).Complex,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/draw/MathPainter.js")).Matrix),j=function(){
function d(){}return $traceurRuntime.createClass(d,{},{describeProbability:function(a,b){var c=100*a,d=Math.pow(10,-b);return c>100-d/2?"On":c<d/2?"Off":Math.min(Math.max(c,d),100-d).toFixed(b)+"%";
},paintProbabilityBox:function(a,b,c){var f=void 0!==arguments[3]?arguments[3]:[],g=void 0!==arguments[4]?arguments[4]:h.DISPLAY_GATE_BACK_COLOR,i=void 0!==arguments[5]?arguments[5]:h.DISPLAY_GATE_FORE_COLOR;
a.fillRect(c,g);var j=c.center();isNaN(b)?(a.fillPolygon([c.bottomLeft(),c.topLeft(),c.topRight()],i),a.print("NaN",j.x,j.y,"center","middle","red","9pt sans-serif",c.w,c.h)):(a.fillRect(c.takeBottomProportion(b),i),
a.print(d.describeProbability(b,1),j.x,j.y,"center","middle","black","9pt sans-serif",c.w,c.h)),a.strokeRect(c,"lightgray"),e(f).any(function(a){
return c.containsPoint(a)})&&(a.strokeRect(c,"orange",2),d.paintDeferredValueTooltip(a,c.right(),c.y,"Chance of being ON if measured",(100*b).toFixed(5)+"%"));
},paintMatrixTooltip:function(a,b,e,f,g,h){var i=void 0!==arguments[6]?arguments[6]:function(){},j=b.width(),k=b.height(),l=e,m=l.x,n=l.y,o=Math.min(e.w/j,e.h/k),p=!0,q=!1,r=void 0;
try{for(var s=void 0,t=f[Symbol.iterator]();!(p=(s=t.next()).done);p=!0){var u=s.value,v=Math.floor((u.x-m)/o),w=Math.floor((u.y-n)/o);
if(v>=0&&v<b.width()&&w>=0&&w<b.height()){a.strokeRect(new c(m+o*v,n+o*w,o,o),"orange",2);var x=b.cell(v,w);d.paintDeferredValueTooltip(a,m+o*v+o,n+o*w,g(v,w),h(v,w,x),i(v,w,x));
}}}catch(y){q=!0,r=y}finally{try{p||null==t["return"]||t["return"]()}finally{if(q)throw r}}},_traceAmplitudeProbabilitySquare:function(a,b,c,d,e,f){
var g=b*b+c*c;g>.001&&a.polygon([d,e+f*(1-g),d+f,e+f*(1-g),d+f,e+f,d,e+f])},_traceProbabilitySquare:function(a,b,c,d,e,f){var g=b;
f*g>.1&&a.polygon([d,e+f*(1-g),d+f,e+f*(1-g),d+f,e+f,d,e+f])},_traceAmplitudeProbabilityCircle:function(a,b,c,d,e,f){var g=Math.sqrt(b*b+c*c);
f*g>.5&&a.circle(d+f/2,e+f/2,g*f/2)},_traceAmplitudeLogarithmCircle:function(a,b,c,d,e,f){var g=1+Math.log(b*b+c*c)/15;g>0&&a.circle(d+f/2,e+f/2,g*f/2);
},_traceAmplitudePhaseDirection:function(a,b,c,d,e,f){var g=Math.sqrt(b*b+c*c),h=1+Math.log(g)/10,i=Math.max(1,h/g)*Math.max(f/2,5);
if(!(i<.1)){var j=d+f/2,k=e+f/2;a.line(j,k,j+b*i,k-c*i)}},paintMatrix:function(a,b,c,e,f,g){var i=void 0!==arguments[6]?arguments[6]:h.DISPLAY_GATE_BACK_COLOR,j=arguments[7],k=void 0!==arguments[8]?arguments[8]:"#AAA",l=b.width(),m=b.height(),n=b.rawBuffer(),o=Math.min(c.w/l,c.h/m);
c=c.withW(o*l).withH(o*m);var p=c,q=p.x,r=p.y,s=b.hasNaN();j=j||f,a.fillRect(c,i);var t=function(b){return a.trace(function(a){for(var c=0;c<m;c++)for(var d=0;d<l;d++){
var e=2*(c*l+d);b(a,n[e],n[e+1],q+o*d,r+o*c,o)}})};s||(void 0!==g&&t(d._traceAmplitudeProbabilitySquare).thenFill(g).thenStroke("lightgray",.5),
void 0!==e&&(t(d._traceAmplitudeProbabilityCircle).thenFill(e).thenStroke(f,.5),t(d._traceAmplitudeLogarithmCircle).thenStroke(k,.5))),
a.trace(function(a){return a.grid(q,r,c.w,c.h,l,m)}).thenStroke("lightgray"),s||void 0!==k&&t(d._traceAmplitudePhaseDirection).thenStroke(j),
s&&a.print("NaN",c.x+c.w/2,c.y+c.h/2,"center","middle","red","16px sans-serif",c.w,c.h)},paintDeferredValueTooltip:function(a,b,d,e,f){
var g=arguments[5],i=void 0!==arguments[6]?arguments[6]:h.DISPLAY_GATE_BACK_COLOR,j="12px sans-serif",k="bold 12px monospace";a.defer(function(){
a.ctx.font=j;var h=a.ctx.measureText(e).width;a.ctx.font=k;var l=a.ctx.measureText(f).width,m=void 0===g?0:a.ctx.measureText(g).width,n=20,o=40+(void 0===g?0:20),p=Math.max(Math.max(h,l),m),q=new c(b,d-o,p,o).snapInside(new c(0,0,a.ctx.canvas.clientWidth,a.ctx.canvas.clientHeight)),r=function(b,d){
var e=new c(q.x,q.bottom()-d,b,d).paddedBy(4);a.trace(function(a){return a.rect(e.x,e.y,e.w,e.h)}).thenFill(i).thenStroke("black");
},s=function(b,c){a.print(e,q.x,q.bottom()-c,"left","bottom","black",j,q.w,n,function(a,d){return r(Math.max(b,a),c+d)})},t=function(b,c){
a.print(f,q.x,q.bottom()-c,"left","bottom","black",k,q.w,n,function(a,d){return s(Math.max(b,a),c+d)})};void 0===g?t(0,0):a.print(g,q.x,q.bottom(),"left","bottom","black",k,q.w,n,t);
})},paintBlochSphereRotation:function(a,c,g){var j,k=void 0!==arguments[3]?arguments[3]:h.DISPLAY_GATE_BACK_COLOR,l=void 0!==arguments[4]?arguments[4]:h.DISPLAY_GATE_FORE_COLOR,m=g.center(),n=Math.min(g.w,g.h)/2,o=i.fromRows([[-n,0],[-n/3,n/3],[0,n]]).adjoint(),p=function(a){
var c=o.times(a);return new b(c.cell(0,0).real,c.cell(0,1).real)},q=f.range(3).map(function(a){return i.generate(1,3,function(b,c){
return b===a?1:0})}).toArray();a.fillCircle(m,n,k),a.trace(function(a){a.circle(m.x,m.y,n),a.ellipse(m.x,m.y,n,n/3),a.ellipse(m.x,m.y,n/3,n);
var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=q[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value,h=p(g);a.line(m.x-h.x,m.y-h.y,m.x+h.x,m.y+h.y);
}}catch(i){c=!0,d=i}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}}).thenStroke("#BBB");var r=c.qubitOperationToAngleAxisRotation(),s=r.angle,t=r.axis,u=(j=i).col.apply(j,$traceurRuntime.spread(t)),v=p(u),w=[i.col(t[0],t[1],0),u,i.col(0,0,t[2])].map(p);
a.strokePolygon(e(w).reverse().concat(w.map(function(a){return a.times(-1)})).map(function(a){return m.plus(a)}).toArray(),"#666"),
a.strokeLine(m.plus(v),m.plus(v.times(-1)),"black",2);var x=function(a){return Math.sqrt(a.adjoint().times(a).cell(0,0).real)},y=e(q).mapWithIndex(function(a,b){
return a.times([2,-3,1][b])}).map(function(a){return u.cross3(a)}).maxBy(x),z=u.cross3(y);y=y.times(.15/x(y)),z=z.times(.15/x(z));
var A=p(y),B=p(z);d._paintBlochSphereRotation_rotationGuideArrows(a,m,s,v,A,B,l)},_paintBlochSphereRotation_rotationGuideArrows:function(a,b,c,d,e,g,h){
var i=f.range(Math.floor(32*Math.abs(c))).map(function(a){var b=c<0?Math.PI-a/32:a/32;return e.times(Math.cos(b)).plus(g.times(Math.sin(b)));
}).toArray();if(!(i.length<=1)){var j=!0,k=!1,l=void 0;try{for(var m=function(){var c=n.value,e=b.plus(d.times(c)),f=i.map(function(a){
return e.plus(a)}),g=f[f.length-1],j=g.plus(f[f.length-2].times(-1)),k=[d.times(.15),j.times(30),d.times(-.15)].map(function(a){return g.plus(a);
}),l=[].concat.apply([],k.map(function(a){return[a.x,a.y]}));a.strokePath(f,"#444"),a.trace(function(a){return a.polygon(l)}).thenFill(h).thenStroke("#444");
},n=void 0,o=[-.55,0,.55][Symbol.iterator]();!(j=(n=o.next()).done);j=!0)m()}catch(p){k=!0,l=p}finally{try{j||null==o["return"]||o["return"]();
}finally{if(k)throw l}}}},paintDensityMatrix:function(b,c,e){var f=void 0!==arguments[3]?arguments[3]:[],i=void 0!==arguments[4]?arguments[4]:h.DISPLAY_GATE_BACK_COLOR,j=void 0!==arguments[5]?arguments[5]:h.DISPLAY_GATE_FORE_COLOR,k=c.width(),l=c.height(),m=c.rawBuffer(),n=Math.min(e.w/k,e.h/l),o=e.x,p=e.y,q=c.hasNaN(),r=function(a){
return b.trace(function(b){for(var c=0;c<l;c++)for(var d=0;d<k;d++)if(d!==c){var e=2*(c*k+d);a(b,m[e],m[e+1],o+n*d,p+n*c,n)}})},s=function(a){
return b.trace(function(b){for(var c=0;c<l;c++){var d=c*(k+1)*2;a(b,m[d],m[d+1],o+n*c,p+n*c,n)}})};b.fillRect(e,i),q||(s(d._traceProbabilitySquare).thenFill(j).thenStroke("#040",.5),
r(d._traceAmplitudeProbabilityCircle).thenFill(j).thenStroke("#040",.5),r(d._traceAmplitudeLogarithmCircle).thenStroke("#BBB",.5),
r(d._traceAmplitudePhaseDirection).thenStroke("black"));var t=e.w/k;t>2?b.trace(function(a){return a.grid(o,p,e.w,e.h,k,l)}).thenStroke("lightgray",Math.min(1,2/Math.log(k))):(b.ctx.save(),
b.ctx.globalAlpha*=.2,b.fillRect(e,"lightgray"),b.ctx.restore()),q&&b.print("NaN",e.x+e.w/2,e.y+e.h/2,"center","middle","red","16px sans-serif",e.w,e.h);
var u=Math.round(Math.log2(l));d.paintMatrixTooltip(b,c,e,f,function(a,b){return a===b?"Probability of |"+g.bin(a,u)+"⟩":"Coupling of |"+g.bin(a,u)+"⟩ to ⟨"+g.bin(b,u)+"|";
},function(b,d,e){return b===d?(100*c.cell(b,d).real).toFixed(4)+"%":c.cell(b,d).toString(new a((!1),0,6,", "))})}})}();return{get MathPainter(){
return j}}}),$traceurRuntime.registerModule("src/draw/Painter.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/Painter.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/Painter.js")).Point,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/Painter.js")).Rect,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/draw/Painter.js")).RestartableRng,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/Painter.js")),f=e.seq,g=e.Seq,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/Painter.js")).Util,i=function(){
function e(a){var b=void 0!==arguments[1]?arguments[1]:new d;this.canvas=a,this.ctx=a.getContext("2d"),this._deferredPaintActions=[],
this._traceAction=new k(this.ctx),this._tracer=new j(this.ctx),this.desiredCursorStyle=void 0,this.touchBlockers=[],this.rng=b}return $traceurRuntime.createClass(e,{
noteTouchBlocker:function(a){this.touchBlockers.push(a)},setDesiredCursor:function(a){this.desiredCursorStyle=a},defer:function(a){
this._deferredPaintActions.push(a)},paintDeferred:function(){var a=!0,b=!1,c=void 0;try{for(var d=void 0,e=this._deferredPaintActions[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){
var f=d.value;f()}}catch(g){b=!0,c=g}finally{try{a||null==e["return"]||e["return"]()}finally{if(b)throw c}}this._deferredPaintActions=[];
},paintableArea:function(){return new c(0,0,this.canvas.width,this.canvas.height)},clear:function(){var b=void 0!==arguments[0]?arguments[0]:a.DEFAULT_FILL_COLOR;
this.ctx.fillStyle=b,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},strokeLine:function(b,c){var d=void 0!==arguments[2]?arguments[2]:a.DEFAULT_STROKE_COLOR,e=void 0!==arguments[3]?arguments[3]:1;
this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y),this.ctx.lineTo(c.x,c.y),this.ctx.strokeStyle=d,this.ctx.lineWidth=e,this.ctx.stroke();
},strokeRect:function(a){var b=void 0!==arguments[1]?arguments[1]:"black",c=void 0!==arguments[2]?arguments[2]:1;this.ctx.strokeStyle=b,
this.ctx.lineWidth=c,this.ctx.strokeRect(a.x,a.y,a.w,a.h)},fillRect:function(b){var c=void 0!==arguments[1]?arguments[1]:a.DEFAULT_FILL_COLOR;
this.ctx.fillStyle=c,this.ctx.fillRect(b.x,b.y,b.w,b.h)},strokeCircle:function(b,c){var d=void 0!==arguments[2]?arguments[2]:a.DEFAULT_STROKE_COLOR,e=void 0!==arguments[3]?arguments[3]:a.DEFAULT_STROKE_THICKNESS;
this.ctx.beginPath(),this.ctx.strokeStyle=d,this.ctx.lineWidth=e,this.ctx.arc(b.x,b.y,Math.max(c-.5,0),0,2*Math.PI),this.ctx.stroke();
},trace:function(a){return this.ctx.beginPath(),a(this._tracer),this._traceAction},fillCircle:function(b,c){var d=void 0!==arguments[2]?arguments[2]:a.DEFAULT_FILL_COLOR;
this.ctx.beginPath(),this.ctx.arc(b.x,b.y,Math.max(c-.5,0),0,2*Math.PI),this.ctx.fillStyle=d,this.ctx.fill()},print:function(a,b,c,d,e,f,g,h,i){
var j=arguments[9];this.ctx.font=g;var k=this.ctx.measureText(a).width,l=2.5*this.ctx.measureText("0").width,m=Math.min(Math.min(h/k,i/l),1);
void 0!==j&&j(k*m,l*m),this.ctx.save(),this.ctx.textAlign=d,this.ctx.textBaseline=e,this.ctx.font=g,this.ctx.fillStyle=f,this.ctx.translate(b,c),
this.ctx.scale(m,m),this.ctx.fillText(a,0,0),this.ctx.restore()},printParagraph:function(d,e){for(var i,j,k,l,m=void 0!==arguments[2]?arguments[2]:new b(0,0),n=void 0!==arguments[3]?arguments[3]:a.DEFAULT_TEXT_COLOR,o=void 0!==arguments[4]?arguments[4]:a.DEFAULT_FONT_SIZE,p=void 0!==arguments[5]?arguments[5]:a.DEFAULT_FONT_FAMILY,q=this,r=function(a){
var b=a.fontBoundingBoxAscent;return void 0===b?.75*i:b},s=function(a){var b=a.fontBoundingBoxDescent;return void 0===b?.25*i:b},t=function(a){
return r(a)+s(a)},u=f(d.split("\n")),v=0;i=o-v,this.ctx.font=i+"px "+p,j=u.flatMap(function(a){return h.breakLine(a,e.w,function(a){
return q.ctx.measureText(a).width})}).toArray(),k=j.map(function(a){return q.ctx.measureText(a)}),l=f(k.map(t)).sum(),!(l<=e.h||i<=4);v++);
var w=function(a,b,c,d){return a+(b-c)*d},x=function(a){return w(e.x,e.w,a,m.x)},y=function(a){return w(e.y,e.h,a,m.y)},z=y(l);this.ctx.fillStyle=n;
for(var A=0,B=0;B<j.length;B++)A+=r(k[B]),this.ctx.fillText(j[B],x(k[B].width),z+A),A+=s(k[B]);var C=new g(k).map(function(a){return a.width;
}).max(0);return new c(x(C),z,C,l)},printLine:function(b,d){for(var e,f,g=void 0!==arguments[2]?arguments[2]:0,h=void 0!==arguments[3]?arguments[3]:a.DEFAULT_TEXT_COLOR,i=void 0!==arguments[4]?arguments[4]:a.DEFAULT_FONT_SIZE,j=void 0!==arguments[5]?arguments[5]:a.DEFAULT_FONT_FAMILY,k=arguments[6],l=function(a){
var b=a.fontBoundingBoxAscent;return void 0===b?.75*e:b},m=function(a){var b=a.fontBoundingBoxDescent;return void 0===b?.25*e:b},n=function(a){
return l(a)+m(a)},o=0;e=i-o,this.ctx.font=e+"px "+j,f=this.ctx.measureText(b),!(f.width<=d.w&&n(f)<=d.h||e<=4);o++);var p=n(f),q=void 0===k?l(f)/p:k,r=function(a,b,c,d){
return a+(b-c)*d},s=r(d.x,d.w,f.width,g),t=r(d.y,d.h,p,q);return this.ctx.fillStyle=h,this.ctx.fillText(b,s,t+l(f)),new c(s,t,f.width,p);
},strokePolygon:function(b){var c=void 0!==arguments[1]?arguments[1]:a.DEFAULT_STROKE_COLOR,d=void 0!==arguments[2]?arguments[2]:a.DEFAULT_STROKE_THICKNESS;
if(0!==b.length){var e=b[b.length-1];this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y);var f=!0,g=!1,h=void 0;try{for(var i=void 0,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value;this.ctx.lineTo(k.x,k.y)}}catch(l){g=!0,h=l}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}}this.ctx.strokeStyle=c,
this.ctx.lineWidth=d,this.ctx.stroke()}},strokePath:function(b){var c=void 0!==arguments[1]?arguments[1]:a.DEFAULT_STROKE_COLOR,d=void 0!==arguments[2]?arguments[2]:a.DEFAULT_STROKE_THICKNESS;
if(0!==b.length){this.ctx.beginPath(),this.ctx.moveTo(b[0].x,b[0].y);var e=!0,f=!1,g=void 0;try{for(var h=void 0,i=b.slice(1)[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){
var j=h.value;this.ctx.lineTo(j.x,j.y)}}catch(k){f=!0,g=k}finally{try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}this.ctx.strokeStyle=c,
this.ctx.lineWidth=d,this.ctx.stroke()}},fillPolygon:function(a,b){var c=a[a.length-1];this.ctx.beginPath(),this.ctx.moveTo(c.x,c.y);
var d=!0,e=!1,f=void 0;try{for(var g=void 0,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;this.ctx.lineTo(i.x,i.y);
}}catch(j){e=!0,f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}this.ctx.fillStyle=b,this.ctx.fill()}},{});
}(),j=function(){function a(a){this.ctx=a}return $traceurRuntime.createClass(a,{line:function(a,b,c,d){this.ctx.moveTo(a,b),this.ctx.lineTo(c,d);
},rect:function(a,b,c,d){this.ctx.moveTo(a,b),this.ctx.lineTo(a+c,b),this.ctx.lineTo(a+c,b+d),this.ctx.lineTo(a,b+d),this.ctx.lineTo(a,b);
},circle:function(a,b,c){this.ctx.moveTo(a+c,b),this.ctx.arc(a,b,c,0,2*Math.PI,!1)},ellipse:function(a,b,c,d){this.ctx.save(),this.ctx.translate(a-c,b-d),
this.ctx.scale(c,d),this.ctx.moveTo(2,1),this.ctx.arc(1,1,1,0,2*Math.PI,!1),this.ctx.restore()},grid:function(a,b,c,d,e,f){for(var g=c/e,h=d/f,i=a+e*g,j=b+f*h,k=0;k<=e;k++)this.ctx.moveTo(a+k*g,b),
this.ctx.lineTo(a+k*g,j);for(var l=0;l<=f;l++)this.ctx.moveTo(a,b+l*h),this.ctx.lineTo(i,b+l*h)},polygon:function(a){if(0!==a.length){
var b=a.length;this.ctx.moveTo(a[b-2],a[b-1]);for(var c=0;c<b;c+=2)this.ctx.lineTo(a[c],a[c+1])}},arrowHead:function(a,b,c,d,e){var f=d+e/2+Math.PI,g=d-e/2+Math.PI;
this.polygon([a+Math.cos(d)*c,b+Math.sin(d)*c,a+Math.cos(f)*c,b+Math.sin(f)*c,a+Math.cos(g)*c,b+Math.sin(g)*c])}},{})}(),k=function(){
function a(a){this.ctx=a}return $traceurRuntime.createClass(a,{thenFill:function(a){return this.ctx.fillStyle=a,this.ctx.fill(),this;
},thenStroke:function(a){var b=void 0!==arguments[1]?arguments[1]:1;return this.ctx.strokeStyle=a,this.ctx.lineWidth=b,this.ctx.stroke(),
this}},{})}();return{get Painter(){return i}}}),$traceurRuntime.registerModule("src/draw/WidgetPainter.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/draw/WidgetPainter.js")).Complex,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/draw/WidgetPainter.js")).Config,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/draw/WidgetPainter.js")).Format,d=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/draw/WidgetPainter.js")).Gate,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/draw/WidgetPainter.js")).MathPainter),e=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/draw/WidgetPainter.js")).Matrix,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/draw/WidgetPainter.js")).Painter,$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/draw/WidgetPainter.js")).Point),f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/draw/WidgetPainter.js")).Rect,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/draw/WidgetPainter.js")).Seq,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/draw/WidgetPainter.js")).drawCircuitTooltip,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/draw/WidgetPainter.js")).Util,j=function(){
function j(){}return $traceurRuntime.createClass(j,{},{describeGateTransformations:function(a,b){var d=a.height(),e=Math.round(Math.log2(d));
return g.range(d).map(function(f){var h=j.describeKet(e,f,1,c.SIMPLIFIED),i=a.getColumn(f);if(i.every(function(a){return a.isEqualTo(0);
}))return"discards "+h;if(g.range(d).every(function(a){return i[a].isEqualTo(a===f?1:0)})){if(b!==c.CONSISTENT)return"doesn't affect "+h;
}else if(g.range(d).every(function(a){return a===f||i[a].isEqualTo(0)}))return"phases "+h+" by "+i[f].toString(b);var k=new g(i).mapWithIndex(function(a,c){
return j.describeKet(e,c,a,b)}).filter(function(a){return""!==a}).join(" + ").split(" + -").join(" - ").split(" + +").join(" + ");
return"transforms "+h+" into "+k}).toArray()},_paintGateTooltip_matrix:function(a,g,h,i,k,l,m,n){if(void 0!==h){m(new f(0,n(),1,0),2*i),
m(a.printParagraph("As matrix:",new f(i,n(),l,18),new e(0,0),"black",12),0);var o=new f(i,n(),k,k),p=new f(0,o.y,l-i,k).skipLeft(o.right()+i);
d.paintMatrix(a,h,o,b.OPERATION_FORE_COLOR,"black",void 0,b.OPERATION_BACK_COLOR,void 0,"transparent"),m(o);var q=h.height();if(q<=4)for(var r=g.stableDuration()<.2?c.CONSISTENT:c.SIMPLIFIED,s=j.describeGateTransformations(h,r),t=p.h/q,u=0;u<q;u++)m(a.printParagraph(s[u],p.skipTop(u*t).takeTop(t),new e(0,.5),"black",12));
}},_paintGateTooltip_rotation:function(a,h,i,k,l,m,n,o){if(void 0!==i&&2===i.width()&&i.isUnitary(.001)){n(new f(0,o(),1,0),2*k),
n(a.printParagraph("As rotation:",new f(k,o(),m,18),new e(0,0),"black",12),0);var p=i.qubitOperationToAngleAxisRotation(),q=p.angle,r=p.axis,s=p.phase,t=new f(k,o(),l,l);
d.paintBlochSphereRotation(a,i,t,b.OPERATION_BACK_COLOR,b.OPERATION_FORE_COLOR),n(t);var u=h.stableDuration()<.2?c.CONSISTENT:c.SIMPLIFIED,v=new g(["rotates: "+u.formatFloat(180*q/Math.PI)+"°","around: "+j.describeAxis(r,u),"","hidden phase: exp("+u.formatFloat(180*s/Math.PI)+"°i)",""]).join("\n");
n(a.printParagraph(v,new f(0,t.y,m-k,l).skipLeft(t.right()+k),new e(0,.5),"black",12))}},_paintGateTooltip_circuit:function(a,b,c,d,g,i,j,k){
if(void 0!==b){var l=b.gateWeight();i(new f(0,j(),1,0),2*c),i(a.printParagraph("As circuit (gate weight = "+l+"):",new f(c,j(),g,18),new e(0,0),"black",12),0);
var m=new f(c,j(),g,d),n=h(a,b,m,!0,k),o=n.maxW,p=n.maxH;i(m.withW(o).withH(p))}},paintGateTooltipHelper:function(a,b,c,d){var g,h,i,k,l=[4,65],m=(g=l[Symbol.iterator](),
(h=g.next()).done?void 0:h.value),n=(h=g.next()).done?void 0:h.value,o=[0,m],p=(i=o[Symbol.iterator](),(k=i.next()).done?void 0:k.value),q=(k=i.next()).done?void 0:k.value,r=function(a){
var b=void 0!==arguments[1]?arguments[1]:m;q=Math.max(q,a.bottom()+b),p=Math.max(p,a.right()+b)};r(a.printLine(c.name,new f(m,q,b,18),0,"blue",24)),
""!==c.blurb&&r(a.printParagraph(c.blurb,new f(m,q,b,50),new e(0,0),"black",14));var s=c.knownMatrixAt(d);return c.definitelyHasNoEffect()?{
maxX:p,maxY:q}:(j._paintGateTooltip_matrix(a,c,s,m,n,b,r,function(){return q}),j._paintGateTooltip_rotation(a,c,s,m,n,b,r,function(){
return q}),j._paintGateTooltip_circuit(a,c.knownCircuitNested,m,n,b,r,function(){return q},d),{maxX:p,maxY:q})},paintGateTooltip:function(a,b,c,d){
var e=void 0===arguments[4]||arguments[4];a.ctx.save(),a.ctx.translate(b.x,b.y),b=b.withX(0).withY(0);var g=Math.min(b.w/500,b.h/300);
e&&g<1&&(a.ctx.scale(g,g),b=b.withH(b.h/g).withW(b.w/g));var h=b.w,i=j.paintGateTooltipHelper(a,h,c,d),k=i.maxX,l=i.maxY,m=new f(0,0,k,l);
return a.fillRect(m,"#F9FFF9"),a.strokeRect(m,"black"),j.paintGateTooltipHelper(a,h,c,d),a.ctx.restore(),{maxW:k,maxH:l}},describeKet:function(b,d,e,f){
if(e=a.from(e),e.isEqualTo(0))return"";var g=e.isEqualTo(1)?"":e.isEqualTo(-1)?"-":e.isEqualTo(a.I)?"i":e.isEqualTo(a.I.times(-1))?"-i":0!==e.real&&0!==e.imag||f===c.CONSISTENT?"("+e.toString(f)+")·":e.toString(f),h=i.bin(d,b);
return g+"|"+h+"⟩"},describeAxis:function(a,b){var c=new g(a).map(Math.abs).max();return new g(a).map(function(a){return a/c}).zip(["X","Y","Z"],function(a,c){
return 0===a?"":1===a?c:a===-1?"-"+c:b.formatFloat(a)+"·"+c}).filter(function(a){return""!==a}).join(" + ").replace(" + -"," - ").replace(" + +"," + ");
}})}();return{get WidgetPainter(){return j}}}),$traceurRuntime.registerModule("src/fallback.js",[],function(){"use strict";function a(){
f=!0,window.onerror=c}function b(a,b){if(void 0===b){var c=!0,d=!1,f=void 0;try{for(var g=void 0,h=e[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){
var i=g.value,j=i.regex,k=i.handler;if(j.test(a))return k}}catch(l){d=!0,f=l}finally{try{c||null==h["return"]||h["return"]()}finally{
if(d)throw f}}}}function c(a,b,c,d,e){try{var f=m((e instanceof Object?e.stack:void 0)||b+":"+c+":"+d),g=["URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","ERROR OBJECT",e instanceof Object&&void 0!==e.toString?e.toString():String(e),"","ERROR LOCATION",m(f)].join("\n");
j("An error happened. :(",a,g,"(Unexpected) "+a+" @ "+f.substr(0,200)+"[...]"),o(["An error is happening. :(","",a,"","Scroll down for more information"].join("\n"));
}catch(h){console.error("Caused an exception when handling unexpected error.",h)}return!1}var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/fallback.js")).describe,e=[],f=!1,g=function(a,b,c,d){
document.getElementById("error-happened-div").innerText=a,document.getElementById("error-message-div").innerText=b,document.getElementById("error-description-div").innerText=c,
document.getElementById("error-mailto-anchor").innerText="Email the issue to craig.gidney@gmail.com",document.getElementById("error-mailto-anchor").href=["mailto:craig.gidney@gmail.com?subject=",encodeURIComponent("Quirk had an error: "+b),"&body=",encodeURIComponent("\n\n\n"+c)].join(""),
document.getElementById("error-github-anchor").href=["https://github.com/Strilanc/Quirk/issues/new?title=",encodeURIComponent("Encountered error: "+b),"&body=",encodeURIComponent("\n\n\n"+c)].join(""),
document.getElementById("error-image-pre").src=k(),setTimeout(function(){document.getElementById("error-image-post").src=k()},0),
void 0===d?(document.getElementById("error-report-div").style.display="block",document.getElementById("error-known-div").style.display="none"):(document.getElementById("error-report-div").style.display="none",
document.getElementById("error-known-div").style.display="block",document.getElementById("error-known-issue-anchor").href=d)},h=[],i=[],j=function(a,c,d,e){
var f=arguments[4],j=document.getElementById("error-div").style;if(j.opacity<.7&&(h=[],i=[]),j.backgroundColor="#FFA",j.opacity=1,
j.display="block",h.indexOf(d)===-1){h.push(d),i.length>0&&(d+="\n\nCOVERED\n"+i.join("\n-------------\n")),i.indexOf(e)===-1&&i.push(e);
var k=b(c,f);return void 0!==k?void k():void g(a,c,d,f)}},k=function(){var a=document.getElementById("drawCanvas");return void 0===a?"#":a.toDataURL("image/png");
},l=function(a,b,c){if(!f)throw c;console.error("Recovered from unexpected error",{recovery:a,context:b,error:c});var e=c.stack||"unknown",g=[a,"","URL",document.location,"","BROWSER",window.navigator.userAgent,window.navigator.appName,window.navigator.appVersion,"","RECOVERY DETAILS",d(b),"","ERROR OBJECT",d(c),"","ERROR LOCATION",m(e)].join("\n");
j("Recovered from an error. :(",a+" ("+(c.message||"")+")",g,"(Recovered) "+a+" @ "+e.substr(0,200)+"[...]")},m=function(a){return a.replace(/http.+?\/src\.min\.js/g,"src.min.js");
},n=function(a,b,c){var d=function(){return j("A known problem is happening. :(",a,"",a,b)},f=!0,g=!1,h=void 0;try{for(var i=void 0,k=c[Symbol.iterator]();!(f=(i=k.next()).done);f=!0){
var l=i.value;e.push({regex:l,handler:d})}}catch(m){g=!0,h=m}finally{try{f||null==k["return"]||k["return"]()}finally{if(g)throw h;
}}d()},o=function(a){var b=document.getElementById("drawCanvas");if(void 0!==b){var c=b.getContext("2d");c.font="12px monospace";var d=a.split("\n"),e=0,f=!0,g=!1,h=void 0;
try{for(var i=void 0,j=d[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value;e=Math.max(e,c.measureText(k).width)}}catch(l){
g=!0,h=l}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h}}var m=12*d.length,n=(b.clientWidth-e)/2,o=(b.clientHeight-m)/2;
c.fillStyle="white",c.globalAlpha=.9,c.fillRect(n-10,o-10,e+20,m+20),c.globalAlpha=1,c.strokeStyle="red",c.strokeRect(n-10,o-10,e+20,m+20),
c.fillStyle="red";for(var p=0,q=0;q<d.length;q++)p+=3,c.fillText(d[q],n,o+p),p+=9}};return{get hookErrorHandler(){return a},get notifyAboutRecoveryFromUnexpectedError(){
return l},get onErrorHandler(){return c},get notifyAboutKnownIssue(){return n}}}),$traceurRuntime.registerModule("src/gates/AllGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ArithmeticGates.js","src/gates/AllGates.js")).ArithmeticGates,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AmplitudeDisplay.js","src/gates/AllGates.js")).AmplitudeDisplayFamily,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BitCountGates.js","src/gates/AllGates.js")).BitCountGates,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BlochSphereDisplay.js","src/gates/AllGates.js")).BlochSphereDisplay,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Controls.js","src/gates/AllGates.js")).Controls,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CountingGates.js","src/gates/AllGates.js")).CountingGates,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CycleBitsGates.js","src/gates/AllGates.js")).CycleBitsGates,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/DensityMatrixDisplay.js","src/gates/AllGates.js")).DensityMatrixDisplayFamily,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Debug_ErrorInjectionGate.js","src/gates/AllGates.js")).ErrorInjectionGate,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ExponentiatingGates.js","src/gates/AllGates.js")).ExponentiatingGates,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/FourierTransformGates.js","src/gates/AllGates.js")).FourierTransformGates,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/AllGates.js")).HalfTurnGates,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/InputGates.js","src/gates/AllGates.js")).InputGates,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MeasurementGate.js","src/gates/AllGates.js")).MeasurementGate,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/MultiplyAccumulateGates.js","src/gates/AllGates.js")).MultiplyAccumulateGates,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_NeGate.js","src/gates/AllGates.js")).NeGate,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PhaseGradientGates.js","src/gates/AllGates.js")).PhaseGradientGates,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PostSelectionGates.js","src/gates/AllGates.js")).PostSelectionGates,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/PoweringGates.js","src/gates/AllGates.js")).PoweringGates,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/AllGates.js")).ProbabilityDisplayFamily,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/QuarterTurnGates.js","src/gates/AllGates.js")).QuarterTurnGates,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/AllGates.js")).ReverseBitsGateFamily,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SampleDisplay.js","src/gates/AllGates.js")).SampleDisplayFamily,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SpacerGate.js","src/gates/AllGates.js")).SpacerGate,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/SwapGateHalf.js","src/gates/AllGates.js")).SwapGateHalf,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Impossible_UniversalNotGate.js","src/gates/AllGates.js")).UniversalNotGate,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousXGates.js","src/gates/AllGates.js")).VariousXGates,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousYGates.js","src/gates/AllGates.js")).VariousYGates,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/VariousZGates.js","src/gates/AllGates.js")).VariousZGates,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/XorGates.js","src/gates/AllGates.js")).XorGates,E=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_ZeroGate.js","src/gates/AllGates.js")).ZeroGate,F=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_MysteryGate.js","src/gates/AllGates.js")).MysteryGateMaker,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/AllGates.js")).seq,H={};
H.Special={Measurement:n,SwapHalf:y},H.Displays={AmplitudeDisplayFamily:b,ProbabilityDisplayFamily:t,SampleDisplayFamily:w,DensityMatrixDisplayFamily:h,
BlochSphereDisplay:d},H.Arithmetic=a,H.BitCountGates=c,H.Controls=e,H.CountingGates=f,H.CycleBitsGates=g,H.Displays.DensityMatrixDisplay=h.ofSize(1),
H.Displays.DensityMatrixDisplay2=h.ofSize(2),H.Displays.ChanceDisplay=H.Displays.ProbabilityDisplayFamily.ofSize(1),H.ErrorInjection=i,
H.Exponentiating=j,H.FourierTransformGates=k,H.HalfTurns=l,H.MultiplyAccumulateGates=o,H.OtherX=A,H.OtherY=B,H.OtherZ=C,H.PhaseGradientGates=q,
H.PostSelectionGates=r,H.Powering=s,H.QuarterTurns=u,H.ReverseBitsGateFamily=v,H.SpacerGate=x,H.UniversalNot=z,H.ZeroGate=E,H.NeGate=p,
H.InputGates=m,H.KnownToSerializer=$traceurRuntime.spread(e.all,m.all,[n,y,x,z,i,E,p],b.all,t.all,w.all,h.all,[d],a.all,c.all,f.all,g.all,j.all,k.all,l.all,o.all,u.all,q.all,r.all,s.all,v.all,A.all,B.all,C.all,D.all);
var I=G(H.KnownToSerializer).keyedBy(function(a){return a.serializedId});return H.findKnownGateById=function(a,b){return I.has(a)?I.get(a):b.findGateWithSerializedId(a);
},H.TopToolboxGroups=[{hint:"Probes",gates:[n,void 0,r.PostSelectOff,r.PostSelectOn,e.AntiControl,e.Control]},{hint:"Displays",gates:[w.ofSize(3),void 0,h.ofSize(1),d,t.ofSize(1),b.ofSize(2)]
},{hint:"Half Turns",gates:[l.Z,y,l.Y,void 0,l.X,l.H]},{hint:"Quarter Turns",gates:[u.SqrtZForward,u.SqrtZBackward,u.SqrtYForward,u.SqrtYBackward,u.SqrtXForward,u.SqrtXBackward]
},{hint:"Eighth Turns",gates:[C.Z4,C.Z4i,B.Y4,B.Y4i,A.X4,A.X4i]},{hint:"Fourier",gates:[q.PhaseGradientFamily.ofSize(2),q.PhaseDegradientFamily.ofSize(2),void 0,v.ofSize(2),k.FourierTransformFamily.ofSize(2),k.InverseFourierTransformFamily.ofSize(2)]
},{hint:"Other Probes",gates:[e.PlusControl,e.MinusControl,e.CrossControl,r.PostSelectCross,r.PostSelectPlus,r.PostSelectMinus]},{
hint:"Silly",gates:[E,F(),p,void 0,x,void 0]}],H.BottomToolboxGroups=[{hint:"Inputs",gates:[m.InputAFamily.ofSize(2),m.InputRevAFamily.ofSize(2),void 0,void 0,m.InputBFamily.ofSize(2),m.InputRevBFamily.ofSize(2)]
},{hint:"Arithmetic",gates:[a.IncrementFamily.ofSize(2),a.DecrementFamily.ofSize(2),a.PlusAFamily.ofSize(2),a.MinusAFamily.ofSize(2),o.MultiplyAddInputsFamily.ofSize(2),o.MultiplySubtractInputsFamily.ofSize(2)]
},{hint:"Cycling",gates:[f.CountingFamily.ofSize(3),f.UncountingFamily.ofSize(3),f.LeftShiftRotatingFamily.ofSize(3),f.RightShiftRotatingFamily.ofSize(3),g.CycleBitsFamily.ofSize(3),g.ReverseCycleBitsFamily.ofSize(3)]
},{hint:"Raising",gates:[s.ZForward,s.ZBackward,s.YForward,s.YBackward,s.XForward,s.XBackward]},{hint:"Exponentiating",gates:[j.ZForward,j.ZBackward,j.YForward,j.YBackward,j.XForward,j.XBackward]
},{hint:"1/8",gates:[C.Z8,C.Z8i,B.Y8,B.Y8i,A.X8,A.X8i]},{hint:"1/16",gates:[C.Z16,C.Z16i,B.Y16,B.Y16i,A.X16,A.X16i]}],{get Gates(){
return H}}}),$traceurRuntime.registerModule("src/gates/AmplitudeDisplay.js",[],function(){"use strict";function a(a,b,c,d){var k=new D(a);
k.dontDeallocCurrentTexture();var l=A().vec2.arrayPowerSizeOfTexture(a),m=v.numberOfSetBits(b.inclusionMask),o=v.numberOfSetBits(b.inclusionMask&(1<<c)-1),p=l-m;
k.shadeAndTrade(function(a){return n.controlSelect(b,a)},C.takeVec2Tex(p)),k.shadeAndTrade(function(a){return q.cycleAllBits(a,o-c);
});var r=k.dontDeallocCurrentTexture();k.shadeAndTrade(e,C.takeVec4Tex(p)),f(k,d),g(k,d),k.shadeAndTrade(h);var s=k.dontDeallocCurrentTexture();
return k.shadeAndTrade(function(a){return I(r,a)},C.takeVec4Tex(p)),r.deallocByDepositingInPool("ketJustAfterCycle in makeAmplitudeSpanPipeline"),
i(k,d),j(k),[s,k.currentTexture]}function b(a,b,e){var f,g,h=b,i=(f=h[Symbol.iterator](),(g=f.next()).done?void 0:g.value),j=(g=f.next()).done?void 0:g.value,k=i.length>>2,l=2===k?2:1<<Math.floor(Math.round(Math.log2(k))/2),m=k/l,n=!isNaN(j[0])&&j[0]!==-666,o=i[2];
if(!n)return d(l,m,k,o,i);for(var p=a===e.numWires?void 0:c(i),q=void 0===p?0:Math.atan2(i[4*p+1],i[4*p]),r=Math.cos(q),s=-Math.sin(q),u=new Float32Array(2*k),v=Math.sqrt(o),w=0;w<k;w++){
var x=i[4*w]/v,y=i[4*w+1]/v;u[2*w]=x*r+y*-s,u[2*w+1]=x*s+y*r}return{probabilities:void 0,superposition:new t(l,m,u),phaseLockIndex:p
}}function c(a){for(var b=0,c=0,d=0;d<a.length;d+=4){var e=a[d],f=a[d+1],g=e*e+f*f;g>1e4*c&&(c=g,b=d>>2)}return b}function d(a,b,c,d,e){
for(var f=new Float32Array(2*c),g=0;g<c;g++){var h=e[4*g],i=e[4*g+1];f[2*g]=Math.sqrt((h*h+i*i)/d)}return{probabilities:new t(a,b,f),
superposition:void 0,phaseLockIndex:void 0}}function e(a){return E(a)}function f(a,b){for(var c=function(b){a.shadeAndTrade(function(a){
return F(a,w["float"]("bit",1<<b))})},d=0;d<b;d++)c(d)}function g(a,b){for(var c=A().vec4.arrayPowerSizeOfTexture(a.currentTexture);c>b;)c-=1,
a.shadeHalveAndTrade(function(a){return G(a,w["float"]("offset",1<<c))})}function h(a){return H(a)}function i(a,b){for(var c=A().vec4.arrayPowerSizeOfTexture(a.currentTexture),d=b;d>0;)d-=1,
c-=1,a.shadeHalveAndTrade(function(a){return K(a,w["float"]("bit",1<<d))})}function j(a){for(var b=A().vec4.arrayPowerSizeOfTexture(a.currentTexture);b>0;)b-=1,
a.shadeHalveAndTrade(L)}function k(a,b){var c=void 0,d=a.positionInCircuit,e=d.col,f=d.row,g=0!==(a.stats.circuitDefinition.colIsMeasuredMask(e)>>f&(1<<a.gate.height)-1);
b?c="incoherent":g&&(c=a.gate.width<=2?"(w/ measure defer)":"(assuming measurement deferred)"),void 0!==c&&a.painter.print(c,a.rect.x+a.rect.w/2,a.rect.y+a.rect.h,"center","hanging","red","12px sans-serif",a.rect.w,a.rect.h,void 0);
}function l(c){return o.fromIdentity("Amps","Amplitude Display","Shows the amplitudes of some wires, if separable.\nUse controls to see conditional amplitudes.").withHeight(c).withWidth(1===c?2:c%2===0?c:Math.ceil(c/2)).withSerializedId("Amps"+c).withCustomStatTexturesMaker(function(b){
return a(b.stateTrader.currentTexture,b.controls,b.row,c)}).withCustomStatPostProcessor(function(a,d){return b(c,a,d)}).withCustomDrawer(M).withCustomDisableReasonFinder(function(a){
return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/AmplitudeDisplay.js")).Config,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/gates/AmplitudeDisplay.js")).CircuitShaders,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/AmplitudeDisplay.js")).Gate,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/AmplitudeDisplay.js")).GatePainting,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/AmplitudeDisplay.js")).GateShaders,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/gates/AmplitudeDisplay.js")).Format,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/AmplitudeDisplay.js")).MathPainter,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/AmplitudeDisplay.js")).Matrix,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/AmplitudeDisplay.js")).Point,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/AmplitudeDisplay.js")).Util,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/AmplitudeDisplay.js")).WglArg,x=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/AmplitudeDisplay.js")).WglConfiguredShader,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/AmplitudeDisplay.js"))),y=x.Inputs,z=x.Outputs,A=x.currentShaderCoder,B=x.makePseudoShaderWithInputsAndOutputAndCode,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/AmplitudeDisplay.js")).WglTexturePool,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/AmplitudeDisplay.js")).WglTextureTrader,E=B([y.vec2("input")],z.vec4(),"vec4 outputFor(float k) {\n        vec2 ri = read_input(k);\n        float mag = dot(ri, ri);\n        float phase = mag == 0.0 ? 0.0 : atan(ri.y, ri.x);\n        return vec4(mag, phase, mag, 0.0);\n    }"),F=B([y.vec4("input")],z.vec4(),"\n    uniform float bit;\n\n    float xorBit(float v) {\n        float b = mod(floor(v/bit), 2.0);\n        float d = 1.0 - 2.0*b;\n        return v + bit*d;\n    }\n\n    vec4 outputFor(float k) {\n        float partner = xorBit(k);\n        vec4 v = read_input(k);\n        vec4 p = read_input(partner);\n        return vec4(v.x, v.y, v.z + p.z, 0.0);\n    }"),G=B([y.vec4("input")],z.vec4(),"\n    uniform float offset;\n\n    vec4 outputFor(float k) {\n        vec4 p = read_input(k);\n        vec4 q = read_input(k + offset);\n        return vec4(\n            p.x + q.x,\n            // Bias towards p1 is to keep the choice stable in the face of uniform superpositions and noise.\n            p.z*1.001 >= q.z ? p.y : q.y,\n            p.z + q.z,\n            0.0);\n    }"),H=B([y.vec4("input")],z.vec4(),"\n    vec4 outputFor(float k) {\n        vec4 polar = read_input(k);\n        float mag = sqrt(polar.x);\n        return vec4(mag * cos(polar.y), mag * sin(polar.y), polar.z, 0.0);\n    }"),I=function(a,b){
return J(a,b)},J=B([y.vec2("ket"),y.vec4("rep")],z.vec4(),"vec4 outputFor(float k) {\n        return vec4(read_ket(k), read_rep(mod(k, len_rep())).xy);\n    }"),K=B([y.vec4("input")],z.vec4(),"\n    uniform float bit;\n\n    vec2 mul(vec2 c1, vec2 c2) {\n        return vec2(c1.x*c2.x - c1.y*c2.y, c1.x*c2.y + c1.y*c2.x);\n    }\n    vec4 mergeRatios(vec4 a, vec4 b) {\n        vec2 c1 = mul(a.xy, b.zw);\n        vec2 c2 = mul(a.zw, b.xy);\n        vec2 d = c1 - c2;\n        float err = dot(d, d);\n        // The max up-scaling controls a tricky tradeoff between noisy false positives and blurry false negatives.\n        err /= max(0.00000000001, min(abs(dot(c1, c1)), abs(dot(c2,c2))));\n        float m1 = dot(a, a);\n        float m2 = dot(b, b);\n        return a.x == -666.0 || b.x == -666.0 || err > 0.001 ? vec4(-666.0, -666.0, -666.0, -666.0)\n            : m1 >= m2 ? a\n            : b;\n    }\n\n    vec4 outputFor(float k) {\n        float s1 = mod(k, bit) + floor(k/bit)*2.0*bit;\n        float s2 = s1 + bit;\n        vec4 v1 = read_input(s1);\n        vec4 v2 = read_input(s2);\n\n        return mergeRatios(v1, v2);\n    }"),L=B([y.vec4("input")],z.vec4(),"vec4 outputFor(float k) {\n        vec4 a = read_input(k);\n        vec4 b = read_input(k + len_output());\n        return a.x == -666.0 || b.x == -666.0 ? vec4(-666.0, -666.0, -666.0, -666.0) : a + b;\n    }"),M=p.makeDisplayDrawer(function(a){
var b=a.gate.height,c=a.customStats||{probabilities:void 0,superposition:(1===b?t.zero(2,1):t.zero(1<<Math.floor(b/2),1<<Math.ceil(b/2))).times(NaN),
phaseLockIndex:void 0},d=c.probabilities,e=c.superposition,f=c.phaseLockIndex,g=d||e,h=void 0===e,i=a.rect.w-a.rect.h*g.width()/g.height(),j=a.rect.skipLeft(i/2).skipRight(i/2);
s.paintMatrix(a.painter,g,j,m.SUPERPOSITION_MID_COLOR,"black",m.SUPERPOSITION_FORE_COLOR,m.SUPERPOSITION_BACK_COLOR,h?"transparent":"black");
var l=function(a){return(a>=0?"+":"")+a.toFixed(2)};if(h)s.paintMatrixTooltip(a.painter,g,j,a.focusPoints,function(b,c){return"Chance of |"+v.bin(c*g.width()+b,a.gate.height)+"⟩ [amplitude not defined]";
},function(a,b,c){return"raw: "+(100*c.norm2()).toFixed(4)+"%, log: "+(10*Math.log10(c.norm2())).toFixed(1)+" dB"},function(a,b,c){
return"[entangled with other qubits]"});else if(s.paintMatrixTooltip(a.painter,g,j,a.focusPoints,function(b,c){return"Amplitude of |"+v.bin(c*g.width()+b,a.gate.height)+"⟩";
},function(a,b,c){return"val:"+c.toString(new r((!1),0,5,", "))},function(a,b,c){return"mag²:"+(100*c.norm2()).toFixed(4)+"%, phase:"+l(180*c.phase()/Math.PI)+"°";
}),void 0!==f){var n=j.w/g.width(),o=j.h/g.height(),p=f%g.width(),q=Math.floor(f/g.width()),w=j.x+n*(p+.5),x=j.y+o*(q+.5);a.painter.strokeLine(new u(w,x),new u(w+n/2,x),"red",2),
a.painter.print("fixed",w+.5*n,x,"right","bottom","red","12px monospace",.5*n,.5*o)}k(a,h)}),N=o.generateFamily(1,16,l);return{get AmplitudeDisplayFamily(){
return N},get amplitudesToPolarKets(){return e},get convertAwayFromPolar(){return h},get amplitudeDisplayStatTextures(){return a},
get reduceToLongestPolarKet(){return g},get foldConsistentRatios(){return i},get spreadLengthAcrossPolarKets(){return f},get signallingSumAll(){
return j},get toRatiosVsRepresentative(){return I}}}),$traceurRuntime.registerModule("src/gates/ArithmeticGates.js",[],function(){
"use strict";function a(a,b,c,d,f){var g;return(g=q).withArgs.apply(g,$traceurRuntime.spread(e(a,b),[h["float"]("srcOffset",1<<c),h["float"]("srcSpan",1<<d),h["float"]("factor",f)]));
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ArithmeticGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ArithmeticGates.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ArithmeticGates.js")),e=d.ketArgs,f=d.ketShaderPermute,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ArithmeticGates.js")).Matrix,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/ArithmeticGates.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/ArithmeticGates.js")).WglConfiguredShader,
{}),j=function(a,b){return g.generateTransition(1<<b,function(c){return c+a&(1<<b)-1})},k=function(a){return j(1,a)},l=function(a){
return j(-1,a)},m=function(a){return g.generateTransition(1<<a,function(b){var c=Math.floor(a/2),d=Math.ceil(a/2),e=b&(1<<c)-1,f=b>>c;
return f+=e,f&=(1<<d)-1,e+(f<<c)})},n=function(a){return g.generateTransition(1<<a,function(b){var c=Math.floor(a/2),d=Math.ceil(a/2),e=b&(1<<c)-1,f=b>>c;
return f-=e,f&=(1<<d)-1,e+(f<<c)})},o=function(a,b,c){var d;return(d=p).withArgs.apply(d,$traceurRuntime.spread(e(a,b),[h["float"]("amount",c)]));
},p=f("uniform float amount;","return mod(out_id - amount + span, span);"),q=f("uniform float srcOffset, srcSpan, factor;","\n        float d = mod(floor(full_out_id / srcOffset), srcSpan);\n        d *= factor;\n        d = mod(d, span);\n        return mod(out_id + span - d, span);");
return i.IncrementFamily=b.generateFamily(1,16,function(a){return b.withoutKnownMatrix("++","Increment Gate","Adds 1 to the little-endian number represented by a block of qubits.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(a>=4?void 0:k(a)).withSerializedId("inc"+a).withHeight(a).withCustomShader(function(b){
return o(b,a,1)})}),i.DecrementFamily=b.generateFamily(1,16,function(a){return b.withoutKnownMatrix("- -","Decrement Gate","Subtracts 1 from the little-endian number represented by a block of qubits.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(a>=4?void 0:l(a)).withSerializedId("dec"+a).withHeight(a).withCustomShader(function(b){
return o(b,a,-1)})}),i.AdditionFamily=b.generateFamily(2,16,function(d){return b.withoutKnownMatrix("b+=a","Addition Gate","Adds a little-endian number into another.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(d>=5?void 0:m(d)).withSerializedId("add"+d).withCustomDrawer(c.SECTIONED_DRAWER_MAKER(["a","b+=a"],[Math.floor(d/2)/d])).withHeight(d).withCustomShader(function(b){
return a(b.withRow(b.row+Math.floor(d/2)),Math.ceil(d/2),b.row,Math.floor(d/2),1)})}),i.SubtractionFamily=b.generateFamily(2,16,function(d){
return b.withoutKnownMatrix("b-=a","Subtraction Gate","Subtracts a little-endian number from another.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(d>=5?void 0:n(d)).withSerializedId("sub"+d).withCustomDrawer(c.SECTIONED_DRAWER_MAKER(["a","b-=a"],[Math.floor(d/2)/d])).withHeight(d).withCustomShader(function(b){
return a(b.withRow(b.row+Math.floor(d/2)),Math.ceil(d/2),b.row,Math.floor(d/2),-1)})}),i.PlusAFamily=b.generateFamily(1,16,function(c){
return b.withoutKnownMatrix("+=A","Addition Gate [input A]","Adds 'input A' into the qubits covered by this gate.").markedAsOnlyPermutingAndPhasing().markedAsStable().withHeight(c).withSerializedId("+=A"+c).withRequiredContextKeys("Input Range A").withCustomShader(function(b){
var d=b.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length;return a(b,c,e,f,1)})}),i.MinusAFamily=b.generateFamily(1,16,function(c){
return b.withoutKnownMatrix("-=A","Subtraction Gate [input A]","Subtracts 'input A' out of the qubits covered by this gate.").markedAsOnlyPermutingAndPhasing().markedAsStable().withHeight(c).withSerializedId("-=A"+c).withRequiredContextKeys("Input Range A").withCustomShader(function(b){
var d=b.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length;return a(b,c,e,f,-1)})}),i.all=$traceurRuntime.spread(i.IncrementFamily.all,i.DecrementFamily.all,i.AdditionFamily.all,i.SubtractionFamily.all,i.PlusAFamily.all,i.MinusAFamily.all),
{get ArithmeticGates(){return i},get makeOffsetMatrix(){return j},get incrementShaderFunc(){return o},get additionShaderFunc(){return a;
}}}),$traceurRuntime.registerModule("src/gates/BitCountGates.js",[],function(){"use strict";function a(a,b,c,d,f){var h;return(h=i).withArgs.apply(h,$traceurRuntime.spread(e(a,b),[g["float"]("srcOffset",1<<c),g["float"]("srcSpan",1<<d),g["float"]("factor",f)]));
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/BitCountGates.js")).Config,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/BitCountGates.js")).Gate,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/BitCountGates.js")),e=d.ketArgs,f=d.ketShaderPermute,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/BitCountGates.js")).WglArg,h={},i=f("uniform float srcOffset, srcSpan, factor;","\n        float d = mod(floor(full_out_id / srcOffset), srcSpan);\n        float popcnt = 0.0;\n        for (int i = 0; i < "+b.MAX_WIRE_COUNT+"; i++) {\n            popcnt += mod(d, 2.0);\n            d = floor(d / 2.0);\n        }\n        float offset = mod(popcnt * factor, span);\n        return mod(out_id + span - offset, span);");
return h.PlusBitCountAFamily=c.generateFamily(1,16,function(b){return c.withoutKnownMatrix("+1s(A)","Bit Count Gate [input A]","Counts the number of ON bits in 'input A' and adds that into this output.").markedAsOnlyPermutingAndPhasing().markedAsStable().withHeight(b).withSerializedId("+cntA"+b).withRequiredContextKeys("Input Range A").withCustomShader(function(c){
var d=c.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length;return a(c,b,e,f,1)})}),h.MinusBitCountAFamily=c.generateFamily(1,16,function(b){
return c.withoutKnownMatrix("-1s(A)","Bit Un-Count Gate [input A]","Counts the number of ON bits in 'input A' and subtracts that into this output.").markedAsOnlyPermutingAndPhasing().markedAsStable().withHeight(b).withSerializedId("-cntA"+b).withRequiredContextKeys("Input Range A").withCustomShader(function(c){
var d=c.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length;return a(c,b,e,f,-1)})}),h.all=$traceurRuntime.spread(h.PlusBitCountAFamily.all,h.MinusBitCountAFamily.all),
{get BitCountGates(){return h}}}),$traceurRuntime.registerModule("src/gates/BlochSphereDisplay.js",[],function(){"use strict";function a(a,b,c,d,e,f){
var h=b.center(),i=Math.min(b.w,b.h)/2;if(!f.every(function(a){return a.distanceTo(h)>=i})){var j=2*Math.PI,k=function(a){return(a>=0?"+":"")+(360*a/j).toFixed(2)+"°";
},l=function(a){return(a>=0?"+":"")+a.toFixed(4)},m=Math.sqrt(c*c+d*d+e*e),n=Math.atan2(d,-c),o=Math.atan2(-e,Math.sqrt(d*d+c*c));
a.strokeCircle(h,i,"orange",2),g.paintDeferredValueTooltip(a,h.x+i*Math.sqrt(.5),h.y-i*Math.sqrt(.5),"Bloch sphere representation of local state","r:"+l(m)+", ϕ:"+k(n)+", θ:"+k(o),"x:"+l(-c)+", y:"+l(d)+", z:"+l(-e));
}}function b(a,b,c,d,e,f){var g,i,j=e.center(),k=Math.min(e.w,e.h)/2,l=[new h((-k),0),new h(k/3,-k/3),new h(0,k)],m=(g=l[Symbol.iterator](),
(i=g.next()).done?void 0:i.value),n=(i=g.next()).done?void 0:i.value,o=(i=g.next()).done?void 0:i.value,p=j.plus(m.times(b)).plus(n.times(c)),q=p.plus(o.times(d)),r=4/(1+c/8),s=j.plus(o.times(d));
a.strokePolygon([s,j,p,q],"#666"),a.strokeLine(j,q,"black",2),a.fillCircle(q,r,f),a.ctx.save(),a.ctx.globalAlpha*=Math.min(1,Math.max(0,1-b*b-c*c-d*d)),
a.fillCircle(q,r,"yellow"),a.ctx.restore(),a.strokeCircle(q,r,"black"),a.ctx.save(),a.ctx.globalAlpha*=Math.min(1,Math.max(0,.5+5*c)),
a.strokeLine(j,q,"black",2),a.ctx.restore()}function c(c,e,f){var g,i,j,k,l,m,n,o=void 0!==arguments[3]?arguments[3]:[],p=void 0!==arguments[4]?arguments[4]:d.DISPLAY_GATE_BACK_COLOR,q=void 0!==arguments[5]?arguments[5]:d.DISPLAY_GATE_FORE_COLOR,r=f.center(),s=Math.min(f.w,f.h)/2,t=[new h((-s),0),new h(s/3,-s/3),new h(0,s)],u=(g=t[Symbol.iterator](),
(i=g.next()).done?void 0:i.value),v=(i=g.next()).done?void 0:i.value,w=(i=g.next()).done?void 0:i.value;c.fillCircle(r,s,p),c.trace(function(a){
a.circle(r.x,r.y,s),a.ellipse(r.x,r.y,u.x,v.y),a.ellipse(r.x,r.y,v.x,w.y);var b=!0,c=!1,d=void 0;try{for(var e=void 0,f=[u,v,w][Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;a.line(r.x-g.x,r.y-g.y,r.x+g.x,r.y+g.y)}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{
if(c)throw d}}}).thenStroke("#BBB");var x=[NaN,NaN,NaN],y=(j=x[Symbol.iterator](),(k=j.next()).done?void 0:k.value),z=(k=j.next()).done?void 0:k.value,A=(k=j.next()).done?void 0:k.value;
e.hasNaN()?c.printParagraph("NaN",f,new h(.5,.5),"red"):(l=e.qubitDensityMatrixToBlochVector(),m=l[Symbol.iterator](),y=(n=m.next()).done?void 0:n.value,
z=(n=m.next()).done?void 0:n.value,A=(n=m.next()).done?void 0:n.value,l,b(c,y,z,A,f,q)),a(c,f,y,z,A,o)}var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/BlochSphereDisplay.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/BlochSphereDisplay.js")).Gate,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/BlochSphereDisplay.js")).GatePainting,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/BlochSphereDisplay.js")).MathPainter,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/BlochSphereDisplay.js")).Point,i=e.fromIdentity("Bloch","Bloch Sphere Display","Shows a wire's local state as a point on the Bloch Sphere.\nUse controls to see conditional states.").markedAsSingleQubitDisplay().withCustomDrawer(f.makeDisplayDrawer(function(a){
var b=a.positionInCircuit,d=b.row,e=b.col,f=a.stats.qubitDensityMatrix(e,d);c(a.painter,f,a.rect,a.focusPoints)})).withCustomDisableReasonFinder(function(a){
return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0});return{get paintBlochSphereDisplay(){return c},get BlochSphereDisplay(){
return i}}}),$traceurRuntime.registerModule("src/gates/Controls.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Controls.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Controls.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/Controls.js")).GateShaders,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Controls.js")).Matrix,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/Controls.js")).HalfTurnGates,f={};
f.Control=a.fromIdentity("•","Control","Conditions on a qubit being ON.\nGates in the same column only apply to states meeting the condition.").withSerializedId("•").markedAsControl(!0).withCustomDrawer(function(a){
(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a)),a.painter.fillCircle(a.rect.center(),5,"black")}),f.AntiControl=a.fromIdentity("◦","Anti-Control","Conditions on a qubit being OFF.\nGates in the same column only apply to states meeting the condition.").withSerializedId("◦").markedAsControl(!1).withCustomDrawer(function(a){
(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a));var c=a.rect.center();a.painter.fillCircle(c,5),a.painter.strokeCircle(c,5);
}),f.PlusControl=a.withoutKnownMatrix("⊕","Plus Control","Conditions on a qubit being ON+OFF.\nGates in the same column only apply to states meeting the condition.").markedAsControl(!1).withSerializedId("⊕").markedAsStable().withCustomBeforeOperation(e.H.customOperation).withCustomOperation(function(){}).withCustomAfterOperation(e.H.customOperation).withCustomDrawer(function(a){
(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a));var c=a.rect.center();a.painter.fillCircle(c,5),a.painter.strokeCircle(c,5),
a.painter.strokeLine(c.offsetBy(0,-5),c.offsetBy(0,5)),a.painter.strokeLine(c.offsetBy(-5,0),c.offsetBy(5,0))}),f.MinusControl=a.withoutKnownMatrix("⊖","Minus Control","Conditions on a qubit being ON-OFF.\nGates in the same column only apply to states meeting the condition.").withSerializedId("⊖").markedAsControl(!0).markedAsStable().withCustomBeforeOperation(e.H.customOperation).withCustomOperation(function(){}).withCustomAfterOperation(e.H.customOperation).withCustomDrawer(function(a){
(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a));var c=a.rect.center();a.painter.fillCircle(c,5),a.painter.strokeCircle(c,5),
a.painter.strokeLine(c.offsetBy(-5,0),c.offsetBy(5,0))});var g=d.fromPauliRotation(.25,0,0),h=d.fromPauliRotation(-.25,0,0);return f.CrossControl=a.withoutKnownMatrix("⊗","Cross Control","Conditions on a qubit being ON+iOFF.\nGates in the same column only apply to states meeting the condition.").markedAsControl(!0).withSerializedId("⊗").markedAsStable().withCustomBeforeOperation(function(a){
return c.applyMatrixOperation(a,h)}).withCustomOperation(function(){}).withCustomAfterOperation(function(a){return c.applyMatrixOperation(a,g);
}).withCustomDrawer(function(a){(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a));var c=a.rect.center();a.painter.fillCircle(c,5),
a.painter.strokeCircle(c,5);var d=5*Math.sqrt(.5);a.painter.strokeLine(c.offsetBy(+d,+d),c.offsetBy(-d,-d)),a.painter.strokeLine(c.offsetBy(+d,-d),c.offsetBy(-d,+d)),
(a.isInToolbox||a.isHighlighted)&&b.paintOutline(a)}),f.AntiCrossControl=a.withoutKnownMatrix("(/)","Anti-Cross Control","Conditions on a qubit being ON-iOFF.\nGates in the same column only apply to states meeting the condition.").markedAsControl(!0).withSerializedId("(/)").markedAsStable().withCustomBeforeOperation(function(a){
return c.applyMatrixOperation(a,g)}).withCustomOperation(function(){}).withCustomAfterOperation(function(a){return c.applyMatrixOperation(a,h);
}).withCustomDrawer(function(a){(a.isInToolbox||a.isHighlighted)&&(b.paintBackground(a),b.paintOutline(a));var c=a.rect.center();a.painter.fillCircle(c,5),
a.painter.strokeCircle(c,5);var d=5*Math.sqrt(.5)*1.1;a.painter.strokeLine(c.offsetBy(+d,-d),c.offsetBy(-d,+d)),(a.isInToolbox||a.isHighlighted)&&b.paintOutline(a);
}),f.all=[f.Control,f.AntiControl,f.PlusControl,f.MinusControl,f.CrossControl,f.AntiCrossControl],{get Controls(){return f}}}),$traceurRuntime.registerModule("src/gates/CountingGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/CountingGates.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/CountingGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/CountingGates.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/CountingGates.js")).Matrix,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/CountingGates.js")).Point,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ArithmeticGates.js","src/gates/CountingGates.js")),g=f.makeOffsetMatrix,h=f.incrementShaderFunc,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/CycleBitsGates.js","src/gates/CountingGates.js")),j=i.makeCycleBitsMatrix,k=i.cycleBits,l={},m=function(a){
for(var b=[],c=0;c<a;c++){var d=c/a,f=c/(a-1);b.push(new e(d,f)),b.push(new e(d+1/a,f))}return b},n=function(b,d){var f=void 0!==arguments[2]&&arguments[2];
return function(g){var h,i,j,k,l;if(c.MAKE_HIGHLIGHTED_DRAWER(a.TIME_DEPENDENT_HIGHLIGHT_COLOR)(g),!g.isInToolbox||g.isHighlighted){
var n=(g.stats.time+b)%1,o=g.rect.y+3,p=g.rect.bottom(),q=g.rect.bottom()-3;f||(j=[q,o],k=j[Symbol.iterator](),o=(l=k.next()).done?void 0:l.value,
q=(l=k.next()).done?void 0:l.value,j,p=g.rect.y);var r=g.rect.x,s=g.rect.right(),t=function(a){return Math.min(Math.max(r+(s-r)*a,r),s);
},u=function(a){return q+(o-q)*a},v=[];v.push(new e(r,p)),(h=v).push.apply(h,$traceurRuntime.spread(m(d).map(function(a){return new e(t(a.x-n),u(a.y));
}))),(i=v).push.apply(i,$traceurRuntime.spread(m(d).map(function(a){return new e(t(a.x+1-n),u(a.y))}))),v.push(new e(s,p)),g.painter.ctx.save(),
g.painter.ctx.globalAlpha*=.3,g.painter.fillPolygon(v,"yellow");for(var w=1;w<v.length-2;w++)g.painter.strokeLine(v[w],v[w+1],"black");
2===d&&n<.5&&(g.painter.fillRect(g.rect,"white"),g.painter.fillRect(g.rect,"white"),g.painter.fillRect(g.rect,"white")),g.painter.ctx.restore();
}}},o=function(a){return function(b){return g(Math.floor(b*(1<<a)),a)}},p=function(a){return function(b){return g(-Math.floor(b*(1<<a)),a);
}},q=function(a){return function(b){return j(Math.floor(b*a),a)}},r=function(a){return function(b){return j(-Math.floor(b*a),a)}};
return l.ClockPulseGate=b.fromVaryingMatrix("X^⌈t⌉",function(a){return a%1<.5?d.identity(2):d.PAULI_X},"Clock Pulse Gate","Xors a square wave into the target wire.").markedAsOnlyPermutingAndPhasing().withCustomDrawer(n(0,2)).withStableDuration(.5),
l.QuarterPhaseClockPulseGate=b.fromVaryingMatrix("X^⌈t-¼⌉",function(a){return(a+.75)%1<.5?d.identity(2):d.PAULI_X},"Clock Pulse Gate (Quarter Phase)","Xors a quarter-phased square wave into the target wire.").markedAsOnlyPermutingAndPhasing().withCustomDrawer(n(.75,2)).withStableDuration(.25),
l.CountingFamily=b.generateFamily(1,8,function(a){return b.withoutKnownMatrix("+⌈t⌉","Counting Gate","Adds an increasing little-endian count into a block of qubits.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrixFunc(a>=4?void 0:o(a)).withSerializedId("Counting"+a).withCustomDrawer(n(0,1<<a)).withHeight(a).withStableDuration(1/(1<<a)).withCustomShader(function(b){
return h(b,a,Math.floor(b.time*(1<<a)))})}),l.UncountingFamily=b.generateFamily(1,8,function(a){return b.withoutKnownMatrix("-⌈t⌉","Down Counting Gate","Subtracts an increasing little-endian count from a block of qubits.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrixFunc(a>=4?void 0:p(a)).withSerializedId("Uncounting"+a).withCustomDrawer(n(0,1<<a,!0)).withHeight(a).withStableDuration(1/(1<<a)).withCustomShader(function(b){
return h(b,a,-Math.floor(b.time*(1<<a)))})}),l.RightShiftRotatingFamily=b.generateFamily(2,16,function(a){return b.withoutKnownMatrix("↟⌈t⌉","Right-Shift Cycling Gate","Right-rotates a block of bits by more and more.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrixFunc(a>=4?void 0:r(a)).withSerializedId(">>t"+a).withCustomDrawer(n(0,a,!0)).withHeight(a).withStableDuration(1/a).withCustomShader(function(b){
return k(b,a,-Math.floor(b.time*a))})}),l.LeftShiftRotatingFamily=b.generateFamily(2,16,function(a){return b.withoutKnownMatrix("↡⌈t⌉","Left-Shift Cycling Gate","Left-rotates a block of bits by more and more.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrixFunc(a>=4?void 0:q(a)).withSerializedId("<<t"+a).withCustomDrawer(n(0,a)).withHeight(a).withStableDuration(1/a).withCustomShader(function(b){
return k(b,a,Math.floor(b.time*a))})}),l.all=$traceurRuntime.spread([l.ClockPulseGate,l.QuarterPhaseClockPulseGate],l.CountingFamily.all,l.UncountingFamily.all,l.RightShiftRotatingFamily.all,l.LeftShiftRotatingFamily.all),
{get CountingGates(){return l}}}),$traceurRuntime.registerModule("src/gates/CycleBitsGates.js",[],function(){"use strict";function a(a,b){
return a.rect.center().y+(b-a.gate.height/2+.5)*e.WIRE_SPACING}function b(b){for(var c=0;c<b.gate.height;c++){var d=a(b,c),e=new l(b.rect.x,d),f=new l(b.rect.center().x,d),g=new l(b.rect.right(),d),h=new l(b.positionInCircuit.col,b.positionInCircuit.row+c),i=b.stats.circuitDefinition.locIsMeasured(h),j=b.stats.circuitDefinition.locIsMeasured(h.offsetBy(1,0)),k=!0,m=!1,n=void 0;
try{for(var o=void 0,p=(i?[-1,1]:[0])[Symbol.iterator]();!(k=(o=p.next()).done);k=!0){var q=o.value;b.painter.strokeLine(e.offsetBy(0,q),f.offsetBy(0,q),"white");
}}catch(r){m=!0,n=r}finally{try{k||null==p["return"]||p["return"]()}finally{if(m)throw n}}var s=!0,t=!1,u=void 0;try{for(var v=void 0,w=(j?[-1,1]:[0])[Symbol.iterator]();!(s=(v=w.next()).done);s=!0){
var x=v.value;b.painter.strokeLine(f.offsetBy(0,x),g.offsetBy(0,x),"white")}}catch(y){t=!0,u=y}finally{try{s||null==w["return"]||w["return"]();
}finally{if(t)throw u}}}}function c(a){return a.isHighlighted||a.isResizeHighlighted||void 0===a.positionInCircuit||a.stats.circuitDefinition.colHasControls(a.positionInCircuit.col);
}function d(d,e){var f,h;if(c(d))return void g.DEFAULT_DRAWER(d);b(d);for(var i=0;i<d.gate.height;i++){var j=e(i),k=new l(d.positionInCircuit.col,d.positionInCircuit.row+i),m=d.stats.circuitDefinition.locIsMeasured(k),n=a(d,i),o=a(d,j),p=d.rect.x,q=d.rect.right();
d.painter.ctx.beginPath(),d.painter.ctx.strokeStyle="black";var r=!0,s=!1,t=void 0;try{for(var u=void 0,v=(m?[[j>i?1:-1,-1],[0,1]]:[[0,0]])[Symbol.iterator]();!(r=(u=v.next()).done);r=!0){
var w=u.value,x=(f=w[Symbol.iterator](),(h=f.next()).done?void 0:h.value),y=(h=f.next()).done?void 0:h.value;d.painter.ctx.moveTo(Math.min(p,p+x),n+y),
d.painter.ctx.lineTo(p+x,n+y),d.painter.ctx.lineTo(q+x,o+y),d.painter.ctx.lineTo(Math.max(q,q+x),o+y)}}catch(z){s=!0,t=z}finally{
try{r||null==v["return"]||v["return"]()}finally{if(s)throw t}}d.painter.ctx.stroke()}}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/CycleBitsGates.js")).Config,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/CycleBitsGates.js")).Gate,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/CycleBitsGates.js")).GatePainting,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/CycleBitsGates.js")),i=h.ketArgs,j=h.ketShaderPermute,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/CycleBitsGates.js")).Matrix,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/CycleBitsGates.js")).Point,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/CycleBitsGates.js")).Util,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/CycleBitsGates.js")).WglArg,o=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/CycleBitsGates.js")).WglConfiguredShader,
{}),p=function(a,b,c){var d;return(d=q).withArgs.apply(d,$traceurRuntime.spread(i(a,b),[n["float"]("amount",1<<m.properMod(-c,b))]));
},q=j("uniform float amount;","out_id *= amount; return mod(out_id, span) + floor(out_id / span);"),r=function(a,b){return k.generateTransition(1<<b,function(c){
return a=m.properMod(a,b),c<<a&(1<<b)-1|c>>b-a})};return o.CycleBitsFamily=f.generateFamily(2,16,function(a){return f.withoutKnownMatrix("↡","Left Shift Gate","Rotates bits in a downward cycle.").markedAsStable().markedAsOnlyPermutingAndPhasing().withKnownMatrix(a>=4?void 0:r(1,a)).withSerializedId("<<"+a).withHeight(a).withKnownBitPermutation(function(b){
return(b+1)%a}).withCustomShader(function(b){return p(b,a,1)}).withCustomDrawer(function(b){return d(b,function(b){return m.properMod(b+1,a);
})})}),o.ReverseCycleBitsFamily=f.generateFamily(2,16,function(a){return f.withoutKnownMatrix("↟","Right Shift Gate","Rotates bits in an upward cycle.").markedAsStable().markedAsOnlyPermutingAndPhasing().withKnownMatrix(a>=4?void 0:r(-1,a)).withSerializedId(">>"+a).withHeight(a).withKnownBitPermutation(function(b){
return(b+a-1)%a}).withCustomShader(function(b){return p(b,a,-1)}).withCustomDrawer(function(b){return d(b,function(b){return m.properMod(b-1,a);
})})}),o.all=$traceurRuntime.spread(o.CycleBitsFamily.all,o.ReverseCycleBitsFamily.all),{get CycleBitsGates(){return o},get cycleBits(){
return p},get makeCycleBitsMatrix(){return r},get PERMUTATION_DRAWER(){return d}}}),$traceurRuntime.registerModule("src/gates/Debug_ErrorInjectionGate.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/gates/Debug_ErrorInjectionGate.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Debug_ErrorInjectionGate.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Debug_ErrorInjectionGate.js")).GatePainting,d=b.withoutKnownMatrix("ERR!","Error Injection Gate","Throws an exception during circuit stat computations, for testing error paths.").markedAsStable().withCustomShader(function(b){
throw new a("Applied an Error Injection Gate",{qubit:b.row})}).withSerializedId("__error__").withCustomDrawer(c.MAKE_HIGHLIGHTED_DRAWER("red","red"));
return{get ErrorInjectionGate(){return d}}}),$traceurRuntime.registerModule("src/gates/DensityMatrixDisplay.js",[],function(){"use strict";
function a(a,b,c,d,f){var g=new t(a);g.dontDeallocCurrentTexture();var i=q().vec2.arrayPowerSizeOfTexture(a),j=l.numberOfSetBits(c.inclusionMask),m=l.numberOfSetBits(c.inclusionMask&(1<<d)-1);
g.shadeAndTrade(function(a){return e.controlSelect(c,a)},s.takeVec2Tex(i-j)),g.shadeAndTrade(function(a){return h.cycleAllBits(a,m-d);
});var n=b-j+f;for(g.shadeAndTrade(function(a){return u(a,f)},s.takeVec2Tex(n));n>2*f;)n--,g.shadeHalveAndTrade(k.sumFoldVec2);return q().vec2.needRearrangingToBeInVec4Format&&g.shadeHalveAndTrade(k.packVec2IntoVec4),
g.currentTexture}function b(a,b){if(0===b)return a;for(var c=new Float32Array(a.rawBuffer()),d=a.width(),e=0;e<d;e++)for(var f=0;f<d;f++)if(0!==((e^f)&b)){
var g=2*(e*d+f);c[g]=0,c[g+1]=0}return new j(d,d,c)}function c(a,c,d,e){for(var f=a.length>>1,g=Math.round(Math.sqrt(f)),h=0,i=0;i<g;i++)h+=a[2*i*(g+1)];
if(isNaN(h)||h<1e-6)return j.zero(g,g).times(NaN);for(var k=0;k<a.length;k++)a[k]/=h;var l=c.colIsMeasuredMask(d)>>e;return b(new j(g,g,a),l);
}function d(b){return f.fromIdentity("Density","Density Matrix Display","Shows the density matrix of the local mixed state of some wires.\nUse controls to see conditional states.").withSerializedId("Density"+b).withWidth(b).withHeight(b).withCustomDrawer(w).withCustomStatTexturesMaker(function(c){
return a(c.stateTrader.currentTexture,c.wireCount,c.controls,c.row,b)}).withCustomStatPostProcessor(c).withCustomDisableReasonFinder(function(a){
return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitShaders.js","src/gates/DensityMatrixDisplay.js")).CircuitShaders,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/DensityMatrixDisplay.js")).Gate,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/DensityMatrixDisplay.js")).GatePainting,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/DensityMatrixDisplay.js")).GateShaders,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/DensityMatrixDisplay.js")).MathPainter,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/DensityMatrixDisplay.js")).Matrix,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/DensityMatrixDisplay.js")).Shaders,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/DensityMatrixDisplay.js")).Util,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/DensityMatrixDisplay.js")).WglArg,n=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/DensityMatrixDisplay.js")).WglConfiguredShader,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/DensityMatrixDisplay.js"))),o=n.Inputs,p=n.Outputs,q=n.currentShaderCoder,r=n.makePseudoShaderWithInputsAndOutputAndCode,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/DensityMatrixDisplay.js")).WglTexturePool,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/DensityMatrixDisplay.js")).WglTextureTrader,u=function(a,b){
return v(a,m["float"]("qubitSpan",1<<b))},v=r([o.vec2("input")],p.vec2(),"\n    uniform float qubitSpan;\n\n    vec2 outputFor(float k) {\n        float k_ket = mod(k, qubitSpan);\n        float k_bra = mod(floor(k / qubitSpan), qubitSpan);\n        float k_rest = floor(k / qubitSpan / qubitSpan);\n        float offset = k_rest*qubitSpan;\n\n        vec2 ampKet = read_input(k_ket + offset);\n        vec2 ampBra = read_input(k_bra + offset);\n        float r = dot(ampKet, ampBra);\n        float i = dot(ampKet, vec2(-ampBra.y, ampBra.x));\n\n        return vec2(r, i);\n    }"),w=g.makeDisplayDrawer(function(a){
var b=a.gate.height,c=a.customStats||j.zero(1<<b,1<<b).times(NaN);i.paintDensityMatrix(a.painter,c,a.rect,a.focusPoints)}),x=f.fromIdentity("Density","Density Matrix Display","Shows the density matrix of the local mixed state of some wires.\nUse controls to see conditional states.").markedAsSingleQubitDisplay().withSerializedId("Density").withCustomDrawer(g.makeDisplayDrawer(function(a){
var b=a.positionInCircuit,c=b.col,d=b.row,e=a.stats.qubitDensityMatrix(c,d);i.paintDensityMatrix(a.painter,e,a.rect,a.focusPoints);
})).withCustomDisableReasonFinder(function(a){return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}),y=f.generateFamily(1,8,function(a){
return 1===a?x:d(a)});return{get DensityMatrixDisplayFamily(){return y},get amplitudesToCouplings(){return u}}}),$traceurRuntime.registerModule("src/gates/ExponentiatingGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ExponentiatingGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ExponentiatingGates.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ExponentiatingGates.js")).Matrix,d={},e=2*Math.PI,f=function(a){
var b=Math.cos(e*a),d=Math.sin(e*a);return new c(2,2,new Float32Array([b,0,0,-d,0,-d,b,0]))},g=function(a){var b=Math.cos(e*a),d=Math.sin(e*a);
return new c(2,2,new Float32Array([b,0,-d,0,d,0,b,0]))},h=function(a){var b=Math.cos(e*a),d=Math.sin(e*a);return new c(2,2,new Float32Array([b,-d,0,0,0,0,b,d]));
};return d.XForward=a.fromVaryingMatrix("e^-iXt",f,"X-Exponentiating Gate (forward)","Right-hand rotation around the X axis.\nPasses through ±iX instead of X.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(.5,1,2)),
d.XBackward=a.fromVaryingMatrix("e^iXt",function(a){return f(-a)},"X-Exponentiating Gate (backward)","Left-hand rotation around the X axis.\nPasses through ±iX instead of X.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(-.5,1,2)),
d.YForward=a.fromVaryingMatrix("e^-iYt",g,"Y-Exponentiating Gate (forward)","Right-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(-1,1,2)),
d.YBackward=a.fromVaryingMatrix("e^iYt",function(a){return g(-a)},"Y-Exponentiating Gate (backward)","Left-hand rotation around the Y axis.\nPasses through ±iY instead of Y.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(1,1,2)),
d.ZForward=a.fromVaryingMatrix("e^-iZt",h,"Z-Exponentiating Gate (forward)","Right-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").markedAsOnlyPhasing().withCustomDrawer(b.makeCycleDrawer(1,.5,2)),
d.ZBackward=a.fromVaryingMatrix("e^iZt",function(a){return h(-a)},"Z-Exponentiating Gate (backward)","Left-hand rotation around the Z axis.\nPasses through ±iZ instead of Z.").markedAsOnlyPhasing().withCustomDrawer(b.makeCycleDrawer(-1,.5,2)),
d.all=[d.XBackward,d.YBackward,d.ZBackward,d.XForward,d.YForward,d.ZForward],{get ExponentiatingGates(){return d}}}),$traceurRuntime.registerModule("src/gates/FourierTransformGates.js",[],function(){
"use strict";function a(a,b){var c,d=void 0!==arguments[2]?arguments[2]:1;a.applyOperation((c=m).withArgs.apply(c,$traceurRuntime.spread(g(a,b),[l["float"]("factor",d)])));
}function b(b,c){c>1&&b.applyOperation(k(c));for(var d=0;d<c;d++)d>0&&a(b,d+1,1),j.H.customOperation(b.withRow(b.row+d))}function c(b,c){
for(var d=c-1;d>=0;d--)j.H.customOperation(b.withRow(b.row+d)),d>0&&a(b,d+1,-1);c>1&&b.applyOperation(k(c))}var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/FourierTransformGates.js")).Complex,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/FourierTransformGates.js")).Gate,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/FourierTransformGates.js")),g=f.ketArgs,h=f.ketShaderPhase,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/FourierTransformGates.js")).Matrix,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/HalfTurnGates.js","src/gates/FourierTransformGates.js")).HalfTurnGates,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/FourierTransformGates.js")).reverseShaderForSize,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/FourierTransformGates.js")).WglArg,m=h("uniform float factor;","\n        float hold = floor(out_id * 2.0 / span);\n        float step = mod(out_id, span / 2.0);\n        float angle = hold * step * factor * 6.2831853071795864769 / span;\n        return vec2(cos(angle), sin(angle));\n    "),n=2*Math.PI,o=function(a){
return i.generate(1<<a,1<<a,function(b,c){return d.polar(Math.pow(.5,a/2),n*b*c/(1<<a))})},p=function(a){return o(a).adjoint()},q={};
return q.FourierTransformFamily=e.generateFamily(1,16,function(a){return e.withoutKnownMatrix("QFT","Fourier Transform Gate","Transforms to/from phase frequency space.").markedAsStable().markedAsUnitary().withKnownMatrix(a>=4?void 0:o(a)).withSerializedId("QFT"+a).withHeight(a).withCustomOperation(function(c){
return b(c,a)})}),q.InverseFourierTransformFamily=e.generateFamily(1,16,function(a){return e.withoutKnownMatrix("QFT^†","Inverse Fourier Transform Gate","Transforms from/to phase frequency space.").markedAsStable().markedAsUnitary().withKnownMatrix(a>=4?void 0:p(a)).withSerializedId("QFT†"+a).withHeight(a).withCustomOperation(function(b){
return c(b,a)})}),q.all=$traceurRuntime.spread(q.FourierTransformFamily.all,q.InverseFourierTransformFamily.all),{get applyControlledPhaseGradient(){
return a},get FourierTransformGates(){return q}}}),$traceurRuntime.registerModule("src/gates/HalfTurnGates.js",[],function(){"use strict";
function a(a){var b=void 0!==a.positionInCircuit&&a.stats.circuitDefinition.colHasSingleWireControl(a.positionInCircuit.col),d=void 0!==a.positionInCircuit&&a.stats.circuitDefinition.colHasDoubleWireControl(a.positionInCircuit.col);
if(!b&&!d||a.isHighlighted)return void c.DEFAULT_DRAWER(a);var f=a.rect.scaledOutwardBy(.6);a.painter.fillCircle(f.center(),f.w/2),
a.painter.strokeCircle(f.center(),f.w/2),b&&a.painter.strokeLine(f.topCenter(),f.bottomCenter()),d&&(a.painter.strokeLine(f.topCenter().offsetBy(-1,0),f.bottomCenter().offsetBy(-1,0)),
a.painter.strokeLine(f.topCenter().offsetBy(1,0),f.bottomCenter().offsetBy(1,0)));var g=a.stats.circuitDefinition.locIsMeasured(new e(a.positionInCircuit.col,a.positionInCircuit.row));
g?(a.painter.strokeLine(f.centerLeft().offsetBy(0,-1),f.centerRight().offsetBy(0,-1)),a.painter.strokeLine(f.centerLeft().offsetBy(0,1),f.centerRight().offsetBy(0,1))):a.painter.strokeLine(f.centerLeft(),f.centerRight());
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/HalfTurnGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/HalfTurnGates.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/HalfTurnGates.js")).Matrix,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/HalfTurnGates.js")).Point,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/HalfTurnGates.js")),g=f.ketArgs,h=f.ketShader,i=f.ketShaderPermute,j={},k=i("","return 1.0-out_id;",1);
j.X=b.fromKnownMatrix("X",d.PAULI_X,"Pauli X Gate","The NOT gate.\nToggles between ON and OFF.").withCustomDrawer(a).withCustomShader(function(a){
var b;return(b=k).withArgs.apply(b,$traceurRuntime.spread(g(a)))});var l=h("","vec2 v = inp(1.0-out_id); return (out_id*2.0 - 1.0)*vec2(-v.y, v.x);",1);
j.Y=b.fromKnownMatrix("Y",d.PAULI_Y,"Pauli Y Gate","A combination of the X and Z gates.").withCustomShader(function(a){var b;return(b=l).withArgs.apply(b,$traceurRuntime.spread(g(a)));
});var m=h("","return amp*(1.0 - out_id*2.0);",1);j.Z=b.fromKnownMatrix("Z",d.PAULI_Z,"Pauli Z Gate","The phase flip gate.\nNegates phases when the qubit is ON.").withCustomShader(function(a){
var b;return(b=m).withArgs.apply(b,$traceurRuntime.spread(g(a)))});var n=h("","return 0.7071067811865476*(amp*(1.0-2.0*out_id) + inp(1.0-out_id));",1);
return j.H=b.fromKnownMatrix("H",d.HADAMARD,"Hadamard Gate","Creates simple superpositions.\nMaps ON to ON + OFF.\nMaps OFF to ON - OFF.").withCustomShader(function(a){
var b;return(b=n).withArgs.apply(b,$traceurRuntime.spread(g(a)))}),j.all=[j.X,j.Y,j.Z,j.H],{get HalfTurnGates(){return j}}}),$traceurRuntime.registerModule("src/gates/Impossible_UniversalNotGate.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Impossible_UniversalNotGate.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/Impossible_UniversalNotGate.js")),c=b.ketArgs,d=b.ketShader,e=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/Impossible_UniversalNotGate.js")).WglConfiguredShader,
function(a){var b;return(b=f).withArgs.apply(b,$traceurRuntime.spread(c(a)))}),f=d("","vec2 other = inp(1.0 - out_id); return vec2(other.x, -other.y) * (1.0 - 2.0 * out_id);",1),g=a.withoutKnownMatrix("UniNot","Universal Not Gate","Mirrors through the origin of the Bloch sphere.\nImpossible in practice.").markedAsStable().withCustomShader(e).withSerializedId("__unstable__UniversalNot");
return{get universalNot(){return e},get UniversalNotGate(){return g}}}),$traceurRuntime.registerModule("src/gates/InputGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/InputGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/InputGates.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ReverseBitsGate.js","src/gates/InputGates.js")).reverseShaderForSize,d={},e=function(d,e){
return a.generateFamily(1,16,function(f){return a.fromIdentity((e?"rev ":"")+("input "+d),"Input Gate ["+d+"]"+(e?" [reversed]":""),"Marks some qubits as input '"+d+"'"+(e?", in big-endian order":"")+".").withSerializedId((e?"rev":"")+("input"+d+f)).withHeight(f).withCustomColumnContextProvider(function(a){
return[{key:"Input Range "+d,val:{offset:a,length:f}}]}).withCustomBeforeOperation(function(a){return f>1?c(f):void 0}).withCustomAfterOperation(function(a){
return f>1?c(f):void 0}).withCustomDrawer(function(a){b.paintBackground(a),a.isInToolbox?b.paintOutline(a):a.painter.strokeRect(a.rect,"#AAA"),
b.paintResizeTab(a);var c=a.rect.center(),f=c.x,g=c.y;a.painter.print("input",f,g-2,"center","bottom","black","16px sans-serif",a.rect.w-2,a.rect.h/2),
a.painter.print(d+(e?"[::-1]":""),f,g+2,"center","top","black","16px sans-serif",a.rect.w-2,a.rect.h/2)})})};return d.InputAFamily=e("A",!1),
d.InputBFamily=e("B",!1),d.InputRevAFamily=e("A",!0),d.InputRevBFamily=e("B",!0),d.all=$traceurRuntime.spread(d.InputAFamily.all,d.InputBFamily.all,d.InputRevAFamily.all,d.InputRevBFamily.all),
{get InputGates(){return d}}}),$traceurRuntime.registerModule("src/gates/Joke_MysteryGate.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/Joke_MysteryGate.js")).Complex,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_MysteryGate.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_MysteryGate.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_MysteryGate.js")).Matrix,e="?",f=function(a){
return b.fromKnownMatrix(e,a,"Mystery Gate","Different every time.\n(Use shift+drag to copy circuit gates.)").withCustomDrawer(c.MATRIX_SYMBOL_DRAWER_EXCEPT_IN_TOOLBOX);
},g=function(){return f(d.square(new a(Math.random()-.5,Math.random()-.5),new a(Math.random()-.5,Math.random()-.5),new a(Math.random()-.5,Math.random()-.5),new a(Math.random()-.5,Math.random()-.5)).closestUnitary(1e-5));
};return{get MysteryGateSymbol(){return e},get MysteryGateMaker(){return g},get MysteryGateMakerWithMatrix(){return f}}}),$traceurRuntime.registerModule("src/gates/Joke_NeGate.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_NeGate.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_NeGate.js")).Matrix,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_NeGate.js")).GatePainting,d=a.fromKnownMatrix("-I",b.square(-1,0,0,-1),"Ne-Gate","Negates all amplitudes.").withSerializedId("NeGate").withCustomDrawer(function(a){
var b=a.rect.center(),d=b.x,e=b.y;if(a.isHighlighted||a.isInToolbox)c.paintBackground(a),c.paintOutline(a);else{var f=Math.min(a.rect.h,a.rect.w);
a.painter.trace(function(a){a.polygon([d,e-f/2,d-f/2,e,d,e+f/2,d+f/2,e])}).thenFill("white").thenStroke("black")}a.painter.print("-I",d,e,"center","middle","black","16px monospace",a.rect.w,a.rect.h);
});return{get NeGate(){return d}}}),$traceurRuntime.registerModule("src/gates/Joke_ZeroGate.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/Joke_ZeroGate.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/Joke_ZeroGate.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/Joke_ZeroGate.js")).Matrix,d=a.fromKnownMatrix("0",c.square(0,0,0,0),"Zero Gate","Destroys the universe.").withCustomDrawer(function(a){
if(a.isHighlighted||a.isInToolbox)return b.paintBackground(a),b.paintOutline(a),void b.paintGateSymbol(a);var c=a.rect.center(),d=c.x,e=c.y,f=Math.min(a.rect.h,a.rect.w);
a.painter.trace(function(a){a.polygon([d,e-f/2,d-f/2,e,d,e+f/2,d+f/2,e])}).thenFill("#666").thenStroke("black"),b.paintGateSymbol(a);
});return{get ZeroGate(){return d}}}),$traceurRuntime.registerModule("src/gates/MeasurementGate.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/MeasurementGate.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/MeasurementGate.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/MeasurementGate.js")).GatePainting,d=b.fromIdentity("Measure","Measurement Gate","Measures a wire's qubit along the Z axis.").withCustomDrawer(function(b){
var d,e,f,g,h=a.GATE_FILL_COLOR;b.isHighlighted&&(h=a.HIGHLIGHTED_GATE_FILL_COLOR),b.painter.fillRect(b.rect,h),c.paintOutline(b);
var i=2*Math.PI,j=.4*b.rect.w,k=b.rect.center(),l=k.x,m=k.y;m+=.6*j;var n=-i/6,o=[Math.cos(n)*j*1.5,Math.sin(n)*j*1.5],p=(d=o[Symbol.iterator](),
(e=d.next()).done?void 0:e.value),q=(e=d.next()).done?void 0:e.value,r=[l+p,m+q],s=(f=r[Symbol.iterator](),(g=f.next()).done?void 0:g.value),t=(g=f.next()).done?void 0:g.value;
b.painter.trace(function(a){a.ctx.arc(l,m,j,i/2,i),a.line(l,m,s,t)}).thenStroke("black"),b.painter.trace(function(a){return a.arrowHead(s,t,.3*j,n,i/4);
}).thenFill("black")}).withCustomDisableReasonFinder(function(a){if(a.isNested)return"can't\nnest\nmeasure\n(sorry)";var b=0!==(a.measuredMask&1<<a.outerRow);
return a.innerColumn.hasControl()&&!b?"can't\ncontrol\n(sorry)":void 0});return{get MeasurementGate(){return d}}}),$traceurRuntime.registerModule("src/gates/MultiplyAccumulateGates.js",[],function(){
"use strict";function a(a,b,c,d,f,g,i){var j;return(j=l).withArgs.apply(j,$traceurRuntime.spread(e(a,b),[h["float"]("srcOffset1",1<<c),h["float"]("srcSpan1",1<<d),h["float"]("srcOffset2",1<<f),h["float"]("srcSpan2",1<<g),h["float"]("factor",i)]));
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/MultiplyAccumulateGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/MultiplyAccumulateGates.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/MultiplyAccumulateGates.js")),e=d.ketArgs,f=d.ketShaderPermute,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/MultiplyAccumulateGates.js")).Matrix,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/MultiplyAccumulateGates.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/MultiplyAccumulateGates.js")).WglConfiguredShader,
{}),j=function(a){var b=Math.ceil(a/2),c=Math.ceil((a-b)/2),d=Math.max(a-b-c,1);return[d,c,a-d-c]},k=function(a,b){return g.generateTransition(1<<a,function(c){
var d,e,f=j(a),g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=(e=d.next()).done?void 0:e.value,k=c&(1<<g)-1,l=c>>g&(1<<h)-1,m=c>>g+h;
return m+=k*l*b,m&=(1<<i)-1,k|l<<g|m<<g+h})},l=f("uniform float srcOffset1, srcSpan1, srcOffset2, srcSpan2, factor;","\n        float d1 = mod(floor(full_out_id / srcOffset1), srcSpan1);\n        float d2 = mod(floor(full_out_id / srcOffset2), srcSpan2);\n        float d = mod(d1*d2*factor, span);\n        return mod(out_id + span - d, span);");
return i.MultiplyAddFamily=b.generateFamily(3,16,function(d){return b.withoutKnownMatrix("c+=ab","Multiply-Add Gate","Adds the product of two numbers into a third.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(d>=5?void 0:k(d,1)).withSerializedId("c+=ab"+d).withCustomDrawer(c.SECTIONED_DRAWER_MAKER(["a","b","c+=ab"],j(d).slice(0,2).map(function(a){
return a/d}))).withHeight(d).withCustomShader(function(b){var c,e,f=j(d),g=(c=f[Symbol.iterator](),(e=c.next()).done?void 0:e.value),h=(e=c.next()).done?void 0:e.value,i=(e=c.next()).done?void 0:e.value;
return a(b.withRow(b.row+g+h),i,b.row,g,b.row+g,h,1)})}),i.MultiplySubtractFamily=b.generateFamily(3,16,function(d){return b.withoutKnownMatrix("c-=ab","Multiply-Subtract Gate","Subtracts the product of two numbers from a third.").markedAsOnlyPermutingAndPhasing().markedAsStable().withKnownMatrix(d>=5?void 0:k(d,-1)).withSerializedId("c-=ab"+d).withCustomDrawer(c.SECTIONED_DRAWER_MAKER(["a","b","c-=ab"],j(d).slice(0,2).map(function(a){
return a/d}))).withHeight(d).withCustomShader(function(b){var c,e,f=j(d),g=(c=f[Symbol.iterator](),(e=c.next()).done?void 0:e.value),h=(e=c.next()).done?void 0:e.value,i=(e=c.next()).done?void 0:e.value;
return a(b.withRow(b.row+g+h),i,b.row,g,b.row+g,h,-1)})}),i.MultiplyAddInputsFamily=b.generateFamily(1,16,function(c){return b.withoutKnownMatrix("+=AB","Multiply-Add Gate [Inputs A, B]","Adds the product of inputs A and B into the qubits covered by this gate.").markedAsOnlyPermutingAndPhasing().markedAsStable().withSerializedId("+=AB"+c).withHeight(c).withRequiredContextKeys("Input Range A","Input Range B").withCustomShader(function(b){
var d=b.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length,g=b.customContextFromGates.get("Input Range B"),h=g.offset,i=g.length;
return a(b,c,e,f,h,i,1)})}),i.MultiplySubtractInputsFamily=b.generateFamily(1,16,function(c){return b.withoutKnownMatrix("-=AB","Multiply-Subtract Gate [Inputs A, B]","Subtracts the product of inputs A and B out of the qubits covered by this gate.").markedAsOnlyPermutingAndPhasing().markedAsStable().withSerializedId("-=AB"+c).withHeight(c).withRequiredContextKeys("Input Range A","Input Range B").withCustomShader(function(b){
var d=b.customContextFromGates.get("Input Range A"),e=d.offset,f=d.length,g=b.customContextFromGates.get("Input Range B"),h=g.offset,i=g.length;
return a(b,c,e,f,h,i,-1)})}),i.all=$traceurRuntime.spread(i.MultiplyAddFamily.all,i.MultiplySubtractFamily.all,i.MultiplyAddInputsFamily.all,i.MultiplySubtractInputsFamily.all),
{get MultiplyAccumulateGates(){return i}}}),$traceurRuntime.registerModule("src/gates/PhaseGradientGates.js",[],function(){"use strict";
function a(a,b){var c,d=void 0!==arguments[2]?arguments[2]:1;return(c=l).withArgs.apply(c,$traceurRuntime.spread(e(a,b),[h["float"]("factor",d)]));
}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/PhaseGradientGates.js")).Complex,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PhaseGradientGates.js")).Gate,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/PhaseGradientGates.js")),e=d.ketArgs,f=d.ketShaderPhase,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PhaseGradientGates.js")).Matrix,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/PhaseGradientGates.js")).WglArg,i=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/PhaseGradientGates.js")).WglConfiguredShader,
2*Math.PI),j=function(a){return g.generateDiagonal(1<<a,function(c){return b.polar(1,i*c/(2<<a))})},k=function(a){return g.generateDiagonal(1<<a,function(c){
return b.polar(1,-i*c/(2<<a))})},l=f("uniform float factor;","float angle = out_id * factor * 3.141592653589793 / span; return vec2(cos(angle), sin(angle));"),m={};
return m.PhaseGradientFamily=c.generateFamily(1,16,function(b){return c.withoutKnownMatrix("Z^#","Phase Gradient Gate","Phases proportional to the number represented by some bits.").markedAsOnlyPhasing().markedAsStable().withKnownMatrix(b>=4?void 0:j(b)).withSerializedId("PhaseGradient"+b).withHeight(b).withCustomShader(function(c){
return a(c,b)})}),m.PhaseDegradientFamily=c.generateFamily(1,16,function(b){return c.withoutKnownMatrix("Z^-#","Inverse Phase Gradient Gate","Counter-phases proportional to the number represented by some bits.").markedAsOnlyPhasing().markedAsStable().withKnownMatrix(b>=4?void 0:k(b)).withSerializedId("PhaseUngradient"+b).withHeight(b).withCustomShader(function(c){
return a(c,b,-1)})}),m.all=$traceurRuntime.spread(m.PhaseGradientFamily.all,m.PhaseDegradientFamily.all),{get PhaseGradientGates(){
return m},get phaseGradient(){return a}}}),$traceurRuntime.registerModule("src/gates/PostSelectionGates.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/gates/PostSelectionGates.js")).Complex,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PostSelectionGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/PostSelectionGates.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PostSelectionGates.js")).Matrix,e={},f=function(a){
if(a.isInToolbox||a.isHighlighted?c.DEFAULT_DRAWER(a):(a.painter.fillRect(a.rect,"white"),c.paintGateSymbol(a)),!a.isInToolbox){var b=a.rect,d=b.x,e=b.y,f=b.w,g=b.h;
a.painter.print("post-",d+f/2,e,"center","hanging","red","10px sans-serif",f,g/2),a.painter.print("select",d+f/2,e+g,"center","bottom","red","10px sans-serif",f,g/2);
}};return e.PostSelectOff=b.fromKnownMatrix("|0⟩⟨0|",d.square(1,0,0,0),"Post-selection Gate [Off]","Keeps OFF states, discards ON states.\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.PostSelectOn=b.fromKnownMatrix("|1⟩⟨1|",d.square(0,0,0,1),"Post-selection Gate [On]","Keeps ON states, discards OFF states.\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.PostSelectPlus=b.fromKnownMatrix("|+⟩⟨+|",d.square(1,1,1,1).times(.5),"Post-selection Gate [Plus]","Keeps ON+OFF states, discards ON-OFF states.\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.PostSelectMinus=b.fromKnownMatrix("|-⟩⟨-|",d.square(1,-1,-1,1).times(.5),"Post-selection Gate [Minus]","Keeps ON-OFF states, discards ON+OFF states\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.PostSelectCross=b.fromKnownMatrix("|X⟩⟨X|",d.square(1,a.I.neg(),a.I,1).times(.5),"Post-selection Gate [Cross]","Keeps ON+iOFF states, discards ON-iOFF states.\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.PostSelectAntiCross=b.fromKnownMatrix("|/⟩⟨/|",d.square(1,a.I,a.I.neg(),1).times(.5),"Post-selection Gate [Cross]","Keeps ON-iOFF states, discards ON+iOFF states.\nMeans 'restart until satisfied'.").withCustomDrawer(f),
e.all=[e.PostSelectOff,e.PostSelectOn,e.PostSelectPlus,e.PostSelectMinus,e.PostSelectCross,e.PostSelectAntiCross],{get PostSelectionGates(){
return e}}}),$traceurRuntime.registerModule("src/gates/PoweringGates.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/PoweringGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/PoweringGates.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/PoweringGates.js")).Matrix,d={},e=2*Math.PI,f=function(a){
var b=Math.cos(e*a)/2,d=Math.sin(e*a)/2;return new c(2,2,new Float32Array([.5+b,d,.5-b,-d,.5-b,-d,.5+b,d]))},g=function(a){var b=Math.cos(e*a)/2,d=Math.sin(e*a)/2;
return new c(2,2,new Float32Array([.5+b,d,-d,b-.5,d,.5-b,.5+b,d]))},h=function(a){var b=Math.cos(e*a),d=Math.sin(e*a);return new c(2,2,new Float32Array([1,0,0,0,0,0,b,d]));
};return d.XForward=a.fromVaryingMatrix("X^t",f,"X-Raising Gate (forward)","Right-handed cycle from no-op to X.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(.5,1)),
d.XBackward=a.fromVaryingMatrix("X^-t",function(a){return f(-a)},"X-Raising Gate (backward)","Left-handed cycle from no-op to X.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(-.5,1)),
d.YForward=a.fromVaryingMatrix("Y^t",g,"Y-Raising Gate (forward)","Right-handed cycle from no-op to Y.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(-1,1)),
d.YBackward=a.fromVaryingMatrix("Y^-t",function(a){return g(-a)},"Y-Raising Gate (backward)","Left-handed cycle from no-op to Y.").markedAsUnitary().withCustomDrawer(b.makeCycleDrawer(1,1)),
d.ZForward=a.fromVaryingMatrix("Z^t",h,"Z-Raising Gate (forward)","Right-handed cycle from no-op to Z.").markedAsOnlyPhasing().withCustomDrawer(b.makeCycleDrawer(1,.5)),
d.ZBackward=a.fromVaryingMatrix("Z^-t",function(a){return h(-a)},"Z-Raising Gate (backward)","Left-handed cycle from no-op to Z.").markedAsOnlyPhasing().withCustomDrawer(b.makeCycleDrawer(-1,.5)),
d.all=[d.XForward,d.YForward,d.ZForward,d.XBackward,d.YBackward,d.ZBackward],{get PoweringGates(){return d}}}),$traceurRuntime.registerModule("src/gates/ProbabilityDisplay.js",[],function(){
"use strict";function a(a,b,c,d){var e=new z(a);e.dontDeallocCurrentTexture();var f=w().vec2.arrayPowerSizeOfTexture(a);for(e.shadeAndTrade(function(a){
return A(a,b)},y.takeVecFloatTex(f)),e.shadeAndTrade(function(a){return m.cycleAllBitsFloat(a,-c)});f>d;)f-=1,e.shadeHalveAndTrade(r.sumFoldFloat);
return w()["float"].needRearrangingToBeInVec4Format&&e.shadeQuarterAndTrade(r.packFloatIntoVec4),e.currentTexture}function b(a,b){
var c=1<<b,d=0,e=!0,f=!1,g=void 0;try{for(var h=void 0,i=a[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;d+=j}}catch(k){
f=!0,g=k}finally{try{e||null==i["return"]||i["return"]()}finally{if(f)throw g}}if(isNaN(d)||d<1e-6)return o.zero(1,c).times(NaN);for(var l=new Float32Array(2*c),m=0;m<c;m++)l[2*m]=a[m]/d;
return new o(1,c,l)}function c(a){var b=a,c=b.painter,d=b.rect,e=d.x,f=d.y,g=d.w,h=d.h,i=1<<a.gate.height,k=h/i;if(c.fillRect(a.rect,j.DISPLAY_GATE_BACK_COLOR),
k<1)return a.painter.ctx.save(),a.painter.ctx.globalAlpha*=.2,c.fillRect(a.rect,"lightgray"),void a.painter.ctx.restore();var l=a.gate.height-5;
c.trace(function(a){for(var b=1;b<i;b++)a.line(e,f+k*b,e+g,f+k*b)}).thenStroke("lightgray",l<=0?1:1/l),c.strokeRect(a.rect,"lightgray");
}function d(a){var b=a,c=b.painter,d=b.rect,e=d.x,f=d.y,g=d.w,h=d.h,i=b.customStats,k=1<<a.gate.height,l=h/k,m=Math.max(l,1);c.ctx.save(),
c.ctx.beginPath(),c.ctx.moveTo(e,f);for(var n=0;n<k;n++){var o=i.rawBuffer()[2*n],p=e+g*o,q=f+l*n;c.ctx.lineTo(p,q),c.ctx.lineTo(p,q+m);
}c.ctx.lineTo(e,f+h),c.ctx.lineTo(e,f),c.ctx.strokeStyle="gray",c.ctx.lineWidth=1,c.ctx.stroke(),c.ctx.fillStyle=j.DISPLAY_GATE_FORE_COLOR,
c.ctx.fill(),c.ctx.restore()}function e(a){var b=a,c=b.painter,d=b.rect,e=d.x,f=d.y,g=d.w,h=d.h,i=b.customStats,j=1<<a.gate.height,k=h/j,l=Math.max(k,1);
c.ctx.save(),c.ctx.beginPath(),c.ctx.moveTo(e,f);for(var m=1/(4+Math.max(8,a.gate.height)),n=0;n<j;n++){var o=i.rawBuffer()[2*n],p=e+g*Math.min(1,Math.max(0,1+Math.log(o)*m)),q=f+k*n;
c.ctx.lineTo(p,q),c.ctx.lineTo(p,q+l)}c.ctx.lineTo(e,f+h),c.ctx.lineWidth=1,c.ctx.strokeStyle="#CCC",c.ctx.stroke(),c.ctx.restore();
}function f(a){var b=a,c=b.painter,d=b.rect,e=d.x,f=d.y,g=d.w,h=d.h,i=b.customStats,j=1<<a.gate.height,k=h/j,l=!0,m=!1,o=void 0;try{
for(var p=void 0,r=a.focusPoints[Symbol.iterator]();!(l=(p=r.next()).done);l=!0){var t=p.value,u=Math.floor((t.y-f)/k);if(a.rect.containsPoint(t)&&u>=0&&u<j){
var v=void 0===i?NaN:i.rawBuffer()[2*u];c.strokeRect(new q(e,f+u*k,g,k),"orange",2),n.paintDeferredValueTooltip(c,e+g,f+u*k,"Chance of |"+s.bin(u,a.gate.height)+"⟩ if measured","raw: "+(100*v).toFixed(4)+"%","log: "+(10*Math.log10(v)).toFixed(1)+" dB");
}}}catch(w){m=!0,o=w}finally{try{l||null==r["return"]||r["return"]()}finally{if(m)throw o}}}function g(a){for(var b=a,c=b.painter,d=b.rect,e=d.x,f=d.y,g=d.w,h=d.h,i=b.customStats,j=h/i.height(),k=0;k<i.height();k++){
var l=i.rawBuffer()[2*k];c.print((100*l).toFixed(1)+"%",e+g-2,f+j*(k+.5),"right","middle","black","8pt monospace",g-4,j)}}function h(a){
c(a);var b=a.customStats,h=void 0===b||b.hasNaN();if(h)a.painter.printParagraph("NaN",a.rect,new p(.5,.5),"red");else{var i=a.rect.h/b.height()>8;
i||e(a),d(a),i&&g(a)}f(a)}function i(c){return k.fromIdentity("Chance","Probability Display","Shows chances of outcomes if a measurement was performed.\nUse controls to see conditional probabilities.").withHeight(c).withSerializedId("Chance"+c).withCustomStatTexturesMaker(function(b){
return a(b.stateTrader.currentTexture,b.controlsTexture,b.row,c)}).withCustomStatPostProcessor(function(a){return b(a,c)}).withCustomDrawer(l.makeDisplayDrawer(h)).withCustomDisableReasonFinder(function(a){
return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ProbabilityDisplay.js")).Config,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ProbabilityDisplay.js")).Gate,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/ProbabilityDisplay.js")).GatePainting,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateShaders.js","src/gates/ProbabilityDisplay.js")).GateShaders,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/ProbabilityDisplay.js")).MathPainter,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ProbabilityDisplay.js")).Matrix,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/ProbabilityDisplay.js")).Point,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/ProbabilityDisplay.js")).Rect,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/Shaders.js","src/gates/ProbabilityDisplay.js")).Shaders,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/ProbabilityDisplay.js")).Util,t=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/gates/ProbabilityDisplay.js")).WglConfiguredShader,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/gates/ProbabilityDisplay.js"))),u=t.Inputs,v=t.Outputs,w=t.currentShaderCoder,x=t.makePseudoShaderWithInputsAndOutputAndCode,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/gates/ProbabilityDisplay.js")).WglTexturePool,z=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTextureTrader.js","src/gates/ProbabilityDisplay.js")).WglTextureTrader,A=function(a,b){
return B(a,b)},B=x([u.vec2("input"),u.bool("control")],v["float"](),"float outputFor(float k) {\n        vec2 amp = read_input(k);\n        return dot(amp, amp) * read_control(k);\n    }"),C=k.fromIdentity("Chance","Probability Display","Shows the chance that measuring a wire would return ON.\nUse controls to see conditional probabilities.").markedAsSingleQubitDisplay().withCustomDrawer(l.makeDisplayDrawer(function(a){
var b=a.positionInCircuit,c=b.row,d=b.col;n.paintProbabilityBox(a.painter,a.stats.controlledWireProbabilityJustAfter(c,d),a.rect,a.focusPoints);
})).withCustomDisableReasonFinder(function(a){return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0}),D=k.generateFamily(1,16,function(a){
return 1===a?C:i(a)});return{get ProbabilityDisplayFamily(){return D},get probabilityStatTexture(){return a},get probabilityPixelsToColumnVector(){
return b},get amplitudesToProbabilities(){return A}}}),$traceurRuntime.registerModule("src/gates/QuarterTurnGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/QuarterTurnGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/QuarterTurnGates.js")).Matrix,c={};
return c.SqrtXForward=a.fromKnownMatrix("X^½",b.fromPauliRotation(.25,0,0),"√X Gate","Principle square root of Not."),c.SqrtXBackward=a.fromKnownMatrix("X^-½",b.fromPauliRotation(.75,0,0),"X^-½ Gate","Adjoint square root of Not."),
c.SqrtYForward=a.fromKnownMatrix("Y^½",b.fromPauliRotation(0,.25,0),"√Y Gate","Principle square root of Y."),c.SqrtYBackward=a.fromKnownMatrix("Y^-½",b.fromPauliRotation(0,.75,0),"Y^-½ Gate","Adjoint square root of Y."),
c.SqrtZForward=a.fromKnownMatrix("Z^½",b.fromPauliRotation(0,0,.25),"√Z Gate","Principle square root of Z.\nAlso known as the 'S' gate."),
c.SqrtZBackward=a.fromKnownMatrix("Z^-½",b.fromPauliRotation(0,0,.75),"Z^-½ Gate","Adjoint square root of Z."),c.all=[c.SqrtXForward,c.SqrtYForward,c.SqrtZForward,c.SqrtXBackward,c.SqrtYBackward,c.SqrtZBackward],
{get QuarterTurnGates(){return c}}}),$traceurRuntime.registerModule("src/gates/ReverseBitsGate.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/ReverseBitsGate.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/ReverseBitsGate.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/ReverseBitsGate.js")),d=c.ketArgs,e=c.ketShaderPermute,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/ReverseBitsGate.js")).Matrix,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/ReverseBitsGate.js")).Seq,h=function(a,b){
for(var c=0,d=0;d<b;d++)0!==(a>>d&1)&&(c|=1<<b-d-1);return c},i=function(a){return f.generateTransition(1<<a,function(b){return h(b,a);
})},j=function(a){return a<2?void 0:e("","\n        float rev = 0.0;\n        for (int k = 0; k < "+a+"; k++) {\n            rev *= 2.0;\n            rev += mod(out_id, 2.0);\n            out_id = floor(out_id*0.5);\n        }\n        return rev;\n    ",a);
},k=g.range(a.MAX_WIRE_COUNT+1).map(j).toArray(),l=function(a){return function(b){var c;return(c=k[a]).withArgs.apply(c,$traceurRuntime.spread(d(b,a)));
}},m=b.generateFamily(2,16,function(a){return b.withoutKnownMatrix("Reverse","Reverse Bits Gate","Swaps some bits into the opposite order.").markedAsStable().markedAsOnlyPermutingAndPhasing().withSerializedId("rev"+a).withHeight(a).withKnownMatrix(a<5?i(a):void 0).withKnownBitPermutation(function(b){
return a-1-b}).withCustomShader(l(a))});return{get ReverseBitsGateFamily(){return m},get reverseShaderForSize(){return l}}}),$traceurRuntime.registerModule("src/gates/SampleDisplay.js",[],function(){
"use strict";function a(a){for(var b=a.customStats,c=b.rawBuffer(),d=a.painter.rng.random(),e=b.height(),f=0;;f++){var g=c[2*f];if(d-=g,
f===e-1||d<1e-5)return{i:f,p:g}}}function b(b){for(var c=b,d=c.painter,f=c.rect,g=f.x,i=f.y,l=f.w,m=f.h,n=e.WIRE_SPACING,o=i+m/2-n*b.gate.height/2,p=a(b),q=p.i,r=p.p,s=0;s<b.gate.height;s++){
var t=0!==(q>>s&1);t&&d.fillRect(new j(g,o+n*s+5,l,n-10),e.OPERATION_FORE_COLOR),d.print(t?"on":"off",g+l/2,o+n*(s+.5),"center","middle","black","16px sans-serif",l,n);
}var u=!0,v=!1,w=void 0;try{for(var x=void 0,y=b.focusPoints[Symbol.iterator]();!(u=(x=y.next()).done);u=!0){var z=x.value,A=Math.floor(2*(z.y-i)/n)/2;
b.rect.containsPoint(z)&&h.paintDeferredValueTooltip(d,g+l,i+A*n,"Chance of |"+k.bin(q,b.gate.height)+"⟩",(100*r).toFixed(4)+"%",void 0,e.OPERATION_BACK_COLOR);
}}catch(B){v=!0,w=B}finally{try{u||null==y["return"]||y["return"]()}finally{if(v)throw w}}}function c(a){a.painter.fillRect(a.rect,e.OPERATION_BACK_COLOR);
var c=a.customStats,d=void 0===c||c.hasNaN();d?a.painter.printParagraph("NaN",a.rect,new i(.5,.5),"red"):b(a),a.painter.strokeRect(a.rect,"lightgray");
}function d(a){return f.fromIdentity("Sample","Sampled Results Display","Shows a random sample of possible measurement outcomes.\nUse controls to see conditional samples.").withHeight(a).withSerializedId("Sample"+a).withCustomStatTexturesMaker(function(b){
return m(b.stateTrader.currentTexture,b.controlsTexture,b.row,a)}).withCustomStatPostProcessor(function(b){return n(b,a)}).withCustomDrawer(g.makeDisplayDrawer(c)).withStableDuration(e.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS/e.CYCLE_DURATION_MS).withCustomDisableReasonFinder(function(a){
return a.isNested?"can't\nnest\ndisplays\n(sorry)":void 0})}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/SampleDisplay.js")).Config,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SampleDisplay.js")).Gate,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SampleDisplay.js")).GatePainting,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/gates/SampleDisplay.js")).MathPainter,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/gates/SampleDisplay.js")).Point,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SampleDisplay.js")).Rect,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/gates/SampleDisplay.js")).Util,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/ProbabilityDisplay.js","src/gates/SampleDisplay.js")),m=l.probabilityStatTexture,n=l.probabilityPixelsToColumnVector,o=f.generateFamily(1,16,d);
return{get SampleDisplayFamily(){return o}}}),$traceurRuntime.registerModule("src/gates/SpacerGate.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/SpacerGate.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SpacerGate.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SpacerGate.js")).GatePainting,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SpacerGate.js")).Rect,e=b.fromIdentity("…","Spacer","A gate with no effect.").withCustomDrawer(function(b){
if(b.isInToolbox||b.isHighlighted){var e=a.GATE_FILL_COLOR;b.isHighlighted&&(e=a.HIGHLIGHTED_GATE_FILL_COLOR),b.painter.fillRect(b.rect,e),
c.paintOutline(b)}else{var f=b.rect.center(),g=f.x,h=f.y,i=new d(g-14,h-2,28,4);b.painter.fillRect(i,a.BACKGROUND_COLOR_CIRCUIT)}
b.painter.fillCircle(b.rect.center().offsetBy(7,0),2,"black"),b.painter.fillCircle(b.rect.center(),2,"black"),b.painter.fillCircle(b.rect.center().offsetBy(-7,0),2,"black");
});return{get SpacerGate(){return e}}}),$traceurRuntime.registerModule("src/gates/SwapGateHalf.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/SwapGateHalf.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/gates/SwapGateHalf.js")).GatePainting,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/SwapGateHalf.js")).Matrix,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/gates/SwapGateHalf.js")).Rect,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/gates/SwapGateHalf.js")).Seq,f=a.fromKnownMatrix("Swap",c.square(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),"Swap Gate [Half]","Swaps the values of two qubits.\n(Place two in the same column.)").withCustomDrawer(function(a){
if(a.isInToolbox||a.isHighlighted)return void b.DEFAULT_DRAWER(a);var c=d.centeredSquareWithRadius(a.rect.center(),a.rect.w/6);a.painter.strokeLine(c.topLeft(),c.bottomRight()),
a.painter.strokeLine(c.topRight(),c.bottomLeft())}).withCustomDisableReasonFinder(function(a){var b=a.innerColumn,c=e.range(b.gates.length).filter(function(a){
return b.gates[a]===f}),d=c.count();if(1===d)return"need\nother\nswap";if(d>2)return"too\nmany\nswap";var g=c.any(function(b){return 0!==(a.measuredMask&1<<b);
}),h=c.any(function(b){return 0===(a.measuredMask&1<<b)});return g&&b.hasCoherentControl(a.measuredMask)?"no\nremix\n(sorry)":g&&h&&b.hasControl()?"no\nremix\n(sorry)":void 0;
});return{get SwapGateHalf(){return f}}}),$traceurRuntime.registerModule("src/gates/VariousXGates.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousXGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousXGates.js")).Matrix,c={};
return c.X3=a.fromKnownMatrix("X^⅓",b.fromPauliRotation(1/6,0,0),"X^⅓ Gate","Principle third root of X."),c.X3i=a.fromKnownMatrix("X^-⅓",b.fromPauliRotation(-1/6,0,0),"X^-⅓ Gate","Adjoint third root of X."),
c.X4=a.fromKnownMatrix("X^¼",b.fromPauliRotation(1/8,0,0),"X^¼ Gate","Principle fourth root of X."),c.X4i=a.fromKnownMatrix("X^-¼",b.fromPauliRotation(-1/8,0,0),"X^-¼ Gate","Adjoint fourth root of X."),
c.X8=a.fromKnownMatrix("X^⅛",b.fromPauliRotation(1/16,0,0),"X^⅛ Gate","Principle eighth root of X."),c.X8i=a.fromKnownMatrix("X^-⅛",b.fromPauliRotation(-1/16,0,0),"X^-⅛ Gate","Adjoint eighth root of X."),
c.X16=a.fromKnownMatrix("X^⅟₁₆",b.fromPauliRotation(1/32,0,0),"X^⅟₁₆ Gate","Principle sixteenth root of X."),c.X16i=a.fromKnownMatrix("X^-⅟₁₆",b.fromPauliRotation(-1/32,0,0),"X^-⅟₁₆ Gate","Adjoint sixteenth root of X."),
c.X32=a.fromKnownMatrix("X^⅟₃₂",b.fromPauliRotation(1/64,0,0),"X^⅟₃₂ Gate","Principle 32'nd root of X."),c.X32i=a.fromKnownMatrix("X^-⅟₃₂",b.fromPauliRotation(-1/64,0,0),"X^-⅟₃₂ Gate","Adjoint 32'nd root of X."),
c.all=[c.X3,c.X4,c.X8,c.X16,c.X32,c.X3i,c.X4i,c.X8i,c.X16i,c.X32i],{get VariousXGates(){return c}}}),$traceurRuntime.registerModule("src/gates/VariousYGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousYGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousYGates.js")).Matrix,c={};
return c.Y3=a.fromKnownMatrix("Y^⅓",b.fromPauliRotation(0,1/6,0),"Y^⅓ Gate","Principle third root of Y."),c.Y3i=a.fromKnownMatrix("Y^-⅓",b.fromPauliRotation(0,-1/6,0),"Y^-⅓ Gate","Adjoint third root of Y."),
c.Y4=a.fromKnownMatrix("Y^¼",b.fromPauliRotation(0,1/8,0),"Y^¼ Gate","Principle fourth root of Y."),c.Y4i=a.fromKnownMatrix("Y^-¼",b.fromPauliRotation(0,-1/8,0),"Y^-¼ Gate","Adjoint fourth root of Y."),
c.Y8=a.fromKnownMatrix("Y^⅛",b.fromPauliRotation(0,1/16,0),"Y^⅛ Gate","Principle eighth root of Y."),c.Y8i=a.fromKnownMatrix("Y^-⅛",b.fromPauliRotation(0,-1/16,0),"Y^-⅛ Gate","Adjoint eighth root of Y."),
c.Y16=a.fromKnownMatrix("Y^⅟₁₆",b.fromPauliRotation(0,1/32,0),"Y^⅟₁₆ Gate","Principle sixteenth root of Y."),c.Y16i=a.fromKnownMatrix("Y^-⅟₁₆",b.fromPauliRotation(0,-1/32,0),"Y^-⅟₁₆ Gate","Adjoint sixteenth root of Y."),
c.Y32=a.fromKnownMatrix("Y^⅟₃₂",b.fromPauliRotation(0,1/64,0),"Y^⅟₃₂ Gate","Principle 32'nd root of Y."),c.Y32i=a.fromKnownMatrix("Y^-⅟₃₂",b.fromPauliRotation(0,-1/64,0),"Y^-⅟₃₂ Gate","Adjoint 32'nd root of Y."),
c.all=[c.Y3,c.Y4,c.Y8,c.Y16,c.Y32,c.Y3i,c.Y4i,c.Y8i,c.Y16i,c.Y32i],{get VariousYGates(){return c}}}),$traceurRuntime.registerModule("src/gates/VariousZGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/VariousZGates.js")).Gate,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/gates/VariousZGates.js")).Matrix,c={};
return c.Z3=a.fromKnownMatrix("Z^⅓",b.fromPauliRotation(0,0,1/6),"Z^⅓ Gate","Principle third root of Z."),c.Z3i=a.fromKnownMatrix("Z^-⅓",b.fromPauliRotation(0,0,-1/6),"Z^-⅓ Gate","Adjoint third root of Z."),
c.Z4=a.fromKnownMatrix("Z^¼",b.fromPauliRotation(0,0,1/8),"Z^¼ Gate","Principle fourth root of Z.\nAlso known as the 'T' gate."),
c.Z4i=a.fromKnownMatrix("Z^-¼",b.fromPauliRotation(0,0,-1/8),"Z^-¼ Gate","Adjoint fourth root of Z."),c.Z8=a.fromKnownMatrix("Z^⅛",b.fromPauliRotation(0,0,1/16),"Z^⅛ Gate","Principle eighth root of Z."),
c.Z8i=a.fromKnownMatrix("Z^-⅛",b.fromPauliRotation(0,0,-1/16),"Z^-⅛ Gate","Adjoint eighth root of Z."),c.Z16=a.fromKnownMatrix("Z^⅟₁₆",b.fromPauliRotation(0,0,1/32),"Z^⅟₁₆ Gate","Principle 16'th root of Z."),
c.Z16i=a.fromKnownMatrix("Z^-⅟₁₆",b.fromPauliRotation(0,0,-1/32),"Z^-⅟₁₆ Gate","Adjoint 16'th root of Z."),c.Z32=a.fromKnownMatrix("Z^⅟₃₂",b.fromPauliRotation(0,0,1/64),"Z^⅟₃₂ Gate","Principle 32'nd root of Z."),
c.Z64=a.fromKnownMatrix("Z^⅟₆₄",b.fromPauliRotation(0,0,1/128),"Z^⅟₆₄ Gate","Principle 64'th root of Z."),c.Z128=a.fromKnownMatrix("Z^⅟₁₂₈",b.fromPauliRotation(0,0,1/256),"Z^⅟₁₂₈ Gate","Principle 128'th root of Z."),
c.all=[c.Z3,c.Z4,c.Z8,c.Z16,c.Z32,c.Z64,c.Z128,c.Z3i,c.Z4i,c.Z8i,c.Z16i],{get VariousZGates(){return c}}}),$traceurRuntime.registerModule("src/gates/XorGates.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/gates/XorGates.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/gates/XorGates.js")).Gate,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/KetShaderUtil.js","src/gates/XorGates.js")),d=c.ketArgs,e=c.ketShaderPermute,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/gates/XorGates.js")).WglArg,g={},h=e("uniform float srcOffset, srcSpan;","\n        float srcMask = mod(floor(full_out_id / srcOffset), srcSpan);\n        float bitPos = 1.0;\n        float result = 0.0;\n        for (int i = 0; i < "+a.MAX_WIRE_COUNT+"; i++) {\n            float srcBit = mod(floor(srcMask/bitPos), 2.0);\n            float dstBit = mod(floor(out_id/bitPos), 2.0);\n            result += (dstBit + srcBit - dstBit * srcBit * 2.0) * bitPos;\n            bitPos *= 2.0;\n        }\n        return result;");
return g.XorAFamily=b.generateFamily(1,8,function(a){return b.withoutKnownMatrix("⊕A","Xor Gate [input A]","Xors 'input A' into the qubits covered by this gate.").markedAsOnlyPermutingAndPhasing().markedAsStable().withHeight(a).withSerializedId("^=A"+a).withRequiredContextKeys("Input Range A").withCustomShader(function(b){
var c,e=b.customContextFromGates.get("Input Range A"),g=e.offset,i=e.length,j=Math.min(i,a);return(c=h).withArgs.apply(c,$traceurRuntime.spread(d(b,j),[f["float"]("srcOffset",1<<g),f["float"]("srcSpan",1<<j)]));
})}),g.all=$traceurRuntime.spread(g.XorAFamily.all),{get XorGates(){return g}}}),$traceurRuntime.registerModule("src/issues.js",[],function(){
"use strict";function a(){return null===e||void 0===e}function b(){return null===e.getExtension("OES_texture_float")}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/issues.js")).notifyAboutKnownIssue,d=document.createElement("canvas"),e=d.getContext("webgl")||d.getContext("experimental-webgl");
return a()?c("Can't simulate circuits. Your browser doesn't support WebGL, or has it disabled.","https://github.com/Strilanc/Quirk/issues/168",[/Computing circuit values failed/,/Error creating WebGL context./]):b()&&c("Can't simulate circuits. Your browser/GPU doesn't support creating floating point textures.","https://github.com/Strilanc/Quirk/issues/156",[/Computing circuit values failed/]),
d=void 0,e=void 0,{}}),$traceurRuntime.registerModule("src/main.js",[],function(){"use strict";$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/Polyfills.js","src/main.js"));
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/main.js")).hookErrorHandler;a(),$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/issues.js","src/main.js"));
var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/CooldownThrottle.js","src/main.js")).CooldownThrottle,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/main.js")).Config,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedInspector.js","src/main.js")).DisplayedInspector,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/main.js")).Painter,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/main.js")).Rect,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/RestartableRng.js","src/main.js")).RestartableRng,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Revision.js","src/main.js")).Revision,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/main.js")),j=i.initSerializer,k=i.fromJsonText_CircuitDefinition,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/TouchScrollBlocker.js","src/main.js")).TouchScrollBlocker,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/main.js")).Util,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/main.js")).initializedWglContext,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/MouseWatcher.js","src/main.js")),p=o.watchDrags,q=o.isMiddleClicking,r=o.eventPosRelativeTo,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/main.js")),t=s.ObservableValue,u=s.ObservableSource,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/exports.js","src/main.js")),w=v.initExports,x=v.obsExportsIsShowing,y=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/forge.js","src/main.js")),z=y.initForge,A=y.obsForgeIsShowing,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/menu.js","src/main.js")),C=B.initMenu,D=B.obsMenuIsShowing,E=B.closeMenu,F=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/undo.js","src/main.js")).initUndoRedo,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/clear.js","src/main.js")).initClear,H=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/url.js","src/main.js")).initUrlCircuitSync,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/title.js","src/main.js")).initTitleSync,J=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/sim.js","src/main.js")).simulate,K=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/main.js")).GatePainting,L=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/main.js")).GATE_CIRCUIT_DRAWER;
j(K.MATRIX_DRAWER,L);var M=document.getElementById("canvasDiv"),N=document.getElementById("drawCanvas");if(!N)throw new Error("Couldn't find 'drawCanvas'");
N.width=M.clientWidth,N.height=.9*window.innerHeight;var O=!1,P=function(){var a,b={cur:new g};return a=function(){b.cur=new g,setTimeout(a,.99*c.SEMI_STABLE_RANDOM_VALUE_LIFETIME_MILLIS);
},a(),b}(),Q=document.getElementById("inspectorDiv"),R=new t(d.empty(new f(0,0,N.clientWidth,N.clientHeight))),S=h.startingAt(R.get().snapshot());
S.latestActiveCommit().subscribe(function(a){var b=k(a),c=R.get().withCircuitDefinition(b);R.set(c)});var T=function(a){return{w:Math.max(M.clientWidth,a.desiredWidth()),
h:a.desiredHeight()}},U=function(a){var b=T(a);return a.updateArea(new f(0,0,b.w,b.h)),a};R.observable().map(function(a){return a.displayedCircuit.circuitDefinition;
}).whenDifferent(m.CUSTOM_IS_EQUAL_TO_EQUALITY).subscribe(function(){var a=document.getElementById("error-div").style;a.opacity*=.9,
a.opacity<.06&&(a.display="None")});var V,W=new l(M),X=function(){if(O){var a=U(R.get()).previewDrop(),b=J(a.displayedCircuit.circuitDefinition),c=T(a);
N.width=c.w,N.height=c.h;var d=new e(N,P.cur.restarted());a.updateArea(d.paintableArea()),a.paint(d,b),d.paintDeferred(),R.get().hand.paintCursor(d),
W.setBlockers(d.touchBlockers,d.desiredCursorStyle),N.style.cursor=d.desiredCursorStyle||"auto";var f=R.get().stableDuration();f<1/0&&window.requestAnimationFrame(function(){
return V.trigger()})}};V=new b(X,c.REDRAW_COOLDOWN_MILLIS,.1,(!0)),window.addEventListener("resize",function(){return V.trigger();
},!1),R.observable().subscribe(function(){return V.trigger()}),p(M,function(a,b){var c=R.get(),d=c.hand.withPos(a),e=U(c.withHand(d)).afterGrabbing(b.shiftKey,b.ctrlKey);
!R.get().isEqualTo(e)&&e.hand.isBusy()&&(S.startedWorkingOnCommit(),R.set(U(c.withHand(d).withJustEnoughWires(e.hand,1)).afterGrabbing(b.shiftKey,b.ctrlKey)),
b.preventDefault())},function(a){S.cancelCommitBeingWorkedOn(),a.preventDefault()},function(a,b){if(R.get().hand.isBusy()){var c=R.get().hand.withPos(a),d=R.get().withHand(c);
R.set(d),b.preventDefault()}},function(a,b){if(R.get().hand.isBusy()){var c=R.get().hand.withPos(a),d=U(R.get()).withHand(c).afterDropping().afterTidyingUp(),e=d.hand.withPos(void 0),f=d.withJustEnoughWires(e,0);
S.commit(f.snapshot()),b.preventDefault()}}),M.addEventListener("mousedown",function(a){if(q(a)){var b=R.get().hand.withPos(r(a,N)),c=U(R.get()).withHand(b).afterGrabbing(!1,!1).withHand(b).afterTidyingUp().withJustEnoughWires(b,0);
R.get().isEqualTo(c)||(S.commit(c.snapshot()),a.preventDefault())}}),M.addEventListener("mousemove",function(a){if(!R.get().hand.isBusy()){
var b=R.get().hand.withPos(r(a,N)),c=R.get().withHand(b);R.set(c)}}),M.addEventListener("mouseleave",function(){if(!R.get().hand.isBusy()){
var a=R.get().hand.withPos(void 0),b=R.get().withHand(a);R.set(b)}});var Y=new u;return H(S),w(S,Y.observable()),z(S,Y.observable()),
F(S,Y.observable()),G(S,Y.observable()),C(S,Y.observable()),I(S),A.zipLatest(x,function(a,b){return a||b}).zipLatest(D,function(a,b){
return a||b}).whenDifferent().subscribe(function(a){Y.send(a),M.tabIndex=a?-1:0}),O=!0,setTimeout(function(){Q.style.display="block",
X(),document.getElementById("loading-div").style.display="none",document.getElementById("close-menu-button").style.display="block",
R.get().displayedCircuit.circuitDefinition.isEmpty()||E();try{n().onContextRestored=function(){return V.trigger()}}catch(a){console.error(a);
}},0),{}}),$traceurRuntime.registerModule("src/math/Axis.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Axis.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Axis.js")).UNICODE_FRACTIONS,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/FormulaParser.js","src/math/Axis.js")).parseFormula,d=new Map,e=function(){
function b(a,b,c){this.x=a,this.y=b,this.z=c}return $traceurRuntime.createClass(b,{toString:function(){return this.x+"X + "+this.y+"Y + "+this.z+"Z";
},isEqualTo:function(a){return a instanceof b&&a.x===this.x&&a.y===this.y&&a.z===this.z}},{parse:function(e){var f=c(e,d);if(!(f instanceof b))throw new a("Not an axis.",{
text:e,result:f});return f},classify:function(c){if("number"==typeof c)return!1;if(c instanceof b)return!0;throw new a("Not an axis or a number",{
v:c})},op:function(a,c,d,e,f,g){var h=b.classify(a),i=b.classify(c);return h&&i?g(a,c):h||i?h?e(a,c):f(a,c):d(a,c)},times:function(c,d){
return b.op(c,d,function(a,b){return a*b},function(a,c){return new b(a.x*c,a.y*c,a.z*c)},function(a,c){return new b(c.x*a,c.y*a,c.z*a);
},function(b,c){throw new a("Can't multiply axes.",{a:b,b:c})})},add:function(c,d){return b.op(c,d,function(a,b){return a+b},function(b,c){
throw new a("Can't add axes to numbers.",{a:b,b:c})},function(b,c){throw new a("Can't add axes to numbers.",{a:b,b:c})},function(a,c){
return new b(a.x+c.x,a.y+c.y,a.z+c.z)})},negate:function(a){return b.classify(a)?new b((-a.x),(-a.y),(-a.z)):-a},subtract:function(c,d){
return b.op(c,d,function(a,b){return a-b},function(b,c){throw new a("Can't subtract axes and numbers.",{a:b,b:c})},function(b,c){
throw new a("Can't subtract axes and numbers.",{a:b,b:c})},function(a,c){return new b(a.x-c.x,a.y-c.y,a.z-c.z)})},divide:function(c,d){
return b.op(c,d,function(a,b){return a/b},function(a,c){return new b(a.x/c,a.y/c,a.z/c)},function(b,c){throw new a("Can't divide by an axis.",{
a:b,b:c})},function(b,c){throw new a("Can't divide by an axis.",{a:b,b:c})})},raisedTo:function(c,d){return b.op(c,d,function(a,b){
return Math.pow(a,b)},function(b,c){throw new a("Can't raise an axis to a power.",{a:b,b:c})},function(b,c){throw new a("Can't raise to an axis power.",{
a:b,b:c})},function(b,c){throw new a("Can't raise to an axis power.",{a:b,b:c})})}})}();d.set("x",new e(1,0,0)),d.set("y",new e(0,1,0)),
d.set("z",new e(0,0,1)),d.set("(","("),d.set(")",")");var f=!0,g=!1,h=void 0;try{for(var i=void 0,j=b[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){
var k=i.value,l=k.character,m=k.value;d.set(l,m)}}catch(n){g=!0,h=n}finally{try{f||null==j["return"]||j["return"]()}finally{if(g)throw h;
}}return d.set("sqrt",{unary_action:function(a){return e.raisedTo(a,.5)},priority:4}),d.set("^",{binary_action:e.raisedTo,priority:3
}),d.set("*",{binary_action:e.times,priority:2}),d.set("/",{binary_action:e.divide,priority:2}),d.set("-",{unary_action:e.negate,
binary_action:e.subtract,priority:1}),d.set("+",{unary_action:function(a){return a},binary_action:e.add,priority:1}),d.set("√",d.get("sqrt")),
{get Axis(){return e}}}),$traceurRuntime.registerModule("src/math/Complex.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Complex.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Complex.js")),c=b.Format,d=b.UNICODE_FRACTIONS,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/math/Complex.js")).Util,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/FormulaParser.js","src/math/Complex.js")).parseFormula,g=new Map,h=function(){
function b(a,b){this.real=a,this.imag=b}return $traceurRuntime.createClass(b,{isEqualTo:function(a){return a instanceof b?this.real===a.real&&this.imag===a.imag:"number"==typeof a&&(this.real===a&&0===this.imag);
},isApproximatelyEqualTo:function(a,c){if(a instanceof b||"number"==typeof a){var d=this.minus(b.from(a));return Math.abs(d.real)<=c&&Math.abs(d.imag)<=c&&d.abs()<=c;
}return!1},toString:function(a){return a=a||c.EXACT,a.allowAbbreviation?this._toString_allowSingleValue(a):this._toString_bothValues(a);
},_toString_allowSingleValue:function(a){return Math.abs(this.imag)<=a.maxAbbreviationError?a.formatFloat(this.real):Math.abs(this.real)<=a.maxAbbreviationError?Math.abs(this.imag-1)<=a.maxAbbreviationError?"i":Math.abs(this.imag+1)<=a.maxAbbreviationError?"-i":a.formatFloat(this.imag)+"i":this._toString_bothValues(a);
},_toString_bothValues:function(a){var b=this.imag>=0?"+":"-",c=a.allowAbbreviation&&Math.abs(Math.abs(this.imag)-1)<=a.maxAbbreviationError?"":a.formatFloat(Math.abs(this.imag)),d=a.allowAbbreviation||void 0===a.fixedDigits||this.real<0?"":"+";
return d+a.formatFloat(this.real)+b+c+"i"},norm2:function(){return this.real*this.real+this.imag*this.imag},abs:function(){return Math.sqrt(this.norm2());
},conjugate:function(){return new b(this.real,(-this.imag))},neg:function(){return new b((-this.real),(-this.imag))},phase:function(){
return Math.atan2(this.imag,this.real)},unit:function(){var a=this.norm2();return a<1e-5?b.polar(1,this.phase()):this.dividedBy(Math.sqrt(a));
},plus:function(a){var c=b.from(a);return new b(this.real+c.real,this.imag+c.imag)},minus:function(a){var c=b.from(a);return new b(this.real-c.real,this.imag-c.imag);
},times:function(a){var c=b.from(a);return new b(this.real*c.real-this.imag*c.imag,this.real*c.imag+this.imag*c.real)},dividedBy:function(a){
var c=b.from(a),d=c.norm2();if(0===d)throw new Error("Division by Zero");var e=this.times(c.conjugate());return new b(e.real/d,e.imag/d);
},sqrts:function(){var a,c,d=[this.real,this.imag],e=(a=d[Symbol.iterator](),(c=a.next()).done?void 0:c.value),f=(c=a.next()).done?void 0:c.value,g=Math.sqrt(Math.sqrt(e*e+f*f));
if(0===g)return[b.ZERO];if(0===f&&e<0)return[new b(0,g),new b(0,(-g))];var h=this.phase()/2,i=b.polar(g,h);return[i,i.times(-1)]},
exp:function(){return b.polar(Math.exp(this.real),this.imag)},ln:function(){return new b(Math.log(this.abs()),this.phase())},raisedTo:function(a){
return.5===a&&0===this.imag&&this.real>=0?new b(Math.sqrt(this.real),0):b.ZERO.isEqualTo(a)?b.ONE:this.isEqualTo(b.ZERO)?b.ZERO:this.ln().times(b.from(a)).exp();
}},{from:function(c){if(c instanceof b)return c;if("number"==typeof c)return new b(c,0);throw new a("Unrecognized value type.",{v:c
})},polar:function(a,c){var d,f,g=e.snappedCosSin(c),h=(d=g[Symbol.iterator](),(f=d.next()).done?void 0:f.value),i=(f=d.next()).done?void 0:f.value;
return new b(a*h,a*i)},realPartOf:function(c){if(c instanceof b)return c.real;if("number"==typeof c)return c;throw new a("Unrecognized value type.",{
v:c})},imagPartOf:function(c){if(c instanceof b)return c.imag;if("number"==typeof c)return 0;throw new a("Unrecognized value type.",{
v:c})},parse:function(a){return b.from(f(a,g))},rootsOfQuadratic:function(a,c,d){if(a=b.from(a),c=b.from(c),d=b.from(d),a.isEqualTo(0)){
if(!c.isEqualTo(0))return[d.times(-1).dividedBy(c)];if(!d.isEqualTo(0))return[];throw Error("Degenerate")}var e=c.times(c).minus(a.times(d).times(4)).sqrts(),f=c.times(-1),g=a.times(2);
return e.map(function(a){return f.minus(a).dividedBy(g)})}})}();h.ZERO=new h(0,0),h.ONE=new h(1,0),h.I=new h(0,1),g.set("i",h.I),
g.set("e",h.from(Math.E)),g.set("pi",h.from(Math.PI)),g.set("(","("),g.set(")",")");var i=!0,j=!1,k=void 0;try{for(var l=void 0,m=d[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){
var n=l.value,o=n.character,p=n.value;g.set(o,p)}}catch(q){j=!0,k=q}finally{try{i||null==m["return"]||m["return"]()}finally{if(j)throw k;
}}return g.set("sqrt",{unary_action:function(a){return h.from(a).raisedTo(.5)},priority:4}),g.set("exp",{unary_action:function(a){
return h.from(a).exp()},priority:4}),g.set("ln",{unary_action:function(a){return h.from(a).ln()},priority:4}),g.set("cos",{unary_action:function(a){
var b=h.from(a).times(new h(0,Math.PI/180));return b.exp().plus(b.neg().exp()).times(.5)},priority:4}),g.set("sin",{unary_action:function(a){
var b=h.from(a).times(new h(0,Math.PI/180));return b.exp().minus(b.neg().exp()).dividedBy(new h(0,2))},priority:4}),g.set("asin",{
unary_action:function(b){if(0!==h.imagPartOf(b))throw new a("asin input out of range",{e:b});return h.from(180*Math.asin(h.realPartOf(b))/Math.PI);
},priority:4}),g.set("acos",{unary_action:function(b){if(0!==h.imagPartOf(b))throw new a("acos input out of range",{e:b});return h.from(180*Math.acos(h.realPartOf(b))/Math.PI);
},priority:4}),g.set("^",{binary_action:function(a,b){return h.from(a).raisedTo(b)},priority:3}),g.set("*",{binary_action:function(a,b){
return h.from(a).times(b)},priority:2}),g.set("/",{binary_action:function(a,b){return h.from(a).dividedBy(b)},priority:2}),g.set("-",{
unary_action:function(a){return h.from(a).neg()},binary_action:function(a,b){return h.from(a).minus(b)},priority:1}),g.set("+",{unary_action:function(a){
return a},binary_action:function(a,b){return h.from(a).plus(b)},priority:1}),g.set("√",g.get("sqrt")),g.set("arccos",g.get("acos")),
g.set("arcsin",g.get("asin")),{get Complex(){return h}}}),$traceurRuntime.registerModule("src/math/FormulaParser.js",[],function(){
"use strict";function a(a){a=$traceurRuntime.spread(a);for(var b=a.indexOf("e",1);b!==-1;b=a.indexOf("e",b+1)){var c=b-1,d=b+1;a[c].match(/[0-9]/)&&((a[d]+"").match(/[+-]/)&&(d+=1),
(a[d]+"").match(/[0-9]/)&&(d+=1,a.splice(c,d-c,a.slice(c,d).join("")),b-=1))}return a}function b(b){var c=f(b.toLowerCase().split(/\s/)).flatMap(function(a){
return f(a).segmentBy(function(a){return""===a.trim()?" ":a.match(/[\.0-9]/)?"#":a.match(/[_a-z]/)?"a":NaN}).map(function(a){return a.join("");
})}).filter(function(a){return""!==a.trim()}).toArray();return a(c)}function c(a,b){if(a.match(/[0-9]+(\.[0-9]+)?/))return parseFloat(a);
if(b.has(a))return b.get(a);throw new e("Unrecognized token",{token:a})}function d(a,d){var f=b(a).map(function(a){return c(a,d)});
f.length>0&&void 0!==f[f.length-1].priority&&(f=f.slice(0,f.length-1));var g=[],h=[],i=function(a){return"("!==a&&void 0===a.priority;
},j=function(){return 1===h.length&&0===g.length},k=function(b){if("("===b)throw new e("Bad expression: unmatched '('",{text:a});if(h.length<2)throw new e("Bad expression: operated on nothing",{
text:a});var c=h.pop(),d=h.pop();h.push(b.f(d,c))},l=function(){for(;;){if(0===g.length)throw new e("Bad expression: unmatched ')'",{
text:a});var b=g.pop();if("("===b)break;k(b)}},m=function(a){for(;g.length>0&&h.length>=2&&void 0!==h[h.length-1];){var b=g[g.length-1];
if(void 0===b.w||b.w<a)break;k(g.pop())}},n=function(b,c){var f=d.get("*");if(b&&void 0===c.binary_action&&")"!==c&&(m(f.priority),
g.push({f:f.binary_action,w:f.priority})),b&&void 0!==c.binary_action)m(c.priority),g.push({f:c.binary_action,w:c.priority});else if(void 0!==c.unary_action)m(c.priority),
h.push(void 0),g.push({f:function(a,b){return c.unary_action(b)},w:1/0});else if(void 0!==c.binary_action)throw new e("Bad expression: binary op in bad spot",{
text:a})},o=!1,p=!0,q=!1,r=void 0;try{for(var s=void 0,t=f[Symbol.iterator]();!(p=(s=t.next()).done);p=!0){var u=s.value;n(o,u),o=i(u),
"("===u?g.push("("):")"===u?l():o&&h.push(u)}}catch(v){q=!0,r=v}finally{try{p||null==t["return"]||t["return"]()}finally{if(q)throw r;
}}if(m(-(1/0)),!j())throw new e("Incomplete expression",{text:a});return h[0]}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/FormulaParser.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/math/FormulaParser.js")).seq;
return{get parseFormula(){return d}}}),$traceurRuntime.registerModule("src/math/Matrix.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/math/Matrix.js")).Complex,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/math/Matrix.js")).DetailedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/math/Matrix.js")).Format,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/math/Matrix.js")),e=d.seq,f=d.Seq,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/math/Matrix.js")).Util,h=function(){
function d(a,c,d){if(a*c*2!==d.length)throw new b("width*height*2 !== buffer.length",{width:a,height:c,len:d.length});this._width=a,
this._height=c,this._buffer=d}return $traceurRuntime.createClass(d,{cell:function(c,d){if(c<0||d<0||c>=this._width||d>=this._height)throw new b("Cell out of range",{
col:c,row:d,width:this._width,height:this._height});var e=2*(this._width*d+c);return new a(this._buffer[e],this._buffer[e+1])},rawBuffer:function(){
return this._buffer},rows:function(){var a=this;return f.range(this._height).map(function(b){return f.range(a._width).map(function(c){
return a.cell(c,b)}).toArray()}).toArray()},isEqualTo:function(a){var b=this;if(this===a)return!0;if(!(a instanceof d))return!1;var c=a;
return this._width===c._width&&this._height===c._height&&f.range(this._buffer.length).every(function(a){return b._buffer[a]===c._buffer[a];
})},isApproximatelyEqualTo:function(a,b){return a instanceof d&&this._width===a._width&&this._height===a._height&&Math.sqrt(this.minus(a).norm2())<=b;
},toString:function(){var a=void 0!==arguments[0]?arguments[0]:c.EXACT,b=this.rows().map(function(b){return b.map(function(b){return b.toString(a);
}).join(a.itemSeparator)}).join("}"+a.itemSeparator+"{");return"{{"+b+"}}"},width:function(){return this._width},height:function(){
return this._height},isUnitary:function(a){var b=this.width();return this.height()===b&&this.times(this.adjoint()).isApproximatelyEqualTo(d.identity(b),a);
},isLowerTriangular:function(){for(var a=void 0!==arguments[0]?arguments[0]:0,b=0;b<this._height;b++)for(var c=b+1;c<this._width;c++){
var d=2*(b*this._width+c),e=this._buffer[d],f=this._buffer[d+1];if(isNaN(e)||isNaN(f)||e*e+f*f>a*a)return!1}return!0},isUpperTriangular:function(){
for(var a=void 0!==arguments[0]?arguments[0]:0,b=0;b<this._height;b++)for(var c=0;c<b&&c<this._width;c++){var d=2*(b*this._width+c),e=this._buffer[d],f=this._buffer[d+1];
if(isNaN(e)||isNaN(f)||e*e+f*f>a*a)return!1}return!0},isPhasedPermutation:function(){var a=void 0!==arguments[0]?arguments[0]:0;if(this._width!==this._height)return!1;
for(var b=this._width,c=new Uint32Array(b),d=new Uint32Array(b),f=0;f<b;f++)for(var g=0;g<b;g++){var h=2*(g*b+f),i=Math.max(Math.abs(this._buffer[h]),Math.abs(this._buffer[h+1]));
(isNaN(i)||i>a)&&(c[f]+=1,d[g]+=1)}return e(c).concat(d).every(function(a){return a<=1})},isApproximatelyHermitian:function(a){if(this._width!==this._height)return!1;
for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++){var d=2*(this._width*c+b),e=2*(this._width*b+c);if(Math.abs(this._buffer[d]-this._buffer[e])>a)return!1;
if(Math.abs(this._buffer[d+1]+this._buffer[e+1])>a)return!1}return!0},isIdentity:function(){var a=void 0!==arguments[0]?arguments[0]:0;
if(this._width!==this._height)return!1;for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++){var d=2*(this._width*c+b),e=Math.abs(this._buffer[d]-(c===b?1:0)),f=Math.abs(this._buffer[d+1]);
if(Math.max(e,f)>a)return!1}return!this.hasNaN()},hasNaN:function(){for(var a=0;a<this._buffer.length;a++)if(isNaN(this._buffer[a]))return!0;
return!1},isDiagonal:function(){for(var a=void 0!==arguments[0]?arguments[0]:0,b=0;b<this._width;b++)for(var c=0;c<this._height;c++)if(c!==b){
var d=2*(this._width*c+b),e=Math.abs(this._buffer[d]),f=Math.abs(this._buffer[d+1]),g=Math.max(e,f);if(isNaN(g)||g>a)return!1}return this._width===this._height;
},adjoint:function(){for(var a=this._height,b=this._width,c=new Float64Array(a*b*2),e=0;e<b;e++)for(var f=0;f<a;f++){var g=2*(f*this._width+e),h=2*(e*a+f);
c[h]=this._buffer[g],c[h+1]=-this._buffer[g+1]}return new d(a,b,c)},transpose:function(){for(var a=this._height,b=this._width,c=new Float64Array(a*b*2),e=0;e<b;e++)for(var f=0;f<a;f++){
var g=2*(f*this._width+e),h=2*(e*a+f);c[h]=this._buffer[g],c[h+1]=this._buffer[g+1]}return new d(a,b,c)},trace:function(){for(var b=0,c=0,d=2*this._width+2,e=0;e<this._buffer.length;e+=d)b+=this._buffer[e],
c+=this._buffer[e+1];return new a(b,c)},_timesScalar:function(b){for(var c=new Float64Array(this._buffer.length),e=a.realPartOf(b),f=a.imagPartOf(b),g=0;g<c.length;g+=2){
var h=this._buffer[g],i=this._buffer[g+1];c[g]=h*e-i*f,c[g+1]=h*f+i*e}return new d(this._width,this._height,c)},plus:function(a){
var b=this,c=b._width,e=b._height,f=b._buffer,h=a._buffer;g.need(a._width===c&&a._height===e,"Matrix.plus: compatible sizes");for(var i=new Float64Array(this._buffer.length),j=0;j<i.length;j++)i[j]=f[j]+h[j];
return new d(c,e,i)},minus:function(a){var b=this,c=b._width,e=b._height,f=b._buffer,h=a._buffer;g.need(a._width===c&&a._height===e,"Matrix.minus: compatible sizes");
for(var i=new Float64Array(this._buffer.length),j=0;j<i.length;j++)i[j]=f[j]-h[j];return new d(c,e,i)},_timesMatrix:function(a){if(this._width!==a._height)throw new b("Incompatible sizes.",{
"this":this,other:a});for(var c=a._width,e=this._height,f=this._width,g=new Float64Array(c*e*2),h=0;h<e;h++)for(var i=0;i<c;i++)for(var j=2*(h*c+i),k=0;k<f;k++){
var l=2*(h*f+k),m=2*(k*c+i),n=this._buffer[l],o=this._buffer[l+1],p=a._buffer[m],q=a._buffer[m+1],r=n*p-o*q,s=n*q+p*o;g[j]+=r,g[j+1]+=s;
}return new d(c,e,g)},times:function(a){return a instanceof d?this._timesMatrix(a):this._timesScalar(a)},expandedForQubitInRegister:function(a,b,c){
for(var e=Math.round(Math.log2(this._width)),f=d.identity(1<<b-a-e).tensorProduct(this).tensorProduct(d.identity(1<<a))._clone(),g=0;g<f._width;g++)for(var h=0;h<f._height;h++)if(!c.allowsState(g)||!c.allowsState(h)){
var i=2*(g+h*f._width);f._buffer[i]=g===h?1:0,f._buffer[i+1]=0}return f},applyToStateVectorAtQubitWithControls:function(a,b,c){for(var e=2*this._width,f=a._buffer.slice(0,e),g=2<<b,h=g*e>>1,i=a._buffer.slice(),j=0;j<i.length;j+=h)for(var k=0;k<g;k+=2)if(c.allowsState((j|k)>>1)){
for(var l=j+k,m=0;m<f.length;m+=2)f[m]=a._buffer[l],f[m+1]=a._buffer[l+1],l+=g;var n=this.times(new d(1,f.length>>1,f));l=j+k;for(var o=0;o<f.length;o+=2)i[l]=n._buffer[o],
i[l+1]=n._buffer[o+1],l+=g}return new d(1,a.height(),i)},norm2:function(){var a=0,b=!0,c=!1,d=void 0;try{for(var e=void 0,f=this._buffer[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){
var g=e.value;a+=g*g}}catch(h){c=!0,d=h}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return a},tensorProduct:function(a){
for(var b=this._width,c=this._height,e=a._width,f=a._height,g=b*e,h=c*f,i=new Float64Array(g*h*2),j=0;j<c;j++)for(var k=0;k<f;k++)for(var l=0;l<b;l++)for(var m=0;m<e;m++){
var n=2*(j*b+l),o=2*(k*e+m),p=2*((j*f+k)*g+(l*e+m)),q=this._buffer[n],r=this._buffer[n+1],s=a._buffer[o],t=a._buffer[o+1],u=q*s-r*t,v=q*t+r*s;
i[p]=u,i[p+1]=v}return new d(g,h,i)},timesQubitOperation:function(a,b,c,e){var f,h;g.need(0===(c&1<<b),"Matrix.timesQubitOperation: self-controlled"),
g.need(2===a._width&&2===a._height,"Matrix.timesQubitOperation: not 2x2");var i=this,j=i._width,k=i._height,l=i._buffer,m=a._buffer,n=(f=m[Symbol.iterator](),
(h=f.next()).done?void 0:h.value),o=(h=f.next()).done?void 0:h.value,p=(h=f.next()).done?void 0:h.value,q=(h=f.next()).done?void 0:h.value,r=(h=f.next()).done?void 0:h.value,s=(h=f.next()).done?void 0:h.value,t=(h=f.next()).done?void 0:h.value,u=(h=f.next()).done?void 0:h.value;
g.need(k>=2<<b,"Matrix.timesQubitOperation: qubit index out of range");for(var v=new Float64Array(l),w=0,x=0;x<k;x++)for(var y=0!==(c&x^e),z=0!==(x&1<<b),A=0;A<j;A++){
if(!y&&!z){var B=w+2*(1<<b)*j,C=v[w],D=v[w+1],E=v[B],F=v[B+1];v[w]=C*n-D*o+E*p-F*q,v[w+1]=C*o+D*n+E*q+F*p,v[B]=C*r-D*s+E*t-F*u,v[B+1]=C*s+D*r+E*u+F*t;
}w+=2}return new d(j,k,v)},tensorPower:function(a){if(!Number.isInteger(a)||a<0)throw new b("Bad exponent",{exponent:a});for(var c=d.identity(1),e=this,f=1;f<=a;f*=2)0!==(f&a)&&(c=c.tensorProduct(e)),
e=e.tensorProduct(e);return c},transformRealAndImagComponentsWith:function(a){for(var b=this._buffer.slice(),c=0;c<b.length;c++)b[c]=a(b[c]);
return new d(this._width,this._height,b)},_inline_rowScale_preMultiply:function(a,b){for(var c=0;c<this._width;c++){var d=this.cell(c,a),e=d.times(b),f=2*(a*this._width+c);
this._buffer[f]=e.real,this._buffer[f+1]=e.imag}},_inline_colScale_postMultiply:function(a,b){for(var c=0;c<this._height;c++){var d=this.cell(a,c),e=d.times(b),f=2*(c*this._width+a);
this._buffer[f]=e.real,this._buffer[f+1]=e.imag}},_inline_rowMix_preMultiply:function(a,b,c){for(var d,e,f=c._2x2Breakdown(),g=(d=f[Symbol.iterator](),
(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=(e=d.next()).done?void 0:e.value,j=(e=d.next()).done?void 0:e.value,k=0;k<this._width;k++){
var l=this.cell(k,a),m=this.cell(k,b),n=l.times(g).plus(m.times(h)),o=l.times(i).plus(m.times(j)),p=2*(a*this._width+k),q=2*(b*this._width+k);
this._buffer[p]=n.real,this._buffer[p+1]=n.imag,this._buffer[q]=o.real,this._buffer[q+1]=o.imag}},_inline_colMix_postMultiply:function(a,b,c){
for(var d,e,f=c._2x2Breakdown(),g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=(e=d.next()).done?void 0:e.value,j=(e=d.next()).done?void 0:e.value,k=0;k<this._width;k++){
var l=this.cell(a,k),m=this.cell(b,k),n=l.times(g).plus(m.times(i)),o=l.times(h).plus(m.times(j)),p=2*(k*this._width+a),q=2*(k*this._width+b);
this._buffer[p]=n.real,this._buffer[p+1]=n.imag,this._buffer[q]=o.real,this._buffer[q+1]=o.imag}},_clone:function(){return new d(this._width,this._height,this._buffer.slice());
},qrDecomposition:function(){if(this._width!==this._height)throw new b("Expected a square matrix.",this);for(var a=d.identity(this._width),c=this._clone(),e=0;e<this._height;e++){
for(var f=0;f<e&&f<this._width;f++){var g=c.cell(f,e),h=c.cell(f,f),i=h.abs(),j=g.abs();if(0!==j){var k=-Math.atan2(j,i),l=Math.cos(k),m=Math.sin(k),n=h.unit().conjugate(),o=g.unit().conjugate(),p=d.square(n.times(l),o.times(-m),n.times(m),o.times(l));
c._inline_rowMix_preMultiply(f,e,p),a._inline_colMix_postMultiply(f,e,p.adjoint())}}var q=c.cell(e,e).unit();c._inline_rowScale_preMultiply(e,q.conjugate()),
a._inline_colScale_postMultiply(e,q)}return{Q:a,R:c}},lqDecomposition:function(){var a=this.adjoint().qrDecomposition(),b=a.Q,c=a.R;
return{L:c.adjoint(),Q:b.adjoint()}},eigenvalueMagnitudes:function(a){var c=void 0!==arguments[1]?arguments[1]:1e3;if(this._width!==this._height)throw new b("Expected a square matrix.",this);
for(var d=0,e=this;!e.isUpperTriangular(a)&&d<c;){var g=e.qrDecomposition(),h=g.Q,i=g.R;if(i.isIdentity(a))return f.repeat(1,this._width).toArray();
e=i.times(h),d++}return f.range(this._width).map(function(a){return e.cell(a,a).abs()}).sortedBy(function(a){return-a}).toArray();
},eigenDecomposition:function(){var b,c;if(2!==this.width()||2!==this.height())throw new Error("Not implemented: non-2x2 eigen decomposition");
var e=this._2x2Breakdown(),f=(b=e[Symbol.iterator](),(c=b.next()).done?void 0:c.value),g=(c=b.next()).done?void 0:c.value,h=(c=b.next()).done?void 0:c.value,i=(c=b.next()).done?void 0:c.value,j=a.rootsOfQuadratic(a.ONE,f.plus(i).times(-1),f.times(i).minus(g.times(h)));
if(0===j.length)throw new Error("Degenerate");return 1===j.length?[{val:j[0],vec:d.col(1,0)},{val:j[0],vec:d.col(0,1)}]:j.map(function(b){
var c,e,j,k,l,m=[g.times(-1),f.minus(b)],n=(c=m[Symbol.iterator](),(e=c.next()).done?void 0:e.value),o=(e=c.next()).done?void 0:e.value;
n.isEqualTo(0)&&o.isEqualTo(0)&&(j=[b.minus(i),h],k=j[Symbol.iterator](),n=(l=k.next()).done?void 0:l.value,o=(l=k.next()).done?void 0:l.value,
j),n.isEqualTo(0)||(o=o.dividedBy(n),n=a.ONE);var p=Math.sqrt(n.norm2()+o.norm2());if(0===p)throw new Error("Unexpected degenerate");
return{val:b,vec:d.col(n,o).times(1/p)}})},liftApply:function(a){var b=this.times(0),c=!0,d=!1,e=void 0;try{for(var f=void 0,g=this.eigenDecomposition()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){
var h=f.value,i=h.val,j=h.vec,k=a(i),l=j.times(j.adjoint());b=b.plus(l.times(k))}}catch(m){d=!0,e=m}finally{try{c||null==g["return"]||g["return"]();
}finally{if(d)throw e}}return b},qubitDensityMatrixToBlochVector:function(){var a,c;if(2!==this._width||2!==this._height)throw new b("Need a 2x2 density matrix.",this);
if(!this.isApproximatelyHermitian(.01))throw new b("Density matrix should be Hermitian.",this);if(!this.trace().isApproximatelyEqualTo(1,.01))throw new b("Density matrix should have unit trace.",this);
var d=this._buffer,e=(a=d[Symbol.iterator](),(c=a.next()).done?void 0:c.value),f=((c=a.next()).done?void 0:c.value,(c=a.next()).done?void 0:c.value),g=(c=a.next()).done?void 0:c.value,h=(c=a.next()).done?void 0:c.value,i=(c=a.next()).done?void 0:c.value,j=(c=a.next()).done?void 0:c.value,k=((c=a.next()).done?void 0:c.value,
h+f),l=i-g,m=e-j;return[k,l,m]},determinant:function(){var b=this;g.need(this.width()===this.height(),"Must be square");var c=this.width();
return 1===c?this.cell(0,0):f.range(c).map(function(a){var e=d.generate(c-1,c-1,function(c,d){return b.cell(d+(d<a?0:1),c+1)});return e.determinant().times(b.cell(a,0)).times(Math.pow(-1,a));
}).aggregate(a.ZERO,function(a,b){return a.plus(b)})},_2x2Breakdown:function(){return[new a(this._buffer[0],this._buffer[1]),new a(this._buffer[2],this._buffer[3]),new a(this._buffer[4],this._buffer[5]),new a(this._buffer[6],this._buffer[7])];
},qubitOperationToAngleAxisRotation:function(){var b,c;g.need(2===this.width()&&2===this.height(),"Need a 2x2 matrix."),g.need(this.isUnitary(.01),"Need a unitary matrix.");
var d=this._2x2Breakdown(),f=(b=d[Symbol.iterator](),(c=b.next()).done?void 0:c.value),h=(c=b.next()).done?void 0:c.value,i=(c=b.next()).done?void 0:c.value,j=(c=b.next()).done?void 0:c.value,k=f.plus(j),l=h.plus(i).dividedBy(a.I),m=h.minus(i),n=f.minus(j).dividedBy(a.I),o=e([k,l,m,n]).maxBy(function(a){
return a.abs()}).unit().times(2),p=Math.min(1,Math.max(-1,k.dividedBy(o).real)),q=l.dividedBy(o).real,r=m.dividedBy(o).real,s=n.dividedBy(o).real,t=-2*Math.acos(p),u=Math.sqrt(q*q+r*r+s*s);
return u<1e-7?{axis:[1,0,0],angle:0,phase:o.phase()}:(q/=u,r/=u,s/=u,t<=-Math.PI&&(t+=2*Math.PI,o=o.times(-1)),q+r+s<0&&(q=-q,r=-r,
s=-s,t=-t),{axis:[q,r,s],angle:t,phase:o.phase()})},cross3:function(a){var b=this;return g.need(1===this.width()&&3===this.height(),"This isn't a 3d column vector."),
g.need(1===a.width()&&3===a.height(),"Other's not a 3d column vector."),d.generate(1,3,function(c){var d,e,f=[(c+1)%3,(c+2)%3],g=(d=f[Symbol.iterator](),
(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=b.cell(0,g).times(a.cell(0,h)),j=b.cell(0,h).times(a.cell(0,g));
return i.minus(j)})},_unordered_singularValueDecomposition_2x2:function(){var a,b,c=d.identity(2),e=this.lqDecomposition(),f=e.L,g=e.Q,h=f.cell(0,0).unit(),i=f.cell(0,1).unit();
c._inline_colScale_postMultiply(0,h),c._inline_colScale_postMultiply(1,i),f._inline_rowScale_preMultiply(0,h.conjugate()),f._inline_rowScale_preMultiply(1,i.conjugate());
var j=f.cell(1,1).unit();f._inline_colScale_postMultiply(1,j.conjugate()),g._inline_rowScale_preMultiply(1,j);var k=f._buffer,l=(a=k[Symbol.iterator](),
(b=a.next()).done?void 0:b.value),m=(a.next(),(b=a.next()).done?void 0:b.value),n=(a.next(),(b=a.next()).done?void 0:b.value),o=(a.next(),
(b=a.next()).done?void 0:b.value),p=l+o,q=m+n,r=m-n,s=l-o,t=Math.atan2(q,p)/2,u=Math.atan2(r,s)/2,v=Math.sqrt(p*p+q*q)/2,w=Math.sqrt(s*s+r*r)/2;
return c._inline_colMix_postMultiply(0,1,d.rotation(t-u)),g._inline_rowMix_preMultiply(0,1,d.rotation(t+u)),f=d.square(v+w,0,0,v-w),
{U:c,S:f,V:g}},_unordered_singularValueDecomposition_iterative:function(){for(var a=void 0!==arguments[0]?arguments[0]:0,b=void 0!==arguments[1]?arguments[1]:100,c=d.identity(this._width),e=this._clone(),f=d.identity(this._width),g=0;!e.isDiagonal(a)&&g++<b;){
var h=e.qrDecomposition(),i=h.Q,j=h.R,k=j.lqDecomposition(),l=k.L,m=k.Q;c=c.times(i),e=l,f=m.times(f)}return{U:c,S:e,V:f}},singularValueDecomposition:function(){
var a,c,e,g,h,i,j,k,l,m=void 0!==arguments[0]?arguments[0]:0,n=void 0!==arguments[1]?arguments[1]:100;if(this._width!==this._height)throw new b("Expected a square matrix.",this);
for(var o=2===this._width?this._unordered_singularValueDecomposition_2x2():this._unordered_singularValueDecomposition_iterative(m,n),p=o.U,q=o.S,r=o.V,s=f.range(this._width).sortedBy(function(a){
return-q.cell(a,a).norm2()}).toArray(),t=0;t<q._width;t++){var u=s[t];t!==u&&(p._inline_colMix_postMultiply(t,u,d.PAULI_X),r._inline_rowMix_preMultiply(t,u,d.PAULI_X),
a=[q._buffer[2*u],q._buffer[2*t]],q._buffer[2*t]=(c=a[Symbol.iterator](),(e=c.next()).done?void 0:e.value),q._buffer[2*u]=(e=c.next()).done?void 0:e.value,
a,g=[q._buffer[2*u+1],q._buffer[2*t+1]],q._buffer[2*t+1]=(h=g[Symbol.iterator](),(i=h.next()).done?void 0:i.value),q._buffer[2*u+1]=(i=h.next()).done?void 0:i.value,
g,j=[s[t],s[u]],s[u]=(k=j[Symbol.iterator](),(l=k.next()).done?void 0:l.value),s[t]=(l=k.next()).done?void 0:l.value,j)}for(var v=0;v<q._width;v++)p._inline_colScale_postMultiply(v,q.cell(v,v).unit());
return q=d.generateDiagonal(q._width,function(a){return q.cell(a,a).abs()}),{U:p,S:q,V:r}},getColumn:function(a){g.need(a>=0&&a<=this.width(),"colIndex >= 0 && colIndex <= this.width()");
for(var b=[],c=0;c<this._height;c++)b.push(this.cell(a,c));return b},closestUnitary:function(){var a=void 0!==arguments[0]?arguments[0]:0,b=void 0!==arguments[1]?arguments[1]:100,c=this.singularValueDecomposition(a,b);
return c.U.times(c.V)}},{fromRows:function(c){g.need(Array.isArray(c)&&c.every(Array.isArray),"array rows",c),g.need(c.length>0,"non-zero height",arguments);
var f=e(c),h=c.length,i=f.map(function(a){return a.length}).distinct().single(null);if(null===i)throw new b("Inconsistent row widths.",{
rows:c});var j=new Float64Array(i*h*2),k=0,l=!0,m=!1,n=void 0;try{for(var o=void 0,p=c[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){
var q=o.value,r=!0,s=!1,t=void 0;try{for(var u=void 0,v=q[Symbol.iterator]();!(r=(u=v.next()).done);r=!0){var w=u.value;j[k]=a.realPartOf(w),
j[k+1]=a.imagPartOf(w),k+=2}}catch(x){s=!0,t=x}finally{try{r||null==v["return"]||v["return"]()}finally{if(s)throw t}}}}catch(y){m=!0,
n=y}finally{try{l||null==p["return"]||p["return"]()}finally{if(m)throw n}}return new d(i,h,j)},parse:function(b){if(b=b.replace(/\s/g,""),
b.length<4||"{{"!==b.substr(0,2)||"}}"!==b.substr(b.length-2,2))throw new Error("Not surrounded by {{}}.");return d.fromRows(b.substr(2,b.length-4).split("},{").map(function(b){
return b.split(",").map(a.parse)}))},generate:function(b,c,e){for(var f=new Float64Array(b*c*2),g=0;g<c;g++)for(var h=0;h<b;h++){
var i=2*(g*b+h),j=e(g,h);f[i]=a.realPartOf(j),f[i+1]=a.imagPartOf(j)}return new d(b,c,f)},generateDiagonal:function(b,c){for(var e=new Float64Array(b*b*2),f=0;f<b;f++){
var g=f*(b+1)*2,h=c(f);e[g]=a.realPartOf(h),e[g+1]=a.imagPartOf(h)}return new d(b,b,e)},generateTransition:function(a,b){for(var c=new Float64Array(a*a*2),e=0;e<a;e++){
var f=b(e),g=2*(f*a+e);c[g]=1}return new d(a,a,c)},zero:function(a,b){return new d(a,b,new Float64Array(a*b*2))},solo:function(b){
return new d(1,1,new Float64Array([a.realPartOf(b),a.imagPartOf(b)]))},square:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];
g.need(Array.isArray(a),"Array.isArray(coefs)",arguments);var c=Math.round(Math.sqrt(a.length));return g.need(c*c===a.length,"Matrix.square: non-square number of arguments"),
d.generate(c,c,function(b,d){return a[b*c+d]})},col:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return g.need(Array.isArray(a),"Array.isArray(coefs)",arguments),
d.generate(1,a.length,function(b){return a[b]})},row:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return g.need(Array.isArray(a),"Array.isArray(coefs)",arguments),
d.generate(a.length,1,function(b,c){return a[c]})},fromPauliRotation:function(b,e,f){var h,i,j=function(a){return Math.abs(a)<2e-4?1-a*a/6:Math.sin(a)/a;
};b=-b*Math.PI*2,e=-e*Math.PI*2,f=-f*Math.PI*2;var k=-11*b+-13*e+-17*f>=0?1:-1,l=Math.sqrt(b*b+e*e+f*f),m=d.PAULI_X.times(b).plus(d.PAULI_Y.times(e)).plus(d.PAULI_Z.times(f)),n=g.snappedCosSin(k*l),o=(h=n[Symbol.iterator](),
(i=h.next()).done?void 0:i.value),p=(i=h.next()).done?void 0:i.value,q=new a(1+o,p).times(.5),r=new a(Math.sin(l/2)*j(l/2),-k*j(l)).times(.5*k),s=d.identity(2).times(q).minus(m.times(r)),t=function(a){
return c.simplifyByRounding(a,1e-13)};return s.transformRealAndImagComponentsWith(t)},fromWireSwap:function(a,b,c){var e=function(a){
var d=1<<b,e=1<<c,f=a&~(d|e);return 0!==(a&d)&&(f|=e),0!==(a&e)&&(f|=d),f};return d.generateTransition(1<<a,e)},identity:function(a){
if(!Number.isInteger(a)||a<=0)throw new b("Bad size",{size:a});for(var c=new Float64Array(a*a*2),e=0;e<a;e++)c[e*(a+1)*2]=1;return new d(a,a,c);
},rotation:function(a){var b=Math.cos(a),c=Math.sin(a);return d.square(b,-c,c,b)},fromAngleAxisPhaseRotation:function(b,c,e){var f,h,i,j,k=c,l=(f=k[Symbol.iterator](),
(h=f.next()).done?void 0:h.value),m=(h=f.next()).done?void 0:h.value,n=(h=f.next()).done?void 0:h.value;g.need(Math.abs(l*l+m*m+n*n-1)<1e-6,"Not a unit axis.");
var o=d.PAULI_X.times(l).plus(d.PAULI_Y.times(m)).plus(d.PAULI_Z.times(n)),p=g.snappedCosSin(-b/2),q=(i=p[Symbol.iterator](),(j=i.next()).done?void 0:j.value),r=(j=i.next()).done?void 0:j.value;
return d.identity(2).times(q).plus(o.times(new a(0,r))).times(a.polar(1,e))}})}();return h.PAULI_X=h.square(0,1,1,0),h.PAULI_Y=h.square(0,new a(0,(-1)),a.I,0),
h.PAULI_Z=h.square(1,0,0,-1),h.HADAMARD=h.square(1,1,1,-1).times(Math.sqrt(.5)),{get Matrix(){return h}}}),$traceurRuntime.registerModule("src/math/Point.js",[],function(){
"use strict";var a=function(){function a(a,b){this.x=a,this.y=b}return $traceurRuntime.createClass(a,{isEqualTo:function(b){if(!(b instanceof a))return!1;
var c=b;return c.x===this.x&&c.y===this.y},toString:function(){return"(x: "+this.x+", y: "+this.y+")"},offsetBy:function(b,c){return new a(this.x+b,this.y+c);
},plus:function(b){return new a(this.x+b.x,this.y+b.y)},minus:function(b){return new a(this.x-b.x,this.y-b.y)},times:function(b){
return new a(this.x*b,this.y*b)},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)}},{})}();return{get Point(){
return a}}}),$traceurRuntime.registerModule("src/math/Rect.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/math/Rect.js")).Point,b=function(){
function b(a,b,c,d){this.x=a,this.y=b,this.w=c,this.h=d}return $traceurRuntime.createClass(b,{isEqualTo:function(a){if(!(a instanceof b))return!1;
var c=a;return c.x===this.x&&c.y===this.y&&c.w===this.w&&c.h===this.h},isApproximatelyEqualTo:function(a,c){if(!(a instanceof b))return!1;
var d=a;return Math.abs(d.x-this.x)<=c&&Math.abs(d.y-this.y)<=c&&Math.abs(d.right()-this.right())<=c&&Math.abs(d.bottom()-this.bottom())<=c;
},toString:function(){return"["+this.x+":"+this.right()+"]x["+this.y+":"+this.bottom()+"]"},center:function(){return new a(this.x+this.w/2,this.y+this.h/2);
},topLeft:function(){return new a(this.x,this.y)},topRight:function(){return new a(this.x+this.w,this.y)},bottomLeft:function(){return new a(this.x,this.y+this.h);
},bottomRight:function(){return new a(this.x+this.w,this.y+this.h)},centerLeft:function(){return new a(this.x,this.y+this.h/2)},centerRight:function(){
return new a(this.x+this.w,this.y+this.h/2)},topCenter:function(){return new a(this.x+this.w/2,this.y)},bottomCenter:function(){return new a(this.x+this.w/2,this.y+this.h);
},right:function(){return this.x+this.w},bottom:function(){return this.y+this.h},skipLeft:function(a){var c=Math.min(a,this.w);return new b(this.x+c,this.y,this.w-c,this.h);
},skipRight:function(a){var c=Math.min(a,this.w);return new b(this.x,this.y,this.w-c,this.h)},skipTop:function(a){var c=Math.min(a,this.h);
return new b(this.x,this.y+c,this.w,this.h-c)},skipBottom:function(a){var c=Math.min(a,this.h);return new b(this.x,this.y,this.w,this.h-c);
},takeLeft:function(a){var c=Math.max(a,0);return new b(this.x,this.y,c,this.h)},takeRight:function(a){var c=Math.max(a,0);return new b(this.x+this.w-c,this.y,c,this.h);
},takeTop:function(a){var c=Math.max(a,0);return new b(this.x,this.y,this.w,c)},takeBottom:function(a){var c=Math.max(a,0);return new b(this.x,this.y+this.h-c,this.w,c);
},paddedBy:function(a){return new b(this.x-a,this.y-a,this.w+2*a,this.h+2*a)},scaledOutwardBy:function(a){var c=this.center(),d=this.w*a,e=this.h*a;
return new b(c.x-d/2,c.y-e/2,d,e)},containsPoint:function(a){return a.x>=this.x&&a.x<this.x+this.w&&a.y>=this.y&&a.y<this.y+this.h;
},takeLeftProportion:function(a){return this.takeLeft(this.w*a)},takeRightProportion:function(a){return this.takeRight(this.w*a)},
takeTopProportion:function(a){return this.takeTop(this.h*a)},takeBottomProportion:function(a){return this.takeBottom(this.h*a)},leftHalf:function(){
return this.skipRight(this.w/2)},rightHalf:function(){return this.skipLeft(this.w/2)},topHalf:function(){return this.skipBottom(this.h/2);
},bottomHalf:function(){return this.skipTop(this.h/2)},shiftedBy:function(a,c){return new b(this.x+a,this.y+c,this.w,this.h)},proportionalShiftedBy:function(a,b){
return this.shiftedBy(a*this.w,b*this.h)},withX:function(a){return new b(a,this.y,this.w,this.h)},withY:function(a){return new b(this.x,a,this.w,this.h);
},withW:function(a){return new b(this.x,this.y,a,this.h)},withH:function(a){return new b(this.x,this.y,this.w,a)},snapInside:function(a){
var c=Math.min(a.w,this.w),d=Math.min(a.h,this.h),e=Math.max(Math.min(this.x,a.right()-c),a.x),f=Math.max(Math.min(this.y,a.bottom()-d),a.y);
return new b(e,f,c,d)}},{centeredSquareWithRadius:function(a,c){return new b(a.x-c,a.y-c,2*c,2*c)}})}();return{get Rect(){return b;
}}}),$traceurRuntime.registerModule("src/ui/clear.js",[],function(){"use strict";function a(a,b){var c='{"cols":[]}',d=document.getElementById("clear-button");
a.latestActiveCommit().zipLatest(b,function(a,b){return{r:a,v:b}}).subscribe(function(a){var b=a,e=b.r,f=b.v;d.disabled=e===c||f}),
d.addEventListener("click",function(){return a.commit(c)})}return{get initClear(){return a}}}),$traceurRuntime.registerModule("src/ui/DisplayedCircuit.js",[],function(){
"use strict";function a(a,b,c,d,e){var g=new C(0,b,(void 0),(void 0),(void 0)),h=g.desiredWidth(!0),i=g.desiredHeight(!0),j=c.w/h,k=c.h/i;
if(d){var l=Math.min(j,k);j=l,k=l}var m=f.withNanDataFromCircuitAtTime(b,e);try{a.ctx.save(),a.ctx.translate(c.x,c.y),a.ctx.scale(Math.min(1,j),Math.min(1,k)),
a.ctx.translate(0,0),g.paint(a,o.EMPTY,m,!0,d)}finally{a.ctx.restore()}return{maxW:h*j,maxH:i*k}}function b(a,b){for(var c=void 0,d=void 0,e=0;e<a;e++)b(e)&&(void 0===c&&(c=e),
d=e);return[c,d]}function c(a,b,c,d,e){var f=a.ctx;f.save(),f.textAlign="left",f.textBaseline="middle",a.ctx.font="12px monospace";
var g=Math.max(a.ctx.measureText(d(0)).width,a.ctx.measureText(d(c-1)).width),h=2.5*f.measureText("0").width,i=Math.min(Math.min(e/g,b/h),1),j=b/i,k=2/i;
if(f.scale(i,i),f.translate(0,.5*b/i-.5*h),f.fillStyle="lightgray",h<.95*j)for(var l=0;l<c;l++)f.fillRect(0,j*l,g+2*k,h);else f.fillRect(0,0,g+2*k,h*c);
f.fillStyle="black";for(var m=0;m<c;m++)f.fillText(d(m),k,.5*h+j*m);f.restore()}var d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/CachablePainting.js","src/ui/DisplayedCircuit.js")).CachablePainting,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/DisplayedCircuit.js")).CircuitDefinition,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedCircuit.js")).CircuitStats,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedCircuit.js")).Config,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/DisplayedCircuit.js")).DetailedError,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Equate.js","src/ui/DisplayedCircuit.js")).equate,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/ui/DisplayedCircuit.js")).Format,k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/DisplayedCircuit.js")).GateColumn,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedCircuit.js")).GateDrawParams,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedCircuit.js")).GatePainting,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/ui/DisplayedCircuit.js")).Gates,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedCircuit.js")).Hand,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/ui/DisplayedCircuit.js")).MathPainter,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/DisplayedCircuit.js")).Point,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/ui/DisplayedCircuit.js")).Matrix,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedCircuit.js")).Rect,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/DisplayedCircuit.js")).Util,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/DisplayedCircuit.js")),v=u.seq,w=u.Seq,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/BlochSphereDisplay.js","src/ui/DisplayedCircuit.js")).paintBlochSphereDisplay,y=10,z=35,A=50,B=2,C=function(){
function a(a,b,c,d,f){if(!Number.isFinite(a))throw new h("Bad top",{top:a,circuitDefinition:b});if(!(b instanceof e))throw new h("Bad circuitDefinition",{
top:a,circuitDefinition:b});this.top=a,this.circuitDefinition=b,this._compressedColumnIndex=c,this._highlightedSlot=d,this._extraWireStartIndex=f;
}return $traceurRuntime.createClass(a,{isBeingEdited:function(){return void 0!==this._extraWireStartIndex},_groundedWireCount:function(){
var a=void 0!==this._extraWireStartIndex&&this._extraWireStartIndex!==g.MAX_WIRE_COUNT?1:0,b=Math.max(g.MIN_WIRE_COUNT,this.circuitDefinition.numWires)-a;
return Math.max(b,this.circuitDefinition.minimumRequiredWireCount())},desiredHeight:function(){var a=void 0!==arguments[0]&&arguments[0];
return a?this.circuitDefinition.numWires*g.WIRE_SPACING:this._groundedWireCount()*g.WIRE_SPACING+55},desiredWidth:function(){var a=void 0!==arguments[0]&&arguments[0];
return a?this.gateRect(1,this.circuitDefinition.columns.length).x+z:this._rectForSuperpositionDisplay().right()+101},wireRect:function(a){
if(a<0)throw new h("Bad wireIndex",{wireIndex:a});return new s(0,this.top+g.WIRE_SPACING*a,1/0,g.WIRE_SPACING)},wireIndexAt:function(a){
return Math.floor((a-this.top)/g.WIRE_SPACING)},toColumnSpaceCoordinate:function(a){var b=y+2*g.GATE_RADIUS,c=z-y/2;return(a-c)/b-.5;
},indexOfDisplayedRowAt:function(a){var b=Math.floor((a-this.top)/g.WIRE_SPACING);if(!(b<0||b>=this.circuitDefinition.numWires))return b;
},indexOfDisplayedColumnAt:function(a){var b,c=this.toColumnSpaceCoordinate(a);if(b=void 0===this._compressedColumnIndex||c<this._compressedColumnIndex-.75?Math.round(c):c<this._compressedColumnIndex-.25?this._compressedColumnIndex:Math.round(c)-1,
!(b<0||b>=this.circuitDefinition.columns.length))return b},findOpHalfColumnAt:function(a){if(!(a.x<0||a.y<this.top||a.y>this.top+this.desiredHeight()))return Math.max(-.5,Math.round(2*this.toColumnSpaceCoordinate(a.x))/2);
},_findModificationIndex_helperColRow:function(a){if(void 0!==a.pos&&void 0!==a.heldGate){var b=a.pos.minus(a.holdOffset).plus(new q(g.GATE_RADIUS,g.GATE_RADIUS)),c=this.findOpHalfColumnAt(b),d=this.indexOfDisplayedRowAt(b.y);
if(void 0!==c&&void 0!==d){var e=Math.ceil(c);return{col:e,row:d,halfColIndex:c}}}},findModificationIndex:function(a){var b=this._findModificationIndex_helperColRow(a);
if(void 0!==b){var c=b,d=c.col,e=c.row,f=c.halfColIndex,g=.5===Math.abs(f%1);if(d>=this.circuitDefinition.columns.length)return{col:d,
row:e,isInsert:g};if(!g){var h=this.circuitDefinition.isSlotRectCoveredByGateInSameColumn(d,e,a.heldGate.height);if(h){var i=a.pos.x>this.opRect(d).center().x;
g=!0,i&&(d+=1)}}return{col:d,row:e,isInsert:g}}},opRect:function(a){var b=2*g.GATE_RADIUS,c=b+y,d=0;void 0!==this._compressedColumnIndex&&a===this._compressedColumnIndex&&(d=c/2),
void 0!==this._compressedColumnIndex&&a>this._compressedColumnIndex&&(d=c);var e=c*a-d+z;return new s(e,this.top,b,this.desiredHeight());
},gateRect:function(a,b){var c=void 0!==arguments[2]?arguments[2]:1,d=void 0!==arguments[3]?arguments[3]:1,e=this.opRect(b),f=this.wireRect(a),h=new s(e.center().x-g.GATE_RADIUS,f.center().y-g.GATE_RADIUS,2*g.GATE_RADIUS+(c-1)*g.WIRE_SPACING,2*g.GATE_RADIUS+(d-1)*g.WIRE_SPACING);
return new s(Math.round(h.x-.5)+.5,Math.round(h.y-.5)+.5,Math.round(h.w),Math.round(h.h))},afterTidyingUp:function(){return this.withCircuit(this.circuitDefinition.withUncoveredColumnsRemoved().withHeightOverlapsFixed().withWidthOverlapsFixed().withUncoveredColumnsRemoved().withTrailingSpacersIncluded())._withCompressedColumnIndex(void 0)._withExtraWireStartIndex(void 0)._withHighlightedSlot(void 0);
},isEqualTo:function(b){return this===b||b instanceof a&&this.top===b.top&&this.circuitDefinition.isEqualTo(b.circuitDefinition)&&this._compressedColumnIndex===b._compressedColumnIndex&&this._extraWireStartIndex===b._extraWireStartIndex&&i(this._highlightedSlot,b._highlightedSlot);
},paint:function(a,b,c){var d=void 0!==arguments[3]&&arguments[3],e=void 0===arguments[4]||arguments[4];e&&this._drawWires(a,!d);for(var f=0;f<this.circuitDefinition.columns.length;f++)this._drawColumn(a,this.circuitDefinition.columns[f],f,b,c);
d||(this._drawOutputDisplays(a,c,b),this._drawHintLabels(a,c))},_drawWires:function(a,b){var c=this,d=Math.min(this.circuitDefinition.numWires,(this._extraWireStartIndex||1/0)+1);
if(b)for(var e=0;e<d;e++){var f=this.wireRect(e),h=f.center().y;a.print("|0⟩",20,h,"right","middle","black","14px sans-serif",20,g.WIRE_SPACING);
}a.ctx.save();for(var i=this,j=function(d){d===i._extraWireStartIndex&&(a.ctx.globalAlpha*=.5),a.trace(function(e){for(var f=c.wireRect(d),g=Math.round(f.center().y-.5)+.5,h=b?25:5,i=0;b?h<a.canvas.width:i<=c.circuitDefinition.columns.length;i++){
var j=c.opRect(i).center().x;c.circuitDefinition.locIsMeasured(new q(i,d))?(e.line(h,g-1,j,g-1),e.line(h,g+1,j,g+1)):e.line(h,g,j,g),
h=j}}).thenStroke("black")},k=0;k<d;k++)j(k);a.ctx.restore(),void 0!==this._extraWireStartIndex&&this.circuitDefinition.numWires===g.MAX_WIRE_COUNT&&a.print("(Max wires. Qubit limit is "+g.MAX_WIRE_COUNT+".)",5,this.wireRect(g.MAX_WIRE_COUNT).y,"left","top","red","16px bold monospace",400,g.WIRE_SPACING);
},_highlightStatusAt:function(a,b,c){var d=this;if(void 0!==this._highlightedSlot&&this._highlightedSlot.col===a&&this._highlightedSlot.row===b)return{
isResizeShowing:!0,isResizeHighlighted:this._highlightedSlot.resizeStyle,isHighlighted:!this._highlightedSlot.resizeStyle};var e=this.circuitDefinition.gateInSlot(a,b);
if(void 0===e||void 0!==this._highlightedSlot)return{isResizeShowing:!1,isResizeHighlighted:!1,isHighlighted:!1};var f=this.gateRect(b,a,e.width,e.height),g=m.rectForResizeTab(f),h=function(c){
var e=d.findGateOverlappingPos(c);return void 0!==e&&e.col===a&&e.row===b},i=function(c){var e=d.findGateOverlappingPos(c);return void 0===e||e.col===a&&e.row===b;
},j=function(a){return i(a)&&g.containsPoint(a)},k=e.canChangeInSize()&&v(c).any(j),l=!k&&v(c).any(h),n=e.canChangeInSize()&&(k||l);
return{isHighlighted:l,isResizeShowing:n,isResizeHighlighted:k}},_drawGate_disabledReason:function(a,b,c,d,e){var f=this.circuitDefinition.gateAtLocIsDisabledReason(b,c);
if(void 0!==f){a.ctx.save(),e&&(a.ctx.globalAlpha*=.3),a.ctx.globalAlpha*=.5,a.fillRect(d.paddedBy(5),"yellow"),a.ctx.globalAlpha*=2,
a.strokeLine(d.topLeft(),d.bottomRight(),"orange",3);var g=a.printParagraph(f,d.paddedBy(5),new q(.5,.5),"red");a.ctx.globalAlpha*=.5,
a.fillRect(g.paddedBy(2),"yellow"),a.ctx.globalAlpha*=2,a.printParagraph(f,d.paddedBy(5),new q(.5,.5),"red"),a.ctx.restore()}},_drawColumn:function(a,b,c,d,e){
this._drawColumnControlWires(a,b,c,e),this._drawColumnDragHighlight(a,c);for(var f=0;f<this.circuitDefinition.numWires;f++)if(void 0!==b.gates[f]){
var g=b.gates[f],h=this.gateRect(f,c,g.width,g.height),i=this._highlightStatusAt(c,f,d.hoverPoints()),j=i.isHighlighted,k=i.isResizeShowing,n=i.isResizeHighlighted,o=g.customDrawer||m.DEFAULT_DRAWER;
a.noteTouchBlocker({rect:h,cursor:"pointer"}),g.canChangeInSize()&&a.noteTouchBlocker({rect:m.rectForResizeTab(h),cursor:"ns-resize"
}),o(new l(a,(!1),j&&!n,k,n,h,g,e,{row:f,col:c},void 0===this._highlightedSlot?d.hoverPoints():[],e.customStatsForSlot(c,f))),this._drawGate_disabledReason(a,c,f,h,j);
}this._drawColumnSurvivalRate(a,b,c,e)},_drawColumnSurvivalRate:function(a,b,c,d){if(void 0!==b.indexOfNonUnitaryGate()){var e=d.survivalRate(c-1),f=d.survivalRate(c),g=(f-e)/e;
if(!(isNaN(g)||Math.abs(g)<=.005)){var h,i;if(g<0){var j=Math.round(100*-g),k=g===-1?"100":j<100?j:">99";h=k+"%",i="fails"}else{var l=Math.round(100*g+100);
h=l+"%",i="gain"}var m=this.opRect(c).bottomCenter();a.print(i,m.x,m.y-28,"center","bottom","red","14px sans-serif",800,50),a.print(h,m.x,m.y-13,"center","bottom","red","14px sans-serif",800,50);
}}},_drawColumnDragHighlight:function(a,b){if(void 0!==this._highlightedSlot&&this._highlightedSlot.col===b&&void 0===this._highlightedSlot.row){
var c=this.gateRect(0,b,1,this._groundedWireCount()).paddedBy(3);a.fillRect(c,"rgba(255, 196, 112, 0.7)"),a.strokeRect(c,"black");
}},_drawColumnControlWires_helper:function(a,c,d,e,f,g){var h,i,j,k,l=c.gates.length,m=b(l,f),n=(h=m[Symbol.iterator](),(i=h.next()).done?void 0:i.value),o=(i=h.next()).done?void 0:i.value,p=b(l,g),r=(j=p[Symbol.iterator](),
(k=j.next()).done?void 0:k.value),s=(k=j.next()).done?void 0:k.value;if(void 0!==r&&void 0!==n){var t=this.wireRect(Math.min(n,r)).center().y,u=this.wireRect(Math.max(o,s)).center().y;
e?(a.strokeLine(new q(d+1,t),new q(d+1,u)),a.strokeLine(new q(d-1,t),new q(d-1,u))):a.strokeLine(new q(d,t),new q(d,u))}},_drawColumnControlWires:function(a,b,c,d){
var e=this,f=b.gates,g=d.circuitDefinition,h=Math.round(this.opRect(c).center().x-.5)+.5;void 0!==g.columns[c].indexOfNonUnitaryGate()&&(a.ctx.save(),
a.ctx.setLineDash([1,4]),a.strokeLine(new q(h,this.gateRect(0,0).y),new q(h,this.opRect(0).bottom()-40)),a.ctx.restore());var i=g.colHasEnabledSwapGate(c),j=function(a){
return new q(c,a)},k=function(a){return g.locHasControllableGate(j(a))},l=function(a){return e.circuitDefinition.locStartsSingleControlWire(j(a));
},m=function(a){return e.circuitDefinition.locStartsDoubleControlWire(j(a))},o=function(a){return i&&f[a]===n.Special.SwapHalf},p=function(a){
return g.locClassifyMeasuredIncludingGateExtension(j(a))!==!0},r=function(a){return g.locClassifyMeasuredIncludingGateExtension(j(a))!==!1;
};this._drawColumnControlWires_helper(a,b,h,!1,k,l),this._drawColumnControlWires_helper(a,b,h,!0,k,m),this._drawColumnControlWires_helper(a,b,h,!1,o,o);
var s=!0,t=!1,u=void 0;try{for(var v=this,w=function(){var c=x.value,d=function(a){return g.locProvidesStat(j(a),c)},e=function(a){
return g.locNeedsStat(j(a),c)};v._drawColumnControlWires_helper(a,b,h,!1,function(a){return d(a)&&p(a)},e),v._drawColumnControlWires_helper(a,b,h,!0,function(a){
return d(a)&&r(a)},e)},x=void 0,y=["Input Range A","Input Range B"][Symbol.iterator]();!(s=(x=y.next()).done);s=!0)w()}catch(z){t=!0,
u=z}finally{try{s||null==y["return"]||y["return"]()}finally{if(t)throw u}}},previewDrop:function(a){return void 0!==a.heldColumn?this._previewDropMovedGateColumn(a):void 0!==a.heldGate?this._previewDropMovedGate(a):this._previewResizedGate(a);
},_previewDropMovedGateColumn:function(a){if(void 0===a.pos)return this;var b=this.findOpHalfColumnAt(new q(a.pos.x,this.top)),c=b%1===0&&void 0!==this.circuitDefinition.columns[b]&&!this.circuitDefinition.columns[b].isEmpty();
if(c){var d=a.pos.x>this.opRect(b).center().x;b+=d?.5:-.5}var e=Math.ceil(b),f=b%1!==0,h=Math.round((a.pos.y-a.holdOffset.y-this.top)/g.WIRE_SPACING),i=this._shiftAndSpliceColumn(h,$traceurRuntime.spread(a.heldColumn.gates),e,f);
return this.withCircuit(i)._withHighlightedSlot({row:void 0,col:e,resizeStyle:!1})._withCompressedColumnIndex(f?e:void 0)},_shiftAndSpliceColumn:function(a,b,c,d){
for(;a<0&&void 0===b[0];)b.shift(),b.push(void 0),a+=1;for(;a>0&&new k(b).minimumRequiredWireCount()<g.MAX_WIRE_COUNT;)b.unshift(void 0),
new k(b).minimumRequiredWireCount()<b.length&&b.pop(),a-=1;for(var e=this.circuitDefinition.withWireCount(b.length),f=$traceurRuntime.spread(e.columns);f.length<c;)f.push(k.empty(e.numWires));
return f.splice(c,d?0:1,new k(b)),e.withColumns(f).withTrailingSpacersIncluded()},_previewDropMovedGate:function(a){var b=this.findModificationIndex(a);
if(void 0===b)return this;var c=Math.floor(a.holdOffset.y/g.WIRE_SPACING);if(b.row+c>=this.circuitDefinition.numWires)return this;
var d=a.heldGate,e=k.empty(this.circuitDefinition.numWires),f=b.col,h=b.isInsert,i=Math.min(b.row,Math.max(0,g.MAX_WIRE_COUNT-d.height)),j=v(this.circuitDefinition.columns).padded(f,e).ifThen(h,function(a){
return a.withInsertedItem(f,e)}).padded(f+d.width,e).withTransformedItem(f,function(a){return a.withGatesAdded(i,new k([d]))}).toArray(),l=Math.max(this._extraWireStartIndex||0,Math.max(this.circuitDefinition.numWires,d.height+i));
if(l>g.MAX_WIRE_COUNT)return this;var m=this.circuitDefinition.withColumns(j).withWireCount(l);return this.withCircuit(m)._withHighlightedSlot({
row:i,col:b.col,resizeStyle:!1})._withCompressedColumnIndex(h?f:void 0)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires);
},_previewResizedGate:function(a){if(void 0===a.resizingGateSlot||void 0===a.pos)return this;var b=this.circuitDefinition.gateInSlot(a.resizingGateSlot.x,a.resizingGateSlot.y);
if(void 0===b)return this;var c=Math.min(this.wireIndexAt(a.pos.y-a.holdOffset.y),g.MAX_WIRE_COUNT-1),d=v(b.gateFamily).minBy(function(b){
return Math.abs(b.height-(c-a.resizingGateSlot.y+1))}),e=Math.min(g.MAX_WIRE_COUNT,Math.max(this.circuitDefinition.numWires,d.height+a.resizingGateSlot.y)),f=v(this.circuitDefinition.columns).withTransformedItem(a.resizingGateSlot.x,function(b){
return new k(v(b.gates).withOverlayedItem(a.resizingGateSlot.y,d).toArray())}).toArray(),h=this.circuitDefinition.withColumns(f).withWireCount(e),i=h.withHeightOverlapsFixed(),j=i.withTrailingSpacersIncluded();
return this.withCircuit(j)._withHighlightedSlot(this._highlightedSlot)._withCompressedColumnIndex(h.isEqualTo(i)?void 0:a.resizingGateSlot.x+1)._withFallbackExtraWireStartIndex(this.circuitDefinition.numWires);
},afterDropping:function(a){return this.previewDrop(a)._withCompressedColumnIndex(void 0)},withCircuit:function(b){return new a(this.top,b,this._compressedColumnIndex,this._highlightedSlot,this._extraWireStartIndex);
},_withCompressedColumnIndex:function(b){return new a(this.top,this.circuitDefinition,b,this._highlightedSlot,this._extraWireStartIndex);
},_withHighlightedSlot:function(b){return new a(this.top,this.circuitDefinition,this._compressedColumnIndex,b,this._extraWireStartIndex);
},_withExtraWireStartIndex:function(b){return new a(this.top,this.circuitDefinition,this._compressedColumnIndex,this._highlightedSlot,b);
},_withFallbackExtraWireStartIndex:function(a){return this._withExtraWireStartIndex(this._extraWireStartIndex||a)},withJustEnoughWires:function(a,b){
var c=void 0!==a.heldGate?a.heldGate.height:0,d=this.circuitDefinition.minimumRequiredWireCount(),e=Math.min(g.MAX_WIRE_COUNT,Math.max(Math.min(1,c),Math.max(g.MIN_WIRE_COUNT,d)+b));
return this.withCircuit(this.circuitDefinition.withWireCount(e))._withExtraWireStartIndex(0===b?void 0:this.circuitDefinition.numWires);
},findGateOverlappingPos:function(a){var b=this.indexOfDisplayedColumnAt(a.x),c=this.indexOfDisplayedRowAt(a.y);if(void 0!==b&&void 0!==c){
var d=this.circuitDefinition.findGateCoveringSlot(b,c);if(void 0!==d){var e=this.gateRect(d.row,d.col,d.gate.width,d.gate.height);
if(e.containsPoint(a))return{col:d.col,row:d.row,offset:a.minus(e.topLeft())}}}},tryGrab:function(a){var b=void 0!==arguments[1]&&arguments[1],c=void 0!==arguments[2]&&arguments[2];
if(c)return this._tryGrabWholeColumn(a,b)||{newCircuit:this,newHand:a};var d=this._tryGrabResizeTab(a)||{newCircuit:this,newHand:a
},e=d.newCircuit,f=d.newHand;return e._tryGrabGate(f,b)||{newCircuit:e,newHand:f}},_tryGrabGate:function(b){var c=void 0!==arguments[1]&&arguments[1];
if(!b.isBusy()&&void 0!==b.pos){var d=this.findGateOverlappingPos(b.pos);if(void 0!==d){var e=d,f=e.col,g=e.row,h=e.offset,i=this.circuitDefinition.columns[f].gates[g],j=v(this.circuitDefinition.columns[f].gates).toArray();
c||(j[g]=void 0);var l=v(this.circuitDefinition.columns).withOverlayedItem(f,new k(j)).toArray();return{newCircuit:new a(this.top,this.circuitDefinition.withColumns(l),(void 0),(void 0),this._extraWireStartIndex),
newHand:b.withHeldGate(i,h)}}}},_tryGrabResizeTab:function(a){if(!a.isBusy()&&void 0!==a.pos)for(var b=0;b<this.circuitDefinition.columns.length;b++)for(var c=0;c<this.circuitDefinition.numWires;c++){
var d=this.circuitDefinition.columns[b].gates[c];if(void 0!==d){var e=this._highlightStatusAt(b,c,a.hoverPoints()).isResizeHighlighted;
if(e){var f=a.pos.minus(this.gateRect(c+d.height-1,b,1,1).center());return{newCircuit:this._withHighlightedSlot({col:b,row:c,resizeStyle:!0
}),newHand:a.withResizeSlot(new q(b,c),f)}}}}},_tryGrabWholeColumn:function(a,b){if(!a.isBusy()&&void 0!==a.pos){var c=Math.round(this.toColumnSpaceCoordinate(a.pos.x));
if(!(c<0||c>=this.circuitDefinition.columns.length||this.circuitDefinition.columns[c].isEmpty())){var d=$traceurRuntime.spread(this.circuitDefinition.columns);
b||d.splice(c,1,k.empty(this.circuitDefinition.numWires));var e=new q(0,this.wireIndexAt(a.pos.y)*g.WIRE_SPACING+g.WIRE_SPACING/2);
return{newCircuit:this.withCircuit(this.circuitDefinition.withColumns(d)),newHand:a.withHeldGateColumn(this.circuitDefinition.columns[c],e)
}}}},stableDuration:function(){return this.circuitDefinition.stableDuration()},importantWireCount:function(){return Math.max(this.circuitDefinition.numWires-(this._extraWireStartIndex===g.MAX_WIRE_COUNT?0:1),g.MIN_WIRE_COUNT,this.circuitDefinition.minimumRequiredWireCount());
},_drawOutputDisplays:function(a,b,c){for(var d=this.clampedCircuitColCount()+1,e=d+1,f=this.importantWireCount(),g=0;g<f;g++){var h=b.controlledWireProbabilityJustAfter(g,1/0);
p.paintProbabilityBox(a,h,this.gateRect(g,d),c.hoverPoints());var i=b.qubitDensityMatrix(1/0,g);void 0!==i&&x(a,i,this.gateRect(g,e),c.hoverPoints());
}var j=this.wireRect(f-1).bottom(),k=this.opRect(d-1).x;a.printParagraph("Local wire states\n(Chance/Bloch)",new s(k,j+4,190,40),new q(.5,0),"gray"),
this._drawOutputSuperpositionDisplay(a,b,c)},clampedCircuitColCount:function(){return Math.max(this.circuitDefinition.columns.length,g.MIN_COL_COUNT+(void 0!==this._compressedColumnIndex?1:0));
},_drawOutputSuperpositionDisplay:function(a,b,c){var d=this._outputStateAsMatrix(b),e=this._rectForSuperpositionDisplay(),f=this.importantWireCount();
p.paintMatrix(a,d,e,f<g.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?g.SUPERPOSITION_MID_COLOR:void 0,"black",f<g.SIMPLE_SUPERPOSITION_DRAWING_WIRE_THRESHOLD?g.SUPERPOSITION_FORE_COLOR:void 0,g.SUPERPOSITION_BACK_COLOR);
var h=function(a){return(a>=0?"+":"")+a.toFixed(2)};p.paintMatrixTooltip(a,d,e,c.hoverPoints(),function(a,b){return"Amplitude of |"+t.bin(b*d.width()+a,f)+"⟩";
},function(a,b,c){return"val:"+c.toString(new j((!1),0,5,", "))},function(a,b,c){return"mag²:"+(100*c.norm2()).toFixed(4)+"%, phase:"+h(180*c.phase()/Math.PI)+"°";
}),this._drawOutputSuperpositionDisplay_labels(a)},_drawOutputSuperpositionDisplay_labels:function(a){var b=this._rectForSuperpositionDisplay(),c=this.importantWireCount();
E.paint(b.right(),b.y,a,c),F.paint(b.x,b.bottom(),a,c)},_outputStateAsMatrix:function(a){var b,c,d,e,f=this.importantWireCount(),g=a.finalState.rawBuffer();
if(a.circuitDefinition.numWires!==f){var h=new Float32Array(2<<f);h.set(g.slice(0,h.length)),g=h}var i=[Math.floor(f/2),Math.ceil(f/2)],j=(b=i[Symbol.iterator](),
(c=b.next()).done?void 0:c.value),k=(c=b.next()).done?void 0:c.value,l=[1<<j,1<<k],m=(d=l[Symbol.iterator](),(e=d.next()).done?void 0:e.value),n=(e=d.next()).done?void 0:e.value;
return new r(m,n,g)},_rectForSuperpositionDisplay:function(){var a,b,c,d,e=this.clampedCircuitColCount()+B+1,f=this.importantWireCount(),g=[Math.floor(f/2),Math.ceil(f/2)],h=(a=g[Symbol.iterator](),
(b=a.next()).done?void 0:b.value),i=(b=a.next()).done?void 0:b.value,j=[1<<h,1<<i],k=(c=j[Symbol.iterator](),(d=c.next()).done?void 0:d.value),l=(d=c.next()).done?void 0:d.value,m=this.gateRect(0,e),n=this.gateRect(f-1,e),o=new s(m.x,m.y,0,n.bottom()-m.y);
return o.withW(o.h*(k/l))},_drawHintLabels:function(a,b){var c=this._rectForSuperpositionDisplay();a.print("Final amplitudes",c.right()+3,c.bottom()+3,"left","top","gray","12px sans-serif",100,20),
0!==this.circuitDefinition.colIsMeasuredMask(1/0)&&a.printParagraph("(assuming measurement deferred)",new s(c.right()+3,c.bottom()+20,100,75),new q(.5,0),"red");
var d=b.survivalRate(1/0);if(Math.abs(d-1)>.01){var e;if(d<1){var f=Math.round(100*d),g=0===d?"0":f>0?f:"<1";e="Survival rate: "+g+"%";
}else{var h=Math.round(100*d);e="Over-unity: "+h+"%"}a.print(e,this._rectForSuperpositionDisplay().x-5,c.bottom()+A,"right","bottom","red","14px sans-serif",800,50);
}}},{empty:function(b){return new a(b,new e(g.MIN_WIRE_COUNT,[]),(void 0),(void 0),(void 0))},fromTextDiagram:function(b,c){var d=c.split("\n").map(function(a){
var d=a.split("|");if(2!==d.length)throw new h("Bad diagram",{diagramText:c,gateMap:b});return d[1]}),f=v(d).skip(1).stride(2).map(function(a){
return v(a).skip(1).stride(2).join("")}).join("\n"),i=10,j=new a(i,e.fromTextDiagram(b,f),(void 0),(void 0),(void 0)),k=w.naturals().takeWhile(function(a){
return c.indexOf(a)!==-1}).map(function(a){var b=v(d).mapWithIndex(function(b,c){return{row:c,col:b.indexOf(a)}}).filter(function(a){
return a.col!==-1}).single();return"^"===d[b.row][b.col+1]&&(b.row-=1,b.col+=1),new q(b.col*g.WIRE_SPACING/2+35.5,b.row*g.WIRE_SPACING/2+10.5);
}).toArray();return{circuit:j,pts:k}}})}(),D=function(b){var c=b.gate.knownCircuit;if(void 0===c||""!==b.gate.symbol)return void(b.gate.stableDuration()===1/0?m.DEFAULT_DRAWER(b):m.makeCycleDrawer()(b));
var d=b.gate.stableDuration()===1/0?g.GATE_FILL_COLOR:g.TIME_DEPENDENT_HIGHLIGHT_COLOR;m.paintBackground(b,d),a(b.painter,b.gate.knownCircuitNested,b.rect,!1,b.stats.time),
m.paintOutline(b),b.isHighlighted&&(b.painter.ctx.save(),b.painter.ctx.globalAlpha*=.9,b.painter.fillRect(b.rect,g.HIGHLIGHTED_GATE_FILL_COLOR),
b.painter.ctx.restore()),m.paintOutline(b)},E=new d(function(a){return{width:A,height:(a-1)*g.WIRE_SPACING+2*g.GATE_RADIUS}},function(a,b){
var d,e,f=[Math.floor(b/2),Math.ceil(b/2)],g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=1<<h,j=g<4?"_".repeat(g):"_..";
c(a,a.canvas.height/i,i,function(a){return t.bin(a,h)+j},A)}),F=new d(function(a){var b,c,d,e,f=[Math.floor(a/2),Math.ceil(a/2)],h=(b=f[Symbol.iterator](),
(c=b.next()).done?void 0:c.value),i=(c=b.next()).done?void 0:c.value,j=[1<<h,1<<i],k=(d=j[Symbol.iterator](),(e=d.next()).done?void 0:e.value),l=(e=d.next()).done?void 0:e.value,m=(a-1)*g.WIRE_SPACING+2*g.GATE_RADIUS,n=m/l;
return{width:k*n,height:A}},function(a,b){var d,e,f=[Math.floor(b/2),Math.ceil(b/2)],g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=1<<g,j=a.canvas.width/i;
a.ctx.translate(i*j,0),a.ctx.rotate(Math.PI/2);var k=h<4?"_".repeat(h):".._";c(a,j,i,function(a){return k+t.bin(i-1-a,h)},A)});return{
get DisplayedCircuit(){return C},get drawCircuitTooltip(){return a},get GATE_CIRCUIT_DRAWER(){return D}}}),$traceurRuntime.registerModule("src/ui/DisplayedInspector.js",[],function(){
"use strict";var a=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/DisplayedInspector.js")).CircuitDefinition,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedInspector.js")).CircuitStats,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedInspector.js")).Config),b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/ui/DisplayedInspector.js")).DisplayedCircuit,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedToolbox.js","src/ui/DisplayedInspector.js")).DisplayedToolbox,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedInspector.js")).GateDrawParams,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedInspector.js")).GatePainting,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/AllGates.js","src/ui/DisplayedInspector.js")).Gates,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedInspector.js")).Hand,h=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/DisplayedInspector.js")).Painter,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedInspector.js")).Rect),i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/DisplayedInspector.js")).Serializer,j=function(){
function j(a,b,c,d,e){this.displayedCircuit=b,this.displayedToolboxTop=c,this.displayedToolboxBottom=d.withCustomGatesInserted(b.circuitDefinition.customGateSet),
this.hand=e,this.drawArea=new h(0,0,0,0),this.updateArea(a)}return $traceurRuntime.createClass(j,{desiredWidth:function(){return Math.max(this.displayedToolboxTop.desiredWidth(),Math.max(this.displayedCircuit.desiredWidth(),this.displayedToolboxBottom.desiredWidth()));
},updateArea:function(a){this.drawArea=a,this.displayedToolboxTop=this.displayedToolboxTop.withTop(0),this.displayedToolboxBottom=this.displayedToolboxBottom.withTop(this.drawArea.bottom()-this.displayedToolboxBottom.desiredHeight());
},paint:function(b,c){b.fillRect(this.drawArea,a.BACKGROUND_COLOR),this.displayedToolboxTop.paint(b,c,this.hand),this.displayedToolboxBottom.paint(b,c,this.hand),
this.displayedCircuit.paint(b,this.hand,c),this._paintHand(b,c),this._drawHint(b)},_paintHand:function(b,c){if(void 0!==this.hand.pos&&void 0!==this.hand.heldGate){
var f=this.hand.heldGate,g=this.hand.pos.minus(this.hand.holdOffset),i=new h(Math.round(g.x-.5)+.5,Math.round(g.y-.5)+.5,2*a.GATE_RADIUS+a.WIRE_SPACING*(f.width-1),2*a.GATE_RADIUS+a.WIRE_SPACING*(f.height-1)),j=f.customDrawer||e.DEFAULT_DRAWER;
j(new d(b,(!1),(!0),(!0),(!1),i,f,c,(void 0),[],(void 0)))}},afterGrabbing:function(){var a=void 0!==arguments[0]&&arguments[0],b=void 0!==arguments[1]&&arguments[1],c=this.hand,d=this.displayedCircuit;
c=this.displayedToolboxTop.tryGrab(c),c=this.displayedToolboxBottom.tryGrab(c);var e=d.tryGrab(c,a,b);return c=e.newHand,d=e.newCircuit,
new j(this.drawArea,d,this.displayedToolboxTop,this.displayedToolboxBottom,c)},isEqualTo:function(a){return this===a||a instanceof j&&this.drawArea.isEqualTo(a.drawArea)&&this.displayedCircuit.isEqualTo(a.displayedCircuit)&&this.displayedToolboxTop.isEqualTo(a.displayedToolboxTop)&&this.displayedToolboxBottom.isEqualTo(a.displayedToolboxBottom)&&this.hand.isEqualTo(a.hand);
},withDisplayedCircuit:function(a){return a===this.displayedCircuit?this:new j(this.drawArea,a,this.displayedToolboxTop,this.displayedToolboxBottom,this.hand);
},withJustEnoughWires:function(a,b){return this.withDisplayedCircuit(this.displayedCircuit.withJustEnoughWires(a,b))},afterTidyingUp:function(){
return this.withDisplayedCircuit(this.displayedCircuit.afterTidyingUp())},previewDrop:function(){if(!this.hand.isBusy())return this;
var a=this.hand,b=this.displayedCircuit,c=b.previewDrop(a),d=c===b?a:a.withDrop();return this.withHand(d).withDisplayedCircuit(c);
},afterDropping:function(){return this.withDisplayedCircuit(this.displayedCircuit.afterDropping(this.hand)).withHand(this.hand.withDrop());
},stableDuration:function(){return Math.min(this.displayedToolboxTop.stableDuration(this.hand),this.displayedToolboxBottom.stableDuration(this.hand),this.hand.stableDuration(),this.displayedCircuit.stableDuration());
},withHand:function(a){return new j(this.drawArea,this.displayedCircuit,this.displayedToolboxTop,this.displayedToolboxBottom,a)},
withCircuitDefinition:function(a){return new j(this.drawArea,b.empty(this.displayedToolboxTop.desiredHeight()).withCircuit(a),this.displayedToolboxTop,this.displayedToolboxBottom,this.hand.withDrop());
},desiredHeight:function(){var b=this.displayedToolboxBottom.desiredHeight()+this.displayedToolboxTop.desiredHeight()+this.displayedCircuit.desiredHeight();
return Math.max(a.MINIMUM_CANVAS_HEIGHT,b)},snapshot:function(){return JSON.stringify(i.toJson(this.displayedCircuit.circuitDefinition),null,0);
},_drawHint:function(a){this._drawHint_dragGatesOntoCircuit(a),this._drawHint_watchOutputsChange(a),this._drawHint_useControls(a);
},_watchOutputsChangeVisibility:function(){var a=this.displayedCircuit.circuitDefinition.countGatesUpTo(2),b=a+(this.hand.isBusy()?1:0);
if(a>=2||0===b)return 0;var c=void 0===this.hand.pos?1/0:this.hand.pos.y;return 0===a?(c-125)/25:2===b?(150-c)/25:1},_drawHint_watchOutputsChange:function(a){
var b=this._watchOutputsChangeVisibility();b<=0||(a.ctx.save(),a.ctx.globalAlpha*=Math.min(1,b),a.ctx.translate(this.displayedCircuit.opRect(this.displayedCircuit.clampedCircuitColCount()).x-280,15),
a.ctx.save(),a.ctx.translate(268,250),a.ctx.rotate(.02*Math.PI),a.ctx.fillStyle="red",a.ctx.textAlign="right",a.ctx.font="16px sans-serif",
a.ctx.fillText("outputs change",0,0),a.ctx.restore(),a.ctx.beginPath(),a.ctx.moveTo(270,245),a.ctx.bezierCurveTo(300,245,315,235,325,225),
a.ctx.strokeStyle="red",a.ctx.lineWidth=3,a.ctx.stroke(),a.trace(function(a){a.arrowHead(330,219,10,Math.PI*-.265,1.3)}).thenFill("red"),
a.ctx.restore())},_drawHint_dragGatesOntoCircuit:function(a){if(!this.displayedCircuit.circuitDefinition.hasNonControlGates()){var b=void 0!==this.hand.pos&&this.hand.isBusy()?void 0!==this.hand.heldGate&&this.hand.heldGate.isControl()?1:(150-this.hand.pos.y)/50:1;
b<=0||(a.ctx.save(),a.ctx.globalAlpha*=Math.min(1,b),a.ctx.save(),a.ctx.translate(70,190),a.ctx.rotate(.05*Math.PI),a.ctx.fillStyle="red",
a.ctx.font="16px sans-serif",a.ctx.fillText("drag gates onto circuit",0,0),a.ctx.restore(),a.ctx.beginPath(),a.ctx.moveTo(268,132),
a.ctx.bezierCurveTo(260,170,235,175,217,187),a.ctx.strokeStyle="red",a.ctx.lineWidth=3,a.ctx.stroke(),a.trace(function(a){a.arrowHead(210,190,10,.84*Math.PI,1.3);
}).thenFill("red"),a.ctx.restore())}},_useControlsHintVisibility:function(){var a=this.displayedCircuit.circuitDefinition,b=a.countGatesUpTo(2),c=b+(void 0!==this.hand.heldGate?1:0),d=a.gateInSlot(0,0);
return a.hasControls()||!a.hasNonControlGates()||void 0!==d&&d.height>1?0:1!==b||1!==c||this.displayedCircuit.isBeingEdited()?1===b&&2===c&&this.displayedCircuit.isBeingEdited()?(150-this.hand.pos.y)/50:0:1;
},_drawHint_useControls:function(a){var b=this._useControlsHintVisibility();if(!(b<=0)){a.ctx.save(),a.ctx.globalAlpha*=Math.min(1,b);
var c=void 0===this.displayedCircuit.circuitDefinition.gateInSlot(0,0),d=c?173:223;a.ctx.save(),a.ctx.translate(70,d-3),a.ctx.rotate(Math.PI*-.01),
a.ctx.fillStyle="red",a.ctx.font="16px sans-serif",a.ctx.fillText("use controls",0,0),a.ctx.restore(),a.ctx.beginPath(),c?(a.ctx.moveTo(90,125),
a.ctx.bezierCurveTo(60,140,48,160,55,d)):(a.ctx.moveTo(100,125),a.ctx.bezierCurveTo(115,150,105,170,55,d)),a.ctx.strokeStyle="red",
a.ctx.lineWidth=3,a.ctx.stroke(),a.ctx.beginPath(),a.ctx.arc(55,d,5,0,2*Math.PI),a.ctx.fillStyle="red",a.ctx.fill(),a.ctx.restore();
}}},{empty:function(a){var d=new c("Toolbox",0,f.TopToolboxGroups,(!0)),e=b.empty(d.desiredHeight()),h=new c("Toolbox₂",e.top+e.desiredHeight(),f.BottomToolboxGroups,(!1));
return new j(a,e,d,h,g.EMPTY)}})}();return{get DisplayedInspector(){return j}}}),$traceurRuntime.registerModule("src/ui/DisplayedToolbox.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/CachablePainting.js","src/ui/DisplayedToolbox.js")).CachablePainting,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/DisplayedToolbox.js")).CircuitStats,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/DisplayedToolbox.js")).Config,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GateDrawParams.js","src/ui/DisplayedToolbox.js")).GateDrawParams,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/GatePainting.js","src/ui/DisplayedToolbox.js")).GatePainting,f=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/Hand.js","src/ui/DisplayedToolbox.js")).Hand,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/gates/Joke_MysteryGate.js","src/ui/DisplayedToolbox.js"))),g=f.MysteryGateSymbol,h=f.MysteryGateMaker,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/DisplayedToolbox.js")).Rect,j=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/DisplayedToolbox.js")).Painter,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/DisplayedToolbox.js")).Point),k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/DisplayedToolbox.js")).seq,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/WidgetPainter.js","src/ui/DisplayedToolbox.js")).WidgetPainter,m=function(){
function f(b,c,d,e){var f=arguments[4],g=arguments[5],h=this;this.name=b,this.top=c,this.toolboxGroups=d,this.labelsOnTop=e,this._originalGroups=f||this.toolboxGroups,
this._standardApperance=g||new a(function(){return{width:h.desiredWidth(),height:h.desiredHeight()}},function(a){a.ctx.save(),a.ctx.translate(0,-h.top),
h._paintStandardContents(a),a.ctx.restore()})}return $traceurRuntime.createClass(f,{withCustomGatesInserted:function(a){for(var b=$traceurRuntime.spread(this._originalGroups),c=0;c<Math.max(1,a.gates.length);c+=6){
for(var d={hint:"Custom Gates",gates:[void 0,void 0,void 0,void 0,void 0,void 0]},e=0;e<6&&c+e<a.gates.length;e++)d.gates[e]=a.gates[c+e];
b.push(d)}return new f(this.name,this.top,b,this.labelsOnTop,this._originalGroups,this._standardApperance)},gateDrawRect:function(a,b){
var d=b%2,e=Math.floor(b/2),f=c.TOOLBOX_MARGIN_X+d*c.TOOLBOX_GATE_SPAN+a*c.TOOLBOX_GROUP_SPAN,g=this.top+(this.labelsOnTop?c.TOOLBOX_MARGIN_Y:3)+e*c.TOOLBOX_GATE_SPAN;
return new i(Math.round(f-.5)+.5,Math.round(g-.5)+.5,2*c.GATE_RADIUS,2*c.GATE_RADIUS)},groupLabelRect:function(a){if(this.labelsOnTop){
var b=this.gateDrawRect(a,0),d=new j(b.x+c.TOOLBOX_GATE_SPAN-c.TOOLBOX_GATE_SPACING/2,b.y-18);return new i(d.x-c.TOOLBOX_GATE_SPAN,d.y,2*c.TOOLBOX_GATE_SPAN,20);
}var e=this.gateDrawRect(a,4),f=new j(e.x+c.TOOLBOX_GATE_SPAN-c.TOOLBOX_GATE_SPACING/2,e.bottom());return new i(f.x-c.TOOLBOX_GATE_SPAN,f.y+2,2*c.TOOLBOX_GATE_SPAN,20);
},findGateAt:function(a){if(void 0!==a)for(var b=0;b<this.toolboxGroups.length;b++)for(var c=this.toolboxGroups[b],d=0;d<c.gates.length;d++){
var e=c.gates[d],f=this.gateDrawRect(b,d);if(void 0!==e&&f.containsPoint(a))return{groupIndex:b,gateIndex:d,gate:e,rect:f}}},isEqualTo:function(a){
return a instanceof f&&this.name===a.name&&this.top===a.top&&this.toolboxGroups===a.toolboxGroups&&this.labelsOnTop===a.labelsOnTop;
},withTop:function(a){return new f(this.name,a,this.toolboxGroups,this.labelsOnTop,this._originalGroups,this._standardApperance)},
curArea:function(a){return new i(0,this.top,a,this.desiredHeight())},paint:function(a,b,d){a.fillRect(this.curArea(a.canvas.width),c.BACKGROUND_COLOR_TOOLBOX),
this._standardApperance.paint(0,this.top,a),this._paintDeviations(a,b,d)},_paintStandardContents:function(a){for(var b=0;b<this.toolboxGroups.length;b++)this._paintGatesInGroup(a,b);
var d=this.curArea(c.TOOLBOX_MARGIN_X),e=d.center(),f=e.x,g=e.y;a.ctx.save(),a.ctx.translate(f,g),a.ctx.rotate(-Math.PI/2),a.printLine(this.name,new i(-d.h/2,-d.w/2,d.h,d.w),.5,"black",24),
a.ctx.restore()},_paintDeviations:function(a,b,c){for(var d=0;d<this.toolboxGroups.length;d++){d>=this._originalGroups.length&&this._paintGatesInGroup(a,d);
for(var e=this.toolboxGroups[d],f=0;f<e.gates.length;f++)void 0!==e.gates[f]&&a.noteTouchBlocker({rect:this.gateDrawRect(d,f),cursor:"pointer"
})}this._paintFocus(a,b,c)},_paintGatesInGroup:function(a,c){var d=this.toolboxGroups[c],e=this.groupLabelRect(c);a.print(d.hint,e.x+e.w/2,e.y+e.h/2,"center","middle","black","16px sans-serif",e.w,e.h);
for(var g=0;g<d.gates.length;g++){var h=d.gates[g];if(void 0!==h){var i=this.gateDrawRect(c,g);f._paintGate(a,h,i,!1,b.EMPTY)}}},
_paintFocus:function(a,b,c){var d=this.findGateAt(c.pos);if(void 0!==d&&(void 0===c.heldGate||d.gate.symbol===c.heldGate.symbol)){
f._paintGate(a,d.gate,d.rect,!0,b),a.ctx.save(),a.ctx.globalAlpha=0,a.ctx.translate(-1e4,-1e4);var e=l.paintGateTooltip(a,new i(0,0,500,300),d.gate,b.time,!0),g=e.maxW,h=e.maxH,j=g>=500||h>=300;
a.ctx.restore();var k=d.rect.right()+1,m=new i(k,d.rect.center().y,g,h).snapInside(a.paintableArea().skipRight(10).skipBottom(20));
a.defer(function(){return l.paintGateTooltip(a,m,d.gate,b.time,j)})}},desiredWidth:function(){return this.gateDrawRect(this.toolboxGroups.length-1,5).right()+5;
},desiredHeight:function(){return 4*(2*c.GATE_RADIUS+2)-c.GATE_RADIUS},tryGrab:function(a){var b=this;if(void 0===a.pos||a.isBusy())return a;
var d=this.findGateAt(a.pos);return void 0===d?a:(d.gate.symbol===g&&setTimeout(function(){b.toolboxGroups[d.groupIndex].gates[d.gateIndex]=h();
},.1),a.withHeldGate(d.gate,new j(c.GATE_RADIUS,c.GATE_RADIUS)))},stableDuration:function(a){var b=this;return k(a.hoverPoints()).map(function(a){
return b.findGateAt(a)}).filter(function(a){return void 0!==a}).map(function(a){return a.gate.stableDuration()}).min(1/0)}},{_paintGate:function(a,b,c,f,g){
var h=b.customDrawer||e.DEFAULT_DRAWER;h(new d(a,(!0),f,(!1),(!1),c,b,g,(void 0),[],(void 0)))}})}();return{get DisplayedToolbox(){
return m}}}),$traceurRuntime.registerModule("src/ui/exports.js",[],function(){"use strict";function a(a,c){!function(){var a=document.getElementById("export-button"),b=document.getElementById("export-overlay"),d=document.getElementById("export-div");
a.addEventListener("click",function(){return g.set(!0)}),c.subscribe(function(b){a.disabled=b}),b.addEventListener("click",function(){
return g.set(!1)}),document.addEventListener("keydown",function(a){var b=27;a.keyCode===b&&g.set(!1)}),h.subscribe(function(a){d.style.display=a?"block":"none",
a&&document.getElementById("export-link-copy-button").focus()})}();var i=function(a,b,c){return a.addEventListener("click",function(){
try{d(b),c.innerText="Done!"}catch(e){c.innerText="It didn't work...",console.warn("Clipboard copy failed.",e)}a.disabled=!0,setTimeout(function(){
c.innerText="",a.disabled=!1},1e3)})};!function(){var c=document.getElementById("export-escaped-anchor"),d=document.getElementById("export-link-copy-button"),e=document.getElementById("export-link-copy-result");
i(d,c,e),a.latestActiveCommit().subscribe(function(a){var d="#"+b.URL_CIRCUIT_PARAM_KEY+"="+encodeURIComponent(a);c.href=d,c.innerText=document.location.href.split("#")[0]+d;
})}(),function(){var b=document.getElementById("export-circuit-json-pre"),c=document.getElementById("export-json-copy-button"),d=document.getElementById("export-json-copy-result");
i(c,b,d),a.latestActiveCommit().subscribe(function(a){try{var c=JSON.parse(a);b.innerText=JSON.stringify(c,null,"  ")}catch(d){b.innerText=a;
}})}(),function(){var b,c=document.getElementById("download-offline-copy-button"),d=function(a){try{var b=e(a);if(!b.isEmpty())return"Quirk with Circuit - "+b.readableHash()+".html";
}catch(c){}return"Quirk.html"};a.latestActiveCommit().subscribe(function(a){c.innerText='Download "'+d(a)+'"',b=a}),c.addEventListener("click",function(){
c.disabled=!0,setTimeout(function(){c.disabled=!1},1e3);var a=document.QUIRK_QUINE_ALL_HTML_ORIGINAL,e="//DEFAULT_CIRCUIT_START\n",g="//DEFAULT_CIRCUIT_END\n",h=a.indexOf(e),i=a.indexOf(g,h),j=a.substring(0,h)+e+"document.DEFAULT_CIRCUIT = "+JSON.stringify(b)+";\n"+a.substring(i),k="<!-- Start Analytics -->\n",l=j.indexOf(k);
if(l!==-1){var m="<!-- End Analytics -->\n",n=j.indexOf(m,l);n!==-1&&(j=j.substring(0,l)+k+j.substring(n))}f(d(b),j)})}()}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/exports.js")).Config,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/exports.js")).ObservableValue,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/Clipboard.js","src/ui/exports.js")).selectAndCopyToClipboard,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/exports.js")).fromJsonText_CircuitDefinition,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/SaveFile.js","src/ui/exports.js")).saveFile,g=new c((!1)),h=g.observable().whenDifferent();
return{get initExports(){return a},get obsExportsIsShowing(){return h}}}),$traceurRuntime.registerModule("src/ui/forge.js",[],function(){
"use strict";function a(a,c){function d(a,b,c){c.disabled=!0;var d=new A(a);d.clear();var e=Math.min((a.width-5)/2,a.height),f=new C(0,0,e,e),g=new C(e+5,0,e,e);
try{var h=b();v.paintMatrix(d,h,f,o.OPERATION_FORE_COLOR,"black",void 0,o.OPERATION_BACK_COLOR,void 0,"transparent"),h.isUnitary(.009)?2!==h.width()?d.printParagraph("(Not a 1-qubit rotation)",g,new B(.5,.5),"#666",20):v.paintBlochSphereRotation(d,h,g,o.OPERATION_BACK_COLOR,o.OPERATION_FORE_COLOR):d.printParagraph("NOT UNITARY",g,new B(.5,.5),"red",24);
var i=(f.right()+g.x)/2;d.strokeLine(new B(i,0),new B(i,a.height),"black",2),h.hasNaN()||(c.disabled=!1)}catch(j){d.printParagraph(j+"",new C(0,0,a.width,a.height),new B(.5,.5),"red",24);
}}function f(b){var c=arguments[1],d=c||E(h);a.commit(JSON.stringify(F.toJson(d.withCustomGate(b)),null,0)),J.set(!1)}var h,i=K.filter(function(a){
return a===!0});a.latestActiveCommit().subscribe(function(a){h=a}),function(){var a=document.getElementById("gate-forge-button"),b=document.getElementById("gate-forge-overlay"),d=document.getElementById("gate-forge-div");
a.addEventListener("click",function(){return J.set(!0)}),b.addEventListener("click",function(){return J.set(!1)}),c.subscribe(function(b){
a.disabled=b}),document.addEventListener("keydown",function(a){var b=27;a.keyCode===b&&J.set(!1)}),K.subscribe(function(a){d.style.display=a?"block":"none",
a&&document.getElementById("gate-forge-rotation-axis").focus()})}(),function(){function a(){return e(b(k),b(l),b(j))}var c,g=document.getElementById("gate-forge-rotation-canvas"),h=document.getElementById("gate-forge-rotation-button"),j=document.getElementById("gate-forge-rotation-axis"),k=document.getElementById("gate-forge-rotation-angle"),l=document.getElementById("gate-forge-rotation-phase"),m=document.getElementById("gate-forge-rotation-name");
i.subscribe(function(){m.value=""});var n=function(){return d(g,a,h)};(c=y).of.apply(c,$traceurRuntime.spread([i],[l,j,k].map(H))).flatten().throttleLatest(100).subscribe(n),
h.addEventListener("click",function(){var b;try{b=a()}catch(c){return void console.warn(c)}var d=s.fromKnownMatrix(m.value,b,"Custom Rotation Gate","").withSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32));
f(d)})}(),function(){function a(){var a=b(e),c=h.checked;return g(a,c)}var c=document.getElementById("gate-forge-matrix-canvas"),e=document.getElementById("gate-forge-matrix"),h=document.getElementById("gate-forge-matrix-fix"),j=document.getElementById("gate-forge-matrix-button"),k=document.getElementById("gate-forge-matrix-name");
i.subscribe(function(){k.value=""});var l=function(){return d(c,a,j)};y.of(i,H(e),y.elementEvent(h,"change")).flatten().throttleLatest(100).subscribe(l),
j.addEventListener("click",function(){var b;try{b=a()}catch(c){return void console.warn(c)}var d=k.value.trim(),e=Math.round(Math.log2(b.height())),g=s.fromKnownMatrix(d,b,"Custom Matrix Gate","").withSerializedId("~"+Math.floor(Math.random()*(1<<20)).toString(32)).withHeight(e).withWidth(""===d?e:1);
f(g)})}(),function(){function a(){var a=E(h),c=j(a,b(d),b(e),m.value.trim());return{gate:c,circuit:a}}var c=document.getElementById("gate-forge-circuit-canvas"),d=document.getElementById("gate-forge-circuit-cols"),e=document.getElementById("gate-forge-circuit-rows"),g=document.getElementById("gate-forge-circuit-inputs"),k=document.getElementById("gate-forge-circuit-weight"),l=document.getElementById("gate-forge-circuit-button"),m=document.getElementById("gate-forge-circuit-name");
i.subscribe(function(){m.value=""});var n=new z((void 0)),o=function(a,b){return q(a,b.knownCircuitNested,new C(0,0,c.width,c.height),!0,u());
};n.observable().zipLatest(K,function(a,b){return b?a:void 0}).map(function(a){return void 0===a||a.gate.stableDuration()===1/0?y.of():y.requestAnimationTicker().map(function(b){
return a})}).flattenLatest().subscribe(function(a){var b=new A(c);b.clear(),o(b,a.gate)});var p=function(){l.disabled=!0;var b=new A(c);
b.clear();try{var d=a().gate,e=d.getUnmetContextKeys();g.innerText=0===e.size?"(none)":$traceurRuntime.spread(e).map(function(a){
return a.replace("Input Range ","")}).join(", "),k.innerText=""+d.knownCircuit.gateWeight(),o(b,d),l.disabled=!1,n.set({gate:d})}catch(f){
n.set(void 0),g.innerText="(err)",k.innerText="(err)",b.printParagraph(f+"",new C(0,0,c.width,c.height),new B(.5,.5),"red",24)}};y.of(i,H(d),H(e)).flatten().throttleLatest(100).subscribe(p),
l.addEventListener("click",function(){try{var b=a(),c=b.gate,d=b.circuit;f(c,d)}catch(e){console.warn(e)}})}()}function b(a){return""===a.value?a.placeholder:a.value;
}function c(a){var b=n.parse(a);if(0!==b.imag||isNaN(b.imag))throw new Error("You just had to make it complicated, didn't you?");return b.real*Math.PI/180;
}function d(a){return w.parse(a.toString(new r((!0),1e-7,7,",")))}function e(a,b,e){var f,g,h=c(a),i=c(b),j=k.parse(e),l=j.x,m=j.y,o=j.z,q=Math.sqrt(l*l+m*m+o*o);
l/=q,m/=q,o/=q;var r=[w.identity(2),w.PAULI_X,w.PAULI_Y,w.PAULI_Z],s=(f=r[Symbol.iterator](),(g=f.next()).done?void 0:g.value),t=(g=f.next()).done?void 0:g.value,u=(g=f.next()).done?void 0:g.value,v=(g=f.next()).done?void 0:g.value,x=t.times(l).plus(u.times(m)).plus(v.times(o)),y=s.times(Math.cos(h/2)).plus(x.times(n.I.neg()).times(Math.sin(h/2))).times(n.polar(1,i));
if(y.hasNaN())throw new p("NaN",{x:l,y:m,z:o,result:y});return d(y)}function f(a){var b;if(a.match(/[\{}\[\]]/))return w.parse(a.split(/[\{\[]/).join("{").split(/[}\]]/).join("}"));
a=a.split(/,?\s*\n\s*(?!$)/).join(","),a=a.trim(),a.endsWith(",")&&(a=a.substring(0,a.length-1));var c=a.split(",").map(function(a){
return""===a?0:n.parse(a)}),d=Math.max(4,1<<2*Math.max(1,I.floorLg2(Math.sqrt(c.length))));if(d<c.length&&(d<<=2),d>256)throw Error("Max custom matrix operation size is 4 qubits.");
return(b=w).square.apply(b,$traceurRuntime.spread(c,new Array(d-c.length).fill(0)))}function g(a,b){var c=f(a);if(c.width()!==c.height()||c.width()<2||c.width()>16||!I.isPowerOf2(c.width()))throw Error("Matrix must be 2x2, 4x4, 8x8, or 16x16.");
return b&&!c.hasNaN()&&(c=c.closestUnitary(1e-4),c=d(c)),c}function h(a,b){var c=a.split(":").map(function(a){return a.trim()});if(c.length>2)throw new Error("Too many colons.");
var d=[void 0,"","∞"],e=parseInt(c[0]||"1"),f=d.indexOf(c[1])!==-1?1/0:parseInt(c[1]);if(isNaN(e))throw new Error("Not a number: "+c[0]);
if(isNaN(f))throw new Error("Not a number: "+c[1]);var g=Math.min(b,Math.max(0,e-1)),h=Math.min(b,Math.max(g,f));return{start:g,end:h
}}function i(a){var b=a.columns.length,c=a.numWires;return a.withColumns(G(a.columns).mapWithIndex(function(a,d){return new t(G(a.gates).mapWithIndex(function(a,e){
return void 0===a||d+a.width>b||e+a.height>c?void 0:a}).toArray())}).toArray())}function j(a,b,c,d){var e=h(b,a.columns.length),f=h(c,a.numWires);
if(f.end===f.start)throw new Error("Empty wire range.");var g=a.columns.slice(e.start,e.end).map(function(a){return new t(a.gates.slice(f.start,f.end));
}),j=new l(f.end-f.start,g);if(j=i(j),j=j.withUncoveredColumnsRemoved(),0===j.columns.length)throw new Error("No gates in included range.");
var k=d,n="~"+Math.floor(Math.random()*(1<<20)).toString(32);return m(j,k,n,"A custom gate.").withSerializedId(n)}var k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Axis.js","src/ui/forge.js")).Axis,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/forge.js")).CircuitDefinition,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitComputeUtil.js","src/ui/forge.js")).circuitDefinitionToGate,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Complex.js","src/ui/forge.js")).Complex,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/forge.js")).Config,p=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/forge.js")).DetailedError,q=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/DisplayedCircuit.js","src/ui/forge.js")).drawCircuitTooltip,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Format.js","src/ui/forge.js")).Format,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/ui/forge.js")).Gate,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/forge.js")).GateColumn,u=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/ui/sim.js","src/ui/forge.js")).getCircuitCycleTime,v=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/MathPainter.js","src/ui/forge.js")).MathPainter,w=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/ui/forge.js")).Matrix,x=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/forge.js")),y=x.Observable,z=x.ObservableValue,A=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/draw/Painter.js","src/ui/forge.js")).Painter,B=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/forge.js")).Point,C=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Rect.js","src/ui/forge.js")).Rect,D=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/forge.js")),E=D.fromJsonText_CircuitDefinition,F=D.Serializer,G=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/ui/forge.js")).seq,H=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/EventUtil.js","src/ui/forge.js")).textEditObservable,I=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/forge.js")).Util,J=new z((!1)),K=J.observable().whenDifferent();
return{get initForge(){return a},get obsForgeIsShowing(){return K},get parseUserRotation(){return e},get parseUserMatrix(){return g;
},get parseUserGateFromCircuitRange(){return j}}}),$traceurRuntime.registerModule("src/ui/Hand.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Describe.js","src/ui/Hand.js")).describe,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/ui/Hand.js")).DetailedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Gate.js","src/ui/Hand.js")).Gate,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/GateColumn.js","src/ui/Hand.js")).GateColumn,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Point.js","src/ui/Hand.js")).Point,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/ui/Hand.js")).Util,g=function(){
function g(a,f,g,h,i){if(void 0!==a&&!(a instanceof e))throw new b("Bad pos",{pos:a,heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i
});if(void 0!==f&&!(f instanceof c))throw new b("Bad heldGate",{pos:a,heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i});if(void 0!==g&&!(g instanceof e))throw new b("Bad holdOffset",{
pos:a,heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i});if(void 0!==i&&!(i instanceof e))throw new b("Bad resizingGateSlot",{
pos:a,heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i});if(void 0!==h&&!(h instanceof d))throw new b("Bad heldColumn",{pos:a,
heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i});if(void 0!==f&&void 0!==this.resizingGateSlot)throw new b("Holding AND resizing",{
pos:a,heldGate:f,holdOffset:g,heldColumn:h,resizingGateSlot:i});this.pos=a,this.heldGate=f,this.holdOffset=g,this.heldColumn=h,this.resizingGateSlot=i;
}return $traceurRuntime.createClass(g,{paintCursor:function(a){void 0!==this.heldGate||void 0!==this.heldColumn?a.setDesiredCursor("move"):void 0!==this.resizingGateSlot&&a.setDesiredCursor("ns-resize");
},isBusy:function(){return void 0!==this.heldGate||void 0!==this.heldColumn||void 0!==this.resizingGateSlot},hoverPoints:function(){
return void 0===this.pos||this.isBusy()?[]:[this.pos]},isEqualTo:function(a){return this===a||a instanceof g&&f.CUSTOM_IS_EQUAL_TO_EQUALITY(this.pos,a.pos)&&f.CUSTOM_IS_EQUAL_TO_EQUALITY(this.holdOffset,a.holdOffset)&&f.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldGate,a.heldGate)&&f.CUSTOM_IS_EQUAL_TO_EQUALITY(this.heldColumn,a.heldColumn)&&f.CUSTOM_IS_EQUAL_TO_EQUALITY(this.resizingGateSlot,a.resizingGateSlot);
},toString:function(){return"Hand("+a({pos:this.pos,heldGate:this.heldGate,holdOffset:this.holdOffset,heldColumn:this.heldColumn,
resizingGateSlot:this.resizingGateSlot})},withPos:function(a){return new g(a,this.heldGate,this.holdOffset,this.heldColumn,this.resizingGateSlot);
},withDrop:function(){return new g(this.pos,(void 0),(void 0),(void 0),(void 0))},withHeldGate:function(a,b){return new g(this.pos,a,b,(void 0),(void 0));
},withHeldGateColumn:function(a,b){return new g(this.pos,(void 0),b,a,(void 0))},withResizeSlot:function(a,b){return new g(this.pos,(void 0),b,(void 0),a);
},stableDuration:function(){return void 0!==this.heldGate?this.heldGate.stableDuration():void 0!==this.heldColumn?this.heldColumn.stableDuration():1/0;
}},{})}();return g.EMPTY=new g((void 0),(void 0),(void 0),(void 0),(void 0)),{get Hand(){return g}}}),$traceurRuntime.registerModule("src/ui/menu.js",[],function(){
"use strict";function a(a,b){var e,i;!function(){var a=document.getElementById("menu-button"),e=document.getElementById("close-menu-button"),f=document.getElementById("menu-overlay"),g=document.getElementById("menu-div");
a.addEventListener("click",function(){return c.set(!0)}),b.subscribe(function(b){a.disabled=b}),f.addEventListener("click",function(){
return c.set(!1)}),e.addEventListener("click",function(){return c.set(!1)}),document.addEventListener("keydown",function(a){var b=27;
a.keyCode===b&&c.set(!1)}),d.subscribe(function(a){g.style.display=a?"block":"none",a&&document.getElementById("export-link-copy-button").focus();
})}();var j=document.getElementById("example-anchor-grover"),k=document.getElementById("example-anchor-teleport"),l=document.getElementById("example-anchor-delayed-erasure"),m=!0,n=!1,o=void 0;
try{for(var p=function(){var b=q.value,d=(e=b[Symbol.iterator](),(i=e.next()).done?void 0:i.value),f=(i=e.next()).done?void 0:i.value,g=JSON.stringify(f);
d.href="#circuit="+g,d.onclick=function(b){if(!(b.shiftKey||b.ctrlKey||b.altKey||1!==b.which))return a.commit(g),c.set(!1),!1}},q=void 0,r=[[j,f],[k,g],[l,h]][Symbol.iterator]();!(m=(q=r.next()).done);m=!0)p();
}catch(s){n=!0,o=s}finally{try{m||null==r["return"]||r["return"]()}finally{if(n)throw o}}}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Obs.js","src/ui/menu.js")).ObservableValue,c=new b((!0)),d=c.observable().whenDifferent(),e=function(){
return c.set(!1)},f={cols:[["X","X","X","X","X"],["H","H","H","H","H"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"],["~vn6c"],["⊖","⊖","⊖","⊖","X"],["Chance5"]],
gates:[{id:"~vn6c",name:"Oracle",circuit:{cols:[["Z","•","◦","•","•"]]}}]},g={cols:[[1,"H"],[1,"•",1,1,"X"],["…","…",1,1,"…"],["…","…",1,1,"…"],["e^-iYt"],["X^t"],["Bloch"],["•","X"],["H"],["Measure","Measure"],[1,"•",1,1,"X"],["•",1,1,1,"Z"],[1,1,1,1,"Bloch"]]
},h={cols:[[1,"H"],[1,"•",1,1,"X"],[1,1,"QFT7"],[1,1,"Measure","Measure","Measure","Measure","Measure","Measure","Measure"],["…","…","Chance7"],["…","…"],["…","…"],["…","…"],["H"],["Measure"],["•","X^½"],[1,"Measure"],["◦","◦","Chance7"],["◦","•","Chance7"],["•","◦","Chance7"],["•","•","Chance7"]]
};return{get initMenu(){return a},get obsMenuIsShowing(){return d},get closeMenu(){return e}}}),$traceurRuntime.registerModule("src/ui/sim.js",[],function(){
"use strict";function a(a){if(void 0!==e&&e.circuitDefinition.isEqualTo(a))return e.withTime(d());e=void 0;var b=c.fromCircuitAtTime(a,d());
return a.stableDuration()===1/0&&(e=b),b}var b=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/sim.js")).CircuitDefinition,
$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/sim.js")).Config),c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitStats.js","src/ui/sim.js")).CircuitStats,d=function(){
var a=0,c=performance.now();return function(){var d=performance.now(),e=(d-c)/b.CYCLE_DURATION_MS;return a+=e,a%=1,c=d,a}}(),e=void 0;
return{get simulate(){return a},get getCircuitCycleTime(){return d}}}),$traceurRuntime.registerModule("src/ui/title.js",[],function(){
"use strict";function a(a){var d=function(a){try{var d=c(a);if(!d.isEmpty())return"Quirk: "+d.readableHash()}catch(e){}return b.EMPTY_CIRCUIT_TITLE;
};a.latestActiveCommit().subscribe(function(a){setTimeout(function(){document.title=d(a)},0)})}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/title.js")).Config,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/title.js")).fromJsonText_CircuitDefinition;
return{get initTitleSync(){return a}}}),$traceurRuntime.registerModule("src/ui/undo.js",[],function(){"use strict";function a(a,b){
var c=[document.getElementById("gate-forge-div"),document.getElementById("export-div")],d=document.getElementById("undo-button"),e=document.getElementById("redo-button");
a.latestActiveCommit().zipLatest(b,function(a,b){return b}).subscribe(function(b){d.disabled=a.isAtBeginningOfHistory()||b,e.disabled=a.isAtEndOfHistory()||b;
}),d.addEventListener("click",function(){return a.undo()}),e.addEventListener("click",function(){return a.redo()}),document.addEventListener("keydown",function(b){
var d=!0,e=!1,f=void 0;try{for(var g=void 0,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;if("NONE"!==i.style.display&&"none"!==i.style.display)return;
}}catch(j){e=!0,f=j}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}var k=89,l=90,m=b.keyCode===l&&b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey,n=b.keyCode===l&&b.ctrlKey&&b.shiftKey&&!b.altKey&&!b.metaKey,o=b.keyCode===k&&b.ctrlKey&&!b.shiftKey&&!b.altKey&&!b.metaKey;
m&&(a.undo(),b.preventDefault()),(n||o)&&(a.redo(),b.preventDefault())})}return{get initUndoRedo(){return a}}}),$traceurRuntime.registerModule("src/ui/url.js",[],function(){
"use strict";function a(a){var f=function(){var a=document.location.hash.substr(1),b=new Map;if(""!==a){var c=!0,d=!1,e=void 0;try{
for(var f=void 0,g=a.split("&")[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=h.indexOf("=");if(i!==-1){var j=h.substring(0,i),k=decodeURIComponent(h.substring(i+1));
b.set(j,k)}}}catch(l){d=!0,e=l}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}}return b},i=new e,j=function(){
try{i.currentStateIsMemorableButUnknown();var e=f();if(!e.has(d.URL_CIRCUIT_PARAM_KEY)){var j=document.DEFAULT_CIRCUIT||JSON.stringify(h.toJson(c.EMPTY));
e.set(d.URL_CIRCUIT_PARAM_KEY,j)}var k=e.get(d.URL_CIRCUIT_PARAM_KEY);i.currentStateIsMemorableAndEqualTo(k);var l=g(k),m=JSON.stringify(h.toJson(l));
if(a.clear(m),l.isEmpty()&&1===e.size)i.currentStateIsNotMemorable();else{var n="#"+d.URL_CIRCUIT_PARAM_KEY+"="+k;i.stateChange(k,n);
}}catch(o){b("Defaulted to an empty circuit. Failed to understand circuit from URL.",{document_location_hash:document.location.hash
},o)}};window.addEventListener("popstate",j),j(),a.latestActiveCommit().whenDifferent().skip(1).subscribe(function(a){var b="#"+d.URL_CIRCUIT_PARAM_KEY+"="+a;
i.stateChange(a,b)})}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/fallback.js","src/ui/url.js")).notifyAboutRecoveryFromUnexpectedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/CircuitDefinition.js","src/ui/url.js")).CircuitDefinition,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/ui/url.js")).Config,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/browser/HistoryPusher.js","src/ui/url.js")).HistoryPusher,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/circuit/Serializer.js","src/ui/url.js")),g=f.fromJsonText_CircuitDefinition,h=f.Serializer;
return{get initUrlCircuitSync(){return a}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_Base.js",[],function(){"use strict";
function a(a){var d="_gen_"+a;return new c("\n        ///////////// boolInput("+a+") ////////////\n        uniform sampler2D "+d+"_tex;\n        uniform vec2 "+d+"_size;\n\n        float read_"+a+"(float k) {\n            vec2 uv = vec2(mod(k, "+d+"_size.x) + 0.5,\n                           floor(k / "+d+"_size.x) + 0.5) / "+d+"_size;\n            return float(texture2D("+d+"_tex, uv).x == 1.0);\n        }\n\n        float len_"+a+"() {\n            return "+d+"_size.x * "+d+"_size.y * 4.0;\n        }",[],function(a){
return[b.texture(d+"_tex",a),b.vec2(d+"_size",a.width,a.height)]})}var b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_Base.js")).WglArg,c=function(){
function a(a,b,c){this.code=a,this.libs=b,this.argsFor=c}return $traceurRuntime.createClass(a,{},{})}(),d=function(){function a(a,b,c,d,e,f,g){
this.inputPartGetter=a,this.outputPart=b,this.powerSizeOverhead=c,this.pixelType=d,this.dataToPixels=e,this.pixelsToData=f,this.needRearrangingToBeInVec4Format=g;
}return $traceurRuntime.createClass(a,{arrayPowerSizeOfTexture:function(a){return a.sizePower()-this.powerSizeOverhead}},{})}(),e=function(){
function a(a,b,c,d){this.bool=a,this["float"]=b,this.vec2=c,this.vec4=d}return $traceurRuntime.createClass(a,{},{})}(),f=new c("\n    ///////////// BOOL_OUTPUT_AS_FLOAT ////////////\n    bool outputFor(float k);\n\n    uniform vec2 _gen_output_size;\n    uniform float _gen_secret_half;\n\n    float len_output() {\n        return _gen_output_size.x * _gen_output_size.y;\n    }\n\n    void main() {\n        vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n        float k = xy.y * _gen_output_size.x + xy.x;\n        gl_FragColor = vec4(float(outputFor(k)), 0.0, 0.0, 0.0);\n    }",[],function(a){
return[b.vec2("_gen_output_size",a.width,a.height),b["float"]("_gen_secret_half",.5)]}),g=new d(a,f,0,WebGLRenderingContext.UNSIGNED_BYTE,function(a){
return a},function(a){return a},(!1));return{get SingleTypeCoder(){return d},get ShaderCoder(){return e},get ShaderPart(){return c;
},get BOOL_TYPE_CODER(){return g}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoBytes.js",[],function(){"use strict";
function a(a){if(a instanceof Float64Array)return new Uint8Array(new Float32Array(a).buffer,0,a.length<<2);if(a instanceof Float32Array)return new Uint8Array(a.buffer,0,a.length<<2);
throw new e("Not a Float32Array or Float64Array",{type:"undefined"==typeof a?"undefined":$traceurRuntime["typeof"](a),floats:a})}
function b(a){if(!(a instanceof Uint8Array))throw new e("Not a Uint8Array",{type:"undefined"==typeof a?"undefined":$traceurRuntime["typeof"](a),
bytes:a});return new Float32Array(a.buffer,0,a.length>>2)}function c(a,b){var c=["float","vec2","vec3","vec4"][a-1],d="_gen_"+b;return new i("\n        ///////////// makeByteCoderInput("+a+", "+b+") ////////////\n        uniform sampler2D "+d+"_tex;\n        uniform vec2 "+d+"_size;\n\n        "+c+" read_"+b+"(float k) {\n            k *= "+a+".0;\n            vec2 uv = vec2(mod(k, "+d+"_size.x) + 0.5,\n                           floor(k / "+d+"_size.x) + 0.5) / "+d+"_size;\n\n            "+g.range(a).map(function(a){
return"\n                vec2 uv"+a+" = uv + vec2("+a+".0 / "+d+"_size.x, 0.0);\n                vec4 bytes"+a+" = texture2D("+d+"_tex, uv"+a+");";
}).join("")+"\n\n            return "+c+"("+g.range(a).map(function(a){return"\n                _gen_unpackBytesIntoFloat(bytes"+a+")";
}).join(",")+");\n        }\n\n        float len_"+b+"() {\n            return "+d+"_size.x * "+d+"_size.y / "+a+".0;\n        }",[n],function(a){
if(a.pixelType!==WebGLRenderingContext.UNSIGNED_BYTE)throw new e("vec2Input_Byte requires byte texture",{name:b,texture:a});return[f.texture(d+"_tex",a),f.vec2(d+"_size",a.width,a.height)];
})}function d(a){var b=["float","vec2","vec3","vec4"][a-1];return new i("\n        ///////////// makeByteCoderOutput"+a+" ////////////\n        "+b+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y / "+a+".0;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n            float r = mod(k, "+a+".0);\n            "+(1===a?"float component = outputFor(k);":b+" result = outputFor(floor(k / "+a+".0));\n                 "+b+" picker = "+b+"("+g.range(a).map(function(a){
return"float(r == "+a+".0)"}).join(", ")+");\n                 float component = dot(result, picker);")+"\n            gl_FragColor = _gen_packFloatIntoBytes(component);\n        }",[m],function(a){
return[f.vec2("_gen_output_size",a.width,a.height),f["float"]("_gen_secret_half",.5)]})}var e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/ShaderCoders_intoBytes.js")).DetailedError,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_intoBytes.js")).WglArg,g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/webgl/ShaderCoders_intoBytes.js")).Seq,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders_intoBytes.js")),i=h.ShaderPart,j=h.SingleTypeCoder,k=h.ShaderCoder,l=h.BOOL_TYPE_CODER,m="\n    //////////// PACK_FLOAT_INTO_BYTES /////////////\n    vec4 _gen_packFloatIntoBytes(float val) {\n        if (val == 0.0) {\n            // If log2(0) returns -Infinity, then the logic below would work out just right and this IF block\n            // wouldn't be needed. Unfortunately, log2(0) isn't guaranteed to do that (it's undefined by the spec).\n            return vec4(0.0, 0.0, 0.0, 0.0);\n        }\n\n        float mag = abs(val);\n        float exponent = floor(log2(mag));\n        // Correct log2 approximation errors.\n        exponent += float(exp2(exponent) <= mag / 2.0);\n        exponent -= float(exp2(exponent) > mag);\n\n        float mantissa;\n        if (exponent > 100.0) {\n            // Not sure why this needs to be done in two steps for the largest float to work. Best guess is the\n            // optimizer is rewriting '/ exp2(e)' into '* exp2(-e)', but exp2(-128.0) is too small to represent.\n            mantissa = mag / 1024.0 / exp2(exponent - 10.0) - 1.0;\n        } else {\n            mantissa = mag / float(exp2(exponent)) - 1.0;\n        }\n\n        exponent += 127.0;\n        float a = float(val < 0.0) * 128.0 + floor(exponent / 2.0);\n        mantissa *= 128.0;\n        float b = mod(exponent, 2.0) * 128.0 + floor(mantissa);\n        mantissa -= floor(mantissa);\n        mantissa *= 256.0;\n        float c = floor(mantissa);\n        mantissa -= c;\n        mantissa *= 256.0;\n        float d = floor(mantissa);\n\n        return vec4(d, c, b, a) / 255.0;\n    }",n="\n    //////////// UNPACK_BYTES_INTO_FLOAT_CODE /////////////\n    float _gen_unpackBytesIntoFloat(vec4 v) {\n        float d = floor(v.r * 255.0 + 0.5);\n        float c = floor(v.g * 255.0 + 0.5);\n        float b = floor(v.b * 255.0 + 0.5);\n        float a = floor(v.a * 255.0 + 0.5);\n\n        float sign = floor(a / 128.0);\n        sign = 1.0 - sign * 2.0;\n\n        float exponent = mod(a, 128.0) * 2.0 + floor(b / 128.0) - 127.0;\n        float mantissa = float(exponent > -127.0)\n                       + mod(b, 128.0) / 128.0\n                       + c / 32768.0\n                       + d / 8388608.0;\n        return sign * mantissa * exp2(exponent);\n    }",o=new j(function(a){
return c(1,a)},d(1),0,WebGLRenderingContext.UNSIGNED_BYTE,a,b,(!1)),p=new j(function(a){return c(2,a)},d(2),1,WebGLRenderingContext.UNSIGNED_BYTE,a,b,(!1)),q=new j(function(a){
return c(4,a)},d(4),2,WebGLRenderingContext.UNSIGNED_BYTE,a,b,(!1)),r=new k(l,o,p,q);return{get SHADER_CODER_BYTES(){return r},get floatsAsBytes(){
return a},get bytesAsFloats(){return b},get UNPACK_BYTES_INTO_FLOAT_CODE(){return n},get PACK_FLOAT_INTO_BYTES_CODE(){return m}}}),
$traceurRuntime.registerModule("src/webgl/ShaderCoders_intoFloats.js",[],function(){"use strict";function a(a,b){var c=["float","vec2","vec3","vec4"][a-1],d="_gen_"+b;
return new i("\n        ///////////// makeFloatCoderInput("+a+", "+b+") ////////////\n        uniform sampler2D "+d+"_tex;\n        uniform vec2 "+d+"_size;\n\n        "+c+" read_"+b+"(float k) {\n            vec2 uv = vec2(mod(k, "+d+"_size.x) + 0.5,\n                           floor(k / "+d+"_size.x) + 0.5) / "+d+"_size;\n            return texture2D("+d+"_tex, uv)."+"xyzw".substring(0,a)+";\n        }\n\n        float len_"+b+"() {\n            return "+d+"_size.x * "+d+"_size.y;\n        }",[],function(c){
if(c.pixelType!==WebGLRenderingContext.FLOAT)throw new g("vecInput"+a+"_Float requires float texture",{name:b,texture:c});return[m.texture(d+"_tex",c),m.vec2(d+"_size",c.width,c.height)];
})}function b(a){var b=["float","vec2","vec3","vec4"][a-1],c=["vec4(v, 0.0, 0.0, 0.0)","vec4(v.x, v.y, 0.0, 0.0)","vec4(v.x, v.y, v.z, 0.0)","v"][a-1];
return new i("\n        ///////////// makeFloatCoderOutput"+a+" ////////////\n        "+b+" outputFor(float k);\n\n        uniform vec2 _gen_output_size;\n        uniform float _gen_secret_half;\n\n        float len_output() {\n            return _gen_output_size.x * _gen_output_size.y;\n        }\n\n        void main() {\n            vec2 xy = gl_FragCoord.xy - vec2(_gen_secret_half, _gen_secret_half);\n            float k = xy.y * _gen_output_size.x + xy.x;\n\n            "+b+" v = outputFor(k);\n\n            gl_FragColor = "+c+";\n        }",[],function(a){
return[m.vec2("_gen_output_size",a.width,a.height),m["float"]("_gen_secret_half",.5)]})}function c(a){for(var b=new Float32Array(a.length<<2),c=0;c<a.length;c++)b[4*c]=a[c];
return b}function d(a){for(var b=new Float32Array(a.length<<1),c=0;2*c<a.length;c++)b[4*c]=a[2*c],b[4*c+1]=a[2*c+1];return b}function e(a){
for(var b=new Float32Array(a.length>>2),c=0;c<b.length;c++)b[c]=a[4*c];return b}function f(a){for(var b=new Float32Array(a.length>>1),c=0;2*c<b.length;c++)b[2*c]=a[4*c],
b[2*c+1]=a[4*c+1];return b}var g=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/ShaderCoders_intoFloats.js")).DetailedError,h=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders_intoFloats.js")),i=h.ShaderPart,j=h.SingleTypeCoder,k=h.ShaderCoder,l=h.BOOL_TYPE_CODER,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders_intoFloats.js")).WglArg,n=new j(function(b){
return a(1,b)},b(1),0,WebGLRenderingContext.FLOAT,c,e,(!0)),o=new j(function(b){return a(2,b)},b(2),0,WebGLRenderingContext.FLOAT,d,f,(!0)),p=new j(function(b){
return a(4,b)},b(4),0,WebGLRenderingContext.FLOAT,function(a){return a},function(a){return a},(!1)),q=new k(l,n,o,p);return{get SHADER_CODER_FLOATS(){
return q}}}),$traceurRuntime.registerModule("src/webgl/ShaderCoders.js",[],function(){"use strict";function a(a,b){var c=a.map(function(a){
return a instanceof r?new u(function(b){return a},"fixed"):a}),d=function(){var a=new Set,d=!0,e=!1,f=void 0;try{for(var g=void 0,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){
var i=g.value,j=!0,k=!1,l=void 0;try{for(var m=void 0,n=i.toConcretePart().libs[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value;
a.add(o)}}catch(p){k=!0,l=p}finally{try{j||null==n["return"]||n["return"]()}finally{if(k)throw l}}}}catch(q){e=!0,f=q}finally{try{
d||null==h["return"]||h["return"]()}finally{if(e)throw f}}var r=$traceurRuntime.spread(a,c.map(function(a){return a.toConcretePart().code;
})).join("");return r+"\n//////// tail ////////\n"+b};return new l(d)}function b(b,d,e){var f=a($traceurRuntime.spread(b,[d]),e);return function(){
for(var a,e,g=[],h=0;h<arguments.length;h++)g[h]=arguments[h];for(var i=[],j=0;j<b.length;j++)(a=i).push.apply(a,$traceurRuntime.spread(b[j].toConcretePart().argsFor(g[j])));
return(e=i).push.apply(e,$traceurRuntime.spread(g.slice(b.length))),c(f,d.toConcretePart(),i)}}function c(a,b,c){return new q(function(d){
var e;return(e=a).withArgs.apply(e,$traceurRuntime.spread(c,b.argsFor(d))).renderTo(d)})}function d(){return x}function e(){return y;
}function f(a){try{n().invalidateExistingResources()}catch(b){}x=a,y=a}function g(){var a=new m(1,1,WebGLRenderingContext.FLOAT),b=new l("void main() { gl_FragColor = vec4(2.0, 3.5, 7.0, -7654321.0); }");
try{b.withArgs().renderTo(a);var c=a.readPixels(!1);return c instanceof Float32Array&&4===c.length&&2===c[0]&&3.5===c[1]&&7===c[2]&&c[3]===-7654321;
}catch(d){return console.warn(d),!1}finally{a.ensureDeinitialized(),b.ensureDeinitialized()}}function h(){var a=new m(1,1,WebGLRenderingContext.FLOAT),b=new m(1,1,WebGLRenderingContext.UNSIGNED_BYTE),c=new l("void main() { gl_FragColor = vec4(1.1, 3.0, 5.0, -7654321.0); }"),d=new l("uniform sampler2D t; void main() {\n        vec4 v = texture2D(t, gl_FragCoord.xy);\n        if (v == vec4(2.0, 3.0, 5.0, -7654321.0)) { // Testing that expected precision is present.\n            gl_FragColor = vec4(2.0, 3.0, 5.0, 254.0) / 255.0;\n        } else {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n    }");
try{c.withArgs().renderTo(a),d.withArgs(k.texture("t",a)).renderTo(b);var e=b.readPixels(!1);return e instanceof Uint8Array&&4===e.length&&2===e[0]&&3===e[1]&&5===e[2]&&254===e[3];
}catch(f){return console.warn(f),!1}finally{a.ensureDeinitialized(),b.ensureDeinitialized(),c.ensureDeinitialized(),d.ensureDeinitialized();
}}function i(){g()?(x=t,y=t):h()?(console.warn("Wrote but failed to read a floating point texture. Falling back to float-as-byte output coding."),
x=t,y=s):(console.warn("Failed to write a floating point texture. Falling back to float-as-byte coding everywhere."),x=s,y=s)}function j(){
return void 0===z&&(z=g()),z}var k=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/ShaderCoders.js")).WglArg,l=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglShader.js","src/webgl/ShaderCoders.js")).WglShader,m=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/ShaderCoders.js")).WglTexture,n=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/ShaderCoders.js")).initializedWglContext,o=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/ShaderCoders.js")),p=o.provideWorkingShaderCoderToWglConfiguredShader,q=o.WglConfiguredShader,r=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_Base.js","src/webgl/ShaderCoders.js")).ShaderPart,s=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_intoBytes.js","src/webgl/ShaderCoders.js")).SHADER_CODER_BYTES,t=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders_intoFloats.js","src/webgl/ShaderCoders.js")).SHADER_CODER_FLOATS,u=function(){
function a(a,b){this._partMaker=a,this.description=b}return $traceurRuntime.createClass(a,{toConcretePart:function(){var a=arguments[0];
return this._partMaker(a||d())},toString:function(){return"ShaderPartDescription("+this.description+")"}},{})}(),v=function(){function a(){}
return $traceurRuntime.createClass(a,{},{bool:function(a){return new u(function(b){return b.bool.inputPartGetter(a)},"Inputs.bool("+a+")");
},"float":function(a){return new u(function(b){return b["float"].inputPartGetter(a)},"Inputs.float("+a+")")},vec2:function(a){return new u(function(b){
return b.vec2.inputPartGetter(a)},"Inputs.vec2("+a+")")},vec4:function(a){return new u(function(b){return b.vec4.inputPartGetter(a);
},"Inputs.vec4("+a+")")}})}(),w=function(){function a(){}return $traceurRuntime.createClass(a,{},{bool:function(){return new u(function(a){
return a.bool.outputPart},"Outputs.bool()")},"float":function(){return new u(function(a){return a["float"].outputPart},"Outputs.float()");
},vec2:function(){return new u(function(a){return a.vec2.outputPart},"Outputs.vec2()")},vec4:function(){return new u(function(a){
return a.vec4.outputPart},"Outputs.vec4()")},vec4WithOutputCoder:function(){return new u(function(a){return e().vec4.outputPart},"Outputs.vec4WithOutputCoder()");
}})}(),x=t,y=s,z=void 0;return i(),p(d),{get combinedShaderPartsWithCode(){return a},get shaderWithOutputPartAndArgs(){return c},
get currentShaderCoder(){return d},get makePseudoShaderWithInputsAndOutputAndCode(){return b},get changeShaderCoder(){return f},get Inputs(){
return v},get Outputs(){return w},get outputShaderCoder(){return e},get canTestFloatShaders(){return j}}}),$traceurRuntime.registerModule("src/webgl/Shaders.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/Shaders.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/Shaders.js")).WglArg,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/Shaders.js")).initializedWglContext,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglShader.js","src/webgl/Shaders.js")).WglShader,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/Shaders.js")).WglConfiguredShader,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/webgl/Shaders.js")),g=f.currentShaderCoder,h=f.Inputs,i=f.Outputs,j=f.makePseudoShaderWithInputsAndOutputAndCode,k=function(){
function a(){}return $traceurRuntime.createClass(a,{},{})}();k.color=function(a,c,d,e){return l.withArgs(b.vec4("color",a,c,d,e));
};var l=new d("\n    uniform vec4 color;\n    void main() {\n        gl_FragColor = color;\n    }");k.passthrough=function(c){return new e(function(d){
if(d.width!==c.width||d.height!==c.height||d.pixelType!==c.pixelType)throw new a("Expected same-shaped textures.",{inp:c,dst:d});m.withArgs(b.vec2("textureSize",c.width,c.height),b.texture("dataTexture",c)).renderTo(d);
})};var m=new d("\n    uniform vec2 textureSize;\n    uniform sampler2D dataTexture;\n    void main() {\n        gl_FragColor = texture2D(dataTexture, gl_FragCoord.xy / textureSize.xy);\n    }");
return k.data=function(d){return new e(function(e){var f,g,h=[e.width,e.height],i=(f=h[Symbol.iterator](),(g=f.next()).done?void 0:g.value),j=(g=f.next()).done?void 0:g.value;
if(d.length!==i*j*4)throw new a("rgbaData.length isn't w * h * 4",{w:i,h:j,len:d.length,rgbaData:d});var k=WebGLRenderingContext,l=c().gl,n=l.createTexture();
try{l.bindTexture(WebGLRenderingContext.TEXTURE_2D,n),l.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.NEAREST),l.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.NEAREST),
l.texImage2D(k.TEXTURE_2D,0,k.RGBA,i,j,0,k.RGBA,d instanceof Uint8Array?k.UNSIGNED_BYTE:k.FLOAT,d),m.withArgs(b.vec2("textureSize",i,j),b.webGlTexture("dataTexture",n)).renderTo(e);
}finally{l.deleteTexture(n)}})},k.vec2Data=function(a){return k.data(g().vec2.dataToPixels(a))},k.vec4Data=function(a){return k.data(g().vec4.dataToPixels(a));
},k.packFloatIntoVec4=j([h["float"]("input")],i.vec4(),"vec4 outputFor(float k) {\n        return vec4(\n            read_input(k*4.0),\n            read_input(k*4.0 + 1.0),\n            read_input(k*4.0 + 2.0),\n            read_input(k*4.0 + 3.0));\n    }"),
k.packVec2IntoVec4=j([h.vec2("input")],i.vec4(),"vec4 outputFor(float k) { return vec4(read_input(k*2.0), read_input(k*2.0 + 1.0)); }"),
k.sumFoldFloat=j([h["float"]("input")],i["float"](),"float outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),
k.sumFoldVec2=j([h.vec2("input")],i.vec2(),"vec2 outputFor(float k) {\n         return read_input(k) + read_input(k + len_output());\n     }"),
k.sumFoldVec4=j([h.vec4("input")],i.vec4(),"vec4 outputFor(float k) {\n        return read_input(k) + read_input(k + len_output());\n    }"),
k.convertVec4CodingForOutput=j([h.vec4("input")],i.vec4WithOutputCoder(),"vec4 outputFor(float k) { return read_input(k); }"),{get Shaders(){
return k}}}),$traceurRuntime.registerModule("src/webgl/WglArg.js",[],function(){"use strict";var a=function(){function a(a,b,c){this.type=a,
this.name=b,this.value=c}return $traceurRuntime.createClass(a,{toString:function(){return this.type+" "+this.name+" = "+JSON.stringify(this.value);
}},{bool:function(b,c){return new a(a.BOOL_TYPE,b,c)},"float":function(b,c){return new a(a.FLOAT_TYPE,b,c)},"int":function(b,c){return new a(a.INT_TYPE,b,c);
},vec2:function(b,c,d){return new a(a.VEC2_TYPE,b,[c,d])},float_array:function(b,c){return c instanceof Float64Array&&(c=new Float32Array(c)),
new a(a.FLOAT_ARRAY_TYPE,b,c)},vec2_array:function(b,c){return c instanceof Float64Array&&(c=new Float32Array(c)),new a(a.VEC2_ARRAY_TYPE,b,c);
},vec4_array:function(b,c){return c instanceof Float64Array&&(c=new Float32Array(c)),new a(a.VEC4_ARRAY_TYPE,b,c)},mat4_array:function(b,c){
return c instanceof Float64Array&&(c=new Float32Array(c)),new a(a.MAT4_ARRAY_TYPE,b,c)},vec4:function(b,c,d,e,f){return new a(a.VEC4_TYPE,b,[c,d,e,f]);
},mat4:function(b,c){return new a(a.MAT4_TYPE,b,c)},texture:function(b,c){return new a(a.WGL_TEXTURE_TYPE,b,c)},webGlTexture:function(b,c){
return new a(a.WEB_GL_TEXTURE_TYPE,b,c)}})}();return a.BOOL_TYPE="bool",a.FLOAT_TYPE="float",a.INT_TYPE="int",a.VEC2_TYPE="vec2",
a.FLOAT_ARRAY_TYPE="float[]",a.VEC2_ARRAY_TYPE="vec2[]",a.VEC4_ARRAY_TYPE="vec4[]",a.MAT4_ARRAY_TYPE="mat4[]",a.VEC4_TYPE="vec4",
a.MAT4_TYPE="mat4",a.WGL_TEXTURE_TYPE="wgl_texture",a.WEB_GL_TEXTURE_TYPE="web_gl_texture",a.INPUT_ACTION_MAP=new Map([[a.BOOL_TYPE,function(a,b,c){
return a.gl.uniform1f(b,c?1:0)}],[a.INT_TYPE,function(a,b,c){return a.gl.uniform1i(b,c)}],[a.FLOAT_TYPE,function(a,b,c){return a.gl.uniform1f(b,c);
}],[a.VEC2_TYPE,function(a,b,c){var d,e,f=c,g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value;
return a.gl.uniform2f(b,g,h)}],[a.FLOAT_ARRAY_TYPE,function(a,b,c){return a.gl.uniform1fv(b,c)}],[a.VEC2_ARRAY_TYPE,function(a,b,c){
return a.gl.uniform2fv(b,c)}],[a.VEC4_ARRAY_TYPE,function(a,b,c){return a.gl.uniform4fv(b,c)}],[a.MAT4_ARRAY_TYPE,function(a,b,c){
return a.gl.uniformMatrix4fv(b,!1,c)}],[a.VEC4_TYPE,function(a,b,c){var d,e,f=c,g=(d=f[Symbol.iterator](),(e=d.next()).done?void 0:e.value),h=(e=d.next()).done?void 0:e.value,i=(e=d.next()).done?void 0:e.value,j=(e=d.next()).done?void 0:e.value;
return a.gl.uniform4f(b,g,h,i,j)}],[a.MAT4_TYPE,function(a,b,c){return a.gl.uniformMatrix4fv(b,!1,c)}],[a.WGL_TEXTURE_TYPE,function(a,b,c,d){
var e=d.coopTextureUnit++;if(e>=a.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+e+" but max "+("is "+a.maxTextureUnits+"."));
if(c.width>a.maxTextureSize||c.height>a.maxTextureSize)throw new Error("Uniform texture argument is "+c.width+"x"+c.height+", but max "+("texture diameter is "+a.maxTextureSize+"."));
var f=a.gl;f.uniform1i(b,e),f.activeTexture(WebGLRenderingContext.TEXTURE0+e),f.bindTexture(WebGLRenderingContext.TEXTURE_2D,c.initializedTexture());
}],[a.WEB_GL_TEXTURE_TYPE,function(a,b,c,d){var e=d.coopTextureUnit++;if(e>=a.maxTextureUnits)throw new Error("Uniform texture argument uses texture unit "+e+" but max "+("is "+a.maxTextureUnits+"."));
var f=a.gl;f.uniform1i(b,e),f.activeTexture(WebGLRenderingContext.TEXTURE0+e),f.bindTexture(WebGLRenderingContext.TEXTURE_2D,c)}]]),
{get WglArg(){return a}}}),$traceurRuntime.registerModule("src/webgl/WglConfiguredShader.js",[],function(){"use strict";function a(a){
e=a}function b(a){c=a}var c,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/math/Matrix.js","src/webgl/WglConfiguredShader.js")).Matrix,e=($traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglConfiguredShader.js")).WglTexture,
void 0),f=function(){function a(a){this.renderToFunc=a}return $traceurRuntime.createClass(a,{renderTo:function(b){var c=this.renderToFunc(b);
if(c instanceof a)throw new Error("Returned a WglConfiguredShader instead of calling renderTo on it.")},_renderToElseDealloc:function(a){
var b=!1;try{this.renderTo(a),b=!0}finally{b||a.deallocByDepositingInPool("_renderToElseDealloc")}},_renderReadDealloc:function(a){
try{return this.renderTo(a),a.readPixels()}finally{a.deallocByDepositingInPool()}},toRawByteTexture:function(a){var b=c.takeRawByteTex(a);
return this._renderToElseDealloc(b),b},toRawFloatTexture:function(a){var b=c.takeRawFloatTex(a);return this._renderToElseDealloc(b),
b},readRawFloatOutputs:function(a){return this._renderReadDealloc(c.takeRawFloatTex(a))},readRawByteOutputs:function(a){return this._renderReadDealloc(c.takeRawByteTex(a));
},readBoolOutputs:function(a){for(var b=this._renderReadDealloc(c.takeBoolTex(a)),d=new Uint8Array(b.length>>2),e=0;e<d.length;e++)d[e]=1&b[e<<2];
return d},readVecFloatOutputs:function(a){return e()["float"].pixelsToData(this._renderReadDealloc(c.takeVecFloatTex(a)))},readVec2Outputs:function(a){
return e().vec2.pixelsToData(this._renderReadDealloc(c.takeVec2Tex(a)))},readVec2OutputsAsKet:function(a){return new d(1,1<<a,this.readVec2Outputs(a));
},readVec4Outputs:function(a){return e().vec4.pixelsToData(this._renderReadDealloc(c.takeVec4Tex(a)))},toVecFloatTexture:function(a){
var b=c.takeVecFloatTex(a);return this._renderToElseDealloc(b),b},toVec2Texture:function(a){var b=c.takeVec2Tex(a);return this._renderToElseDealloc(b),
b},toVec4Texture:function(a){var b=c.takeVec4Tex(a);return this._renderToElseDealloc(b),b},toBoolTexture:function(a){var b=c.takeBoolTex(a);
return this._renderToElseDealloc(b),b}},{})}();return{get WglConfiguredShader(){return f},get provideWorkingShaderCoderToWglConfiguredShader(){
return a},get provideWglTexturePoolToWglConfiguredShader(){return b}}}),$traceurRuntime.registerModule("src/webgl/WglContext.js",[],function(){
"use strict";function a(){return void 0===c&&(c=new b),c}var b=function(){function a(){var a=this;if(this.canvas=document.createElement("canvas"),
this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),null===this.gl)throw new Error("Error creating WebGL context.");
void 0===this.gl.getExtension("OES_texture_float")&&console.warn("OES_texture_float webgl extension not present."),void 0===this.gl.getExtension("WEBGL_color_buffer_float")&&console.warn("WEBGL_color_buffer_float webgl extension not present."),
this.onContextRestored=void 0,this.lifetimeCounter=0,this.canvas.addEventListener("webglcontextrestored",function(b){b.preventDefault(),
a.recomputeProperties(),void 0!==a.onContextRestored&&a.onContextRestored()},!1),this.canvas.addEventListener("webglcontextlost",function(b){
b.preventDefault(),a.lifetimeCounter++},!1),this.recomputeProperties()}return $traceurRuntime.createClass(a,{invalidateExistingResources:function(){
this.lifetimeCounter++},recomputeProperties:function(){this.lifetimeCounter++,this.maxTextureUnits=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_IMAGE_UNITS),
this.maxTextureSize=this.gl.getParameter(WebGLRenderingContext.MAX_TEXTURE_SIZE),this.maximumShaderFloatPrecision=this._getMaximumShaderFloatPrecision();
},_getMaximumShaderFloatPrecision:function(){var a=this.gl,b=WebGLRenderingContext,c=function(c,d){var e=a.getShaderPrecisionFormat(c,d);
return a.getError()===b.NO_ERROR&&void 0!==e&&null!==e&&e.precision>0},d=c(b.VERTEX_SHADER,b.HIGH_FLOAT)&&c(b.FRAGMENT_SHADER,b.HIGH_FLOAT);
if(d)return"highp";console.warn("WebGL high precision not available.");var e=c(b.VERTEX_SHADER,b.MEDIUM_FLOAT)&&c(b.FRAGMENT_SHADER,b.MEDIUM_FLOAT);
return e?"mediump":(console.warn("WebGL medium precision not available."),"lowp")}},{})}(),c=void 0;return{get initializedWglContext(){
return a}}}),$traceurRuntime.registerModule("src/webgl/WglMortalValueSlot.js",[],function(){"use strict";var a=function(){function a(a,b){
this.initializer=a,this.deinitializer=b,this.lifetimeId=void 0,this.mortalValue=void 0}return $traceurRuntime.createClass(a,{initializedValue:function(a){
return this.lifetimeId!==a&&(this.ensureDeinitialized(),this.mortalValue=this.initializer(),this.lifetimeId=a),this.mortalValue},
ensureInitialized:function(a){this.initializedValue(a)},ensureDeinitialized:function(){if(void 0!==this.lifetimeId){var a=this.mortalValue;
this.lifetimeId=void 0,this.mortalValue=void 0,this.deinitializer(a)}}},{})}();return{get WglMortalValueSlot(){return a}}}),$traceurRuntime.registerModule("src/webgl/WglShader.js",[],function(){
"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/webgl/WglShader.js")).Config,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglShader.js")).DetailedError,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglArg.js","src/webgl/WglShader.js")).WglArg,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/WglShader.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglMortalValueSlot.js","src/webgl/WglShader.js")).WglMortalValueSlot,f=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglUtil.js","src/webgl/WglShader.js")),g=f.checkGetErrorResult,h=f.checkFrameBufferStatusResult,i=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Seq.js","src/webgl/WglShader.js")).Seq,j=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglShader.js")).WglConfiguredShader,k=new e(function(){
var a=WebGLRenderingContext,b=d().gl,c=b.createBuffer(),e=new Float32Array([-1,1,1,1,-1,-1,1,-1]);b.bindBuffer(a.ARRAY_BUFFER,c),
b.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);var f=b.createBuffer(),g=new Uint16Array([0,2,1,2,3,1]);return b.bindBuffer(a.ELEMENT_ARRAY_BUFFER,f),
b.bufferData(a.ELEMENT_ARRAY_BUFFER,g,a.STATIC_DRAW),{positionBuffer:c,indexBuffer:f}},function(){}),l=function(){function a(a){if("string"==typeof a){
var b=a;a=function(){return b}}this.fragmentShaderSourceGenerator=a,this._compiledShaderSlot=void 0}return $traceurRuntime.createClass(a,{
withArgs:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=this;if(void 0===this._compiledShaderSlot){var f=a.map(function(a){
return a.name});this._compiledShaderSlot=new e(function(){return new m(c.fragmentShaderSourceGenerator(),f)},function(a){return a.free();
})}return new j(function(b){if(0!==b.width&&0!==b.height){var e=WebGLRenderingContext,f=d(),i=f.gl;k.ensureInitialized(f.lifetimeCounter),
i.bindFramebuffer(e.FRAMEBUFFER,b.initializedFramebuffer()),g(i,"framebufferTexture2D",!0),h(i,!0),c._compiledShaderSlot.initializedValue(f.lifetimeCounter).useWithArgs(a),
i.viewport(0,0,b.width,b.height),i.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),g(i,"drawElements",!0),b.markRendered()}})},ensureDeinitialized:function(){
void 0!==this._compiledShaderSlot&&this._compiledShaderSlot.ensureDeinitialized()},toString:function(){return"WglShader(fragmentShaderSource: "+this.fragmentShaderSourceGenerator()+")";
}},{})}(),m=function(){function e(b,c){var f=d(),g=f.maximumShaderFloatPrecision,h="\n            precision "+g+" float;\n            precision "+g+" int;\n            attribute vec2 position;\n            void main() {\n              gl_Position = vec4(position, 0, 1);\n            }",j="\n            precision "+g+" float;\n            precision "+g+" int;\n            "+b,k=WebGLRenderingContext,l=f.gl,m=e.compileShader(l,k.VERTEX_SHADER,h),n=e.compileShader(l,k.FRAGMENT_SHADER,j),o=l.createProgram();
l.attachShader(o,m),l.attachShader(o,n),l.linkProgram(o);var p=l.getProgramInfoLog(o);if(""!==p&&"\0"!==p&&a.SUPPRESSED_GLSL_WARNING_PATTERNS.every(function(a){
return!a.test(p)})&&console.warn("Shader compile caused warnings","gl.getProgramInfoLog()",p),l.getProgramParameter(o,k.LINK_STATUS)===!1)throw new Error("Failed to link shader program.\n\ngl.VALIDATE_STATUS: "+l.getProgramParameter(o,k.VALIDATE_STATUS)+"\ngl.getError(): "+l.getError());
l.deleteShader(m),l.deleteShader(n),this.uniformLocations=new i(c).toMap(function(a){return a},function(a){return l.getUniformLocation(o,a);
}),this.positionAttributeLocation=l.getAttribLocation(o,"position"),this.program=o}return $traceurRuntime.createClass(e,{useWithArgs:function(a){
var e=d(),f=e.gl;f.useProgram(this.program);var g={coopTextureUnit:0},h=!0,i=!1,j=void 0;try{for(var k=void 0,l=a[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){
var m=k.value,n=this.uniformLocations.get(m.name);if(void 0===n)throw new b("Unexpected uniform argument",{arg:m,uniformArgs:a});c.INPUT_ACTION_MAP.get(m.type)(e,n,m.value,g);
}}catch(o){i=!0,j=o}finally{try{h||null==l["return"]||l["return"]()}finally{if(i)throw j}}f.enableVertexAttribArray(this.positionAttributeLocation),
f.vertexAttribPointer(this.positionAttributeLocation,2,WebGLRenderingContext.FLOAT,!1,0,0)},free:function(){var a=d().gl;a.deleteProgram(this.program);
}},{compileShader:function(a,b,c){var d=a.createShader(b);a.shaderSource(d,c),a.compileShader(d);var e=a.getShaderInfoLog(d);if(""!==e&&(console.warn("WebGLShader: gl.getShaderInfoLog() wasn't empty: "+a.getShaderInfoLog(d)),
console.warn("Source code was: "+c)),a.getShaderParameter(d,WebGLRenderingContext.COMPILE_STATUS)===!1)throw new Error("WebGLShader: Shader compile failed.\n                Info: "+e+"\n                Source: "+c);
return d}})}();return{get WglShader(){return l}}}),$traceurRuntime.registerModule("src/webgl/WglTexture.js",[],function(){"use strict";
var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglTexture.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/Util.js","src/webgl/WglTexture.js")).Util,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglMortalValueSlot.js","src/webgl/WglTexture.js")).WglMortalValueSlot,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglContext.js","src/webgl/WglTexture.js")).initializedWglContext,e=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglUtil.js","src/webgl/WglTexture.js")),f=e.checkGetErrorResult,g=e.checkFrameBufferStatusResult,h=function(){
function e(d,f){var g=void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.FLOAT,h=this;if(0===d&&0===f)return this.width=0,this.height=0,
this.pixelType=g,this._hasBeenRenderedTo=!0,void(this._textureAndFrameBufferSlot=new c(function(){throw new a("Touched a zero-size texture.",h);
},function(){throw new a("Touched a zero-size texture.",h)}));if(!b.isPowerOf2(d)||!b.isPowerOf2(f))throw new a("Sizes must be a power of 2.",{
width:d,height:f,pixelType:g});this.width=d,this.height=f,this.pixelType=g,this._hasBeenRenderedTo=!1,this._textureAndFrameBufferSlot=new c(function(){
return h._textureAndFramebufferInitializer()},function(a){return e._deinitialize(a)})}return $traceurRuntime.createClass(e,{sizePower:function(){
return 0===this.width?-(1/0):Math.round(Math.log2(this.width*this.height))},toString:function(){return"Texture("+[this.width+"x"+this.height,this.pixelType,this._hasBeenRenderedTo?"rendered":"not rendered"].join(", ")+")";
},markRendered:function(){this._hasBeenRenderedTo=!0},invalidateButMoveToNewInstance:function(b){var d=new e(this.width,this.height,this.pixelType);
d._textureAndFrameBufferSlot=this._textureAndFrameBufferSlot;var f=function(){throw new a("WglTexture's value accessed after invalidation.",b);
};return this._textureAndFrameBufferSlot=new c(f,f),d},initializedTexture:function(){if(!this._hasBeenRenderedTo)throw new Error("Called initializedTexture on a texture that hasn't been rendered to.");
return this._textureAndFrameBufferSlot.initializedValue(d().lifetimeCounter).texture},initializedFramebuffer:function(){return this._textureAndFrameBufferSlot.initializedValue(d().lifetimeCounter).framebuffer;
},ensureDeinitialized:function(){this._textureAndFrameBufferSlot.ensureDeinitialized()},_textureAndFramebufferInitializer:function(){
var a=WebGLRenderingContext,b=d().gl,c={texture:b.createTexture(),framebuffer:b.createFramebuffer()};b.bindTexture(a.TEXTURE_2D,c.texture),
b.bindFramebuffer(a.FRAMEBUFFER,c.framebuffer);try{b.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),b.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),
b.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),b.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),b.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,this.pixelType,null),
f(b,"texImage2D"),b.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,c.texture,0),f(b,"framebufferTexture2D"),
g(b)}finally{b.bindTexture(a.TEXTURE_2D,null),b.bindFramebuffer(a.FRAMEBUFFER,null)}return c},readPixels:function(){var a=void 0===arguments[0]||arguments[0],b=WebGLRenderingContext;
if(!this._hasBeenRenderedTo)throw new Error("Called readPixels on a texture that hasn't been rendered to.");var c;switch(this.pixelType){
case b.UNSIGNED_BYTE:c=new Uint8Array(this.width*this.height*4);break;case b.FLOAT:c=new Float32Array(this.width*this.height*4);break;
default:throw new Error("Unrecognized pixel type.")}if(0===this.width||0===this.height)return c;var e=d().gl;return e.bindFramebuffer(b.FRAMEBUFFER,this.initializedFramebuffer()),
f(e,"framebufferTexture2D",a),g(e,a),e.readPixels(0,0,this.width,this.height,b.RGBA,this.pixelType,c),f(e,"readPixels(..., RGBA, "+this.pixelType+", ...)",a),
c}},{preferredWidthHeightForSizePower:function(a){var b=1<<Math.ceil(a/2),c=1<<Math.floor(a/2);return 2===b&&2===c&&(b=4,c=1),{w:b,
h:c}},_deinitialize:function(a){var b=a,c=b.texture,e=b.framebuffer,f=d().gl;f.deleteTexture(c),f.deleteFramebuffer(e)}})}();return{
get WglTexture(){return h}}}),$traceurRuntime.registerModule("src/webgl/WglTexturePool.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/base/DetailedError.js","src/webgl/WglTexturePool.js")).DetailedError,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglTexturePool.js")).WglTexture,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglTexturePool.js")).provideWglTexturePoolToWglConfiguredShader,d=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/ShaderCoders.js","src/webgl/WglTexturePool.js")).currentShaderCoder,e=[],f=[],g=0,h=function(){
function c(){}return $traceurRuntime.createClass(c,{},{_bucketFor:function(b,c){if(!Number.isInteger(b)||b<0||b>50)throw new a("Bad sizePower",{
sizePower:b,pixelType:c});for(var d=c===WebGLRenderingContext.FLOAT?e:f;d.length<=b;)d.push([]);return d[b]},take:function(a,d){if(a===-(1/0))return new b(0,0,d);
var e=c._bucketFor(a,d);if(g++,g>1e3&&console.warn("High borrowed texture count: "+g+". (Maybe a leak?)"),e.length>0)return e.pop();
var f=b.preferredWidthHeightForSizePower(a),h=f.w,i=f.h;return new b(h,i,d)},deposit:function(d){var e=void 0!==arguments[1]?arguments[1]:"[no dealloc details]";
if(!(d instanceof b))throw new a("Not a texture",{texture:d,detailsShownWhenUsedAfterDone:e});if(0!==d.width){var f=c._bucketFor(d.sizePower(),d.pixelType);
g--,f.push(d.invalidateButMoveToNewInstance(e))}},takeSame:function(a){return c.take(a.sizePower(),a.pixelType)},getUnReturnedTextureCount:function(){
return g},takeRawFloatTex:function(a){return c.take(a,WebGLRenderingContext.FLOAT)},takeRawByteTex:function(a){return c.take(a,WebGLRenderingContext.UNSIGNED_BYTE);
},takeBoolTex:function(a){return c.take(a,WebGLRenderingContext.UNSIGNED_BYTE)},takeVecFloatTex:function(a){return c.take(a+d()["float"].powerSizeOverhead,d()["float"].pixelType);
},takeVec2Tex:function(a){return c.take(a+d().vec2.powerSizeOverhead,d().vec2.pixelType)},takeVec4Tex:function(a){return c.take(a+d().vec4.powerSizeOverhead,d().vec4.pixelType);
}})}();return b.prototype.deallocByDepositingInPool=function(){var a=arguments[0];h.deposit(this,a)},c(h),{get WglTexturePool(){return h;
}}}),$traceurRuntime.registerModule("src/webgl/WglTextureTrader.js",[],function(){"use strict";var a=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglConfiguredShader.js","src/webgl/WglTextureTrader.js")).WglConfiguredShader,b=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexture.js","src/webgl/WglTextureTrader.js")).WglTexture,c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/webgl/WglTexturePool.js","src/webgl/WglTextureTrader.js")).WglTexturePool,d=function(){
function b(a){this.currentTexture=a,this._dontDeallocFlag=!1}return $traceurRuntime.createClass(b,{dontDeallocCurrentTexture:function(){
return this._dontDeallocFlag=!0,this.currentTexture},shadeAndTrade:function(b){var d=arguments[1],e=this.currentTexture,f=!this._dontDeallocFlag,g=d||c.takeSame(e),h=b instanceof a?b:b(e);
h.renderTo(g),this.currentTexture=g,this._dontDeallocFlag=!1,f&&e.deallocByDepositingInPool("WglTexturePool shadeAndTrade")},shadeHalveAndTrade:function(a){
this.shadeAndTrade(a,c.take(Math.max(0,this.currentTexture.sizePower()-1),this.currentTexture.pixelType))},shadeQuarterAndTrade:function(a){
this.shadeAndTrade(a,c.take(Math.max(0,this.currentTexture.sizePower()-2),this.currentTexture.pixelType))}},{})}();return b.prototype.tradeThrough=function(a){
var b=void 0!==arguments[1]&&arguments[1],c=new d(this);return b&&c.dontDeallocCurrentTexture(),a(c),c.currentTexture},{get WglTextureTrader(){
return d}}}),$traceurRuntime.registerModule("src/webgl/WglUtil.js",[],function(){"use strict";function a(a,b){var d,e=void 0!==arguments[2]&&arguments[2];
if(!e||c.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var f=a.getError(),g=WebGLRenderingContext;if(f!==g.NO_ERROR){var h=(d={},Object.defineProperty(d,1280,{
value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d,1281,{value:"INVALID_VALUE [+constant not found]",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d,1282,{value:"INVALID_OPERATION [+constant not found]",configurable:!0,
enumerable:!0,writable:!0}),Object.defineProperty(d,1285,{value:"OUT_OF_MEMORY [+constant not found]",configurable:!0,enumerable:!0,
writable:!0}),Object.defineProperty(d,1286,{value:"INVALID_FRAMEBUFFER_OPERATION [+constant not found]",configurable:!0,enumerable:!0,
writable:!0}),Object.defineProperty(d,37442,{value:"CONTEXT_LOST_WEBGL [+constant not found]",configurable:!0,enumerable:!0,writable:!0
}),Object.defineProperty(d,g.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d,g.INVALID_VALUE,{
value:"INVALID_VALUE",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d,g.INVALID_OPERATION,{value:"INVALID_OPERATION",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(d,g.OUT_OF_MEMORY,{value:"OUT_OF_MEMORY",configurable:!0,enumerable:!0,
writable:!0}),Object.defineProperty(d,g.INVALID_FRAMEBUFFER_OPERATION,{value:"INVALID_FRAMEBUFFER_OPERATION",configurable:!0,enumerable:!0,
writable:!0}),Object.defineProperty(d,g.CONTEXT_LOST_WEBGL,{value:"CONTEXT_LOST_WEBGL",configurable:!0,enumerable:!0,writable:!0}),
d),i=void 0!==h[f]?h[f]:"?";throw new Error("gl.getError() returned 0x"+f.toString(16)+" ("+i+") after "+b+".")}}}function b(a){var b,d=void 0!==arguments[1]&&arguments[1];
if(!d||c.CHECK_WEB_GL_ERRORS_EVEN_ON_HOT_PATHS){var e=WebGLRenderingContext,f=a.checkFramebufferStatus(e.FRAMEBUFFER);if(f!==e.FRAMEBUFFER_COMPLETE){
var g=(b={},Object.defineProperty(b,0,{value:"Argument wasn't a frame buffer",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,1280,{
value:"INVALID_ENUM [+constant not found]",configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,36054,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT [+constant not found]",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,36055,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT [+constant not found]",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,36057,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS [+constant not found]",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,36061,{value:"FRAMEBUFFER_UNSUPPORTED [+constant not found]",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,e.INVALID_ENUM,{value:"INVALID_ENUM",configurable:!0,enumerable:!0,
writable:!0}),Object.defineProperty(b,e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",configurable:!0,
enumerable:!0,writable:!0}),Object.defineProperty(b,e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT,{value:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS,{value:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",
configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(b,e.FRAMEBUFFER_UNSUPPORTED,{value:"FRAMEBUFFER_UNSUPPORTED",configurable:!0,
enumerable:!0,writable:!0}),b),h=void 0!==g[f]?g[f]:"?";throw new Error("gl.checkFramebufferStatus() returned 0x"+f.toString(16)+" ("+h+").");
}}}var c=$traceurRuntime.getModule($traceurRuntime.normalizeModuleName("src/Config.js","src/webgl/WglUtil.js")).Config;return{get checkGetErrorResult(){
return a},get checkFrameBufferStatusResult(){return b}}}),$traceurRuntime.getModule("src/main.js");

        </script>
    </body>
</html>
